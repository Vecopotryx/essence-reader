var zo=Object.defineProperty;var No=(t,e,n)=>e in t?zo(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Ho=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Yr=(t,e,n)=>(No(t,typeof e!="symbol"?e+"":e,n),n);var Nl=Ho((Ul,Fo)=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerpolicy&&(a.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?a.credentials="include":i.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(i){if(i.ep)return;i.ep=!0;const a=n(i);fetch(i.href,a)}})();function N(){}const In=t=>t;function Z(t,e){for(const n in e)t[n]=e[n];return t}function zi(t){return t()}function qr(){return Object.create(null)}function xe(t){t.forEach(zi)}function it(t){return typeof t=="function"}function ve(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let rn;function Gr(t,e){return rn||(rn=document.createElement("a")),rn.href=e,t===rn.href}function Uo(t){return Object.keys(t).length===0}function jo(t,...e){if(t==null)return N;const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function Vo(t,e,n){t.$$.on_destroy.push(jo(e,n))}function St(t,e,n,r){if(t){const i=Ni(t,e,n,r);return t[0](i)}}function Ni(t,e,n,r){return t[1]&&r?Z(n.ctx.slice(),t[1](r(e))):n.ctx}function xt(t,e,n,r){if(t[2]&&r){const i=t[2](r(n));if(e.dirty===void 0)return i;if(typeof i=="object"){const a=[],o=Math.max(e.dirty.length,i.length);for(let s=0;s<o;s+=1)a[s]=e.dirty[s]|i[s];return a}return e.dirty|i}return e.dirty}function Ct(t,e,n,r,i,a){if(i){const o=Ni(e,n,r,a);t.p(o,i)}}function Bt(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let r=0;r<n;r++)e[r]=-1;return e}return-1}function _e(t){const e={};for(const n in t)n[0]!=="$"&&(e[n]=t[n]);return e}function be(t,e){const n={};e=new Set(e);for(const r in t)!e.has(r)&&r[0]!=="$"&&(n[r]=t[r]);return n}function Qr(t){return t==null?"":t}function Wo(t){return t&&it(t.destroy)?t.destroy:N}const Hi=typeof window<"u";let Ar=Hi?()=>window.performance.now():()=>Date.now(),Sr=Hi?t=>requestAnimationFrame(t):N;const ct=new Set;function Ui(t){ct.forEach(e=>{e.c(t)||(ct.delete(e),e.f())}),ct.size!==0&&Sr(Ui)}function xr(t){let e;return ct.size===0&&Sr(Ui),{promise:new Promise(n=>{ct.add(e={c:t,f:n})}),abort(){ct.delete(e)}}}function S(t,e){t.appendChild(e)}function ji(t){if(!t)return document;const e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function Yo(t){const e=D("style");return qo(ji(t),e),e.sheet}function qo(t,e){return S(t.head||t,e),e.sheet}function T(t,e,n){t.insertBefore(e,n||null)}function C(t){t.parentNode&&t.parentNode.removeChild(t)}function Go(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function D(t){return document.createElement(t)}function X(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function Y(t){return document.createTextNode(t)}function H(){return Y(" ")}function Cr(){return Y("")}function ee(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function M(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function we(t,e){for(const n in e)M(t,n,e[n])}function Qo(t){return t===""?null:+t}function Xo(t){return Array.from(t.childNodes)}function ie(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function Xr(t,e){t.value=e==null?"":e}function Q(t,e,n,r){n===null?t.style.removeProperty(e):t.style.setProperty(e,n,r?"important":"")}function Jr(t,e){for(let n=0;n<t.options.length;n+=1){const r=t.options[n];if(r.__value===e){r.selected=!0;return}}t.selectedIndex=-1}function Jo(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}function Zo(t,e,{bubbles:n=!1,cancelable:r=!1}={}){const i=document.createEvent("CustomEvent");return i.initCustomEvent(t,n,r,e),i}const bn=new Map;let wn=0;function $o(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}function ea(t,e){const n={stylesheet:Yo(e),rules:{}};return bn.set(t,n),n}function kn(t,e,n,r,i,a,o,s=0){const u=16.666/r;let l=`{
`;for(let v=0;v<=1;v+=u){const w=e+(n-e)*a(v);l+=v*100+`%{${o(w,1-w)}}
`}const c=l+`100% {${o(n,1-n)}}
}`,d=`__svelte_${$o(c)}_${s}`,h=ji(t),{stylesheet:m,rules:p}=bn.get(h)||ea(h,t);p[d]||(p[d]=!0,m.insertRule(`@keyframes ${d} ${c}`,m.cssRules.length));const f=t.style.animation||"";return t.style.animation=`${f?`${f}, `:""}${d} ${r}ms linear ${i}ms 1 both`,wn+=1,d}function En(t,e){const n=(t.style.animation||"").split(", "),r=n.filter(e?a=>a.indexOf(e)<0:a=>a.indexOf("__svelte")===-1),i=n.length-r.length;i&&(t.style.animation=r.join(", "),wn-=i,wn||ta())}function ta(){Sr(()=>{wn||(bn.forEach(t=>{const{ownerNode:e}=t.stylesheet;e&&C(e)}),bn.clear())})}function na(t,e,n,r){if(!e)return N;const i=t.getBoundingClientRect();if(e.left===i.left&&e.right===i.right&&e.top===i.top&&e.bottom===i.bottom)return N;const{delay:a=0,duration:o=300,easing:s=In,start:u=Ar()+a,end:l=u+o,tick:c=N,css:d}=n(t,{from:e,to:i},r);let h=!0,m=!1,p;function f(){d&&(p=kn(t,0,1,o,a,s,d)),a||(m=!0)}function v(){d&&En(t,p),h=!1}return xr(w=>{if(!m&&w>=u&&(m=!0),m&&w>=l&&(c(1,0),v()),!h)return!1;if(m){const _=w-u,g=0+1*s(_/o);c(g,1-g)}return!0}),f(),c(0,1),v}function ra(t){const e=getComputedStyle(t);if(e.position!=="absolute"&&e.position!=="fixed"){const{width:n,height:r}=e,i=t.getBoundingClientRect();t.style.position="absolute",t.style.width=n,t.style.height=r,ia(t,i)}}function ia(t,e){const n=t.getBoundingClientRect();if(e.left!==n.left||e.top!==n.top){const r=getComputedStyle(t),i=r.transform==="none"?"":r.transform;t.style.transform=`${i} translate(${e.left-n.left}px, ${e.top-n.top}px)`}}let Ft;function Tt(t){Ft=t}function oa(){if(!Ft)throw new Error("Function called outside component initialization");return Ft}function Br(t){oa().$$.on_mount.push(t)}const kt=[],ze=[],fn=[],Xn=[],aa=Promise.resolve();let Jn=!1;function sa(){Jn||(Jn=!0,aa.then(Vi))}function ke(t){fn.push(t)}function Lt(t){Xn.push(t)}const zn=new Set;let on=0;function Vi(){const t=Ft;do{for(;on<kt.length;){const e=kt[on];on++,Tt(e),ua(e.$$)}for(Tt(null),kt.length=0,on=0;ze.length;)ze.pop()();for(let e=0;e<fn.length;e+=1){const n=fn[e];zn.has(n)||(zn.add(n),n())}fn.length=0}while(kt.length);for(;Xn.length;)Xn.pop()();Jn=!1,zn.clear(),Tt(t)}function ua(t){if(t.fragment!==null){t.update(),xe(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(ke)}}let wt;function Wi(){return wt||(wt=Promise.resolve(),wt.then(()=>{wt=null})),wt}function Rt(t,e,n){t.dispatchEvent(Zo(`${e?"intro":"outro"}${n}`))}const dn=new Set;let Ke;function pt(){Ke={r:0,c:[],p:Ke}}function mt(){Ke.r||xe(Ke.c),Ke=Ke.p}function z(t,e){t&&t.i&&(dn.delete(t),t.i(e))}function U(t,e,n,r){if(t&&t.o){if(dn.has(t))return;dn.add(t),Ke.c.push(()=>{dn.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}const Yi={duration:0};function zt(t,e,n){let r=e(t,n),i=!1,a,o,s=0;function u(){a&&En(t,a)}function l(){const{delay:d=0,duration:h=300,easing:m=In,tick:p=N,css:f}=r||Yi;f&&(a=kn(t,0,1,h,d,m,f,s++)),p(0,1);const v=Ar()+d,w=v+h;o&&o.abort(),i=!0,ke(()=>Rt(t,!0,"start")),o=xr(_=>{if(i){if(_>=w)return p(1,0),Rt(t,!0,"end"),u(),i=!1;if(_>=v){const g=m((_-v)/h);p(g,1-g)}}return i})}let c=!1;return{start(){c||(c=!0,En(t),it(r)?(r=r(),Wi().then(l)):l())},invalidate(){c=!1},end(){i&&(u(),i=!1)}}}function An(t,e,n,r){let i=e(t,n),a=r?0:1,o=null,s=null,u=null;function l(){u&&En(t,u)}function c(h,m){const p=h.b-a;return m*=Math.abs(p),{a,b:h.b,d:p,duration:m,start:h.start,end:h.start+m,group:h.group}}function d(h){const{delay:m=0,duration:p=300,easing:f=In,tick:v=N,css:w}=i||Yi,_={start:Ar()+m,b:h};h||(_.group=Ke,Ke.r+=1),o||s?s=_:(w&&(l(),u=kn(t,a,h,p,m,f,w)),h&&v(0,1),o=c(_,p),ke(()=>Rt(t,h,"start")),xr(g=>{if(s&&g>s.start&&(o=c(s,p),s=null,Rt(t,o.b,"start"),w&&(l(),u=kn(t,a,o.b,o.duration,0,f,i.css))),o){if(g>=o.end)v(a=o.b,1-a),Rt(t,o.b,"end"),s||(o.b?l():--o.group.r||xe(o.group.c)),o=null;else if(g>=o.start){const b=g-o.start;a=o.a+o.d*f(b/o.duration),v(a,1-a)}}return!!(o||s)}))}return{run(h){it(i)?Wi().then(()=>{i=i(),d(h)}):d(h)},end(){l(),o=s=null}}}const la=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function ca(t,e){U(t,1,1,()=>{e.delete(t.key)})}function fa(t,e){t.f(),ca(t,e)}function da(t,e,n,r,i,a,o,s,u,l,c,d){let h=t.length,m=a.length,p=h;const f={};for(;p--;)f[t[p].key]=p;const v=[],w=new Map,_=new Map;for(p=m;p--;){const k=d(i,a,p),x=n(k);let A=o.get(x);A?r&&A.p(k,e):(A=l(x,k),A.c()),w.set(x,v[p]=A),x in f&&_.set(x,Math.abs(p-f[x]))}const g=new Set,b=new Set;function y(k){z(k,1),k.m(s,c),o.set(k.key,k),c=k.first,m--}for(;h&&m;){const k=v[m-1],x=t[h-1],A=k.key,E=x.key;k===x?(c=k.first,h--,m--):w.has(E)?!o.has(A)||g.has(A)?y(k):b.has(E)?h--:_.get(A)>_.get(E)?(b.add(A),y(k)):(g.add(E),h--):(u(x,o),h--)}for(;h--;){const k=t[h];w.has(k.key)||u(k,o)}for(;m;)y(v[m-1]);return v}function ot(t,e){const n={},r={},i={$$scope:1};let a=t.length;for(;a--;){const o=t[a],s=e[a];if(s){for(const u in o)u in s||(r[u]=1);for(const u in s)i[u]||(n[u]=s[u],i[u]=1);t[a]=s}else for(const u in o)i[u]=1}for(const o in r)o in n||(n[o]=void 0);return n}function Nt(t,e,n){const r=t.$$.props[e];r!==void 0&&(t.$$.bound[r]=n,n(t.$$.ctx[r]))}function oe(t){t&&t.c()}function te(t,e,n,r){const{fragment:i,after_update:a}=t.$$;i&&i.m(e,n),r||ke(()=>{const o=t.$$.on_mount.map(zi).filter(it);t.$$.on_destroy?t.$$.on_destroy.push(...o):xe(o),t.$$.on_mount=[]}),a.forEach(ke)}function ne(t,e){const n=t.$$;n.fragment!==null&&(xe(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function ha(t,e){t.$$.dirty[0]===-1&&(kt.push(t),sa(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function ge(t,e,n,r,i,a,o,s=[-1]){const u=Ft;Tt(t);const l=t.$$={fragment:null,ctx:[],props:a,update:N,not_equal:i,bound:qr(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(u?u.$$.context:[])),callbacks:qr(),dirty:s,skip_bound:!1,root:e.target||u.$$.root};o&&o(l.root);let c=!1;if(l.ctx=n?n(t,e.props||{},(d,h,...m)=>{const p=m.length?m[0]:h;return l.ctx&&i(l.ctx[d],l.ctx[d]=p)&&(!l.skip_bound&&l.bound[d]&&l.bound[d](p),c&&ha(t,d)),h}):[],l.update(),c=!0,xe(l.before_update),l.fragment=r?r(l.ctx):!1,e.target){if(e.hydrate){const d=Xo(e.target);l.fragment&&l.fragment.l(d),d.forEach(C)}else l.fragment&&l.fragment.c();e.intro&&z(t.$$.fragment),te(t,e.target,e.anchor,e.customElement),Vi()}Tt(u)}class ye{$destroy(){ne(this,1),this.$destroy=N}$on(e,n){if(!it(n))return N;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!Uo(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.
Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.
THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var V=function(){return V=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},V.apply(this,arguments)};function Zn(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,a;r<i;r++)(a||!(r in e))&&(a||(a=Array.prototype.slice.call(e,0,r)),a[r]=e[r]);return t.concat(a||Array.prototype.slice.call(e))}var q=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,re=Object.keys,de=Array.isArray;typeof Promise<"u"&&!q.Promise&&(q.Promise=Promise);function me(t,e){return typeof e!="object"||re(e).forEach(function(n){t[n]=e[n]}),t}var Ht=Object.getPrototypeOf,pa={}.hasOwnProperty;function Ae(t,e){return pa.call(t,e)}function dt(t,e){typeof e=="function"&&(e=e(Ht(t))),(typeof Reflect>"u"?re:Reflect.ownKeys)(e).forEach(function(n){Ne(t,n,e[n])})}var qi=Object.defineProperty;function Ne(t,e,n,r){qi(t,e,me(n&&Ae(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function vt(t){return{from:function(e){return t.prototype=Object.create(e.prototype),Ne(t.prototype,"constructor",t),{extend:dt.bind(null,t.prototype)}}}}var ma=Object.getOwnPropertyDescriptor;function Tr(t,e){var n=ma(t,e),r;return n||(r=Ht(t))&&Tr(r,e)}var va=[].slice;function Pn(t,e,n){return va.call(t,e,n)}function Gi(t,e){return e(t)}function Et(t){if(!t)throw new Error("Assertion Failed")}function Qi(t){q.setImmediate?setImmediate(t):setTimeout(t,0)}function Xi(t,e){return t.reduce(function(n,r,i){var a=e(r,i);return a&&(n[a[0]]=a[1]),n},{})}function ga(t,e,n){try{t.apply(null,n)}catch(r){e&&e(r)}}function Le(t,e){if(Ae(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var n=[],r=0,i=e.length;r<i;++r){var a=Le(t,e[r]);n.push(a)}return n}var o=e.indexOf(".");if(o!==-1){var s=t[e.substr(0,o)];return s===void 0?void 0:Le(s,e.substr(o+1))}}function Te(t,e,n){if(!(!t||e===void 0)&&!("isFrozen"in Object&&Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){Et(typeof n!="string"&&"length"in n);for(var r=0,i=e.length;r<i;++r)Te(t,e[r],n[r])}else{var a=e.indexOf(".");if(a!==-1){var o=e.substr(0,a),s=e.substr(a+1);if(s==="")n===void 0?de(t)&&!isNaN(parseInt(o))?t.splice(o,1):delete t[o]:t[o]=n;else{var u=t[o];(!u||!Ae(t,o))&&(u=t[o]={}),Te(u,s,n)}}else n===void 0?de(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=n}}function ya(t,e){typeof e=="string"?Te(t,e,void 0):"length"in e&&[].map.call(e,function(n){Te(t,n,void 0)})}function Ji(t){var e={};for(var n in t)Ae(t,n)&&(e[n]=t[n]);return e}var _a=[].concat;function Zi(t){return _a.apply([],t)}var $i="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Zi([8,16,32,64].map(function(t){return["Int","Uint","Float"].map(function(e){return e+t+"Array"})}))).filter(function(t){return q[t]}),ba=$i.map(function(t){return q[t]});Xi($i,function(t){return[t,!0]});var Ve=null;function Xt(t){Ve=typeof WeakMap<"u"&&new WeakMap;var e=$n(t);return Ve=null,e}function $n(t){if(!t||typeof t!="object")return t;var e=Ve&&Ve.get(t);if(e)return e;if(de(t)){e=[],Ve&&Ve.set(t,e);for(var n=0,r=t.length;n<r;++n)e.push($n(t[n]))}else if(ba.indexOf(t.constructor)>=0)e=t;else{var i=Ht(t);e=i===Object.prototype?{}:Object.create(i),Ve&&Ve.set(t,e);for(var a in t)Ae(t,a)&&(e[a]=$n(t[a]))}return e}var wa={}.toString;function er(t){return wa.call(t).slice(8,-1)}var tr=typeof Symbol<"u"?Symbol.iterator:"@@iterator",ka=typeof tr=="symbol"?function(t){var e;return t!=null&&(e=t[tr])&&e.apply(t)}:function(){return null},lt={};function Pe(t){var e,n,r,i;if(arguments.length===1){if(de(t))return t.slice();if(this===lt&&typeof t=="string")return[t];if(i=ka(t)){for(n=[];r=i.next(),!r.done;)n.push(r.value);return n}if(t==null)return[t];if(e=t.length,typeof e=="number"){for(n=new Array(e);e--;)n[e]=t[e];return n}return[t]}for(e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];return n}var Rr=typeof Symbol<"u"?function(t){return t[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Me=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function eo(t,e){Me=t,to=e}var to=function(){return!0},Ea=!new Error("").stack;function at(){if(Ea)try{throw at.arguments,new Error}catch(t){return t}return new Error}function nr(t,e){var n=t.stack;return n?(e=e||0,n.indexOf(t.name)===0&&(e+=(t.name+t.message).split(`
`).length),n.split(`
`).slice(e).filter(to).map(function(r){return`
`+r}).join("")):""}var Aa=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"],no=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Or=Aa.concat(no),Sa={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function gt(t,e){this._e=at(),this.name=t,this.message=e}vt(gt).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+nr(this._e,2))}},toString:function(){return this.name+": "+this.message}});function ro(t,e){return t+". Errors: "+Object.keys(e).map(function(n){return e[n].toString()}).filter(function(n,r,i){return i.indexOf(n)===r}).join(`
`)}function Sn(t,e,n,r){this._e=at(),this.failures=e,this.failedKeys=r,this.successCount=n,this.message=ro(t,e)}vt(Sn).from(gt);function Ot(t,e){this._e=at(),this.name="BulkError",this.failures=Object.keys(e).map(function(n){return e[n]}),this.failuresByPos=e,this.message=ro(t,e)}vt(Ot).from(gt);var Mr=Or.reduce(function(t,e){return t[e]=e+"Error",t},{}),xa=gt,K=Or.reduce(function(t,e){var n=e+"Error";function r(i,a){this._e=at(),this.name=n,i?typeof i=="string"?(this.message=""+i+(a?`
 `+a:""),this.inner=a||null):typeof i=="object"&&(this.message=i.name+" "+i.message,this.inner=i):(this.message=Sa[e]||n,this.inner=null)}return vt(r).from(xa),t[e]=r,t},{});K.Syntax=SyntaxError;K.Type=TypeError;K.Range=RangeError;var Zr=no.reduce(function(t,e){return t[e+"Error"]=K[e],t},{});function Ca(t,e){if(!t||t instanceof gt||t instanceof TypeError||t instanceof SyntaxError||!t.name||!Zr[t.name])return t;var n=new Zr[t.name](e||t.message,t);return"stack"in t&&Ne(n,"stack",{get:function(){return this.inner.stack}}),n}var Kn=Or.reduce(function(t,e){return["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=K[e]),t},{});Kn.ModifyError=Sn;Kn.DexieError=gt;Kn.BulkError=Ot;function W(){}function Jt(t){return t}function Ba(t,e){return t==null||t===Jt?e:function(n){return e(t(n))}}function tt(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function Ta(t,e){return t===W?e:function(){var n=t.apply(this,arguments);n!==void 0&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var a=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?tt(r,this.onsuccess):r),i&&(this.onerror=this.onerror?tt(i,this.onerror):i),a!==void 0?a:n}}function Ra(t,e){return t===W?e:function(){t.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?tt(n,this.onsuccess):n),r&&(this.onerror=this.onerror?tt(r,this.onerror):r)}}function Oa(t,e){return t===W?e:function(n){var r=t.apply(this,arguments);me(n,r);var i=this.onsuccess,a=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?tt(i,this.onsuccess):i),a&&(this.onerror=this.onerror?tt(a,this.onerror):a),r===void 0?o===void 0?void 0:o:me(r,o)}}function Ma(t,e){return t===W?e:function(){return e.apply(this,arguments)===!1?!1:t.apply(this,arguments)}}function Dr(t,e){return t===W?e:function(){var n=t.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,i=arguments.length,a=new Array(i);i--;)a[i]=arguments[i];return n.then(function(){return e.apply(r,a)})}return e.apply(this,arguments)}}var Ut={},Da=100,Ia=20,io=100,Ir=typeof Promise>"u"?[]:function(){var t=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[t,Ht(t),t];var e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,Ht(e),t]}(),rr=Ir[0],xn=Ir[1],ir=Ir[2],oo=xn&&xn.then,hn=rr&&rr.constructor,Pr=!!ir,or=!1,Pa=ir?function(){ir.then(an)}:q.setImmediate?setImmediate.bind(null,an):q.MutationObserver?function(){var t=document.createElement("div");new MutationObserver(function(){an(),t=null}).observe(t,{attributes:!0}),t.setAttribute("i","1")}:function(){setTimeout(an,0)},jt=function(t,e){At.push([t,e]),Cn&&(Pa(),Cn=!1)},ar=!0,Cn=!0,$e=[],pn=[],sr=null,ur=Jt,ft={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ti,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(function(t){try{ti(t[0],t[1])}catch{}})}},I=ft,At=[],et=0,mn=[];function R(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=W,this._lib=!1;var e=this._PSD=I;if(Me&&(this._stackHolder=at(),this._prev=null,this._numPrev=0),typeof t!="function"){if(t!==Ut)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&cr(this,this._value);return}this._state=null,this._value=null,++e.ref,so(this,t)}var lr={get:function(){var t=I,e=Bn;function n(r,i){var a=this,o=!t.global&&(t!==I||e!==Bn),s=o&&!He(),u=new R(function(l,c){Kr(a,new ao(Rn(r,t,o,s),Rn(i,t,o,s),l,c,t))});return Me&&co(u,this),u}return n.prototype=Ut,n},set:function(t){Ne(this,"then",t&&t.prototype===Ut?lr:{get:function(){return t},set:lr.set})}};dt(R.prototype,{then:lr,_then:function(t,e){Kr(this,new ao(null,null,t,e,I))},catch:function(t){if(arguments.length===1)return this.then(null,t);var e=arguments[0],n=arguments[1];return typeof e=="function"?this.then(null,function(r){return r instanceof e?n(r):vn(r)}):this.then(null,function(r){return r&&r.name===e?n(r):vn(r)})},finally:function(t){return this.then(function(e){return t(),e},function(e){return t(),vn(e)})},stack:{get:function(){if(this._stack)return this._stack;try{or=!0;var t=lo(this,[],Ia),e=t.join(`
From previous: `);return this._state!==null&&(this._stack=e),e}finally{or=!1}}},timeout:function(t,e){var n=this;return t<1/0?new R(function(r,i){var a=setTimeout(function(){return i(new K.Timeout(e))},t);n.then(r,i).finally(clearTimeout.bind(null,a))}):this}});typeof Symbol<"u"&&Symbol.toStringTag&&Ne(R.prototype,Symbol.toStringTag,"Dexie.Promise");ft.env=fo();function ao(t,e,n,r,i){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=n,this.reject=r,this.psd=i}dt(R,{all:function(){var t=Pe.apply(null,arguments).map(Tn);return new R(function(e,n){t.length===0&&e([]);var r=t.length;t.forEach(function(i,a){return R.resolve(i).then(function(o){t[a]=o,--r||e(t)},n)})})},resolve:function(t){if(t instanceof R)return t;if(t&&typeof t.then=="function")return new R(function(n,r){t.then(n,r)});var e=new R(Ut,!0,t);return co(e,sr),e},reject:vn,race:function(){var t=Pe.apply(null,arguments).map(Tn);return new R(function(e,n){t.map(function(r){return R.resolve(r).then(e,n)})})},PSD:{get:function(){return I},set:function(t){return I=t}},totalEchoes:{get:function(){return Bn}},newPSD:qe,usePSD:_t,scheduler:{get:function(){return jt},set:function(t){jt=t}},rejectionMapper:{get:function(){return ur},set:function(t){ur=t}},follow:function(t,e){return new R(function(n,r){return qe(function(i,a){var o=I;o.unhandleds=[],o.onunhandled=a,o.finalize=tt(function(){var s=this;Fa(function(){s.unhandleds.length===0?i():a(s.unhandleds[0])})},o.finalize),t()},e,n,r)})}});hn&&(hn.allSettled&&Ne(R,"allSettled",function(){var t=Pe.apply(null,arguments).map(Tn);return new R(function(e){t.length===0&&e([]);var n=t.length,r=new Array(n);t.forEach(function(i,a){return R.resolve(i).then(function(o){return r[a]={status:"fulfilled",value:o}},function(o){return r[a]={status:"rejected",reason:o}}).then(function(){return--n||e(r)})})})}),hn.any&&typeof AggregateError<"u"&&Ne(R,"any",function(){var t=Pe.apply(null,arguments).map(Tn);return new R(function(e,n){t.length===0&&n(new AggregateError([]));var r=t.length,i=new Array(r);t.forEach(function(a,o){return R.resolve(a).then(function(s){return e(s)},function(s){i[o]=s,--r||n(new AggregateError(i))})})})}));function so(t,e){try{e(function(n){if(t._state===null){if(n===t)throw new TypeError("A promise cannot be resolved with itself.");var r=t._lib&&Zt();n&&typeof n.then=="function"?so(t,function(i,a){n instanceof R?n._then(i,a):n.then(i,a)}):(t._state=!0,t._value=n,uo(t)),r&&$t()}},cr.bind(null,t))}catch(n){cr(t,n)}}function cr(t,e){if(pn.push(e),t._state===null){var n=t._lib&&Zt();e=ur(e),t._state=!1,t._value=e,Me&&e!==null&&typeof e=="object"&&!e._promise&&ga(function(){var r=Tr(e,"stack");e._promise=t,Ne(e,"stack",{get:function(){return or?r&&(r.get?r.get.apply(e):r.value):t.stack}})}),La(t),uo(t),n&&$t()}}function uo(t){var e=t._listeners;t._listeners=[];for(var n=0,r=e.length;n<r;++n)Kr(t,e[n]);var i=t._PSD;--i.ref||i.finalize(),et===0&&(++et,jt(function(){--et===0&&Fr()},[]))}function Kr(t,e){if(t._state===null){t._listeners.push(e);return}var n=t._state?e.onFulfilled:e.onRejected;if(n===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++et,jt(Ka,[n,t,e])}function Ka(t,e,n){try{sr=e;var r,i=e._value;e._state?r=t(i):(pn.length&&(pn=[]),r=t(i),pn.indexOf(i)===-1&&za(e)),n.resolve(r)}catch(a){n.reject(a)}finally{sr=null,--et===0&&Fr(),--n.psd.ref||n.psd.finalize()}}function lo(t,e,n){if(e.length===n)return e;var r="";if(t._state===!1){var i=t._value,a,o;i!=null?(a=i.name||"Error",o=i.message||i,r=nr(i,0)):(a=i,o=""),e.push(a+(o?": "+o:"")+r)}return Me&&(r=nr(t._stackHolder,2),r&&e.indexOf(r)===-1&&e.push(r),t._prev&&lo(t._prev,e,n)),e}function co(t,e){var n=e?e._numPrev+1:0;n<Da&&(t._prev=e,t._numPrev=n)}function an(){Zt()&&$t()}function Zt(){var t=ar;return ar=!1,Cn=!1,t}function $t(){var t,e,n;do for(;At.length>0;)for(t=At,At=[],n=t.length,e=0;e<n;++e){var r=t[e];r[0].apply(null,r[1])}while(At.length>0);ar=!0,Cn=!0}function Fr(){var t=$e;$e=[],t.forEach(function(r){r._PSD.onunhandled.call(null,r._value,r)});for(var e=mn.slice(0),n=e.length;n;)e[--n]()}function Fa(t){function e(){t(),mn.splice(mn.indexOf(e),1)}mn.push(e),++et,jt(function(){--et===0&&Fr()},[])}function La(t){$e.some(function(e){return e._value===t._value})||$e.push(t)}function za(t){for(var e=$e.length;e;)if($e[--e]._value===t._value){$e.splice(e,1);return}}function vn(t){return new R(Ut,!1,t)}function G(t,e){var n=I;return function(){var r=Zt(),i=I;try{return Ge(n,!0),t.apply(this,arguments)}catch(a){e&&e(a)}finally{Ge(i,!1),r&&$t()}}}var fe={awaits:0,echoes:0,id:0},Na=0,gn=[],Nn=0,Bn=0,Ha=0;function qe(t,e,n,r){var i=I,a=Object.create(i);a.parent=i,a.ref=0,a.global=!1,a.id=++Ha;var o=ft.env;a.env=Pr?{Promise:R,PromiseProp:{value:R,configurable:!0,writable:!0},all:R.all,race:R.race,allSettled:R.allSettled,any:R.any,resolve:R.resolve,reject:R.reject,nthen:$r(o.nthen,a),gthen:$r(o.gthen,a)}:{},e&&me(a,e),++i.ref,a.finalize=function(){--this.parent.ref||this.parent.finalize()};var s=_t(a,t,n,r);return a.ref===0&&a.finalize(),s}function yt(){return fe.id||(fe.id=++Na),++fe.awaits,fe.echoes+=io,fe.id}function He(){return fe.awaits?(--fe.awaits===0&&(fe.id=0),fe.echoes=fe.awaits*io,!0):!1}(""+oo).indexOf("[native code]")===-1&&(yt=He=W);function Tn(t){return fe.echoes&&t&&t.constructor===hn?(yt(),t.then(function(e){return He(),e},function(e){return He(),ae(e)})):t}function Ua(t){++Bn,(!fe.echoes||--fe.echoes===0)&&(fe.echoes=fe.id=0),gn.push(I),Ge(t,!0)}function ja(){var t=gn[gn.length-1];gn.pop(),Ge(t,!1)}function Ge(t,e){var n=I;if((e?fe.echoes&&(!Nn++||t!==I):Nn&&(!--Nn||t!==I))&&ho(e?Ua.bind(null,t):ja),t!==I&&(I=t,n===ft&&(ft.env=fo()),Pr)){var r=ft.env.Promise,i=t.env;xn.then=i.nthen,r.prototype.then=i.gthen,(n.global||t.global)&&(Object.defineProperty(q,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function fo(){var t=q.Promise;return Pr?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(q,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:xn.then,gthen:t.prototype.then}:{}}function _t(t,e,n,r,i){var a=I;try{return Ge(t,!0),e(n,r,i)}finally{Ge(a,!1)}}function ho(t){oo.call(rr,t)}function Rn(t,e,n,r){return typeof t!="function"?t:function(){var i=I;n&&yt(),Ge(e,!0);try{return t.apply(this,arguments)}finally{Ge(i,!1),r&&ho(He)}}}function $r(t,e){return function(n,r){return t.call(this,Rn(n,e),Rn(r,e))}}var ei="unhandledrejection";function ti(t,e){var n;try{n=e.onuncatched(t)}catch{}if(n!==!1)try{var r,i={promise:e,reason:t};if(q.document&&document.createEvent?(r=document.createEvent("Event"),r.initEvent(ei,!0,!0),me(r,i)):q.CustomEvent&&(r=new CustomEvent(ei,{detail:i}),me(r,i)),r&&q.dispatchEvent&&(dispatchEvent(r),!q.PromiseRejectionEvent&&q.onunhandledrejection))try{q.onunhandledrejection(r)}catch{}Me&&r&&!r.defaultPrevented&&console.warn("Unhandled rejection: "+(t.stack||t))}catch{}}var ae=R.reject;function fr(t,e,n,r){if(!t.idbdb||!t._state.openComplete&&!I.letThrough&&!t._vip){if(t._state.openComplete)return ae(new K.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return ae(new K.DatabaseClosed);t.open().catch(W)}return t._state.dbReadyPromise.then(function(){return fr(t,e,n,r)})}else{var i=t._createTransaction(e,n,t._dbSchema);try{i.create(),t._state.PR1398_maxLoop=3}catch(a){return a.name===Mr.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(function(){return fr(t,e,n,r)})):ae(a)}return i._promise(e,function(a,o){return qe(function(){return I.trans=i,r(a,o,i)})}).then(function(a){return i._completion.then(function(){return a})})}}var ni="3.2.2",Je=String.fromCharCode(65535),dr=-1/0,De="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",po="String expected.",Mt=[],Fn=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Va=Fn,Wa=Fn,mo=function(t){return!/(dexie\.js|dexie\.min\.js)/.test(t)},Ln="__dbnames",Hn="readonly",Un="readwrite";function nt(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}var vo={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function sn(t){return typeof t=="string"&&!/\./.test(t)?function(e){return e[t]===void 0&&t in e&&(e=Xt(e),delete e[t]),e}:function(e){return e}}var Ya=function(){function t(){}return t.prototype._trans=function(e,n,r){var i=this._tx||I.trans,a=this.name;function o(u,l,c){if(!c.schema[a])throw new K.NotFound("Table "+a+" not part of transaction");return n(c.idbtrans,c)}var s=Zt();try{return i&&i.db===this.db?i===I.trans?i._promise(e,o,r):qe(function(){return i._promise(e,o,r)},{trans:i,transless:I.transless||I}):fr(this.db,e,[this.name],o)}finally{s&&$t()}},t.prototype.get=function(e,n){var r=this;return e&&e.constructor===Object?this.where(e).first(n):this._trans("readonly",function(i){return r.core.get({trans:i,key:e}).then(function(a){return r.hook.reading.fire(a)})}).then(n)},t.prototype.where=function(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(de(e))return new this.db.WhereClause(this,"["+e.join("+")+"]");var n=re(e);if(n.length===1)return this.where(n[0]).equals(e[n[0]]);var r=this.schema.indexes.concat(this.schema.primKey).filter(function(c){return c.compound&&n.every(function(d){return c.keyPath.indexOf(d)>=0})&&c.keyPath.every(function(d){return n.indexOf(d)>=0})})[0];if(r&&this.db._maxKey!==Je)return this.where(r.name).equals(r.keyPath.map(function(c){return e[c]}));!r&&Me&&console.warn("The query "+JSON.stringify(e)+" on "+this.name+" would benefit of a "+("compound index ["+n.join("+")+"]"));var i=this.schema.idxByName,a=this.db._deps.indexedDB;function o(c,d){try{return a.cmp(c,d)===0}catch{return!1}}var s=n.reduce(function(c,d){var h=c[0],m=c[1],p=i[d],f=e[d];return[h||p,h||!p?nt(m,p&&p.multi?function(v){var w=Le(v,d);return de(w)&&w.some(function(_){return o(f,_)})}:function(v){return o(f,Le(v,d))}):m]},[null,null]),u=s[0],l=s[1];return u?this.where(u.name).equals(e[u.keyPath]).filter(l):r?this.filter(l):this.where(n).equals("")},t.prototype.filter=function(e){return this.toCollection().and(e)},t.prototype.count=function(e){return this.toCollection().count(e)},t.prototype.offset=function(e){return this.toCollection().offset(e)},t.prototype.limit=function(e){return this.toCollection().limit(e)},t.prototype.each=function(e){return this.toCollection().each(e)},t.prototype.toArray=function(e){return this.toCollection().toArray(e)},t.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},t.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,de(e)?"["+e.join("+")+"]":e))},t.prototype.reverse=function(){return this.toCollection().reverse()},t.prototype.mapToClass=function(e){this.schema.mappedClass=e;var n=function(r){if(!r)return r;var i=Object.create(e.prototype);for(var a in r)if(Ae(r,a))try{i[a]=r[a]}catch{}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=n,this.hook("reading",n),e},t.prototype.defineClass=function(){function e(n){me(this,n)}return this.mapToClass(e)},t.prototype.add=function(e,n){var r=this,i=this.schema.primKey,a=i.auto,o=i.keyPath,s=e;return o&&a&&(s=sn(o)(e)),this._trans("readwrite",function(u){return r.core.mutate({trans:u,type:"add",keys:n!=null?[n]:null,values:[s]})}).then(function(u){return u.numFailures?R.reject(u.failures[0]):u.lastResult}).then(function(u){if(o)try{Te(e,o,u)}catch{}return u})},t.prototype.update=function(e,n){if(typeof e=="object"&&!de(e)){var r=Le(e,this.schema.primKey.keyPath);if(r===void 0)return ae(new K.InvalidArgument("Given object does not contain its primary key"));try{typeof n!="function"?re(n).forEach(function(i){Te(e,i,n[i])}):n(e,{value:e,primKey:r})}catch{}return this.where(":id").equals(r).modify(n)}else return this.where(":id").equals(e).modify(n)},t.prototype.put=function(e,n){var r=this,i=this.schema.primKey,a=i.auto,o=i.keyPath,s=e;return o&&a&&(s=sn(o)(e)),this._trans("readwrite",function(u){return r.core.mutate({trans:u,type:"put",values:[s],keys:n!=null?[n]:null})}).then(function(u){return u.numFailures?R.reject(u.failures[0]):u.lastResult}).then(function(u){if(o)try{Te(e,o,u)}catch{}return u})},t.prototype.delete=function(e){var n=this;return this._trans("readwrite",function(r){return n.core.mutate({trans:r,type:"delete",keys:[e]})}).then(function(r){return r.numFailures?R.reject(r.failures[0]):void 0})},t.prototype.clear=function(){var e=this;return this._trans("readwrite",function(n){return e.core.mutate({trans:n,type:"deleteRange",range:vo})}).then(function(n){return n.numFailures?R.reject(n.failures[0]):void 0})},t.prototype.bulkGet=function(e){var n=this;return this._trans("readonly",function(r){return n.core.getMany({keys:e,trans:r}).then(function(i){return i.map(function(a){return n.hook.reading.fire(a)})})})},t.prototype.bulkAdd=function(e,n,r){var i=this,a=Array.isArray(n)?n:void 0;r=r||(a?void 0:n);var o=r?r.allKeys:void 0;return this._trans("readwrite",function(s){var u=i.schema.primKey,l=u.auto,c=u.keyPath;if(c&&a)throw new K.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(a&&a.length!==e.length)throw new K.InvalidArgument("Arguments objects and keys must have the same length");var d=e.length,h=c&&l?e.map(sn(c)):e;return i.core.mutate({trans:s,type:"add",keys:a,values:h,wantResults:o}).then(function(m){var p=m.numFailures,f=m.results,v=m.lastResult,w=m.failures,_=o?f:v;if(p===0)return _;throw new Ot(i.name+".bulkAdd(): "+p+" of "+d+" operations failed",w)})})},t.prototype.bulkPut=function(e,n,r){var i=this,a=Array.isArray(n)?n:void 0;r=r||(a?void 0:n);var o=r?r.allKeys:void 0;return this._trans("readwrite",function(s){var u=i.schema.primKey,l=u.auto,c=u.keyPath;if(c&&a)throw new K.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(a&&a.length!==e.length)throw new K.InvalidArgument("Arguments objects and keys must have the same length");var d=e.length,h=c&&l?e.map(sn(c)):e;return i.core.mutate({trans:s,type:"put",keys:a,values:h,wantResults:o}).then(function(m){var p=m.numFailures,f=m.results,v=m.lastResult,w=m.failures,_=o?f:v;if(p===0)return _;throw new Ot(i.name+".bulkPut(): "+p+" of "+d+" operations failed",w)})})},t.prototype.bulkDelete=function(e){var n=this,r=e.length;return this._trans("readwrite",function(i){return n.core.mutate({trans:i,type:"delete",keys:e})}).then(function(i){var a=i.numFailures,o=i.lastResult,s=i.failures;if(a===0)return o;throw new Ot(n.name+".bulkDelete(): "+a+" of "+r+" operations failed",s)})},t}();function en(t){var e={},n=function(s,u){if(u){for(var l=arguments.length,c=new Array(l-1);--l;)c[l-1]=arguments[l];return e[s].subscribe.apply(null,c),t}else if(typeof s=="string")return e[s]};n.addEventType=a;for(var r=1,i=arguments.length;r<i;++r)a(arguments[r]);return n;function a(s,u,l){if(typeof s=="object")return o(s);u||(u=Ma),l||(l=W);var c={subscribers:[],fire:l,subscribe:function(d){c.subscribers.indexOf(d)===-1&&(c.subscribers.push(d),c.fire=u(c.fire,d))},unsubscribe:function(d){c.subscribers=c.subscribers.filter(function(h){return h!==d}),c.fire=c.subscribers.reduce(u,l)}};return e[s]=n[s]=c,c}function o(s){re(s).forEach(function(u){var l=s[u];if(de(l))a(u,s[u][0],s[u][1]);else if(l==="asap")var c=a(u,Jt,function(){for(var h=arguments.length,m=new Array(h);h--;)m[h]=arguments[h];c.subscribers.forEach(function(p){Qi(function(){p.apply(null,m)})})});else throw new K.InvalidArgument("Invalid event config")})}}function tn(t,e){return vt(e).from({prototype:t}),e}function qa(t){return tn(Ya.prototype,function(n,r,i){this.db=t,this._tx=i,this.name=n,this.schema=r,this.hook=t._allTables[n]?t._allTables[n].hook:en(null,{creating:[Ta,W],reading:[Ba,Jt],updating:[Oa,W],deleting:[Ra,W]})})}function st(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function jn(t,e){t.filter=nt(t.filter,e)}function Vn(t,e,n){var r=t.replayFilter;t.replayFilter=r?function(){return nt(r(),e())}:e,t.justLimit=n&&!r}function Ga(t,e){t.isMatch=nt(t.isMatch,e)}function yn(t,e){if(t.isPrimKey)return e.primaryKey;var n=e.getIndexByKeyPath(t.index);if(!n)throw new K.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return n}function ri(t,e,n){var r=yn(t,e.schema);return e.openCursor({trans:n,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:r,range:t.range}})}function un(t,e,n,r){var i=t.replayFilter?nt(t.filter,t.replayFilter()):t.filter;if(t.or){var a={},o=function(s,u,l){if(!i||i(u,l,function(h){return u.stop(h)},function(h){return u.fail(h)})){var c=u.primaryKey,d=""+c;d==="[object ArrayBuffer]"&&(d=""+new Uint8Array(c)),Ae(a,d)||(a[d]=!0,e(s,u,l))}};return Promise.all([t.or._iterate(o,n),ii(ri(t,r,n),t.algorithm,o,!t.keysOnly&&t.valueMapper)])}else return ii(ri(t,r,n),nt(t.algorithm,i),e,!t.keysOnly&&t.valueMapper)}function ii(t,e,n,r){var i=r?function(o,s,u){return n(r(o),s,u)}:n,a=G(i);return t.then(function(o){if(o)return o.start(function(){var s=function(){return o.continue()};(!e||e(o,function(u){return s=u},function(u){o.stop(u),s=W},function(u){o.fail(u),s=W}))&&a(o.value,o,function(u){return s=u}),s()})})}function pe(t,e){try{var n=oi(t),r=oi(e);if(n!==r)return n==="Array"?1:r==="Array"?-1:n==="binary"?1:r==="binary"?-1:n==="string"?1:r==="string"?-1:n==="Date"?1:r!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return Xa(ai(t),ai(e));case"Array":return Qa(t,e)}}catch{}return NaN}function Qa(t,e){for(var n=t.length,r=e.length,i=n<r?n:r,a=0;a<i;++a){var o=pe(t[a],e[a]);if(o!==0)return o}return n===r?0:n<r?-1:1}function Xa(t,e){for(var n=t.length,r=e.length,i=n<r?n:r,a=0;a<i;++a)if(t[a]!==e[a])return t[a]<e[a]?-1:1;return n===r?0:n<r?-1:1}function oi(t){var e=typeof t;if(e!=="object")return e;if(ArrayBuffer.isView(t))return"binary";var n=er(t);return n==="ArrayBuffer"?"binary":n}function ai(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}var Ja=function(){function t(){}return t.prototype._read=function(e,n){var r=this._ctx;return r.error?r.table._trans(null,ae.bind(null,r.error)):r.table._trans("readonly",e).then(n)},t.prototype._write=function(e){var n=this._ctx;return n.error?n.table._trans(null,ae.bind(null,n.error)):n.table._trans("readwrite",e,"locked")},t.prototype._addAlgorithm=function(e){var n=this._ctx;n.algorithm=nt(n.algorithm,e)},t.prototype._iterate=function(e,n){return un(this._ctx,e,n,this._ctx.table.core)},t.prototype.clone=function(e){var n=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&me(r,e),n._ctx=r,n},t.prototype.raw=function(){return this._ctx.valueMapper=null,this},t.prototype.each=function(e){var n=this._ctx;return this._read(function(r){return un(n,e,r,n.table.core)})},t.prototype.count=function(e){var n=this;return this._read(function(r){var i=n._ctx,a=i.table.core;if(st(i,!0))return a.count({trans:r,query:{index:yn(i,a.schema),range:i.range}}).then(function(s){return Math.min(s,i.limit)});var o=0;return un(i,function(){return++o,!1},r,a).then(function(){return o})}).then(e)},t.prototype.sortBy=function(e,n){var r=e.split(".").reverse(),i=r[0],a=r.length-1;function o(l,c){return c?o(l[r[c]],c-1):l[i]}var s=this._ctx.dir==="next"?1:-1;function u(l,c){var d=o(l,a),h=o(c,a);return d<h?-s:d>h?s:0}return this.toArray(function(l){return l.sort(u)}).then(n)},t.prototype.toArray=function(e){var n=this;return this._read(function(r){var i=n._ctx;if(i.dir==="next"&&st(i,!0)&&i.limit>0){var a=i.valueMapper,o=yn(i,i.table.core.schema);return i.table.core.query({trans:r,limit:i.limit,values:!0,query:{index:o,range:i.range}}).then(function(u){var l=u.result;return a?l.map(a):l})}else{var s=[];return un(i,function(u){return s.push(u)},r,i.table.core).then(function(){return s})}},e)},t.prototype.offset=function(e){var n=this._ctx;return e<=0?this:(n.offset+=e,st(n)?Vn(n,function(){var r=e;return function(i,a){return r===0?!0:r===1?(--r,!1):(a(function(){i.advance(r),r=0}),!1)}}):Vn(n,function(){var r=e;return function(){return--r<0}}),this)},t.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Vn(this._ctx,function(){var n=e;return function(r,i,a){return--n<=0&&i(a),n>=0}},!0),this},t.prototype.until=function(e,n){return jn(this._ctx,function(r,i,a){return e(r.value)?(i(a),n):!0}),this},t.prototype.first=function(e){return this.limit(1).toArray(function(n){return n[0]}).then(e)},t.prototype.last=function(e){return this.reverse().first(e)},t.prototype.filter=function(e){return jn(this._ctx,function(n){return e(n.value)}),Ga(this._ctx,e),this},t.prototype.and=function(e){return this.filter(e)},t.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},t.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},t.prototype.desc=function(){return this.reverse()},t.prototype.eachKey=function(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){e(i.key,i)})},t.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},t.prototype.eachPrimaryKey=function(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){e(i.primaryKey,i)})},t.prototype.keys=function(e){var n=this._ctx;n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,a){r.push(a.key)}).then(function(){return r}).then(e)},t.prototype.primaryKeys=function(e){var n=this._ctx;if(n.dir==="next"&&st(n,!0)&&n.limit>0)return this._read(function(i){var a=yn(n,n.table.core.schema);return n.table.core.query({trans:i,values:!1,limit:n.limit,query:{index:a,range:n.range}})}).then(function(i){var a=i.result;return a}).then(e);n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,a){r.push(a.primaryKey)}).then(function(){return r}).then(e)},t.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},t.prototype.firstKey=function(e){return this.limit(1).keys(function(n){return n[0]}).then(e)},t.prototype.lastKey=function(e){return this.reverse().firstKey(e)},t.prototype.distinct=function(){var e=this._ctx,n=e.index&&e.table.schema.idxByName[e.index];if(!n||!n.multi)return this;var r={};return jn(this._ctx,function(i){var a=i.primaryKey.toString(),o=Ae(r,a);return r[a]=!0,!o}),this},t.prototype.modify=function(e){var n=this,r=this._ctx;return this._write(function(i){var a;if(typeof e=="function")a=e;else{var o=re(e),s=o.length;a=function(w){for(var _=!1,g=0;g<s;++g){var b=o[g],y=e[b];Le(w,b)!==y&&(Te(w,b,y),_=!0)}return _}}var u=r.table.core,l=u.schema.primaryKey,c=l.outbound,d=l.extractKey,h=n.db._options.modifyChunkSize||200,m=[],p=0,f=[],v=function(w,_){var g=_.failures,b=_.numFailures;p+=w-b;for(var y=0,k=re(g);y<k.length;y++){var x=k[y];m.push(g[x])}};return n.clone().primaryKeys().then(function(w){var _=function(g){var b=Math.min(h,w.length-g);return u.getMany({trans:i,keys:w.slice(g,g+b),cache:"immutable"}).then(function(y){for(var k=[],x=[],A=c?[]:null,E=[],B=0;B<b;++B){var O=y[B],j={value:Xt(O),primKey:w[g+B]};a.call(j,j.value,j)!==!1&&(j.value==null?E.push(w[g+B]):!c&&pe(d(O),d(j.value))!==0?(E.push(w[g+B]),k.push(j.value)):(x.push(j.value),c&&A.push(w[g+B])))}var L=st(r)&&r.limit===1/0&&(typeof e!="function"||e===Wn)&&{index:r.index,range:r.range};return Promise.resolve(k.length>0&&u.mutate({trans:i,type:"add",values:k}).then(function(J){for(var F in J.failures)E.splice(parseInt(F),1);v(k.length,J)})).then(function(){return(x.length>0||L&&typeof e=="object")&&u.mutate({trans:i,type:"put",keys:A,values:x,criteria:L,changeSpec:typeof e!="function"&&e}).then(function(J){return v(x.length,J)})}).then(function(){return(E.length>0||L&&e===Wn)&&u.mutate({trans:i,type:"delete",keys:E,criteria:L}).then(function(J){return v(E.length,J)})}).then(function(){return w.length>g+b&&_(g+h)})})};return _(0).then(function(){if(m.length>0)throw new Sn("Error modifying one or more objects",m,p,f);return w.length})})})},t.prototype.delete=function(){var e=this._ctx,n=e.range;return st(e)&&(e.isPrimKey&&!Wa||n.type===3)?this._write(function(r){var i=e.table.core.schema.primaryKey,a=n;return e.table.core.count({trans:r,query:{index:i,range:a}}).then(function(o){return e.table.core.mutate({trans:r,type:"deleteRange",range:a}).then(function(s){var u=s.failures;s.lastResult,s.results;var l=s.numFailures;if(l)throw new Sn("Could not delete some values",Object.keys(u).map(function(c){return u[c]}),o-l);return o-l})})}):this.modify(Wn)},t}(),Wn=function(t,e){return e.value=null};function Za(t){return tn(Ja.prototype,function(n,r){this.db=t;var i=vo,a=null;if(r)try{i=r()}catch(l){a=l}var o=n._ctx,s=o.table,u=s.hook.reading.fire;this._ctx={table:s,index:o.index,isPrimKey:!o.index||s.schema.primKey.keyPath&&o.index===s.schema.primKey.name,range:i,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:a,or:o.or,valueMapper:u!==Jt?u:null}})}function $a(t,e){return t<e?-1:t===e?0:1}function es(t,e){return t>e?-1:t===e?0:1}function Ee(t,e,n){var r=t instanceof yo?new t.Collection(t):t;return r._ctx.error=n?new n(e):new TypeError(e),r}function ut(t){return new t.Collection(t,function(){return go("")}).limit(0)}function ts(t){return t==="next"?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()}}function ns(t){return t==="next"?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()}}function rs(t,e,n,r,i,a){for(var o=Math.min(t.length,r.length),s=-1,u=0;u<o;++u){var l=e[u];if(l!==r[u])return i(t[u],n[u])<0?t.substr(0,u)+n[u]+n.substr(u+1):i(t[u],r[u])<0?t.substr(0,u)+r[u]+n.substr(u+1):s>=0?t.substr(0,s)+e[s]+n.substr(s+1):null;i(t[u],l)<0&&(s=u)}return o<r.length&&a==="next"?t+n.substr(t.length):o<t.length&&a==="prev"?t.substr(0,n.length):s<0?null:t.substr(0,s)+r[s]+n.substr(s+1)}function ln(t,e,n,r){var i,a,o,s,u,l,c,d=n.length;if(!n.every(function(f){return typeof f=="string"}))return Ee(t,po);function h(f){i=ts(f),a=ns(f),o=f==="next"?$a:es;var v=n.map(function(w){return{lower:a(w),upper:i(w)}}).sort(function(w,_){return o(w.lower,_.lower)});s=v.map(function(w){return w.upper}),u=v.map(function(w){return w.lower}),l=f,c=f==="next"?"":r}h("next");var m=new t.Collection(t,function(){return je(s[0],u[d-1]+r)});m._ondirectionchange=function(f){h(f)};var p=0;return m._addAlgorithm(function(f,v,w){var _=f.key;if(typeof _!="string")return!1;var g=a(_);if(e(g,u,p))return!0;for(var b=null,y=p;y<d;++y){var k=rs(_,g,s[y],u[y],o,l);k===null&&b===null?p=y+1:(b===null||o(b,k)>0)&&(b=k)}return v(b!==null?function(){f.continue(b+c)}:w),!1}),m}function je(t,e,n,r){return{type:2,lower:t,upper:e,lowerOpen:n,upperOpen:r}}function go(t){return{type:1,lower:t,upper:t}}var yo=function(){function t(){}return Object.defineProperty(t.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),t.prototype.between=function(e,n,r,i){r=r!==!1,i=i===!0;try{return this._cmp(e,n)>0||this._cmp(e,n)===0&&(r||i)&&!(r&&i)?ut(this):new this.Collection(this,function(){return je(e,n,!r,!i)})}catch{return Ee(this,De)}},t.prototype.equals=function(e){return e==null?Ee(this,De):new this.Collection(this,function(){return go(e)})},t.prototype.above=function(e){return e==null?Ee(this,De):new this.Collection(this,function(){return je(e,void 0,!0)})},t.prototype.aboveOrEqual=function(e){return e==null?Ee(this,De):new this.Collection(this,function(){return je(e,void 0,!1)})},t.prototype.below=function(e){return e==null?Ee(this,De):new this.Collection(this,function(){return je(void 0,e,!1,!0)})},t.prototype.belowOrEqual=function(e){return e==null?Ee(this,De):new this.Collection(this,function(){return je(void 0,e)})},t.prototype.startsWith=function(e){return typeof e!="string"?Ee(this,po):this.between(e,e+Je,!0,!0)},t.prototype.startsWithIgnoreCase=function(e){return e===""?this.startsWith(e):ln(this,function(n,r){return n.indexOf(r[0])===0},[e],Je)},t.prototype.equalsIgnoreCase=function(e){return ln(this,function(n,r){return n===r[0]},[e],"")},t.prototype.anyOfIgnoreCase=function(){var e=Pe.apply(lt,arguments);return e.length===0?ut(this):ln(this,function(n,r){return r.indexOf(n)!==-1},e,"")},t.prototype.startsWithAnyOfIgnoreCase=function(){var e=Pe.apply(lt,arguments);return e.length===0?ut(this):ln(this,function(n,r){return r.some(function(i){return n.indexOf(i)===0})},e,Je)},t.prototype.anyOf=function(){var e=this,n=Pe.apply(lt,arguments),r=this._cmp;try{n.sort(r)}catch{return Ee(this,De)}if(n.length===0)return ut(this);var i=new this.Collection(this,function(){return je(n[0],n[n.length-1])});i._ondirectionchange=function(o){r=o==="next"?e._ascending:e._descending,n.sort(r)};var a=0;return i._addAlgorithm(function(o,s,u){for(var l=o.key;r(l,n[a])>0;)if(++a,a===n.length)return s(u),!1;return r(l,n[a])===0?!0:(s(function(){o.continue(n[a])}),!1)}),i},t.prototype.notEqual=function(e){return this.inAnyRange([[dr,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},t.prototype.noneOf=function(){var e=Pe.apply(lt,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return Ee(this,De)}var n=e.reduce(function(r,i){return r?r.concat([[r[r.length-1][1],i]]):[[dr,i]]},null);return n.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})},t.prototype.inAnyRange=function(e,n){var r=this,i=this._cmp,a=this._ascending,o=this._descending,s=this._min,u=this._max;if(e.length===0)return ut(this);if(!e.every(function(y){return y[0]!==void 0&&y[1]!==void 0&&a(y[0],y[1])<=0}))return Ee(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",K.InvalidArgument);var l=!n||n.includeLowers!==!1,c=n&&n.includeUppers===!0;function d(y,k){for(var x=0,A=y.length;x<A;++x){var E=y[x];if(i(k[0],E[1])<0&&i(k[1],E[0])>0){E[0]=s(E[0],k[0]),E[1]=u(E[1],k[1]);break}}return x===A&&y.push(k),y}var h=a;function m(y,k){return h(y[0],k[0])}var p;try{p=e.reduce(d,[]),p.sort(m)}catch{return Ee(this,De)}var f=0,v=c?function(y){return a(y,p[f][1])>0}:function(y){return a(y,p[f][1])>=0},w=l?function(y){return o(y,p[f][0])>0}:function(y){return o(y,p[f][0])>=0};function _(y){return!v(y)&&!w(y)}var g=v,b=new this.Collection(this,function(){return je(p[0][0],p[p.length-1][1],!l,!c)});return b._ondirectionchange=function(y){y==="next"?(g=v,h=a):(g=w,h=o),p.sort(m)},b._addAlgorithm(function(y,k,x){for(var A=y.key;g(A);)if(++f,f===p.length)return k(x),!1;return _(A)?!0:(r._cmp(A,p[f][1])===0||r._cmp(A,p[f][0])===0||k(function(){h===a?y.continue(p[f][0]):y.continue(p[f][1])}),!1)}),b},t.prototype.startsWithAnyOf=function(){var e=Pe.apply(lt,arguments);return e.every(function(n){return typeof n=="string"})?e.length===0?ut(this):this.inAnyRange(e.map(function(n){return[n,n+Je]})):Ee(this,"startsWithAnyOf() only works with strings")},t}();function is(t){return tn(yo.prototype,function(n,r,i){this.db=t,this._ctx={table:n,index:r===":id"?null:r,or:i};var a=t._deps.indexedDB;if(!a)throw new K.MissingAPI;this._cmp=this._ascending=a.cmp.bind(a),this._descending=function(o,s){return a.cmp(s,o)},this._max=function(o,s){return a.cmp(o,s)>0?o:s},this._min=function(o,s){return a.cmp(o,s)<0?o:s},this._IDBKeyRange=t._deps.IDBKeyRange})}function Oe(t){return G(function(e){return Vt(e),t(e.target.error),!1})}function Vt(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}var Wt="storagemutated",We="x-storagemutated-1",Qe=en(null,Wt),os=function(){function t(){}return t.prototype._lock=function(){return Et(!I.global),++this._reculock,this._reculock===1&&!I.global&&(I.lockOwnerFor=this),this},t.prototype._unlock=function(){if(Et(!I.global),--this._reculock===0)for(I.global||(I.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{_t(e[1],e[0])}catch{}}return this},t.prototype._locked=function(){return this._reculock&&I.lockOwnerFor!==this},t.prototype.create=function(e){var n=this;if(!this.mode)return this;var r=this.db.idbdb,i=this.db._state.dbOpenError;if(Et(!this.idbtrans),!e&&!r)switch(i&&i.name){case"DatabaseClosedError":throw new K.DatabaseClosed(i);case"MissingAPIError":throw new K.MissingAPI(i.message,i);default:throw new K.OpenFailed(i)}if(!this.active)throw new K.TransactionInactive;return Et(this._completion._state===null),e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):r.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})),e.onerror=G(function(a){Vt(a),n._reject(e.error)}),e.onabort=G(function(a){Vt(a),n.active&&n._reject(new K.Abort(e.error)),n.active=!1,n.on("abort").fire(a)}),e.oncomplete=G(function(){n.active=!1,n._resolve(),"mutatedParts"in e&&Qe.storagemutated.fire(e.mutatedParts)}),this},t.prototype._promise=function(e,n,r){var i=this;if(e==="readwrite"&&this.mode!=="readwrite")return ae(new K.ReadOnly("Transaction is readonly"));if(!this.active)return ae(new K.TransactionInactive);if(this._locked())return new R(function(o,s){i._blockedFuncs.push([function(){i._promise(e,n,r).then(o,s)},I])});if(r)return qe(function(){var o=new R(function(s,u){i._lock();var l=n(s,u,i);l&&l.then&&l.then(s,u)});return o.finally(function(){return i._unlock()}),o._lib=!0,o});var a=new R(function(o,s){var u=n(o,s,i);u&&u.then&&u.then(o,s)});return a._lib=!0,a},t.prototype._root=function(){return this.parent?this.parent._root():this},t.prototype.waitFor=function(e){var n=this._root(),r=R.resolve(e);if(n._waitingFor)n._waitingFor=n._waitingFor.then(function(){return r});else{n._waitingFor=r,n._waitingQueue=[];var i=n.idbtrans.objectStore(n.storeNames[0]);(function o(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(i.get(-1/0).onsuccess=o)})()}var a=n._waitingFor;return new R(function(o,s){r.then(function(u){return n._waitingQueue.push(G(o.bind(null,u)))},function(u){return n._waitingQueue.push(G(s.bind(null,u)))}).finally(function(){n._waitingFor===a&&(n._waitingFor=null)})})},t.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new K.Abort))},t.prototype.table=function(e){var n=this._memoizedTables||(this._memoizedTables={});if(Ae(n,e))return n[e];var r=this.schema[e];if(!r)throw new K.NotFound("Table "+e+" not part of transaction");var i=new this.db.Table(e,r,this);return i.core=this.db.core.table(e),n[e]=i,i},t}();function as(t){return tn(os.prototype,function(n,r,i,a,o){var s=this;this.db=t,this.mode=n,this.storeNames=r,this.schema=i,this.chromeTransactionDurability=a,this.idbtrans=null,this.on=en(this,"complete","error","abort"),this.parent=o||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new R(function(u,l){s._resolve=u,s._reject=l}),this._completion.then(function(){s.active=!1,s.on.complete.fire()},function(u){var l=s.active;return s.active=!1,s.on.error.fire(u),s.parent?s.parent._reject(u):l&&s.idbtrans&&s.idbtrans.abort(),ae(u)})})}function hr(t,e,n,r,i,a,o){return{name:t,keyPath:e,unique:n,multi:r,auto:i,compound:a,src:(n&&!o?"&":"")+(r?"*":"")+(i?"++":"")+_o(e)}}function _o(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function bo(t,e,n){return{name:t,primKey:e,indexes:n,mappedClass:null,idxByName:Xi(n,function(r){return[r.name,r]})}}function ss(t){return t.length===1?t[0]:t}var Yt=function(t){try{return t.only([[]]),Yt=function(){return[[]]},[[]]}catch{return Yt=function(){return Je},Je}};function pr(t){return t==null?function(){}:typeof t=="string"?us(t):function(e){return Le(e,t)}}function us(t){var e=t.split(".");return e.length===1?function(n){return n[t]}:function(n){return Le(n,t)}}function si(t){return[].slice.call(t)}var ls=0;function Dt(t){return t==null?":id":typeof t=="string"?t:"["+t.join("+")+"]"}function cs(t,e,n){function r(d,h){var m=si(d.objectStoreNames);return{schema:{name:d.name,tables:m.map(function(p){return h.objectStore(p)}).map(function(p){var f=p.keyPath,v=p.autoIncrement,w=de(f),_=f==null,g={},b={name:p.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:_,compound:w,keyPath:f,autoIncrement:v,unique:!0,extractKey:pr(f)},indexes:si(p.indexNames).map(function(y){return p.index(y)}).map(function(y){var k=y.name,x=y.unique,A=y.multiEntry,E=y.keyPath,B=de(E),O={name:k,compound:B,keyPath:E,unique:x,multiEntry:A,extractKey:pr(E)};return g[Dt(E)]=O,O}),getIndexByKeyPath:function(y){return g[Dt(y)]}};return g[":id"]=b.primaryKey,f!=null&&(g[Dt(f)]=b.primaryKey),b})},hasGetAll:m.length>0&&"getAll"in h.objectStore(m[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function i(d){if(d.type===3)return null;if(d.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var h=d.lower,m=d.upper,p=d.lowerOpen,f=d.upperOpen,v=h===void 0?m===void 0?null:e.upperBound(m,!!f):m===void 0?e.lowerBound(h,!!p):e.bound(h,m,!!p,!!f);return v}function a(d){var h=d.name;function m(v){var w=v.trans,_=v.type,g=v.keys,b=v.values,y=v.range;return new Promise(function(k,x){k=G(k);var A=w.objectStore(h),E=A.keyPath==null,B=_==="put"||_==="add";if(!B&&_!=="delete"&&_!=="deleteRange")throw new Error("Invalid operation type: "+_);var O=(g||b||{length:1}).length;if(g&&b&&g.length!==b.length)throw new Error("Given keys array must have same length as given values array.");if(O===0)return k({numFailures:0,failures:{},results:[],lastResult:void 0});var j,L=[],J=[],F=0,se=function(Re){++F,Vt(Re)};if(_==="deleteRange"){if(y.type===4)return k({numFailures:F,failures:J,results:[],lastResult:void 0});y.type===3?L.push(j=A.clear()):L.push(j=A.delete(i(y)))}else{var ue=B?E?[b,g]:[b,null]:[g,null],$=ue[0],le=ue[1];if(B)for(var Se=0;Se<O;++Se)L.push(j=le&&le[Se]!==void 0?A[_]($[Se],le[Se]):A[_]($[Se])),j.onerror=se;else for(var Se=0;Se<O;++Se)L.push(j=A[_]($[Se])),j.onerror=se}var Ue=function(Re){var bt=Re.target.result;L.forEach(function(Ce,nn){return Ce.error!=null&&(J[nn]=Ce.error)}),k({numFailures:F,failures:J,results:_==="delete"?g:L.map(function(Ce){return Ce.result}),lastResult:bt})};j.onerror=function(Re){se(Re),Ue(Re)},j.onsuccess=Ue})}function p(v){var w=v.trans,_=v.values,g=v.query,b=v.reverse,y=v.unique;return new Promise(function(k,x){k=G(k);var A=g.index,E=g.range,B=w.objectStore(h),O=A.isPrimaryKey?B:B.index(A.name),j=b?y?"prevunique":"prev":y?"nextunique":"next",L=_||!("openKeyCursor"in O)?O.openCursor(i(E),j):O.openKeyCursor(i(E),j);L.onerror=Oe(x),L.onsuccess=G(function(J){var F=L.result;if(!F){k(null);return}F.___id=++ls,F.done=!1;var se=F.continue.bind(F),ue=F.continuePrimaryKey;ue&&(ue=ue.bind(F));var $=F.advance.bind(F),le=function(){throw new Error("Cursor not started")},Se=function(){throw new Error("Cursor not stopped")};F.trans=w,F.stop=F.continue=F.continuePrimaryKey=F.advance=le,F.fail=G(x),F.next=function(){var Ue=this,Re=1;return this.start(function(){return Re--?Ue.continue():Ue.stop()}).then(function(){return Ue})},F.start=function(Ue){var Re=new Promise(function(Ce,nn){Ce=G(Ce),L.onerror=Oe(nn),F.fail=nn,F.stop=function(Lo){F.stop=F.continue=F.continuePrimaryKey=F.advance=Se,Ce(Lo)}}),bt=function(){if(L.result)try{Ue()}catch(Ce){F.fail(Ce)}else F.done=!0,F.start=function(){throw new Error("Cursor behind last entry")},F.stop()};return L.onsuccess=G(function(Ce){L.onsuccess=bt,bt()}),F.continue=se,F.continuePrimaryKey=ue,F.advance=$,bt(),Re},k(F)},x)})}function f(v){return function(w){return new Promise(function(_,g){_=G(_);var b=w.trans,y=w.values,k=w.limit,x=w.query,A=k===1/0?void 0:k,E=x.index,B=x.range,O=b.objectStore(h),j=E.isPrimaryKey?O:O.index(E.name),L=i(B);if(k===0)return _({result:[]});if(v){var J=y?j.getAll(L,A):j.getAllKeys(L,A);J.onsuccess=function($){return _({result:$.target.result})},J.onerror=Oe(g)}else{var F=0,se=y||!("openKeyCursor"in j)?j.openCursor(L):j.openKeyCursor(L),ue=[];se.onsuccess=function($){var le=se.result;if(!le)return _({result:ue});if(ue.push(y?le.value:le.primaryKey),++F===k)return _({result:ue});le.continue()},se.onerror=Oe(g)}})}}return{name:h,schema:d,mutate:m,getMany:function(v){var w=v.trans,_=v.keys;return new Promise(function(g,b){g=G(g);for(var y=w.objectStore(h),k=_.length,x=new Array(k),A=0,E=0,B,O=function(F){var se=F.target;(x[se._pos]=se.result)!=null,++E===A&&g(x)},j=Oe(b),L=0;L<k;++L){var J=_[L];J!=null&&(B=y.get(_[L]),B._pos=L,B.onsuccess=O,B.onerror=j,++A)}A===0&&g(x)})},get:function(v){var w=v.trans,_=v.key;return new Promise(function(g,b){g=G(g);var y=w.objectStore(h),k=y.get(_);k.onsuccess=function(x){return g(x.target.result)},k.onerror=Oe(b)})},query:f(u),openCursor:p,count:function(v){var w=v.query,_=v.trans,g=w.index,b=w.range;return new Promise(function(y,k){var x=_.objectStore(h),A=g.isPrimaryKey?x:x.index(g.name),E=i(b),B=E?A.count(E):A.count();B.onsuccess=G(function(O){return y(O.target.result)}),B.onerror=Oe(k)})}}}var o=r(t,n),s=o.schema,u=o.hasGetAll,l=s.tables.map(function(d){return a(d)}),c={};return l.forEach(function(d){return c[d.name]=d}),{stack:"dbcore",transaction:t.transaction.bind(t),table:function(d){var h=c[d];if(!h)throw new Error("Table '"+d+"' not found");return c[d]},MIN_KEY:-1/0,MAX_KEY:Yt(e),schema:s}}function fs(t,e){return e.reduce(function(n,r){var i=r.create;return V(V({},n),i(n))},t)}function ds(t,e,n,r){var i=n.IDBKeyRange;n.indexedDB;var a=fs(cs(e,i,r),t.dbcore);return{dbcore:a}}function Lr(t,e){var n=t._novip,r=e.db,i=ds(n._middlewares,r,n._deps,e);n.core=i.dbcore,n.tables.forEach(function(a){var o=a.name;n.core.schema.tables.some(function(s){return s.name===o})&&(a.core=n.core.table(o),n[o]instanceof n.Table&&(n[o].core=a.core))})}function On(t,e,n,r){var i=t._novip;n.forEach(function(a){var o=r[a];e.forEach(function(s){var u=Tr(s,a);(!u||"value"in u&&u.value===void 0)&&(s===i.Transaction.prototype||s instanceof i.Transaction?Ne(s,a,{get:function(){return this.table(a)},set:function(l){qi(this,a,{value:l,writable:!0,configurable:!0,enumerable:!0})}}):s[a]=new i.Table(a,o))})})}function mr(t,e){var n=t._novip;e.forEach(function(r){for(var i in r)r[i]instanceof n.Table&&delete r[i]})}function hs(t,e){return t._cfg.version-e._cfg.version}function ps(t,e,n,r){var i=t._dbSchema,a=t._createTransaction("readwrite",t._storeNames,i);a.create(n),a._completion.catch(r);var o=a._reject.bind(a),s=I.transless||I;qe(function(){I.trans=a,I.transless=s,e===0?(re(i).forEach(function(u){zr(n,u,i[u].primKey,i[u].indexes)}),Lr(t,n),R.follow(function(){return t.on.populate.fire(a)}).catch(o)):ms(t,e,a,n).catch(o)})}function ms(t,e,n,r){var i=t._novip,a=[],o=i._versions,s=i._dbSchema=Nr(i,i.idbdb,r),u=!1,l=o.filter(function(d){return d._cfg.version>=e});l.forEach(function(d){a.push(function(){var h=s,m=d._cfg.dbschema;gr(i,h,r),gr(i,m,r),s=i._dbSchema=m;var p=wo(h,m);p.add.forEach(function(b){zr(r,b[0],b[1].primKey,b[1].indexes)}),p.change.forEach(function(b){if(b.recreate)throw new K.Upgrade("Not yet support for changing primary key");var y=r.objectStore(b.name);b.add.forEach(function(k){return vr(y,k)}),b.change.forEach(function(k){y.deleteIndex(k.name),vr(y,k)}),b.del.forEach(function(k){return y.deleteIndex(k)})});var f=d._cfg.contentUpgrade;if(f&&d._cfg.version>e){Lr(i,r),n._memoizedTables={},u=!0;var v=Ji(m);p.del.forEach(function(b){v[b]=h[b]}),mr(i,[i.Transaction.prototype]),On(i,[i.Transaction.prototype],re(v),v),n.schema=v;var w=Rr(f);w&&yt();var _,g=R.follow(function(){if(_=f(n),_&&w){var b=He.bind(null,null);_.then(b,b)}});return _&&typeof _.then=="function"?R.resolve(_):g.then(function(){return _})}}),a.push(function(h){if(!u||!Va){var m=d._cfg.dbschema;gs(m,h)}mr(i,[i.Transaction.prototype]),On(i,[i.Transaction.prototype],i._storeNames,i._dbSchema),n.schema=i._dbSchema})});function c(){return a.length?R.resolve(a.shift()(n.idbtrans)).then(c):R.resolve()}return c().then(function(){vs(s,r)})}function wo(t,e){var n={del:[],add:[],change:[]},r;for(r in t)e[r]||n.del.push(r);for(r in e){var i=t[r],a=e[r];if(!i)n.add.push([r,a]);else{var o={name:r,def:a,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(a.primKey.keyPath||"")||i.primKey.auto!==a.primKey.auto&&!Fn)o.recreate=!0,n.change.push(o);else{var s=i.idxByName,u=a.idxByName,l=void 0;for(l in s)u[l]||o.del.push(l);for(l in u){var c=s[l],d=u[l];c?c.src!==d.src&&o.change.push(d):o.add.push(d)}(o.del.length>0||o.add.length>0||o.change.length>0)&&n.change.push(o)}}}return n}function zr(t,e,n,r){var i=t.db.createObjectStore(e,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(function(a){return vr(i,a)}),i}function vs(t,e){re(t).forEach(function(n){e.db.objectStoreNames.contains(n)||zr(e,n,t[n].primKey,t[n].indexes)})}function gs(t,e){[].slice.call(e.db.objectStoreNames).forEach(function(n){return t[n]==null&&e.db.deleteObjectStore(n)})}function vr(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function Nr(t,e,n){var r={},i=Pn(e.objectStoreNames,0);return i.forEach(function(a){for(var o=n.objectStore(a),s=o.keyPath,u=hr(_o(s),s||"",!1,!1,!!o.autoIncrement,s&&typeof s!="string",!0),l=[],c=0;c<o.indexNames.length;++c){var d=o.index(o.indexNames[c]);s=d.keyPath;var h=hr(d.name,s,!!d.unique,!!d.multiEntry,!1,s&&typeof s!="string",!1);l.push(h)}r[a]=bo(a,u,l)}),r}function ys(t,e,n){var r=t._novip;r.verno=e.version/10;var i=r._dbSchema=Nr(r,e,n);r._storeNames=Pn(e.objectStoreNames,0),On(r,[r._allTables],re(i),i)}function _s(t,e){var n=Nr(t,t.idbdb,e),r=wo(n,t._dbSchema);return!(r.add.length||r.change.some(function(i){return i.add.length||i.change.length}))}function gr(t,e,n){for(var r=t._novip,i=n.db.objectStoreNames,a=0;a<i.length;++a){var o=i[a],s=n.objectStore(o);r._hasGetAll="getAll"in s;for(var u=0;u<s.indexNames.length;++u){var l=s.indexNames[u],c=s.index(l).keyPath,d=typeof c=="string"?c:"["+Pn(c).join("+")+"]";if(e[o]){var h=e[o].idxByName[d];h&&(h.name=l,delete e[o].idxByName[d],e[o].idxByName[l]=h)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&q.WorkerGlobalScope&&q instanceof q.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(r._hasGetAll=!1)}function bs(t){return t.split(",").map(function(e,n){e=e.trim();var r=e.replace(/([&*]|\+\+)/g,""),i=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return hr(r,i||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),de(i),n===0)})}var ws=function(){function t(){}return t.prototype._parseStoresSpec=function(e,n){re(e).forEach(function(r){if(e[r]!==null){var i=bs(e[r]),a=i.shift();if(a.multi)throw new K.Schema("Primary key cannot be multi-valued");i.forEach(function(o){if(o.auto)throw new K.Schema("Only primary key can be marked as autoIncrement (++)");if(!o.keyPath)throw new K.Schema("Index must have a name and cannot be an empty string")}),n[r]=bo(r,a,i)}})},t.prototype.stores=function(e){var n=this.db;this._cfg.storesSource=this._cfg.storesSource?me(this._cfg.storesSource,e):e;var r=n._versions,i={},a={};return r.forEach(function(o){me(i,o._cfg.storesSource),a=o._cfg.dbschema={},o._parseStoresSpec(i,a)}),n._dbSchema=a,mr(n,[n._allTables,n,n.Transaction.prototype]),On(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],re(a),a),n._storeNames=re(a),this},t.prototype.upgrade=function(e){return this._cfg.contentUpgrade=Dr(this._cfg.contentUpgrade||W,e),this},t}();function ks(t){return tn(ws.prototype,function(n){this.db=t,this._cfg={version:n,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function Hr(t,e){var n=t._dbNamesDB;return n||(n=t._dbNamesDB=new Wr(Ln,{addons:[],indexedDB:t,IDBKeyRange:e}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function Ur(t){return t&&typeof t.databases=="function"}function Es(t){var e=t.indexedDB,n=t.IDBKeyRange;return Ur(e)?Promise.resolve(e.databases()).then(function(r){return r.map(function(i){return i.name}).filter(function(i){return i!==Ln})}):Hr(e,n).toCollection().primaryKeys()}function As(t,e){var n=t.indexedDB,r=t.IDBKeyRange;!Ur(n)&&e!==Ln&&Hr(n,r).put({name:e}).catch(W)}function Ss(t,e){var n=t.indexedDB,r=t.IDBKeyRange;!Ur(n)&&e!==Ln&&Hr(n,r).delete(e).catch(W)}function yr(t){return qe(function(){return I.letThrough=!0,t()})}function xs(){var t=!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent);if(!t||!indexedDB.databases)return Promise.resolve();var e;return new Promise(function(n){var r=function(){return indexedDB.databases().finally(n)};e=setInterval(r,100),r()}).finally(function(){return clearInterval(e)})}function Cs(t){var e=t._state,n=t._deps.indexedDB;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(function(){return e.dbOpenError?ae(e.dbOpenError):t});Me&&(e.openCanceller._stackHolder=at()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;var r=e.openCanceller;function i(){if(e.openCanceller!==r)throw new K.DatabaseClosed("db.open() was cancelled")}var a=e.dbReadyResolve,o=null,s=!1;return R.race([r,(typeof navigator>"u"?R.resolve():xs()).then(function(){return new R(function(u,l){if(i(),!n)throw new K.MissingAPI;var c=t.name,d=e.autoSchema?n.open(c):n.open(c,Math.round(t.verno*10));if(!d)throw new K.MissingAPI;d.onerror=Oe(l),d.onblocked=G(t._fireOnBlocked),d.onupgradeneeded=G(function(h){if(o=d.transaction,e.autoSchema&&!t._options.allowEmptyDB){d.onerror=Vt,o.abort(),d.result.close();var m=n.deleteDatabase(c);m.onsuccess=m.onerror=G(function(){l(new K.NoSuchDatabase("Database "+c+" doesnt exist"))})}else{o.onerror=Oe(l);var p=h.oldVersion>Math.pow(2,62)?0:h.oldVersion;s=p<1,t._novip.idbdb=d.result,ps(t,p/10,o,l)}},l),d.onsuccess=G(function(){o=null;var h=t._novip.idbdb=d.result,m=Pn(h.objectStoreNames);if(m.length>0)try{var p=h.transaction(ss(m),"readonly");e.autoSchema?ys(t,h,p):(gr(t,t._dbSchema,p),_s(t,p)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),Lr(t,p)}catch{}Mt.push(t),h.onversionchange=G(function(f){e.vcFired=!0,t.on("versionchange").fire(f)}),h.onclose=G(function(f){t.on("close").fire(f)}),s&&As(t._deps,c),u()},l)})})]).then(function(){return i(),e.onReadyBeingFired=[],R.resolve(yr(function(){return t.on.ready.fire(t.vip)})).then(function u(){if(e.onReadyBeingFired.length>0){var l=e.onReadyBeingFired.reduce(Dr,W);return e.onReadyBeingFired=[],R.resolve(yr(function(){return l(t.vip)})).then(u)}})}).finally(function(){e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(function(){return t}).catch(function(u){e.dbOpenError=u;try{o&&o.abort()}catch{}return r===e.openCanceller&&t._close(),ae(u)}).finally(function(){e.openComplete=!0,a()})}function _r(t){var e=function(o){return t.next(o)},n=function(o){return t.throw(o)},r=a(e),i=a(n);function a(o){return function(s){var u=o(s),l=u.value;return u.done?l:!l||typeof l.then!="function"?de(l)?Promise.all(l).then(r,i):r(l):l.then(r,i)}}return a(e)()}function Bs(t,e,n){var r=arguments.length;if(r<2)throw new K.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];n=i.pop();var a=Zi(i);return[t,a,n]}function ko(t,e,n,r,i){return R.resolve().then(function(){var a=I.transless||I,o=t._createTransaction(e,n,t._dbSchema,r),s={trans:o,transless:a};if(r)o.idbtrans=r.idbtrans;else try{o.create(),t._state.PR1398_maxLoop=3}catch(d){return d.name===Mr.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(function(){return ko(t,e,n,null,i)})):ae(d)}var u=Rr(i);u&&yt();var l,c=R.follow(function(){if(l=i.call(o,o),l)if(u){var d=He.bind(null,null);l.then(d,d)}else typeof l.next=="function"&&typeof l.throw=="function"&&(l=_r(l))},s);return(l&&typeof l.then=="function"?R.resolve(l).then(function(d){return o.active?d:ae(new K.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):c.then(function(){return l})).then(function(d){return r&&o._resolve(),o._completion.then(function(){return d})}).catch(function(d){return o._reject(d),ae(d)})})}function cn(t,e,n){for(var r=de(t)?t.slice():[t],i=0;i<n;++i)r.push(e);return r}function Ts(t){return V(V({},t),{table:function(e){var n=t.table(e),r=n.schema,i={},a=[];function o(f,v,w){var _=Dt(f),g=i[_]=i[_]||[],b=f==null?0:typeof f=="string"?1:f.length,y=v>0,k=V(V({},w),{isVirtual:y,keyTail:v,keyLength:b,extractKey:pr(f),unique:!y&&w.unique});if(g.push(k),k.isPrimaryKey||a.push(k),b>1){var x=b===2?f[0]:f.slice(0,b-1);o(x,v+1,w)}return g.sort(function(A,E){return A.keyTail-E.keyTail}),k}var s=o(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[s];for(var u=0,l=r.indexes;u<l.length;u++){var c=l[u];o(c.keyPath,0,c)}function d(f){var v=i[Dt(f)];return v&&v[0]}function h(f,v){return{type:f.type===1?2:f.type,lower:cn(f.lower,f.lowerOpen?t.MAX_KEY:t.MIN_KEY,v),lowerOpen:!0,upper:cn(f.upper,f.upperOpen?t.MIN_KEY:t.MAX_KEY,v),upperOpen:!0}}function m(f){var v=f.query.index;return v.isVirtual?V(V({},f),{query:{index:v,range:h(f.query.range,v.keyTail)}}):f}var p=V(V({},n),{schema:V(V({},r),{primaryKey:s,indexes:a,getIndexByKeyPath:d}),count:function(f){return n.count(m(f))},query:function(f){return n.query(m(f))},openCursor:function(f){var v=f.query.index,w=v.keyTail,_=v.isVirtual,g=v.keyLength;if(!_)return n.openCursor(f);function b(y){function k(A){A!=null?y.continue(cn(A,f.reverse?t.MAX_KEY:t.MIN_KEY,w)):f.unique?y.continue(y.key.slice(0,g).concat(f.reverse?t.MIN_KEY:t.MAX_KEY,w)):y.continue()}var x=Object.create(y,{continue:{value:k},continuePrimaryKey:{value:function(A,E){y.continuePrimaryKey(cn(A,t.MAX_KEY,w),E)}},primaryKey:{get:function(){return y.primaryKey}},key:{get:function(){var A=y.key;return g===1?A[0]:A.slice(0,g)}},value:{get:function(){return y.value}}});return x}return n.openCursor(m(f)).then(function(y){return y&&b(y)})}});return p}})}var Rs={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:Ts};function jr(t,e,n,r){return n=n||{},r=r||"",re(t).forEach(function(i){if(!Ae(e,i))n[r+i]=void 0;else{var a=t[i],o=e[i];if(typeof a=="object"&&typeof o=="object"&&a&&o){var s=er(a),u=er(o);s!==u?n[r+i]=e[i]:s==="Object"?jr(a,o,n,r+i+"."):a!==o&&(n[r+i]=e[i])}else a!==o&&(n[r+i]=e[i])}}),re(e).forEach(function(i){Ae(t,i)||(n[r+i]=e[i])}),n}function Os(t,e){return e.type==="delete"?e.keys:e.keys||e.values.map(t.extractKey)}var Ms={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(t){return V(V({},t),{table:function(e){var n=t.table(e),r=n.schema.primaryKey,i=V(V({},n),{mutate:function(a){var o=I.trans,s=o.table(e).hook,u=s.deleting,l=s.creating,c=s.updating;switch(a.type){case"add":if(l.fire===W)break;return o._promise("readwrite",function(){return d(a)},!0);case"put":if(l.fire===W&&c.fire===W)break;return o._promise("readwrite",function(){return d(a)},!0);case"delete":if(u.fire===W)break;return o._promise("readwrite",function(){return d(a)},!0);case"deleteRange":if(u.fire===W)break;return o._promise("readwrite",function(){return h(a)},!0)}return n.mutate(a);function d(p){var f=I.trans,v=p.keys||Os(r,p);if(!v)throw new Error("Keys missing");return p=p.type==="add"||p.type==="put"?V(V({},p),{keys:v}):V({},p),p.type!=="delete"&&(p.values=Zn([],p.values,!0)),p.keys&&(p.keys=Zn([],p.keys,!0)),Ds(n,p,v).then(function(w){var _=v.map(function(g,b){var y=w[b],k={onerror:null,onsuccess:null};if(p.type==="delete")u.fire.call(k,g,y,f);else if(p.type==="add"||y===void 0){var x=l.fire.call(k,g,p.values[b],f);g==null&&x!=null&&(g=x,p.keys[b]=g,r.outbound||Te(p.values[b],r.keyPath,g))}else{var A=jr(y,p.values[b]),E=c.fire.call(k,A,g,y,f);if(E){var B=p.values[b];Object.keys(E).forEach(function(O){Ae(B,O)?B[O]=E[O]:Te(B,O,E[O])})}}return k});return n.mutate(p).then(function(g){for(var b=g.failures,y=g.results,k=g.numFailures,x=g.lastResult,A=0;A<v.length;++A){var E=y?y[A]:v[A],B=_[A];E==null?B.onerror&&B.onerror(b[A]):B.onsuccess&&B.onsuccess(p.type==="put"&&w[A]?p.values[A]:E)}return{failures:b,results:y,numFailures:k,lastResult:x}}).catch(function(g){return _.forEach(function(b){return b.onerror&&b.onerror(g)}),Promise.reject(g)})})}function h(p){return m(p.trans,p.range,1e4)}function m(p,f,v){return n.query({trans:p,values:!1,query:{index:r,range:f},limit:v}).then(function(w){var _=w.result;return d({type:"delete",keys:_,trans:p}).then(function(g){return g.numFailures>0?Promise.reject(g.failures[0]):_.length<v?{failures:[],numFailures:0,lastResult:void 0}:m(p,V(V({},f),{lower:_[_.length-1],lowerOpen:!0}),v)})})}}});return i}})}};function Ds(t,e,n){return e.type==="add"?Promise.resolve([]):t.getMany({trans:e.trans,keys:n,cache:"immutable"})}function Eo(t,e,n){try{if(!e||e.keys.length<t.length)return null;for(var r=[],i=0,a=0;i<e.keys.length&&a<t.length;++i)pe(e.keys[i],t[a])===0&&(r.push(n?Xt(e.values[i]):e.values[i]),++a);return r.length===t.length?r:null}catch{return null}}var Is={stack:"dbcore",level:-1,create:function(t){return{table:function(e){var n=t.table(e);return V(V({},n),{getMany:function(r){if(!r.cache)return n.getMany(r);var i=Eo(r.keys,r.trans._cache,r.cache==="clone");return i?R.resolve(i):n.getMany(r).then(function(a){return r.trans._cache={keys:r.keys,values:r.cache==="clone"?Xt(a):a},a})},mutate:function(r){return r.type!=="add"&&(r.trans._cache=null),n.mutate(r)}})}}}},Yn;function Vr(t){return!("from"in t)}var Ie=function(t,e){if(this)me(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0});else{var n=new Ie;return t&&"d"in t&&me(n,t),n}};dt(Ie.prototype,(Yn={add:function(t){return Mn(this,t),this},addKey:function(t){return qt(this,t,t),this},addKeys:function(t){var e=this;return t.forEach(function(n){return qt(e,n,n)}),this}},Yn[tr]=function(){return br(this)},Yn));function qt(t,e,n){var r=pe(e,n);if(!isNaN(r)){if(r>0)throw RangeError();if(Vr(t))return me(t,{from:e,to:n,d:1});var i=t.l,a=t.r;if(pe(n,t.from)<0)return i?qt(i,e,n):t.l={from:e,to:n,d:1,l:null,r:null},ui(t);if(pe(e,t.to)>0)return a?qt(a,e,n):t.r={from:e,to:n,d:1,l:null,r:null},ui(t);pe(e,t.from)<0&&(t.from=e,t.l=null,t.d=a?a.d+1:1),pe(n,t.to)>0&&(t.to=n,t.r=null,t.d=t.l?t.l.d+1:1);var o=!t.r;i&&!t.l&&Mn(t,i),a&&o&&Mn(t,a)}}function Mn(t,e){function n(r,i){var a=i.from,o=i.to,s=i.l,u=i.r;qt(r,a,o),s&&n(r,s),u&&n(r,u)}Vr(e)||n(t,e)}function Ps(t,e){var n=br(e),r=n.next();if(r.done)return!1;for(var i=r.value,a=br(t),o=a.next(i.from),s=o.value;!r.done&&!o.done;){if(pe(s.from,i.to)<=0&&pe(s.to,i.from)>=0)return!0;pe(i.from,s.from)<0?i=(r=n.next(s.from)).value:s=(o=a.next(i.from)).value}return!1}function br(t){var e=Vr(t)?null:{s:0,n:t};return{next:function(n){for(var r=arguments.length>0;e;)switch(e.s){case 0:if(e.s=1,r)for(;e.n.l&&pe(n,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!r||pe(n,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function ui(t){var e,n,r=(((e=t.r)===null||e===void 0?void 0:e.d)||0)-(((n=t.l)===null||n===void 0?void 0:n.d)||0),i=r>1?"r":r<-1?"l":"";if(i){var a=i==="r"?"l":"r",o=V({},t),s=t[i];t.from=s.from,t.to=s.to,t[i]=s[i],o[i]=s[a],t[a]=o,o.d=li(o)}t.d=li(t)}function li(t){var e=t.r,n=t.l;return(e?n?Math.max(e.d,n.d):e.d:n?n.d:0)+1}var Ks={stack:"dbcore",level:0,create:function(t){var e=t.schema.name,n=new Ie(t.MIN_KEY,t.MAX_KEY);return V(V({},t),{table:function(r){var i=t.table(r),a=i.schema,o=a.primaryKey,s=o.extractKey,u=o.outbound,l=V(V({},i),{mutate:function(h){var m=h.trans,p=m.mutatedParts||(m.mutatedParts={}),f=function(x){var A="idb://"+e+"/"+r+"/"+x;return p[A]||(p[A]=new Ie)},v=f(""),w=f(":dels"),_=h.type,g=h.type==="deleteRange"?[h.range]:h.type==="delete"?[h.keys]:h.values.length<50?[[],h.values]:[],b=g[0],y=g[1],k=h.trans._cache;return i.mutate(h).then(function(x){if(de(b)){_!=="delete"&&(b=x.results),v.addKeys(b);var A=Eo(b,k);!A&&_!=="add"&&w.addKeys(b),(A||y)&&Fs(f,a,A,y)}else if(b){var E={from:b.lower,to:b.upper};w.add(E),v.add(E)}else v.add(n),w.add(n),a.indexes.forEach(function(B){return f(B.name).add(n)});return x})}}),c=function(h){var m,p,f=h.query,v=f.index,w=f.range;return[v,new Ie((m=w.lower)!==null&&m!==void 0?m:t.MIN_KEY,(p=w.upper)!==null&&p!==void 0?p:t.MAX_KEY)]},d={get:function(h){return[o,new Ie(h.key)]},getMany:function(h){return[o,new Ie().addKeys(h.keys)]},count:c,query:c,openCursor:c};return re(d).forEach(function(h){l[h]=function(m){var p=I.subscr;if(p){var f=function(k){var x="idb://"+e+"/"+r+"/"+k;return p[x]||(p[x]=new Ie)},v=f(""),w=f(":dels"),_=d[h](m),g=_[0],b=_[1];if(f(g.name||"").add(b),!g.isPrimaryKey)if(h==="count")w.add(n);else{var y=h==="query"&&u&&m.values&&i.query(V(V({},m),{values:!1}));return i[h].apply(this,arguments).then(function(k){if(h==="query"){if(u&&m.values)return y.then(function(B){var O=B.result;return v.addKeys(O),k});var x=m.values?k.result.map(s):k.result;m.values?v.addKeys(x):w.addKeys(x)}else if(h==="openCursor"){var A=k,E=m.values;return A&&Object.create(A,{key:{get:function(){return w.addKey(A.primaryKey),A.key}},primaryKey:{get:function(){var B=A.primaryKey;return w.addKey(B),B}},value:{get:function(){return E&&v.addKey(A.primaryKey),A.value}}})}return k})}}return i[h].apply(this,arguments)}}),l}})}};function Fs(t,e,n,r){function i(a){var o=t(a.name||"");function s(l){return l!=null?a.extractKey(l):null}var u=function(l){return a.multiEntry&&de(l)?l.forEach(function(c){return o.addKey(c)}):o.addKey(l)};(n||r).forEach(function(l,c){var d=n&&s(n[c]),h=r&&s(r[c]);pe(d,h)!==0&&(d!=null&&u(d),h!=null&&u(h))})}e.indexes.forEach(i)}var Wr=function(){function t(e,n){var r=this;this._middlewares={},this.verno=0;var i=t.dependencies;this._options=n=V({addons:t.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange},n),this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};var a=n.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var o={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:W,dbReadyPromise:null,cancelOpen:W,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};o.dbReadyPromise=new R(function(s){o.dbReadyResolve=s}),o.openCanceller=new R(function(s,u){o.cancelOpen=u}),this._state=o,this.name=e,this.on=en(this,"populate","blocked","versionchange","close",{ready:[Dr,W]}),this.on.ready.subscribe=Gi(this.on.ready.subscribe,function(s){return function(u,l){t.vip(function(){var c=r._state;if(c.openComplete)c.dbOpenError||R.resolve().then(u),l&&s(u);else if(c.onReadyBeingFired)c.onReadyBeingFired.push(u),l&&s(u);else{s(u);var d=r;l||s(function h(){d.on.ready.unsubscribe(u),d.on.ready.unsubscribe(h)})}})}}),this.Collection=Za(this),this.Table=qa(this),this.Transaction=as(this),this.Version=ks(this),this.WhereClause=is(this),this.on("versionchange",function(s){s.newVersion>0?console.warn("Another connection wants to upgrade database '"+r.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+r.name+"'. Closing db now to resume the delete request."),r.close()}),this.on("blocked",function(s){!s.newVersion||s.newVersion<s.oldVersion?console.warn("Dexie.delete('"+r.name+"') was blocked"):console.warn("Upgrade '"+r.name+"' blocked by other connection holding version "+s.oldVersion/10)}),this._maxKey=Yt(n.IDBKeyRange),this._createTransaction=function(s,u,l,c){return new r.Transaction(s,u,l,r._options.chromeTransactionDurability,c)},this._fireOnBlocked=function(s){r.on("blocked").fire(s),Mt.filter(function(u){return u.name===r.name&&u!==r&&!u._state.vcFired}).map(function(u){return u.on("versionchange").fire(s)})},this.use(Rs),this.use(Ms),this.use(Ks),this.use(Is),this.vip=Object.create(this,{_vip:{value:!0}}),a.forEach(function(s){return s(r)})}return t.prototype.version=function(e){if(isNaN(e)||e<.1)throw new K.Type("Given version is not a positive number");if(e=Math.round(e*10)/10,this.idbdb||this._state.isBeingOpened)throw new K.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var n=this._versions,r=n.filter(function(i){return i._cfg.version===e})[0];return r||(r=new this.Version(e),n.push(r),n.sort(hs),r.stores({}),this._state.autoSchema=!1,r)},t.prototype._whenReady=function(e){var n=this;return this.idbdb&&(this._state.openComplete||I.letThrough||this._vip)?e():new R(function(r,i){if(n._state.openComplete)return i(new K.DatabaseClosed(n._state.dbOpenError));if(!n._state.isBeingOpened){if(!n._options.autoOpen){i(new K.DatabaseClosed);return}n.open().catch(W)}n._state.dbReadyPromise.then(r,i)}).then(e)},t.prototype.use=function(e){var n=e.stack,r=e.create,i=e.level,a=e.name;a&&this.unuse({stack:n,name:a});var o=this._middlewares[n]||(this._middlewares[n]=[]);return o.push({stack:n,create:r,level:i==null?10:i,name:a}),o.sort(function(s,u){return s.level-u.level}),this},t.prototype.unuse=function(e){var n=e.stack,r=e.name,i=e.create;return n&&this._middlewares[n]&&(this._middlewares[n]=this._middlewares[n].filter(function(a){return i?a.create!==i:r?a.name!==r:!1})),this},t.prototype.open=function(){return Cs(this)},t.prototype._close=function(){var e=this._state,n=Mt.indexOf(this);if(n>=0&&Mt.splice(n,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}e.dbReadyPromise=new R(function(r){e.dbReadyResolve=r}),e.openCanceller=new R(function(r,i){e.cancelOpen=i})},t.prototype.close=function(){this._close();var e=this._state;this._options.autoOpen=!1,e.dbOpenError=new K.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)},t.prototype.delete=function(){var e=this,n=arguments.length>0,r=this._state;return new R(function(i,a){var o=function(){e.close();var s=e._deps.indexedDB.deleteDatabase(e.name);s.onsuccess=G(function(){Ss(e._deps,e.name),i()}),s.onerror=Oe(a),s.onblocked=e._fireOnBlocked};if(n)throw new K.InvalidArgument("Arguments not allowed in db.delete()");r.isBeingOpened?r.dbReadyPromise.then(o):o()})},t.prototype.backendDB=function(){return this.idbdb},t.prototype.isOpen=function(){return this.idbdb!==null},t.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"},t.prototype.hasFailed=function(){return this._state.dbOpenError!==null},t.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(t.prototype,"tables",{get:function(){var e=this;return re(this._allTables).map(function(n){return e._allTables[n]})},enumerable:!1,configurable:!0}),t.prototype.transaction=function(){var e=Bs.apply(this,arguments);return this._transaction.apply(this,e)},t.prototype._transaction=function(e,n,r){var i=this,a=I.trans;(!a||a.db!==this||e.indexOf("!")!==-1)&&(a=null);var o=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");var s,u;try{if(u=n.map(function(c){var d=c instanceof i.Table?c.name:c;if(typeof d!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return d}),e=="r"||e===Hn)s=Hn;else if(e=="rw"||e==Un)s=Un;else throw new K.InvalidArgument("Invalid transaction mode: "+e);if(a){if(a.mode===Hn&&s===Un)if(o)a=null;else throw new K.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");a&&u.forEach(function(c){if(a&&a.storeNames.indexOf(c)===-1)if(o)a=null;else throw new K.SubTransaction("Table "+c+" not included in parent transaction.")}),o&&a&&!a.active&&(a=null)}}catch(c){return a?a._promise(null,function(d,h){h(c)}):ae(c)}var l=ko.bind(null,this,s,u,a,r);return a?a._promise(s,l,"lock"):I.trans?_t(I.transless,function(){return i._whenReady(l)}):this._whenReady(l)},t.prototype.table=function(e){if(!Ae(this._allTables,e))throw new K.InvalidTable("Table "+e+" does not exist");return this._allTables[e]},t}(),Ls=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",zs=function(){function t(e){this._subscribe=e}return t.prototype.subscribe=function(e,n,r){return this._subscribe(!e||typeof e=="function"?{next:e,error:n,complete:r}:e)},t.prototype[Ls]=function(){return this},t}();function Ao(t,e){return re(e).forEach(function(n){var r=t[n]||(t[n]=new Ie);Mn(r,e[n])}),t}function So(t){return new zs(function(e){var n=Rr(t);function r(m){n&&yt();var p=function(){return qe(t,{subscr:m,trans:null})},f=I.trans?_t(I.transless,p):p();return n&&f.then(He,He),f}var i=!1,a={},o={},s={get closed(){return i},unsubscribe:function(){i=!0,Qe.storagemutated.unsubscribe(d)}};e.start&&e.start(s);var u=!1,l=!1;function c(){return re(o).some(function(m){return a[m]&&Ps(a[m],o[m])})}var d=function(m){Ao(a,m),c()&&h()},h=function(){if(!(u||i)){a={};var m={},p=r(m);l||(Qe(Wt,d),l=!0),u=!0,Promise.resolve(p).then(function(f){u=!1,!i&&(c()?h():(a={},o=m,e.next&&e.next(f)))},function(f){u=!1,e.error&&e.error(f),s.unsubscribe()})}};return h(),s})}var wr;try{wr={indexedDB:q.indexedDB||q.mozIndexedDB||q.webkitIndexedDB||q.msIndexedDB,IDBKeyRange:q.IDBKeyRange||q.webkitIDBKeyRange}}catch{wr={indexedDB:null,IDBKeyRange:null}}var Xe=Wr;dt(Xe,V(V({},Kn),{delete:function(t){var e=new Xe(t,{addons:[]});return e.delete()},exists:function(t){return new Xe(t,{addons:[]}).open().then(function(e){return e.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(t){try{return Es(Xe.dependencies).then(t)}catch{return ae(new K.MissingAPI)}},defineClass:function(){function t(e){me(this,e)}return t},ignoreTransaction:function(t){return I.trans?_t(I.transless,t):t()},vip:yr,async:function(t){return function(){try{var e=_r(t.apply(this,arguments));return!e||typeof e.then!="function"?R.resolve(e):e}catch(n){return ae(n)}}},spawn:function(t,e,n){try{var r=_r(t.apply(n,e||[]));return!r||typeof r.then!="function"?R.resolve(r):r}catch(i){return ae(i)}},currentTransaction:{get:function(){return I.trans||null}},waitFor:function(t,e){var n=R.resolve(typeof t=="function"?Xe.ignoreTransaction(t):t).timeout(e||6e4);return I.trans?I.trans.waitFor(n):n},Promise:R,debug:{get:function(){return Me},set:function(t){eo(t,t==="dexie"?function(){return!0}:mo)}},derive:vt,extend:me,props:dt,override:Gi,Events:en,on:Qe,liveQuery:So,extendObservabilitySet:Ao,getByKeyPath:Le,setByKeyPath:Te,delByKeyPath:ya,shallowClone:Ji,deepClone:Xt,getObjectDiff:jr,cmp:pe,asap:Qi,minKey:dr,addons:[],connections:Mt,errnames:Mr,dependencies:wr,semVer:ni,version:ni.split(".").map(function(t){return parseInt(t)}).reduce(function(t,e,n){return t+e/Math.pow(10,n*2)})}));Xe.maxKey=Yt(Xe.dependencies.IDBKeyRange);typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Qe(Wt,function(t){if(!Fe){var e;Fn?(e=document.createEvent("CustomEvent"),e.initCustomEvent(We,!0,!0,t)):e=new CustomEvent(We,{detail:t}),Fe=!0,dispatchEvent(e),Fe=!1}}),addEventListener(We,function(t){var e=t.detail;Fe||Dn(e)}));function Dn(t){var e=Fe;try{Fe=!0,Qe.storagemutated.fire(t)}finally{Fe=e}}var Fe=!1;if(typeof BroadcastChannel<"u"){var ci=new BroadcastChannel(We);Qe(Wt,function(t){Fe||ci.postMessage(t)}),ci.onmessage=function(t){t.data&&Dn(t.data)}}else if(typeof self<"u"&&typeof navigator<"u"){Qe(Wt,function(t){try{Fe||(typeof localStorage<"u"&&localStorage.setItem(We,JSON.stringify({trig:Math.random(),changedParts:t})),typeof self.clients=="object"&&Zn([],self.clients.matchAll({includeUncontrolled:!0}),!0).forEach(function(e){return e.postMessage({type:We,changedParts:t})}))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",function(t){if(t.key===We){var e=JSON.parse(t.newValue);e&&Dn(e.changedParts)}});var fi=self.document&&navigator.serviceWorker;fi&&fi.addEventListener("message",Ns)}function Ns(t){var e=t.data;e&&e.type===We&&Dn(e.changedParts)}R.rejectionMapper=Ca;eo(Me,mo);class Hs extends Wr{constructor(){super("bookDB");Yr(this,"books");this.version(5).stores({books:"++id, meta, contents, spine, toc, files, progress"})}}const Be=new Hs,Us=async t=>{for(let e of await Be.books.toArray())if(e.meta.title===t.meta.title)return e.id;try{return await Be.books.add(t)}catch(e){console.log(e)}};function xo(t){return t.arrayBuffer?t.arrayBuffer():new Promise((e,n)=>{const r=new FileReader;r.addEventListener("loadend",()=>{e(r.result)}),r.addEventListener("error",n),r.readAsArrayBuffer(t)})}async function js(t){const e=await xo(t);return new Uint8Array(e)}function Co(t){return typeof Blob<"u"&&t instanceof Blob}function Gt(t){return typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}const Vs=typeof process<"u"&&process.versions&&typeof process.versions.node<"u"&&typeof process.versions.electron>"u";function Ws(t){return t.byteOffset===0&&t.byteLength===t.buffer.byteLength}class di{constructor(e){this.typedArray=e instanceof ArrayBuffer||Gt(e)?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}async getLength(){return this.typedArray.byteLength}async read(e,n){return new Uint8Array(this.typedArray.buffer,this.typedArray.byteOffset+e,n)}}class hi{constructor(e){this.blob=e}async getLength(){return this.blob.size}async read(e,n){const r=this.blob.slice(e,e+n),i=await xo(r);return new Uint8Array(i)}async sliceAsBlob(e,n,r=""){return this.blob.slice(e,e+n,r)}}function Ys(t,e){var n=Uint8Array;if(t[0]==3&&t[1]==0)return e||new n(0);var r=Gs,i=Bo,a=qs,o=To,s=e==null;s&&(e=new n(t.length>>>2<<3));for(var u=0,l=0,c=0,d=0,h=0,m=0,p=0,f=0,v=0,w,_;u==0;){if(u=r(t,v,1),l=r(t,v+1,2),v+=3,l==0){(v&7)!=0&&(v+=8-(v&7));var g=(v>>>3)+4,b=t[g-4]|t[g-3]<<8;s&&(e=qn(e,f+b)),e.set(new n(t.buffer,t.byteOffset+g,b),f),v=g+b<<3,f+=b;continue}if(s&&(e=qn(e,f+(1<<17))),l==1&&(w=P.flmap,_=P.fdmap,m=(1<<9)-1,p=(1<<5)-1),l==2){c=i(t,v,5)+257,d=i(t,v+5,5)+1,h=i(t,v+10,4)+4,v+=14;for(var y=0;y<38;y+=2)P.itree[y]=0,P.itree[y+1]=0;for(var k=1,y=0;y<h;y++){var x=i(t,v+y*3,3);P.itree[(P.ordr[y]<<1)+1]=x,x>k&&(k=x)}v+=3*h,It(P.itree,k),Pt(P.itree,k,P.imap),w=P.lmap,_=P.dmap,v=a(P.imap,(1<<k)-1,c+d,t,v,P.ttree);var A=pi(P.ttree,0,c,P.ltree);m=(1<<A)-1;var E=pi(P.ttree,c,d,P.dtree);p=(1<<E)-1,It(P.ltree,A),Pt(P.ltree,A,w),It(P.dtree,E),Pt(P.dtree,E,_)}for(;;){var B=w[o(t,v)&m];v+=B&15;var O=B>>>4;if(O>>>8==0)e[f++]=O;else{if(O==256)break;var j=f+O-254;if(O>264){var L=P.ldef[O-257];j=f+(L>>>3)+i(t,v,L&7),v+=L&7}var J=_[o(t,v)&p];v+=J&15;var F=J>>>4,se=P.ddef[F],ue=(se>>>4)+r(t,v,se&15);for(v+=se&15,s&&(e=qn(e,f+(1<<17)));f<j;)e[f]=e[f++-ue],e[f]=e[f++-ue],e[f]=e[f++-ue],e[f]=e[f++-ue];f=j}}}return e.length==f?e:e.slice(0,f)}function qn(t,e){var n=t.length;if(e<=n)return t;var r=new Uint8Array(Math.max(n<<1,e));return r.set(t,0),r}function qs(t,e,n,r,i,a){for(var o=Bo,s=To,u=0;u<n;){var l=t[s(r,i)&e];i+=l&15;var c=l>>>4;if(c<=15)a[u]=c,u++;else{var d=0,h=0;c==16?(h=3+o(r,i,2),i+=2,d=a[u-1]):c==17?(h=3+o(r,i,3),i+=3):c==18&&(h=11+o(r,i,7),i+=7);for(var m=u+h;u<m;)a[u]=d,u++}}return i}function pi(t,e,n,r){for(var i=0,a=0,o=r.length>>>1;a<n;){var s=t[a+e];r[a<<1]=0,r[(a<<1)+1]=s,s>i&&(i=s),a++}for(;a<o;)r[a<<1]=0,r[(a<<1)+1]=0,a++;return i}function It(t,e){for(var n=t.length,r,i,a,o,s,u=P.bl_count,o=0;o<=e;o++)u[o]=0;for(o=1;o<n;o+=2)u[t[o]]++;var l=P.next_code;for(r=0,u[0]=0,i=1;i<=e;i++)r=r+u[i-1]<<1,l[i]=r;for(a=0;a<n;a+=2)s=t[a+1],s!=0&&(t[a]=l[s],l[s]++)}function Pt(t,e,n){for(var r=t.length,i=P.rev15,a=0;a<r;a+=2)if(t[a+1]!=0)for(var o=a>>1,s=t[a+1],u=o<<4|s,l=e-s,c=t[a]<<l,d=c+(1<<l);c!=d;){var h=i[c]>>>15-e;n[h]=u,c++}}function mi(t,e){for(var n=P.rev15,r=15-e,i=0;i<t.length;i+=2){var a=t[i]<<e-t[i+1];t[i]=n[a]>>>r}}function Bo(t,e,n){return(t[e>>>3]|t[(e>>>3)+1]<<8)>>>(e&7)&(1<<n)-1}function Gs(t,e,n){return(t[e>>>3]|t[(e>>>3)+1]<<8|t[(e>>>3)+2]<<16)>>>(e&7)&(1<<n)-1}function To(t,e){return(t[e>>>3]|t[(e>>>3)+1]<<8|t[(e>>>3)+2]<<16)>>>(e&7)}const P=function(){var t=Uint16Array,e=Uint32Array;return{next_code:new t(16),bl_count:new t(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new t(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new e(32),flmap:new t(512),fltree:[],fdmap:new t(32),fdtree:[],lmap:new t(32768),ltree:[],ttree:[],dmap:new t(32768),dtree:[],imap:new t(512),itree:[],rev15:new t(1<<15),lhst:new e(286),dhst:new e(30),ihst:new e(19),lits:new e(15e3),strt:new t(1<<16),prev:new t(1<<15)}}();(function(){for(var t=32768,e=0;e<t;e++){var n=e;n=(n&2863311530)>>>1|(n&1431655765)<<1,n=(n&3435973836)>>>2|(n&858993459)<<2,n=(n&4042322160)>>>4|(n&252645135)<<4,n=(n&4278255360)>>>8|(n&16711935)<<8,P.rev15[e]=(n>>>16|n<<16)>>>17}function r(i,a,o){for(;a--!=0;)i.push(0,o)}for(var e=0;e<32;e++)P.ldef[e]=P.of0[e]<<3|P.exb[e],P.ddef[e]=P.df0[e]<<4|P.dxb[e];r(P.fltree,144,8),r(P.fltree,255-143,9),r(P.fltree,279-255,7),r(P.fltree,287-279,8),It(P.fltree,9),Pt(P.fltree,9,P.flmap),mi(P.fltree,9),r(P.fdtree,32,5),It(P.fdtree,5),Pt(P.fdtree,5,P.fdmap),mi(P.fdtree,5),r(P.itree,19,0),r(P.ltree,286,0),r(P.dtree,30,0),r(P.ttree,320,0)})();const vi={table:function(){for(var t=new Uint32Array(256),e=0;e<256;e++){for(var n=e,r=0;r<8;r++)n&1?n=3988292384^n>>>1:n=n>>>1;t[e]=n}return t}(),update:function(t,e,n,r){for(var i=0;i<r;i++)t=vi.table[(t^e[n+i])&255]^t>>>8;return t},crc:function(t,e,n){return vi.update(4294967295,t,e,n)^4294967295}};function Qs(t,e){return Ys(t,e)}const gi={numWorkers:1,workerURL:"",useWorkers:!1};let Xs=0;const _n=[];function Gn(t){return new Promise((e,n)=>{const r=new Worker(t);r.onmessage=i=>{i.data==="start"?(r.onerror=void 0,r.onmessage=void 0,e(r)):n(new Error(`unexpected message: ${i.data}`))},r.onerror=n})}function Js(t,e){return t.require(e)}(function(){if(Vs){const{Worker:t}=Js(Fo,"worker_threads");return{async createWorker(e){return new t(e)},addEventListener(e,n){e.on("message",r=>{n({target:e,data:r})})},async terminate(e){await e.terminate()}}}else return{async createWorker(t){try{return await Gn(t)}catch{console.warn("could not load worker:",t)}let e;try{const n=await fetch(t,{mode:"cors"});if(!n.ok)throw new Error(`could not load: ${t}`);e=await n.text(),t=URL.createObjectURL(new Blob([e],{type:"application/javascript"}));const r=await Gn(t);return gi.workerURL=t,r}catch{console.warn("could not load worker via fetch:",t)}if(e!==void 0)try{t=`data:application/javascript;base64,${btoa(e)}`;const n=await Gn(t);return gi.workerURL=t,n}catch{console.warn("could not load worker via dataURI")}throw console.warn("workers will not be used"),new Error("can not start workers")},addEventListener(t,e){t.addEventListener("message",e)},async terminate(t){t.terminate()}}})();function Zs(t,e,n,r){const i=new Uint8Array(e);Qs(t,i),r(n?new Blob([i],{type:n}):i.buffer)}async function $s(){if(_n.length!==0)for(;_n.length;){const{src:t,uncompressedSize:e,type:n,resolve:r}=_n.shift();let i=t;Co(t)&&(i=await js(t)),Zs(i,e,n,r)}}function Ro(t,e,n){return new Promise((r,i)=>{_n.push({src:t,uncompressedSize:e,type:n,resolve:r,reject:i,id:Xs++}),$s()})}function eu(t,e){const n=t&31,r=(t>>5&15)-1,i=(t>>9&127)+1980,a=0,o=(e&31)*2,s=e>>5&63,u=e>>11&31;return new Date(i,r,n,u,s,o,a)}class tu{constructor(e,n){this._reader=e,this._rawEntry=n,this.name=n.name,this.nameBytes=n.nameBytes,this.size=n.uncompressedSize,this.compressedSize=n.compressedSize,this.comment=n.comment,this.commentBytes=n.commentBytes,this.compressionMethod=n.compressionMethod,this.lastModDate=eu(n.lastModFileDate,n.lastModFileTime),this.isDirectory=n.uncompressedSize===0&&n.name.endsWith("/"),this.encrypted=!!(n.generalPurposeBitFlag&1),this.externalFileAttributes=n.externalFileAttributes,this.versionMadeBy=n.versionMadeBy}async blob(e="application/octet-stream"){return await du(this._reader,this._rawEntry,e)}async arrayBuffer(){return await fu(this._reader,this._rawEntry)}async text(){const e=await this.arrayBuffer();return Kt(new Uint8Array(e))}async json(){const e=await this.text();return JSON.parse(e)}}const Qn=22,nu=65535,ru=101010256,iu=101075792;async function ht(t,e,n){return await t.read(e,n)}async function kr(t,e,n,r){return t.sliceAsBlob?await t.sliceAsBlob(e,n,r):await t.read(e,n)}const ou={unsigned(){return 0}};function ce(t,e){return t[e]+t[e+1]*256}function he(t,e){return t[e]+t[e+1]*256+t[e+2]*65536+t[e+3]*16777216}function Ze(t,e){return he(t,e)+he(t,e+4)*4294967296}const au=new TextDecoder;function Kt(t,e){return Gt(t.buffer)&&(t=new Uint8Array(t)),au.decode(t)}async function su(t,e){const n=Math.min(Qn+nu,e),r=e-n,i=await ht(t,r,n);for(let a=n-Qn;a>=0;--a){if(he(i,a)!==ru)continue;const o=new Uint8Array(i.buffer,i.byteOffset+a,i.byteLength-a),s=ce(o,4);if(s!==0)throw new Error(`multi-volume zip files are not supported. This is volume: ${s}`);const u=ce(o,10),l=he(o,12),c=he(o,16),d=ce(o,20),h=o.length-Qn;if(d!==h)throw new Error(`invalid comment length. expected: ${h}, actual: ${d}`);const m=new Uint8Array(o.buffer,o.byteOffset+22,d),p=Kt(m);return u===65535||c===4294967295?await lu(t,r+a,p,m):await Oo(t,c,l,u,p,m)}throw new Error("could not find end of central directory. maybe not zip file")}const uu=117853008;async function lu(t,e,n,r){const i=e-20,a=await ht(t,i,20);if(he(a,0)!==uu)throw new Error("invalid zip64 end of central directory locator signature");const o=Ze(a,8),s=await ht(t,o,56);if(he(s,0)!==iu)throw new Error("invalid zip64 end of central directory record signature");const u=Ze(s,32),l=Ze(s,40),c=Ze(s,48);return Oo(t,c,l,u,n,r)}const cu=33639248;async function Oo(t,e,n,r,i,a){let o=0;const s=await ht(t,e,n),u=[];for(let c=0;c<r;++c){const d=s.subarray(o,o+46),h=he(d,0);if(h!==cu)throw new Error(`invalid central directory file header signature: 0x${h.toString(16)}`);const m={versionMadeBy:ce(d,4),versionNeededToExtract:ce(d,6),generalPurposeBitFlag:ce(d,8),compressionMethod:ce(d,10),lastModFileTime:ce(d,12),lastModFileDate:ce(d,14),crc32:he(d,16),compressedSize:he(d,20),uncompressedSize:he(d,24),fileNameLength:ce(d,28),extraFieldLength:ce(d,30),fileCommentLength:ce(d,32),internalFileAttributes:ce(d,36),externalFileAttributes:he(d,38),relativeOffsetOfLocalHeader:he(d,42)};if(m.generalPurposeBitFlag&64)throw new Error("strong encryption is not supported");o+=46;const p=s.subarray(o,o+m.fileNameLength+m.extraFieldLength+m.fileCommentLength);m.nameBytes=p.slice(0,m.fileNameLength),m.name=Kt(m.nameBytes);const f=m.fileNameLength+m.extraFieldLength,v=p.slice(m.fileNameLength,f);m.extraFields=[];let w=0;for(;w<v.length-3;){const g=ce(v,w+0),b=ce(v,w+2),y=w+4,k=y+b;if(k>v.length)throw new Error("extra field length exceeds extra field buffer size");m.extraFields.push({id:g,data:v.slice(y,k)}),w=k}if(m.commentBytes=p.slice(f,f+m.fileCommentLength),m.comment=Kt(m.commentBytes),o+=p.length,m.uncompressedSize===4294967295||m.compressedSize===4294967295||m.relativeOffsetOfLocalHeader===4294967295){const g=m.extraFields.find(k=>k.id===1);if(!g)throw new Error("expected zip64 extended information extra field");const b=g.data;let y=0;if(m.uncompressedSize===4294967295){if(y+8>b.length)throw new Error("zip64 extended information extra field does not include uncompressed size");m.uncompressedSize=Ze(b,y),y+=8}if(m.compressedSize===4294967295){if(y+8>b.length)throw new Error("zip64 extended information extra field does not include compressed size");m.compressedSize=Ze(b,y),y+=8}if(m.relativeOffsetOfLocalHeader===4294967295){if(y+8>b.length)throw new Error("zip64 extended information extra field does not include relative header offset");m.relativeOffsetOfLocalHeader=Ze(b,y),y+=8}}const _=m.extraFields.find(g=>g.id===28789&&g.data.length>=6&&g.data[0]===1&&he(g.data,1),ou.unsigned(m.nameBytes));if(_&&(m.fileName=Kt(_.data.slice(5))),m.compressionMethod===0){let g=m.uncompressedSize;if((m.generalPurposeBitFlag&1)!==0&&(g+=12),m.compressedSize!==g)throw new Error(`compressed size mismatch for stored file: ${m.compressedSize} != ${g}`)}u.push(m)}return{zip:{comment:i,commentBytes:a},entries:u.map(c=>new tu(t,c))}}async function Mo(t,e){if(e.generalPurposeBitFlag&1)throw new Error("encrypted entries not supported");const n=await ht(t,e.relativeOffsetOfLocalHeader,30),r=await t.getLength(),i=he(n,0);if(i!==67324752)throw new Error(`invalid local file header signature: 0x${i.toString(16)}`);const a=ce(n,26),o=ce(n,28),s=e.relativeOffsetOfLocalHeader+n.length+a+o;let u;if(e.compressionMethod===0)u=!1;else if(e.compressionMethod===8)u=!0;else throw new Error(`unsupported compression method: ${e.compressionMethod}`);const l=s,c=l+e.compressedSize;if(e.compressedSize!==0&&c>r)throw new Error(`file data overflows file bounds: ${l} +  ${e.compressedSize}  > ${r}`);return{decompress:u,fileDataStart:l}}async function fu(t,e){const{decompress:n,fileDataStart:r}=await Mo(t,e);if(!n){const o=await ht(t,r,e.compressedSize);return Ws(o)?o.buffer:o.slice().buffer}const i=await kr(t,r,e.compressedSize);return await Ro(i,e.uncompressedSize)}async function du(t,e,n){const{decompress:r,fileDataStart:i}=await Mo(t,e);if(!r){const s=await kr(t,i,e.compressedSize,n);return Co(s)?s:new Blob([Gt(s.buffer)?new Uint8Array(s):s],{type:n})}const a=await kr(t,i,e.compressedSize);return await Ro(a,e.uncompressedSize,n)}async function hu(t){let e;if(typeof Blob<"u"&&t instanceof Blob)e=new hi(t);else if(t instanceof ArrayBuffer||t&&t.buffer&&t.buffer instanceof ArrayBuffer)e=new di(t);else if(Gt(t)||Gt(t.buffer))e=new di(t);else if(typeof t=="string"){const r=await fetch(t);if(!r.ok)throw new Error(`failed http request ${t}, status: ${r.status}: ${r.statusText}`);const i=await r.blob();e=new hi(i)}else if(typeof t.getLength=="function"&&typeof t.read=="function")e=t;else throw new Error("unsupported source type");const n=await e.getLength();if(n>Number.MAX_SAFE_INTEGER)throw new Error(`file too large. size: ${n}. Only file sizes up 4503599627370496 bytes are supported`);return await su(e,n)}async function pu(t){const{zip:e,entries:n}=await hu(t);return{zip:e,entries:Object.fromEntries(n.map(r=>[r.name,r]))}}const Qt=new DOMParser,mu=(t,e)=>{const n=Qt.parseFromString(t,"text/xml"),{title:r,author:i,coverId:a}=gu(n.querySelector("metadata")),o=yu(n.querySelector("manifest")),s=_u(n.querySelector("spine"),o),u=o.has(a)?e.get(o.get(a)):void 0;return{meta:{title:r,author:i,cover:u},spine:s}},vu=async t=>{const{entries:e}=await pu(t),n=new Map,r=new Map,i=new Map,a=new Map;let o="",s="";for(const[u,l]of Object.entries(e))switch(u.substring(u.lastIndexOf("."))){case".opf":s=await l.text();break;case".png":case".jpg":case".jpeg":case".gif":{const c=await l.blob();n.set(Ye(u),c);break}case".css":{const c=await l.text();i.set(u,ku(c,"#container"));break}case".htm":case".xml":case".html":case".xhtml":{const c=await l.text();r.set(Ye(u),c);break}case".otf":case".ttf":case".woff":{const c=await l.blob();a.set(Ye(u),c);break}case".ncx":{o=await l.text();break}}return{images:n,htmls:r,styles:i,fonts:a,tocNcx:o,opf:s}},gu=t=>{var i;const e=t.querySelector("title").textContent,n=Array.from(t.querySelectorAll("creator")).map(a=>a.textContent),r=(i=t.querySelector("[name='cover']"))==null?void 0:i.attributes.content.value;return{title:e,author:n,coverId:r}},yu=t=>{const e=new Map;for(const n of t.children)e.set(n.attributes.id.value,Ye(n.attributes.href.value));return e},_u=(t,e)=>Array.from(t.children).map(n=>e.get(n.attributes.idref.value)),Ye=t=>decodeURI(t.split("\\").pop().split("/").pop()),bu=(t,e)=>{const n=Qt.parseFromString(t,"application/xhtml+xml").querySelector("img");if(n&&n.hasAttribute("src"))return e.get(Ye(n.getAttribute("src")))},wu=t=>{let e=Qt.parseFromString(t,"application/xhtml+xml");e.querySelector("parsererror")&&(e=Qt.parseFromString(t,"text/html"));for(const r of e.querySelectorAll("[src],[href], image"))switch(r.tagName){case"img":{const i=Ye(r.getAttribute("src"));r.setAttribute("src","ESSENCE-READER-IMAGE-"+i),r.style.cssText+="max-height: 100%; max-width: 100%; object-fit: scale-down;";break}case"image":{const i=Ye(r.getAttributeNS("http://www.w3.org/1999/xlink","href"));r.setAttributeNS("http://www.w3.org/1999/xlink","href","ESSENCE-READER-IMAGE-"+i);break}default:{r.getAttribute("src")!==null&&!r.getAttribute("src").includes("http")&&r.removeAttribute("src");break}}return e.body.innerHTML},ku=(t,e)=>{let n=[];return t=t.replace(/@(-moz-|-webkit-|-ms-)*keyframes\s(.*?){([0-9%a-zA-Z,\s.]*{(.*?)})*[\s\n]*}/g,r=>n.push(r)&&"__keyframes__"),t=t.replace(/([^\r\n,{}]+)(,(?=[^}]*{)|\s*{)/g,r=>r.trim()[0]==="@"?r:r.replace(/(\s*)/,"$1"+e+" ")),t.replace(/__keyframes__/g,r=>n.shift())},Eu=(t,e)=>{const n=[],r=Qt.parseFromString(t,"application/xml").querySelectorAll("navPoint");for(const i of r){const a=i.querySelector("text").textContent;let o=Ye(i.querySelector("content").attributes.src.value);o.includes("#")&&(o=o.substring(0,o.indexOf("#")));const s=e.get(o).index,u=i.parentElement.nodeName==="navPoint";n.push({name:a,index:s,isChild:u})}return n},Au=async t=>{try{const{images:e,htmls:n,styles:r,fonts:i,tocNcx:a,opf:o}=await vu(t),{meta:s,spine:u}=mu(o,e);s.cover===void 0&&(s.cover=bu(n.get(u[0]),e));const l=new Map;u.forEach((d,h)=>{l.set(d,{index:h,html:n.has(d)?wu(n.get(d)):null})});const c=Eu(a,l);return{meta:s,contents:l,spine:u,toc:c,files:{images:e,fonts:i,styles:r},progress:0}}catch{throw new Error(t.name+" does not appear to be a valid EPUB file")}},Su=(t,e,n)=>t.replace(/url\((?!['"]?(?:data):)['"]?([^'"\)]*)['"]?\)/g,function(i,a){const o=a.split("\\").pop().split("/").pop(),s=[".png",".jpg",".jpeg",".gif"],u=[".otf",".ttf",".woff"];return s.some(l=>o.endsWith(l))&&e.has(o)?"url("+URL.createObjectURL(e.get(o))+")":u.some(l=>o.endsWith(l))&&n.has(o)?"url("+URL.createObjectURL(n.get(o))+")":""}),xu=(t,e)=>t.replace(/ESSENCE-READER-IMAGE-([^?#"']*)/g,function(n,r){return e.has(r)?URL.createObjectURL(e.get(r)):""}),Cu=t=>{try{return t.contents.forEach((e,n,r)=>r.set(n,{index:e.index,html:xu(e.html,t.files.images)})),t.files.styles.forEach((e,n,r)=>r.set(n,Su(e,t.files.images,t.files.fonts))),t}catch{alert("An error occured when opening book, please try removing it and adding it again")}};function Do(t){const e=t-1;return e*e*e+1}function rt(t,{delay:e=0,duration:n=400,easing:r=In}={}){const i=+getComputedStyle(t).opacity;return{delay:e,duration:n,easing:r,css:a=>`opacity: ${a*i}`}}function yi(t,{delay:e=0,duration:n=400,easing:r=Do,x:i=0,y:a=0,opacity:o=0}={}){const s=getComputedStyle(t),u=+s.opacity,l=s.transform==="none"?"":s.transform,c=u*(1-o);return{delay:e,duration:n,easing:r,css:(d,h)=>`
			transform: ${l} translate(${(1-d)*i}px, ${(1-d)*a}px);
			opacity: ${u-c*h}`}}const Bu=t=>({}),_i=t=>({}),Tu=t=>({}),bi=t=>({}),Ru=t=>({}),wi=t=>({});function Ou(t){let e,n,r,i,a,o,s,u;const l=t[2].leftbar,c=St(l,t,t[1],wi),d=t[2].toptext,h=St(d,t,t[1],bi),m=t[2].rightbar,p=St(m,t,t[1],_i);return{c(){e=D("div"),n=D("div"),c&&c.c(),r=H(),i=D("div"),h&&h.c(),a=H(),o=D("div"),p&&p.c(),M(n,"class","buttonbar svelte-16kcssx"),M(n,"id","leftbar"),M(i,"id","toptext"),M(i,"class","svelte-16kcssx"),M(o,"class","buttonbar svelte-16kcssx"),M(o,"id","rightbar"),M(e,"id","topbar"),M(e,"style",s=t[0]?"color: rgba(0, 0, 0, 0.5);":" "),M(e,"class","svelte-16kcssx")},m(f,v){T(f,e,v),S(e,n),c&&c.m(n,null),S(e,r),S(e,i),h&&h.m(i,null),S(e,a),S(e,o),p&&p.m(o,null),u=!0},p(f,[v]){c&&c.p&&(!u||v&2)&&Ct(c,l,f,f[1],u?xt(l,f[1],v,Ru):Bt(f[1]),wi),h&&h.p&&(!u||v&2)&&Ct(h,d,f,f[1],u?xt(d,f[1],v,Tu):Bt(f[1]),bi),p&&p.p&&(!u||v&2)&&Ct(p,m,f,f[1],u?xt(m,f[1],v,Bu):Bt(f[1]),_i),(!u||v&1&&s!==(s=f[0]?"color: rgba(0, 0, 0, 0.5);":" "))&&M(e,"style",s)},i(f){u||(z(c,f),z(h,f),z(p,f),u=!0)},o(f){U(c,f),U(h,f),U(p,f),u=!1},d(f){f&&C(e),c&&c.d(f),h&&h.d(f),p&&p.d(f)}}}function Mu(t,e,n){let{$$slots:r={},$$scope:i}=e,{toned:a=!1}=e;return t.$$set=o=>{"toned"in o&&n(0,a=o.toned),"$$scope"in o&&n(1,i=o.$$scope)},[a,i,r]}class Io extends ye{constructor(e){super(),ge(this,e,Mu,Ou,ve,{toned:0})}}function Du(t){let e,n,r,i,a,o,s,u,l;return{c(){e=D("button"),e.textContent="warm",n=H(),r=D("button"),r.textContent="black",i=H(),a=D("button"),a.textContent="dark",o=H(),s=D("button"),s.textContent="light",Q(e,"background-color","#f6e4bd"),Q(e,"color","#000"),M(e,"class","svelte-k014sn"),Q(r,"background-color","#000"),Q(r,"color","#e9e9e9"),M(r,"class","svelte-k014sn"),Q(a,"background-color","#032038"),Q(a,"color","#e9e9e9"),M(a,"class","svelte-k014sn"),Q(s,"background-color","#fff"),Q(s,"color","#000"),M(s,"class","svelte-k014sn")},m(c,d){T(c,e,d),T(c,n,d),T(c,r,d),T(c,i,d),T(c,a,d),T(c,o,d),T(c,s,d),u||(l=[ee(e,"click",t[1]),ee(r,"click",t[2]),ee(a,"click",t[3]),ee(s,"click",t[4])],u=!0)},p:N,i:N,o:N,d(c){c&&C(e),c&&C(n),c&&C(r),c&&C(i),c&&C(a),c&&C(o),c&&C(s),u=!1,xe(l)}}}function Iu(t){const e=o=>{document.documentElement.setAttribute("data-theme",o),localStorage.setItem("theme",o)};return[e,()=>e("warm"),()=>e("black"),()=>e("dark"),()=>e("light")]}class Po extends ye{constructor(e){super(),ge(this,e,Iu,Du,ve,{})}}function Pu(t){let e,n,r,i,a,o,s,u,l,c,d,h,m,p,f,v,w,_,g,b,y,k,x,A;return y=new Po({}),{c(){e=D("label"),e.textContent="Font:",n=H(),r=D("br"),i=H(),a=D("select"),o=D("option"),o.textContent="Default",s=D("option"),s.textContent="Verdana",u=D("option"),u.textContent="Arial",l=D("option"),l.textContent="Courier New ",c=D("option"),c.textContent="Helvetica",d=D("option"),d.textContent="Times New Roman",h=H(),m=D("br"),p=H(),f=D("label"),f.textContent="Scale:",v=H(),w=D("br"),_=H(),g=D("input"),b=H(),oe(y.$$.fragment),M(e,"for","fontpicker"),o.__value="Default",o.value=o.__value,Q(s,"font-family","'Verdana'"),s.__value="Verdana",s.value=s.__value,Q(u,"font-family","'Arial'"),u.__value="Arial",u.value=u.__value,Q(l,"font-family","'Courier New '"),l.__value="Courier New ",l.value=l.__value,Q(c,"font-family","'Helvetica'"),c.__value="Helvetica",c.value=c.__value,Q(d,"font-family","'Times New Roman'"),d.__value="Times New Roman",d.value=d.__value,M(a,"name","fontpicker"),Q(a,"width","100%"),t[0].fontFamily===void 0&&ke(()=>t[1].call(a)),M(f,"for","scale"),M(g,"name","scale"),M(g,"type","range"),M(g,"min","5"),M(g,"max","30")},m(E,B){T(E,e,B),T(E,n,B),T(E,r,B),T(E,i,B),T(E,a,B),S(a,o),S(a,s),S(a,u),S(a,l),S(a,c),S(a,d),Jr(a,t[0].fontFamily),T(E,h,B),T(E,m,B),T(E,p,B),T(E,f,B),T(E,v,B),T(E,w,B),T(E,_,B),T(E,g,B),Xr(g,t[0].scale),T(E,b,B),te(y,E,B),k=!0,x||(A=[ee(a,"change",t[1]),ee(g,"change",t[2]),ee(g,"input",t[2])],x=!0)},p(E,[B]){B&1&&Jr(a,E[0].fontFamily),B&1&&Xr(g,E[0].scale)},i(E){k||(z(y.$$.fragment,E),k=!0)},o(E){U(y.$$.fragment,E),k=!1},d(E){E&&C(e),E&&C(n),E&&C(r),E&&C(i),E&&C(a),E&&C(h),E&&C(m),E&&C(p),E&&C(f),E&&C(v),E&&C(w),E&&C(_),E&&C(g),E&&C(b),ne(y,E),x=!1,xe(A)}}}function Ku(t,e,n){let{settings:r}=e;function i(){r.fontFamily=Jo(this),n(0,r)}function a(){r.scale=Qo(this.value),n(0,r)}return t.$$set=o=>{"settings"in o&&n(0,r=o.settings)},[r,i,a]}class Fu extends ye{constructor(e){super(),ge(this,e,Ku,Pu,ve,{settings:0})}}const Lu=t=>({}),ki=t=>({});function Ei(t){let e,n,r,i,a;const o=t[4].default,s=St(o,t,t[3],null);return{c(){e=D("div"),s&&s.c(),M(e,"class","popover svelte-1eiwdr8")},m(u,l){T(u,e,l),s&&s.m(e,null),r=!0,i||(a=Wo(t[2].call(null,e)),i=!0)},p(u,l){s&&s.p&&(!r||l&8)&&Ct(s,o,u,u[3],r?xt(o,u[3],l,null):Bt(u[3]),null)},i(u){r||(z(s,u),ke(()=>{n||(n=An(e,yi,{x:50,duration:200},!0)),n.run(1)}),r=!0)},o(u){U(s,u),n||(n=An(e,yi,{x:50,duration:200},!1)),n.run(0),r=!1},d(u){u&&C(e),s&&s.d(u),u&&n&&n.end(),i=!1,a()}}}function zu(t){let e,n,r,i,a,o;const s=t[4].icon,u=St(s,t,t[3],ki);let l=t[0]&&Ei(t);return{c(){e=D("button"),u&&u.c(),n=H(),l&&l.c(),r=Cr(),M(e,"class","popoverBtn svelte-1eiwdr8")},m(c,d){T(c,e,d),u&&u.m(e,null),t[5](e),T(c,n,d),l&&l.m(c,d),T(c,r,d),i=!0,a||(o=ee(e,"click",t[6]),a=!0)},p(c,[d]){u&&u.p&&(!i||d&8)&&Ct(u,s,c,c[3],i?xt(s,c[3],d,Lu):Bt(c[3]),ki),c[0]?l?(l.p(c,d),d&1&&z(l,1)):(l=Ei(c),l.c(),z(l,1),l.m(r.parentNode,r)):l&&(pt(),U(l,1,1,()=>{l=null}),mt())},i(c){i||(z(u,c),z(l),i=!0)},o(c){U(u,c),U(l),i=!1},d(c){c&&C(e),u&&u.d(c),t[5](null),c&&C(n),l&&l.d(c),c&&C(r),a=!1,o()}}}function Nu(t,e,n){let{$$slots:r={},$$scope:i}=e,a,o;function s(c){const d=h=>{h.target instanceof Element&&!c.contains(h.target)&&h.target!==o&&n(0,a=!1)};return document.addEventListener("click",d,!0),{destroy(){document.removeEventListener("click",d,!0)}}}function u(c){ze[c?"unshift":"push"](()=>{o=c,n(1,o)})}const l=()=>n(0,a=!a);return t.$$set=c=>{"$$scope"in c&&n(3,i=c.$$scope)},[a,o,s,i,r,u,l]}class Er extends ye{constructor(e){super(),ge(this,e,Nu,zu,ve,{})}}function Hu(t){let e,n,r=t[0].name+"",i,a,o,s;return{c(){e=D("button"),n=Y("- "),i=Y(r),M(e,"class","tocButton svelte-p2xs1d"),M(e,"style",a=(t[2]?"border: 1px solid lightblue; font-weight: bold;":"")+" "+(t[0].isChild?"padding-left: 2em;":""))},m(u,l){T(u,e,l),S(e,n),S(e,i),o||(s=ee(e,"click",function(){it(t[1])&&t[1].apply(this,arguments)}),o=!0)},p(u,[l]){t=u,l&1&&r!==(r=t[0].name+"")&&ie(i,r),l&5&&a!==(a=(t[2]?"border: 1px solid lightblue; font-weight: bold;":"")+" "+(t[0].isChild?"padding-left: 2em;":""))&&M(e,"style",a)},i:N,o:N,d(u){u&&C(e),o=!1,s()}}}function Uu(t,e,n){let{tocitem:r}=e,{onclick:i}=e,{selected:a}=e;return t.$$set=o=>{"tocitem"in o&&n(0,r=o.tocitem),"onclick"in o&&n(1,i=o.onclick),"selected"in o&&n(2,a=o.selected)},[r,i,a]}class ju extends ye{constructor(e){super(),ge(this,e,Uu,Hu,ve,{tocitem:0,onclick:1,selected:2})}}const Vu=t=>{let e=document.getElementById("user-settings");e||(e=document.createElement("style"),e.id="user-settings",document.head.appendChild(e)),e.innerText="#container { transform: scale("+t.scale/10+"); width: "+50/(t.scale/10)+"%; } @media (max-width: 1500px) {#container { width: "+90/(t.scale/10)+"%}}"+(t.fontFamily!=="Default"?" #container p, #container a, #container span { font-family: "+t.fontFamily+" !important;}":""),localStorage.setItem("settings",JSON.stringify(t))},Wu=t=>{for(const e of document.getElementsByClassName("essence-reader"))e.remove();t.forEach(e=>{const n=document.createElement("style");n.innerText=e,n.className="essence-reader",document.head.appendChild(n)})},Yu=(t,e)=>{t!==-1&&Be.books.update(t,{progress:e})},qu=(t,e)=>{for(const n of t)if(n.getAttribute("href").includes("http"))n.setAttribute("target","_blank");else{let r=n.getAttribute("href").split("\\").pop().split("/").pop();n.addEventListener("click",i=>{i.preventDefault(),r.includes("#")&&(r=r.substring(0,r.indexOf("#"))),e(r)})}};function Ai(t){let e,n;return{c(){e=X("title"),n=Y(t[1])},m(r,i){T(r,e,i),S(e,n)},p(r,i){i&2&&ie(n,r[1])},d(r){r&&C(e)}}}function Gu(t){let e,n,r,i=t[1]&&Ai(t),a=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:t[0]},{height:t[0]},t[2],t[3]],o={};for(let s=0;s<a.length;s+=1)o=Z(o,a[s]);return{c(){e=X("svg"),i&&i.c(),n=X("path"),r=X("path"),M(n,"d","M27,16.76c0-.25,0-.5,0-.76s0-.51,0-.77l1.92-1.68A2,2,0,0,0,29.3,11L26.94,7a2,2,0,0,0-1.73-1,2,2,0,0,0-.64.1l-2.43.82a11.35,11.35,0,0,0-1.31-.75l-.51-2.52a2,2,0,0,0-2-1.61H13.64a2,2,0,0,0-2,1.61l-.51,2.52a11.48,11.48,0,0,0-1.32.75L7.43,6.06A2,2,0,0,0,6.79,6,2,2,0,0,0,5.06,7L2.7,11a2,2,0,0,0,.41,2.51L5,15.24c0,.25,0,.5,0,.76s0,.51,0,.77L3.11,18.45A2,2,0,0,0,2.7,21L5.06,25a2,2,0,0,0,1.73,1,2,2,0,0,0,.64-.1l2.43-.82a11.35,11.35,0,0,0,1.31.75l.51,2.52a2,2,0,0,0,2,1.61h4.72a2,2,0,0,0,2-1.61l.51-2.52a11.48,11.48,0,0,0,1.32-.75l2.42.82a2,2,0,0,0,.64.1,2,2,0,0,0,1.73-1L29.3,21a2,2,0,0,0-.41-2.51ZM25.21,24l-3.43-1.16a8.86,8.86,0,0,1-2.71,1.57L18.36,28H13.64l-.71-3.55a9.36,9.36,0,0,1-2.7-1.57L6.79,24,4.43,20l2.72-2.4a8.9,8.9,0,0,1,0-3.13L4.43,12,6.79,8l3.43,1.16a8.86,8.86,0,0,1,2.71-1.57L13.64,4h4.72l.71,3.55a9.36,9.36,0,0,1,2.7,1.57L25.21,8,27.57,12l-2.72,2.4a8.9,8.9,0,0,1,0,3.13L27.57,20Z"),M(r,"d","M16,22a6,6,0,1,1,6-6A5.94,5.94,0,0,1,16,22Zm0-10a3.91,3.91,0,0,0-4,4,3.91,3.91,0,0,0,4,4,3.91,3.91,0,0,0,4-4A3.91,3.91,0,0,0,16,12Z"),we(e,o)},m(s,u){T(s,e,u),i&&i.m(e,null),S(e,n),S(e,r)},p(s,[u]){s[1]?i?i.p(s,u):(i=Ai(s),i.c(),i.m(e,n)):i&&(i.d(1),i=null),we(e,o=ot(a,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},u&1&&{width:s[0]},u&1&&{height:s[0]},u&4&&s[2],u&8&&s[3]]))},i:N,o:N,d(s){s&&C(e),i&&i.d()}}}function Qu(t,e,n){let r,i;const a=["size","title"];let o=be(e,a),{size:s=16}=e,{title:u=void 0}=e;return t.$$set=l=>{n(5,e=Z(Z({},e),_e(l))),n(3,o=be(e,a)),"size"in l&&n(0,s=l.size),"title"in l&&n(1,u=l.title)},t.$$.update=()=>{n(4,r=e["aria-label"]||e["aria-labelledby"]||u),n(2,i={"aria-hidden":r?void 0:!0,role:r?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=_e(e),[s,u,i,o,r]}class Ko extends ye{constructor(e){super(),ge(this,e,Qu,Gu,ve,{size:0,title:1})}}function Si(t){let e,n;return{c(){e=X("title"),n=Y(t[1])},m(r,i){T(r,e,i),S(e,n)},p(r,i){i&2&&ie(n,r[1])},d(r){r&&C(e)}}}function Xu(t){let e,n,r=t[1]&&Si(t),i=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:t[0]},{height:t[0]},t[2],t[3]],a={};for(let o=0;o<i.length;o+=1)a=Z(a,i[o]);return{c(){e=X("svg"),r&&r.c(),n=X("path"),M(n,"d","M4 6H22V8H4zM4 12H22V14H4zM4 18H22V20H4zM4 24H22V26H4zM26 6H28V8H26zM26 12H28V14H26zM26 18H28V20H26zM26 24H28V26H26z"),we(e,a)},m(o,s){T(o,e,s),r&&r.m(e,null),S(e,n)},p(o,[s]){o[1]?r?r.p(o,s):(r=Si(o),r.c(),r.m(e,n)):r&&(r.d(1),r=null),we(e,a=ot(i,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},s&1&&{width:o[0]},s&1&&{height:o[0]},s&4&&o[2],s&8&&o[3]]))},i:N,o:N,d(o){o&&C(e),r&&r.d()}}}function Ju(t,e,n){let r,i;const a=["size","title"];let o=be(e,a),{size:s=16}=e,{title:u=void 0}=e;return t.$$set=l=>{n(5,e=Z(Z({},e),_e(l))),n(3,o=be(e,a)),"size"in l&&n(0,s=l.size),"title"in l&&n(1,u=l.title)},t.$$.update=()=>{n(4,r=e["aria-label"]||e["aria-labelledby"]||u),n(2,i={"aria-hidden":r?void 0:!0,role:r?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=_e(e),[s,u,i,o,r]}class Zu extends ye{constructor(e){super(),ge(this,e,Ju,Xu,ve,{size:0,title:1})}}function xi(t){let e,n;return{c(){e=X("title"),n=Y(t[1])},m(r,i){T(r,e,i),S(e,n)},p(r,i){i&2&&ie(n,r[1])},d(r){r&&C(e)}}}function $u(t){let e,n,r=t[1]&&xi(t),i=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:t[0]},{height:t[0]},t[2],t[3]],a={};for(let o=0;o<i.length;o+=1)a=Z(a,i[o]);return{c(){e=X("svg"),r&&r.c(),n=X("path"),M(n,"d","M18 6L16.57 7.393 24.15 15 4 15 4 17 24.15 17 16.57 24.573 18 26 28 16 18 6z"),we(e,a)},m(o,s){T(o,e,s),r&&r.m(e,null),S(e,n)},p(o,[s]){o[1]?r?r.p(o,s):(r=xi(o),r.c(),r.m(e,n)):r&&(r.d(1),r=null),we(e,a=ot(i,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},s&1&&{width:o[0]},s&1&&{height:o[0]},s&4&&o[2],s&8&&o[3]]))},i:N,o:N,d(o){o&&C(e),r&&r.d()}}}function el(t,e,n){let r,i;const a=["size","title"];let o=be(e,a),{size:s=16}=e,{title:u=void 0}=e;return t.$$set=l=>{n(5,e=Z(Z({},e),_e(l))),n(3,o=be(e,a)),"size"in l&&n(0,s=l.size),"title"in l&&n(1,u=l.title)},t.$$.update=()=>{n(4,r=e["aria-label"]||e["aria-labelledby"]||u),n(2,i={"aria-hidden":r?void 0:!0,role:r?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=_e(e),[s,u,i,o,r]}class tl extends ye{constructor(e){super(),ge(this,e,el,$u,ve,{size:0,title:1})}}function Ci(t){let e,n;return{c(){e=X("title"),n=Y(t[1])},m(r,i){T(r,e,i),S(e,n)},p(r,i){i&2&&ie(n,r[1])},d(r){r&&C(e)}}}function nl(t){let e,n,r=t[1]&&Ci(t),i=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:t[0]},{height:t[0]},t[2],t[3]],a={};for(let o=0;o<i.length;o+=1)a=Z(a,i[o]);return{c(){e=X("svg"),r&&r.c(),n=X("path"),M(n,"d","M14 26L15.41 24.59 7.83 17 28 17 28 15 7.83 15 15.41 7.41 14 6 4 16 14 26z"),we(e,a)},m(o,s){T(o,e,s),r&&r.m(e,null),S(e,n)},p(o,[s]){o[1]?r?r.p(o,s):(r=Ci(o),r.c(),r.m(e,n)):r&&(r.d(1),r=null),we(e,a=ot(i,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},s&1&&{width:o[0]},s&1&&{height:o[0]},s&4&&o[2],s&8&&o[3]]))},i:N,o:N,d(o){o&&C(e),r&&r.d()}}}function rl(t,e,n){let r,i;const a=["size","title"];let o=be(e,a),{size:s=16}=e,{title:u=void 0}=e;return t.$$set=l=>{n(5,e=Z(Z({},e),_e(l))),n(3,o=be(e,a)),"size"in l&&n(0,s=l.size),"title"in l&&n(1,u=l.title)},t.$$.update=()=>{n(4,r=e["aria-label"]||e["aria-labelledby"]||u),n(2,i={"aria-hidden":r?void 0:!0,role:r?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=_e(e),[s,u,i,o,r]}class il extends ye{constructor(e){super(),ge(this,e,rl,nl,ve,{size:0,title:1})}}function Bi(t){let e,n;return{c(){e=X("title"),n=Y(t[1])},m(r,i){T(r,e,i),S(e,n)},p(r,i){i&2&&ie(n,r[1])},d(r){r&&C(e)}}}function ol(t){let e,n,r=t[1]&&Bi(t),i=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:t[0]},{height:t[0]},t[2],t[3]],a={};for(let o=0;o<i.length;o+=1)a=Z(a,i[o]);return{c(){e=X("svg"),r&&r.c(),n=X("path"),M(n,"d","M10 16L20 6 21.4 7.4 12.8 16 21.4 24.6 20 26z"),we(e,a)},m(o,s){T(o,e,s),r&&r.m(e,null),S(e,n)},p(o,[s]){o[1]?r?r.p(o,s):(r=Bi(o),r.c(),r.m(e,n)):r&&(r.d(1),r=null),we(e,a=ot(i,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},s&1&&{width:o[0]},s&1&&{height:o[0]},s&4&&o[2],s&8&&o[3]]))},i:N,o:N,d(o){o&&C(e),r&&r.d()}}}function al(t,e,n){let r,i;const a=["size","title"];let o=be(e,a),{size:s=16}=e,{title:u=void 0}=e;return t.$$set=l=>{n(5,e=Z(Z({},e),_e(l))),n(3,o=be(e,a)),"size"in l&&n(0,s=l.size),"title"in l&&n(1,u=l.title)},t.$$.update=()=>{n(4,r=e["aria-label"]||e["aria-labelledby"]||u),n(2,i={"aria-hidden":r?void 0:!0,role:r?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=_e(e),[s,u,i,o,r]}class sl extends ye{constructor(e){super(),ge(this,e,al,ol,ve,{size:0,title:1})}}function Ti(t){let e,n;return{c(){e=X("title"),n=Y(t[1])},m(r,i){T(r,e,i),S(e,n)},p(r,i){i&2&&ie(n,r[1])},d(r){r&&C(e)}}}function ul(t){let e,n,r,i=t[1]&&Ti(t),a=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:t[0]},{height:t[0]},t[2],t[3]],o={};for(let s=0;s<a.length;s+=1)o=Z(o,a[s]);return{c(){e=X("svg"),i&&i.c(),n=X("path"),r=X("path"),M(n,"d","M16 20H18V28H16z"),M(r,"d","M23,4a7.0078,7.0078,0,0,0-7,7v3h2V11a5,5,0,1,1,5,5H5.8281l4.586-4.5859L9,10,2,17l7,7,1.4141-1.4141L5.8281,18H23A7,7,0,0,0,23,4Z"),we(e,o)},m(s,u){T(s,e,u),i&&i.m(e,null),S(e,n),S(e,r)},p(s,[u]){s[1]?i?i.p(s,u):(i=Ti(s),i.c(),i.m(e,n)):i&&(i.d(1),i=null),we(e,o=ot(a,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},u&1&&{width:s[0]},u&1&&{height:s[0]},u&4&&s[2],u&8&&s[3]]))},i:N,o:N,d(s){s&&C(e),i&&i.d()}}}function ll(t,e,n){let r,i;const a=["size","title"];let o=be(e,a),{size:s=16}=e,{title:u=void 0}=e;return t.$$set=l=>{n(5,e=Z(Z({},e),_e(l))),n(3,o=be(e,a)),"size"in l&&n(0,s=l.size),"title"in l&&n(1,u=l.title)},t.$$.update=()=>{n(4,r=e["aria-label"]||e["aria-labelledby"]||u),n(2,i={"aria-hidden":r?void 0:!0,role:r?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=_e(e),[s,u,i,o,r]}class cl extends ye{constructor(e){super(),ge(this,e,ll,ul,ve,{size:0,title:1})}}const{document:Ri}=la;function Oi(t,e,n){const r=t.slice();return r[24]=e[n],r}function fl(t){let e,n,r,i,a;return n=new sl({props:{size:24}}),{c(){e=D("button"),oe(n.$$.fragment),M(e,"slot","leftbar")},m(o,s){T(o,e,s),te(n,e,null),r=!0,i||(a=ee(e,"click",t[18]),i=!0)},p:N,i(o){r||(z(n.$$.fragment,o),r=!0)},o(o){U(n.$$.fragment,o),r=!1},d(o){o&&C(e),ne(n),i=!1,a()}}}function dl(t){let e,n,r=t[1].meta.title+"",i,a,o,s=t[1].meta.author+"",u,l,c,d,h,m=t[1].spine.length-1+"",p;return{c(){e=D("h4"),n=D("b"),i=Y(r),a=Y(" -"),o=H(),u=Y(s),l=H(),c=D("p"),d=Y(t[4]),h=Y("/"),p=Y(m)},m(f,v){T(f,e,v),S(e,n),S(n,i),S(n,a),S(e,o),S(e,u),T(f,l,v),T(f,c,v),S(c,d),S(c,h),S(c,p)},p(f,v){v&2&&r!==(r=f[1].meta.title+"")&&ie(i,r),v&2&&s!==(s=f[1].meta.author+"")&&ie(u,s),v&16&&ie(d,f[4]),v&2&&m!==(m=f[1].spine.length-1+"")&&ie(p,m)},d(f){f&&C(e),f&&C(l),f&&C(c)}}}function Mi(t){let e,n,r,i=t[6][t[6].length-1]+"",a,o,s,u,l;return n=new cl({}),{c(){e=D("button"),oe(n.$$.fragment),r=H(),a=Y(i),M(e,"id","jumpbtn"),M(e,"class","svelte-1si9v5y")},m(c,d){T(c,e,d),te(n,e,null),S(e,r),S(e,a),s=!0,u||(l=ee(e,"click",t[13]),u=!0)},p(c,d){(!s||d&64)&&i!==(i=c[6][c[6].length-1]+"")&&ie(a,i)},i(c){s||(z(n.$$.fragment,c),ke(()=>{o||(o=An(e,rt,{duration:200},!0)),o.run(1)}),s=!0)},o(c){U(n.$$.fragment,c),o||(o=An(e,rt,{duration:200},!1)),o.run(0),s=!1},d(c){c&&C(e),ne(n),c&&o&&o.end(),u=!1,l()}}}function Di(t){let e,n;function r(){return t[14](t[24])}return e=new ju({props:{tocitem:t[24],selected:t[4]===t[24].index,onclick:r}}),{c(){oe(e.$$.fragment)},m(i,a){te(e,i,a),n=!0},p(i,a){t=i;const o={};a&2&&(o.tocitem=t[24]),a&18&&(o.selected=t[4]===t[24].index),a&2&&(o.onclick=r),e.$set(o)},i(i){n||(z(e.$$.fragment,i),n=!0)},o(i){U(e.$$.fragment,i),n=!1},d(i){ne(e,i)}}}function hl(t){let e,n,r=t[1].toc,i=[];for(let o=0;o<r.length;o+=1)i[o]=Di(Oi(t,r,o));const a=o=>U(i[o],1,1,()=>{i[o]=null});return{c(){for(let o=0;o<i.length;o+=1)i[o].c();e=Cr()},m(o,s){for(let u=0;u<i.length;u+=1)i[u].m(o,s);T(o,e,s),n=!0},p(o,s){if(s&530){r=o[1].toc;let u;for(u=0;u<r.length;u+=1){const l=Oi(o,r,u);i[u]?(i[u].p(l,s),z(i[u],1)):(i[u]=Di(l),i[u].c(),z(i[u],1),i[u].m(e.parentNode,e))}for(pt(),u=r.length;u<i.length;u+=1)a(u);mt()}},i(o){if(!n){for(let s=0;s<r.length;s+=1)z(i[s]);n=!0}},o(o){i=i.filter(Boolean);for(let s=0;s<i.length;s+=1)U(i[s]);n=!1},d(o){Go(i,o),o&&C(e)}}}function pl(t){let e,n;return e=new Zu({props:{size:24,slot:"icon"}}),{c(){oe(e.$$.fragment)},m(r,i){te(e,r,i),n=!0},p:N,i(r){n||(z(e.$$.fragment,r),n=!0)},o(r){U(e.$$.fragment,r),n=!1},d(r){ne(e,r)}}}function ml(t){let e,n,r;function i(o){t[15](o)}let a={};return t[2]!==void 0&&(a.settings=t[2]),e=new Fu({props:a}),ze.push(()=>Nt(e,"settings",i)),{c(){oe(e.$$.fragment)},m(o,s){te(e,o,s),r=!0},p(o,s){const u={};!n&&s&4&&(n=!0,u.settings=o[2],Lt(()=>n=!1)),e.$set(u)},i(o){r||(z(e.$$.fragment,o),r=!0)},o(o){U(e.$$.fragment,o),r=!1},d(o){ne(e,o)}}}function vl(t){let e,n;return e=new Ko({props:{size:24,slot:"icon"}}),{c(){oe(e.$$.fragment)},m(r,i){te(e,r,i),n=!0},p:N,i(r){n||(z(e.$$.fragment,r),n=!0)},o(r){U(e.$$.fragment,r),n=!1},d(r){ne(e,r)}}}function gl(t){let e,n,r,i,a,o,s,u,l,c,d,h,m,p=t[6].length!==0&&Mi(t);return n=new Er({props:{$$slots:{icon:[pl],default:[hl]},$$scope:{ctx:t}}}),i=new Er({props:{$$slots:{icon:[vl],default:[ml]},$$scope:{ctx:t}}}),s=new il({props:{size:24}}),c=new tl({props:{size:24}}),{c(){p&&p.c(),e=H(),oe(n.$$.fragment),r=H(),oe(i.$$.fragment),a=H(),o=D("button"),oe(s.$$.fragment),u=H(),l=D("button"),oe(c.$$.fragment)},m(f,v){p&&p.m(f,v),T(f,e,v),te(n,f,v),T(f,r,v),te(i,f,v),T(f,a,v),T(f,o,v),te(s,o,null),T(f,u,v),T(f,l,v),te(c,l,null),d=!0,h||(m=[ee(o,"click",t[16]),ee(l,"click",t[17])],h=!0)},p(f,v){f[6].length!==0?p?(p.p(f,v),v&64&&z(p,1)):(p=Mi(f),p.c(),z(p,1),p.m(e.parentNode,e)):p&&(pt(),U(p,1,1,()=>{p=null}),mt());const w={};v&134217746&&(w.$$scope={dirty:v,ctx:f}),n.$set(w);const _={};v&134217732&&(_.$$scope={dirty:v,ctx:f}),i.$set(_)},i(f){d||(z(p),z(n.$$.fragment,f),z(i.$$.fragment,f),z(s.$$.fragment,f),z(c.$$.fragment,f),d=!0)},o(f){U(p),U(n.$$.fragment,f),U(i.$$.fragment,f),U(s.$$.fragment,f),U(c.$$.fragment,f),d=!1},d(f){p&&p.d(f),f&&C(e),ne(n,f),f&&C(r),ne(i,f),f&&C(a),f&&C(o),ne(s),f&&C(u),f&&C(l),ne(c),h=!1,xe(m)}}}function yl(t){let e=!1,n=()=>{e=!1},r,i,a,o,s,u,l,c,d,h,m;return ke(t[12]),Ri.title=i=`
        `+(t[1].meta.title+" - "+t[1].meta.author)+`
    `,s=new Io({props:{toned:t[5]>100,$$slots:{rightbar:[gl],toptext:[dl],leftbar:[fl]},$$scope:{ctx:t}}}),{c(){a=H(),o=D("div"),oe(s.$$.fragment),u=H(),l=D("div"),M(l,"id","container"),M(l,"class","svelte-1si9v5y")},m(p,f){T(p,a,f),T(p,o,f),te(s,o,null),S(o,u),S(o,l),t[19](l),d=!0,h||(m=[ee(window,"keydown",t[10]),ee(window,"scroll",()=>{e=!0,clearTimeout(r),r=setTimeout(n,100),t[12]()})],h=!0)},p(p,[f]){f&32&&!e&&(e=!0,clearTimeout(r),scrollTo(window.pageXOffset,p[5]),r=setTimeout(n,100)),(!d||f&2)&&i!==(i=`
        `+(p[1].meta.title+" - "+p[1].meta.author)+`
    `)&&(Ri.title=i);const v={};f&32&&(v.toned=p[5]>100),f&134217815&&(v.$$scope={dirty:f,ctx:p}),s.$set(v)},i(p){d||(z(s.$$.fragment,p),c||ke(()=>{c=zt(o,rt,{duration:200}),c.start()}),d=!0)},o(p){U(s.$$.fragment,p),d=!1},d(p){p&&C(a),p&&C(o),ne(s),t[19](null),h=!1,xe(m)}}}function _l(t,e,n){let{currentBook:r}=e,{reading:i}=e,{currentId:a}=e,o,s=0,u=0,l=r.meta.title,c=JSON.parse(localStorage.getItem("settings"))||{scale:10,fontFamily:"Default"};const d=()=>{isNaN(r.progress)?m(0):m(Math.floor(r.progress)),Wu(r.files.styles)},h=()=>{l!==r.meta.title&&(l=r.meta.title,d())};Br(d);const m=O=>{0<=O&&O<r.spine.length&&(n(4,s=O),n(5,u=0),Yu(a,s),p())},p=()=>{n(3,o.innerHTML=r.contents.get(r.spine[s]).html,o),qu(o.querySelectorAll("[href]"),O=>w(r.contents.get(O).index))};let f=[];const v=O=>{m(s+O),f.length!==0&&n(6,f=[])},w=O=>{n(6,f=[...f,s]),m(O)},_=({key:O})=>{switch(O){case"ArrowLeft":v(-1);break;case"ArrowRight":v(1);break}};function g(){n(5,u=window.pageYOffset)}const b=()=>{m(f.pop()),n(6,f)},y=O=>w(O.index);function k(O){c=O,n(2,c)}const x=()=>v(-1),A=()=>v(1),E=()=>{n(0,i=!1),document.title="Essence Reader",location.hash=""};function B(O){ze[O?"unshift":"push"](()=>{o=O,n(3,o)})}return t.$$set=O=>{"currentBook"in O&&n(1,r=O.currentBook),"reading"in O&&n(0,i=O.reading),"currentId"in O&&n(11,a=O.currentId)},t.$$.update=()=>{t.$$.dirty&4&&Vu(c),t.$$.dirty&2&&h()},[i,r,c,o,s,u,f,m,v,w,_,a,g,b,y,k,x,A,E,B]}class bl extends ye{constructor(e){super(),ge(this,e,_l,yl,ve,{currentBook:1,reading:0,currentId:11})}}function wl(t,{from:e,to:n},r={}){const i=getComputedStyle(t),a=i.transform==="none"?"":i.transform,[o,s]=i.transformOrigin.split(" ").map(parseFloat),u=e.left+e.width*o/n.width-(n.left+o),l=e.top+e.height*s/n.height-(n.top+s),{delay:c=0,duration:d=m=>Math.sqrt(m)*120,easing:h=Do}=r;return{delay:c,duration:it(d)?d(Math.sqrt(u*u+l*l)):d,easing:h,css:(m,p)=>{const f=p*u,v=p*l,w=m+p*e.width/n.width,_=m+p*e.height/n.height;return`transform: ${a} translate(${f}px, ${v}px) scale(${w}, ${_});`}}}function Ii(t){let e,n;return{c(){e=X("title"),n=Y(t[1])},m(r,i){T(r,e,i),S(e,n)},p(r,i){i&2&&ie(n,r[1])},d(r){r&&C(e)}}}function kl(t){let e,n,r,i=t[1]&&Ii(t),a=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:t[0]},{height:t[0]},t[2],t[3]],o={};for(let s=0;s<a.length;s+=1)o=Z(o,a[s]);return{c(){e=X("svg"),i&&i.c(),n=X("path"),r=X("path"),M(n,"d","M12 12H14V24H12zM18 12H20V24H18z"),M(r,"d","M4 6V8H6V28a2 2 0 002 2H24a2 2 0 002-2V8h2V6zM8 28V8H24V28zM12 2H20V4H12z"),we(e,o)},m(s,u){T(s,e,u),i&&i.m(e,null),S(e,n),S(e,r)},p(s,[u]){s[1]?i?i.p(s,u):(i=Ii(s),i.c(),i.m(e,n)):i&&(i.d(1),i=null),we(e,o=ot(a,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},u&1&&{width:s[0]},u&1&&{height:s[0]},u&4&&s[2],u&8&&s[3]]))},i:N,o:N,d(s){s&&C(e),i&&i.d()}}}function El(t,e,n){let r,i;const a=["size","title"];let o=be(e,a),{size:s=16}=e,{title:u=void 0}=e;return t.$$set=l=>{n(5,e=Z(Z({},e),_e(l))),n(3,o=be(e,a)),"size"in l&&n(0,s=l.size),"title"in l&&n(1,u=l.title)},t.$$.update=()=>{n(4,r=e["aria-label"]||e["aria-labelledby"]||u),n(2,i={"aria-hidden":r?void 0:!0,role:r?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=_e(e),[s,u,i,o,r]}class Al extends ye{constructor(e){super(),ge(this,e,El,kl,ve,{size:0,title:1})}}function Pi(t,e,n){const r=t.slice();return r[16]=e[n],r}function Sl(t){let e;return{c(){e=D("h3"),e.textContent="Essence Reader",M(e,"slot","toptext")},m(n,r){T(n,e,r)},p:N,d(n){n&&C(e)}}}function xl(t){let e,n,r,i,a,o,s,u,l,c,d,h,m,p,f,v;return m=new Po({}),{c(){e=D("div"),n=D("label"),r=D("input"),i=Y(`
                    Save books
                `),a=D("br"),o=H(),s=D("button"),s.textContent="Remove all",u=H(),l=D("hr"),c=H(),d=D("p"),d.textContent="Select theme",h=H(),oe(m.$$.fragment),M(r,"type","checkbox"),Q(n,"user-select","none"),Q(d,"display","inline"),Q(e,"width","8em")},m(w,_){T(w,e,_),S(e,n),S(n,r),r.checked=t[0],S(n,i),S(e,a),S(e,o),S(e,s),S(e,u),S(e,l),S(e,c),S(e,d),S(e,h),te(m,e,null),p=!0,f||(v=[ee(r,"change",t[11]),ee(s,"click",t[9])],f=!0)},p(w,_){_&1&&(r.checked=w[0])},i(w){p||(z(m.$$.fragment,w),p=!0)},o(w){U(m.$$.fragment,w),p=!1},d(w){w&&C(e),ne(m),f=!1,xe(v)}}}function Cl(t){let e,n;return e=new Ko({props:{slot:"icon",size:24}}),{c(){oe(e.$$.fragment)},m(r,i){te(e,r,i),n=!0},p:N,i(r){n||(z(e.$$.fragment,r),n=!0)},o(r){U(e.$$.fragment,r),n=!1},d(r){ne(e,r)}}}function Bl(t){let e,n;return e=new Er({props:{slot:"rightbar",$$slots:{icon:[Cl],default:[xl]},$$scope:{ctx:t}}}),{c(){oe(e.$$.fragment)},m(r,i){te(e,r,i),n=!0},p(r,i){const a={};i&524289&&(a.$$scope={dirty:i,ctx:r}),e.$set(a)},i(r){n||(z(e.$$.fragment,r),n=!0)},o(r){U(e.$$.fragment,r),n=!1},d(r){ne(e,r)}}}function Ki(t){let e=[],n=new Map,r,i,a=t[5];const o=s=>s[16].id;for(let s=0;s<a.length;s+=1){let u=Pi(t,a,s),l=o(u);n.set(l,e[s]=Fi(l,u))}return{c(){for(let s=0;s<e.length;s+=1)e[s].c();r=Cr()},m(s,u){for(let l=0;l<e.length;l+=1)e[l].m(s,u);T(s,r,u),i=!0},p(s,u){if(u&290){a=s[5],pt();for(let l=0;l<e.length;l+=1)e[l].r();e=da(e,u,o,1,s,a,n,r.parentNode,fa,Fi,r,Pi);for(let l=0;l<e.length;l+=1)e[l].a();mt()}},i(s){if(!i){for(let u=0;u<a.length;u+=1)z(e[u]);i=!0}},o(s){for(let u=0;u<e.length;u+=1)U(e[u]);i=!1},d(s){for(let u=0;u<e.length;u+=1)e[u].d(s);s&&C(r)}}}function Fi(t,e){let n,r,i,a,o,s,u,l,c,d,h=e[16].meta.author+"",m,p,f,v=e[16].meta.title+"",w,_,g,b=e[16].progress+"",y,k,x=e[16].spine.length-1+"",A,E,B,O,j=N,L,J,F;i=new Al({props:{size:20}});function se(...$){return e[12](e[16],...$)}function ue(){return e[13](e[16])}return{key:t,first:null,c(){n=D("button"),r=D("button"),oe(i.$$.fragment),a=H(),o=D("img"),l=H(),c=D("div"),d=D("h4"),m=Y(h),p=H(),f=D("h3"),w=Y(v),_=H(),g=D("p"),y=Y(b),k=Y(" / "),A=Y(x),B=H(),M(r,"class","deleteBtn svelte-is49rk"),Gr(o.src,s=e[16].meta.cover!==void 0?URL.createObjectURL(e[16].meta.cover):"")||M(o,"src",s),M(o,"alt","cover"),M(o,"class","svelte-is49rk"),M(f,"class","svelte-is49rk"),M(c,"class","bookInfo svelte-is49rk"),M(n,"class","book svelte-is49rk"),this.first=n},m($,le){T($,n,le),S(n,r),te(i,r,null),S(n,a),S(n,o),S(n,l),S(n,c),S(c,d),S(d,m),S(c,p),S(c,f),S(f,w),S(c,_),S(c,g),S(g,y),S(g,k),S(g,A),S(n,B),L=!0,J||(F=[ee(r,"click",se),ee(n,"click",ue)],J=!0)},p($,le){e=$,(!L||le&32&&!Gr(o.src,s=e[16].meta.cover!==void 0?URL.createObjectURL(e[16].meta.cover):""))&&M(o,"src",s),(!L||le&32)&&h!==(h=e[16].meta.author+"")&&ie(m,h),(!L||le&32)&&v!==(v=e[16].meta.title+"")&&ie(w,v),(!L||le&32)&&b!==(b=e[16].progress+"")&&ie(y,b),(!L||le&32)&&x!==(x=e[16].spine.length-1+"")&&ie(A,x)},r(){O=n.getBoundingClientRect()},f(){ra(n),j()},a(){j(),j=na(n,O,wl,{duration:200})},i($){L||(z(i.$$.fragment,$),u||ke(()=>{u=zt(o,rt,{duration:200}),u.start()}),E||ke(()=>{E=zt(c,rt,{duration:200}),E.start()}),L=!0)},o($){U(i.$$.fragment,$),L=!1},d($){$&&C(n),ne(i),J=!1,xe(F)}}}function Tl(t){let e,n,r,i=t[4]?"+":"Drop anywhere or click to select a file",a;return{c(){e=D("h1"),e.textContent="\u{1F4DA}",n=H(),r=D("h2"),a=Y(i),M(e,"class","svelte-is49rk")},m(o,s){T(o,e,s),T(o,n,s),T(o,r,s),S(r,a)},p(o,s){s&16&&i!==(i=o[4]?"+":"Drop anywhere or click to select a file")&&ie(a,i)},d(o){o&&C(e),o&&C(n),o&&C(r)}}}function Rl(t){let e,n,r;return{c(){e=D("h1"),e.textContent="\u{1F4DA}",n=H(),r=D("h2"),r.textContent="...",M(e,"class","svelte-is49rk")},m(i,a){T(i,e,a),T(i,n,a),T(i,r,a)},p:N,d(i){i&&C(e),i&&C(n),i&&C(r)}}}function Li(t){let e,n,r,i,a=t[3]?"Loading":"Drop anywhere or click to select a file",o;return{c(){e=D("div"),n=D("h4"),n.textContent="Load new book",r=H(),i=D("h3"),o=Y(a),Q(i,"color",t[2]?"#87CEFA":""),M(i,"class","svelte-is49rk"),M(e,"class","bookInfo svelte-is49rk")},m(s,u){T(s,e,u),S(e,n),S(e,r),S(e,i),S(i,o)},p(s,u){u&8&&a!==(a=s[3]?"Loading":"Drop anywhere or click to select a file")&&ie(o,a),u&4&&Q(i,"color",s[2]?"#87CEFA":"")},d(s){s&&C(e)}}}function Ol(t){let e,n,r,i,a,o,s,u,l,c,d,h,m,p;n=new Io({props:{$$slots:{rightbar:[Bl],toptext:[Sl]},$$scope:{ctx:t}}});let f=t[5]&&Ki(t);function v(b,y){return b[3]?Rl:Tl}let w=v(t),_=w(t),g=t[4]&&Li(t);return{c(){e=D("div"),oe(n.$$.fragment),r=H(),i=D("div"),f&&f.c(),a=H(),o=D("button"),s=D("div"),_.c(),l=H(),g&&g.c(),M(s,"id","dropInfo"),M(s,"class",u=Qr(t[3]?"loading":"")+" svelte-is49rk"),Q(s,"max-width",t[4]?"":"100% "),Q(s,"background-color",t[2]?" #87CEFA":""),M(o,"class","book svelte-is49rk"),M(o,"style",c=t[4]?"":"max-width: 50vw"),M(i,"id","parent"),M(i,"class","svelte-is49rk")},m(b,y){T(b,e,y),te(n,e,null),S(e,r),S(e,i),f&&f.m(i,null),S(i,a),S(i,o),S(o,s),_.m(s,null),S(o,l),g&&g.m(o,null),h=!0,m||(p=ee(o,"click",t[14]),m=!0)},p(b,[y]){const k={};y&524289&&(k.$$scope={dirty:y,ctx:b}),n.$set(k),b[5]?f?(f.p(b,y),y&32&&z(f,1)):(f=Ki(b),f.c(),z(f,1),f.m(i,a)):f&&(pt(),U(f,1,1,()=>{f=null}),mt()),w===(w=v(b))&&_?_.p(b,y):(_.d(1),_=w(b),_&&(_.c(),_.m(s,null))),(!h||y&8&&u!==(u=Qr(b[3]?"loading":"")+" svelte-is49rk"))&&M(s,"class",u),(!h||y&16)&&Q(s,"max-width",b[4]?"":"100% "),(!h||y&4)&&Q(s,"background-color",b[2]?" #87CEFA":""),b[4]?g?g.p(b,y):(g=Li(b),g.c(),g.m(o,null)):g&&(g.d(1),g=null),(!h||y&16&&c!==(c=b[4]?"":"max-width: 50vw"))&&M(o,"style",c)},i(b){h||(z(n.$$.fragment,b),z(f),d||ke(()=>{d=zt(e,rt,{duration:200}),d.start()}),h=!0)},o(b){U(n.$$.fragment,b),U(f),h=!1},d(b){b&&C(e),ne(n),f&&f.d(),_.d(),g&&g.d(),m=!1,p()}}}function Ml(t,e,n){let r,{readFiles:i=g=>{}}=e,{openExisting:a=g=>{}}=e,{dragging:o}=e,{saveBooksOn:s}=e,{loading:u}=e,l=So(()=>Be.books.toArray().catch(()=>(n(0,s=!1),null)));Vo(t,l,g=>n(5,r=g));let c=!1;const d=()=>{let g=document.createElement("input");g.type="file",g.onchange=b=>{i(b.target.files[0])},g.click()};async function h(g){await Be.books.delete(g)}const m=async()=>{confirm("Are you sure you want to remove all saved books?")&&await Be.books.clear()};async function p(){if(s){const g=await Be.books.count();n(4,c=g>0)}}Br(()=>{p(),window.addEventListener("unhandledrejection",g=>{g.reason instanceof TypeError&&(Be.books.clear(),console.log("An error was encountered and book database has been cleared"))})});function f(){s=this.checked,n(0,s)}const v=(g,b)=>{b.stopPropagation(),h(g.id)},w=g=>a(g.id),_=()=>d();return t.$$set=g=>{"readFiles"in g&&n(10,i=g.readFiles),"openExisting"in g&&n(1,a=g.openExisting),"dragging"in g&&n(2,o=g.dragging),"saveBooksOn"in g&&n(0,s=g.saveBooksOn),"loading"in g&&n(3,u=g.loading)},[s,a,o,u,c,r,l,d,h,m,i,f,v,w,_]}class Dl extends ye{constructor(e){super(),ge(this,e,Ml,Ol,ve,{readFiles:10,openExisting:1,dragging:2,saveBooksOn:0,loading:3})}}function Il(t){let e,n,r,i;function a(u){t[11](u)}function o(u){t[12](u)}let s={readFiles:t[7],openExisting:t[8],dragging:t[3]};return t[0]!==void 0&&(s.saveBooksOn=t[0]),t[4]!==void 0&&(s.loading=t[4]),e=new Dl({props:s}),ze.push(()=>Nt(e,"saveBooksOn",a)),ze.push(()=>Nt(e,"loading",o)),{c(){oe(e.$$.fragment)},m(u,l){te(e,u,l),i=!0},p(u,l){const c={};l&8&&(c.dragging=u[3]),!n&&l&1&&(n=!0,c.saveBooksOn=u[0],Lt(()=>n=!1)),!r&&l&16&&(r=!0,c.loading=u[4],Lt(()=>r=!1)),e.$set(c)},i(u){i||(z(e.$$.fragment,u),i=!0)},o(u){U(e.$$.fragment,u),i=!1},d(u){ne(e,u)}}}function Pl(t){let e,n;return{c(){e=D("p"),e.textContent="Loading",Q(e,"text-align","center")},m(r,i){T(r,e,i)},p:N,i(r){n||ke(()=>{n=zt(e,rt,{}),n.start()})},o:N,d(r){r&&C(e)}}}function Kl(t){let e,n,r,i;function a(u){t[9](u)}function o(u){t[10](u)}let s={currentBook:t[1]};return t[2]!==void 0&&(s.reading=t[2]),t[5]!==void 0&&(s.currentId=t[5]),e=new bl({props:s}),ze.push(()=>Nt(e,"reading",a)),ze.push(()=>Nt(e,"currentId",o)),{c(){oe(e.$$.fragment)},m(u,l){te(e,u,l),i=!0},p(u,l){const c={};l&2&&(c.currentBook=u[1]),!n&&l&4&&(n=!0,c.reading=u[2],Lt(()=>n=!1)),!r&&l&32&&(r=!0,c.currentId=u[5],Lt(()=>r=!1)),e.$set(c)},i(u){i||(z(e.$$.fragment,u),i=!0)},o(u){U(e.$$.fragment,u),i=!1},d(u){ne(e,u)}}}function Fl(t){let e,n,r,i;const a=[Kl,Pl,Il],o=[];function s(u,l){return u[2]?0:u[6]?1:2}return n=s(t),r=o[n]=a[n](t),{c(){e=D("main"),r.c()},m(u,l){T(u,e,l),o[n].m(e,null),i=!0},p(u,[l]){let c=n;n=s(u),n===c?o[n].p(u,l):(pt(),U(o[c],1,1,()=>{o[c]=null}),mt(),r=o[n],r?r.p(u,l):(r=o[n]=a[n](u),r.c()),z(r,1),r.m(e,null))},i(u){i||(z(r),i=!0)},o(u){U(r),i=!1},d(u){u&&C(e),o[n].d()}}}function Ll(t,e,n){let r,i=!1,a=!1,o=!1;const s=async _=>{try{n(4,o=!0);const g=await Au(_);if(u&&_.size<3e7){const b=await Us(g);c(g,b)}else c(g)}catch(g){alert(g)}n(4,o=!1)};let u;localStorage.getItem("saveBooksOn")!==null?u=JSON.parse(localStorage.getItem("saveBooksOn")):u=!0;const l=()=>{localStorage.setItem("saveBooksOn",JSON.stringify(u))};window.addEventListener("dragenter",_=>{_.dataTransfer.types.includes("Files")&&n(3,a=!0)}),window.addEventListener("dragleave",_=>{n(3,a=!1),_.preventDefault()});const c=(_,g)=>{n(1,r=Cu(_)),n(2,i=!0),location.hash=g?g.toString():"",n(5,h=g||-1)},d=_=>{n(6,m=!0),Be.transaction("r",Be.books,async()=>{let g=await Be.books.get(_);g?c(g,g.id):(location.hash="",n(6,m=!1))})};Br(()=>{location.hash!==""&&(n(6,m=!0),d(parseInt(location.hash.substring(1))))}),window.onhashchange=()=>{u&&location.hash===""?(document.title="Essence Reader",n(2,i=!1),history.replaceState(null,""," "),n(6,m=!1)):u&&location.hash!==""&&d(parseInt(location.hash.substring(1)))},window.addEventListener("dragover",_=>_.preventDefault()),window.addEventListener("drop",_=>{_.preventDefault(),n(3,a=!1),s(_.dataTransfer.files[0])});let h=-1,m=!1;function p(_){i=_,n(2,i)}function f(_){h=_,n(5,h)}function v(_){u=_,n(0,u)}function w(_){o=_,n(4,o)}return t.$$.update=()=>{t.$$.dirty&1&&l()},[u,r,i,a,o,h,m,s,d,p,f,v,w]}class zl extends ye{constructor(e){super(),ge(this,e,Ll,Fl,ve,{})}}new zl({target:document.getElementById("app")})});export default Nl();
