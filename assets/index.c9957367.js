var Io=Object.defineProperty;var Ko=(t,e,n)=>e in t?Io(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Po=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var jr=(t,e,n)=>(Ko(t,typeof e!="symbol"?e+"":e,n),n);var ol=Po((sl,Oo)=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();function Q(){}const Cn=t=>t;function Fo(t,e){for(const n in e)t[n]=e[n];return t}function Ci(t){return t()}function Ur(){return Object.create(null)}function fe(t){t.forEach(Ci)}function ut(t){return typeof t=="function"}function Qe(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let Wt;function $r(t,e){return Wt||(Wt=document.createElement("a")),Wt.href=e,t===Wt.href}function Mo(t){return Object.keys(t).length===0}function Lo(t,...e){if(t==null)return Q;const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function No(t,e,n){t.$$.on_destroy.push(Lo(e,n))}function Jt(t,e,n,r){if(t){const i=Bi(t,e,n,r);return t[0](i)}}function Bi(t,e,n,r){return t[1]&&r?Fo(n.ctx.slice(),t[1](r(e))):n.ctx}function Zt(t,e,n,r){if(t[2]&&r){const i=t[2](r(n));if(e.dirty===void 0)return i;if(typeof i=="object"){const o=[],a=Math.max(e.dirty.length,i.length);for(let s=0;s<a;s+=1)o[s]=e.dirty[s]|i[s];return o}return e.dirty|i}return e.dirty}function en(t,e,n,r,i,o){if(i){const a=Bi(e,n,r,o);t.p(a,i)}}function tn(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let r=0;r<n;r++)e[r]=-1;return e}return-1}function Hr(t){return t==null?"":t}function zo(t){return t&&ut(t.destroy)?t.destroy:Q}const Ti=typeof window<"u";let _r=Ti?()=>window.performance.now():()=>Date.now(),br=Ti?t=>requestAnimationFrame(t):Q;const rt=new Set;function Di(t){rt.forEach(e=>{e.c(t)||(rt.delete(e),e.f())}),rt.size!==0&&br(Di)}function wr(t){let e;return rt.size===0&&br(Di),{promise:new Promise(n=>{rt.add(e={c:t,f:n})}),abort(){rt.delete(e)}}}function T(t,e){t.appendChild(e)}function Oi(t){if(!t)return document;const e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function jo(t){const e=O("style");return Uo(Oi(t),e),e.sheet}function Uo(t,e){return T(t.head||t,e),e.sheet}function L(t,e,n){t.insertBefore(e,n||null)}function F(t){t.parentNode&&t.parentNode.removeChild(t)}function $o(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function O(t){return document.createElement(t)}function ne(t){return document.createTextNode(t)}function z(){return ne(" ")}function kr(){return ne("")}function X(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function R(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Ho(t){return t===""?null:+t}function Wo(t){return Array.from(t.childNodes)}function he(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function Wr(t,e){t.value=e==null?"":e}function U(t,e,n,r){n===null?t.style.removeProperty(e):t.style.setProperty(e,n,r?"important":"")}function Vr(t,e){for(let n=0;n<t.options.length;n+=1){const r=t.options[n];if(r.__value===e){r.selected=!0;return}}t.selectedIndex=-1}function Vo(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}function qo(t,e,{bubbles:n=!1,cancelable:r=!1}={}){const i=document.createEvent("CustomEvent");return i.initCustomEvent(t,n,r,e),i}const hn=new Map;let pn=0;function Yo(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}function Go(t,e){const n={stylesheet:jo(e),rules:{}};return hn.set(t,n),n}function vn(t,e,n,r,i,o,a,s=0){const u=16.666/r;let l=`{
`;for(let m=0;m<=1;m+=u){const _=e+(n-e)*o(m);l+=m*100+`%{${a(_,1-_)}}
`}const c=l+`100% {${a(n,1-n)}}
}`,f=`__svelte_${Yo(c)}_${s}`,d=Oi(t),{stylesheet:p,rules:h}=hn.get(d)||Go(d,t);h[f]||(h[f]=!0,p.insertRule(`@keyframes ${f} ${c}`,p.cssRules.length));const v=t.style.animation||"";return t.style.animation=`${v?`${v}, `:""}${f} ${r}ms linear ${i}ms 1 both`,pn+=1,f}function mn(t,e){const n=(t.style.animation||"").split(", "),r=n.filter(e?o=>o.indexOf(e)<0:o=>o.indexOf("__svelte")===-1),i=n.length-r.length;i&&(t.style.animation=r.join(", "),pn-=i,pn||Qo())}function Qo(){br(()=>{pn||(hn.forEach(t=>{const{ownerNode:e}=t.stylesheet;e&&F(e)}),hn.clear())})}function Xo(t,e,n,r){if(!e)return Q;const i=t.getBoundingClientRect();if(e.left===i.left&&e.right===i.right&&e.top===i.top&&e.bottom===i.bottom)return Q;const{delay:o=0,duration:a=300,easing:s=Cn,start:u=_r()+o,end:l=u+a,tick:c=Q,css:f}=n(t,{from:e,to:i},r);let d=!0,p=!1,h;function v(){f&&(h=vn(t,0,1,a,o,s,f)),o||(p=!0)}function m(){f&&mn(t,h),d=!1}return wr(_=>{if(!p&&_>=u&&(p=!0),p&&_>=l&&(c(1,0),m()),!d)return!1;if(p){const w=_-u,y=0+1*s(w/a);c(y,1-y)}return!0}),v(),c(0,1),m}function Jo(t){const e=getComputedStyle(t);if(e.position!=="absolute"&&e.position!=="fixed"){const{width:n,height:r}=e,i=t.getBoundingClientRect();t.style.position="absolute",t.style.width=n,t.style.height=r,Zo(t,i)}}function Zo(t,e){const n=t.getBoundingClientRect();if(e.left!==n.left||e.top!==n.top){const r=getComputedStyle(t),i=r.transform==="none"?"":r.transform;t.style.transform=`${i} translate(${e.left-n.left}px, ${e.top-n.top}px)`}}let Ct;function _t(t){Ct=t}function Ri(){if(!Ct)throw new Error("Function called outside component initialization");return Ct}function Ii(t){Ri().$$.on_mount.push(t)}function ea(t){Ri().$$.after_update.push(t)}const vt=[],ve=[],nn=[],$n=[],ta=Promise.resolve();let Hn=!1;function na(){Hn||(Hn=!0,ta.then(Ki))}function le(t){nn.push(t)}function De(t){$n.push(t)}const Rn=new Set;let Vt=0;function Ki(){const t=Ct;do{for(;Vt<vt.length;){const e=vt[Vt];Vt++,_t(e),ra(e.$$)}for(_t(null),vt.length=0,Vt=0;ve.length;)ve.pop()();for(let e=0;e<nn.length;e+=1){const n=nn[e];Rn.has(n)||(Rn.add(n),n())}nn.length=0}while(vt.length);for(;$n.length;)$n.pop()();Hn=!1,Rn.clear(),_t(t)}function ra(t){if(t.fragment!==null){t.update(),fe(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(le)}}let pt;function Pi(){return pt||(pt=Promise.resolve(),pt.then(()=>{pt=null})),pt}function bt(t,e,n){t.dispatchEvent(qo(`${e?"intro":"outro"}${n}`))}const rn=new Set;let Be;function Fi(){Be={r:0,c:[],p:Be}}function Mi(){Be.r||fe(Be.c),Be=Be.p}function q(t,e){t&&t.i&&(rn.delete(t),t.i(e))}function ee(t,e,n,r){if(t&&t.o){if(rn.has(t))return;rn.add(t),Be.c.push(()=>{rn.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}const Li={duration:0};function Bt(t,e,n){let r=e(t,n),i=!1,o,a,s=0;function u(){o&&mn(t,o)}function l(){const{delay:f=0,duration:d=300,easing:p=Cn,tick:h=Q,css:v}=r||Li;v&&(o=vn(t,0,1,d,f,p,v,s++)),h(0,1);const m=_r()+f,_=m+d;a&&a.abort(),i=!0,le(()=>bt(t,!0,"start")),a=wr(w=>{if(i){if(w>=_)return h(1,0),bt(t,!0,"end"),u(),i=!1;if(w>=m){const y=p((w-m)/d);h(y,1-y)}}return i})}let c=!1;return{start(){c||(c=!0,mn(t),ut(r)?(r=r(),Pi().then(l)):l())},invalidate(){c=!1},end(){i&&(u(),i=!1)}}}function qr(t,e,n,r){let i=e(t,n),o=r?0:1,a=null,s=null,u=null;function l(){u&&mn(t,u)}function c(d,p){const h=d.b-o;return p*=Math.abs(h),{a:o,b:d.b,d:h,duration:p,start:d.start,end:d.start+p,group:d.group}}function f(d){const{delay:p=0,duration:h=300,easing:v=Cn,tick:m=Q,css:_}=i||Li,w={start:_r()+p,b:d};d||(w.group=Be,Be.r+=1),a||s?s=w:(_&&(l(),u=vn(t,o,d,h,p,v,_)),d&&m(0,1),a=c(w,h),le(()=>bt(t,d,"start")),wr(y=>{if(s&&y>s.start&&(a=c(s,h),s=null,bt(t,a.b,"start"),_&&(l(),u=vn(t,o,a.b,a.duration,0,v,i.css))),a){if(y>=a.end)m(o=a.b,1-o),bt(t,a.b,"end"),s||(a.b?l():--a.group.r||fe(a.group.c)),a=null;else if(y>=a.start){const k=y-a.start;o=a.a+a.d*v(k/a.duration),m(o,1-o)}}return!!(a||s)}))}return{run(d){ut(i)?Pi().then(()=>{i=i(),f(d)}):f(d)},end(){l(),a=s=null}}}const ia=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function oa(t,e){t.d(1),e.delete(t.key)}function aa(t,e){t.f(),oa(t,e)}function sa(t,e,n,r,i,o,a,s,u,l,c,f){let d=t.length,p=o.length,h=d;const v={};for(;h--;)v[t[h].key]=h;const m=[],_=new Map,w=new Map;for(h=p;h--;){const g=f(i,o,h),A=n(g);let S=a.get(A);S?r&&S.p(g,e):(S=l(A,g),S.c()),_.set(A,m[h]=S),A in v&&w.set(A,Math.abs(h-v[A]))}const y=new Set,k=new Set;function b(g){q(g,1),g.m(s,c),a.set(g.key,g),c=g.first,p--}for(;d&&p;){const g=m[p-1],A=t[d-1],S=g.key,E=A.key;g===A?(c=g.first,d--,p--):_.has(E)?!a.has(S)||y.has(S)?b(g):k.has(E)?d--:w.get(S)>w.get(E)?(k.add(S),b(g)):(y.add(E),d--):(u(A,a),d--)}for(;d--;){const g=t[d];_.has(g.key)||u(g,a)}for(;p;)b(m[p-1]);return m}function Oe(t,e,n){const r=t.$$.props[e];r!==void 0&&(t.$$.bound[r]=n,n(t.$$.ctx[r]))}function Ee(t){t&&t.c()}function me(t,e,n,r){const{fragment:i,after_update:o}=t.$$;i&&i.m(e,n),r||le(()=>{const a=t.$$.on_mount.map(Ci).filter(ut);t.$$.on_destroy?t.$$.on_destroy.push(...a):fe(a),t.$$.on_mount=[]}),o.forEach(le)}function ye(t,e){const n=t.$$;n.fragment!==null&&(fe(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function ua(t,e){t.$$.dirty[0]===-1&&(vt.push(t),na(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Xe(t,e,n,r,i,o,a,s=[-1]){const u=Ct;_t(t);const l=t.$$={fragment:null,ctx:[],props:o,update:Q,not_equal:i,bound:Ur(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(u?u.$$.context:[])),callbacks:Ur(),dirty:s,skip_bound:!1,root:e.target||u.$$.root};a&&a(l.root);let c=!1;if(l.ctx=n?n(t,e.props||{},(f,d,...p)=>{const h=p.length?p[0]:d;return l.ctx&&i(l.ctx[f],l.ctx[f]=h)&&(!l.skip_bound&&l.bound[f]&&l.bound[f](h),c&&ua(t,f)),d}):[],l.update(),c=!0,fe(l.before_update),l.fragment=r?r(l.ctx):!1,e.target){if(e.hydrate){const f=Wo(e.target);l.fragment&&l.fragment.l(f),f.forEach(F)}else l.fragment&&l.fragment.c();e.intro&&q(t.$$.fragment),me(t,e.target,e.anchor,e.customElement),Ki()}_t(u)}class Je{$destroy(){ye(this,1),this.$destroy=Q}$on(e,n){if(!ut(n))return Q;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!Mo(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.
Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.
THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var j=function(){return j=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},j.apply(this,arguments)};function Wn(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))}var V=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,J=Object.keys,ie=Array.isArray;typeof Promise<"u"&&!V.Promise&&(V.Promise=Promise);function se(t,e){return typeof e!="object"||J(e).forEach(function(n){t[n]=e[n]}),t}var Tt=Object.getPrototypeOf,la={}.hasOwnProperty;function ce(t,e){return la.call(t,e)}function at(t,e){typeof e=="function"&&(e=e(Tt(t))),(typeof Reflect>"u"?J:Reflect.ownKeys)(e).forEach(function(n){Ie(t,n,e[n])})}var Ni=Object.defineProperty;function Ie(t,e,n,r){Ni(t,e,se(n&&ce(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function lt(t){return{from:function(e){return t.prototype=Object.create(e.prototype),Ie(t.prototype,"constructor",t),{extend:at.bind(null,t.prototype)}}}}var ca=Object.getOwnPropertyDescriptor;function Er(t,e){var n=ca(t,e),r;return n||(r=Tt(t))&&Er(r,e)}var fa=[].slice;function Bn(t,e,n){return fa.call(t,e,n)}function zi(t,e){return e(t)}function mt(t){if(!t)throw new Error("Assertion Failed")}function ji(t){V.setImmediate?setImmediate(t):setTimeout(t,0)}function Ui(t,e){return t.reduce(function(n,r,i){var o=e(r,i);return o&&(n[o[0]]=o[1]),n},{})}function da(t,e,n){try{t.apply(null,n)}catch(r){e&&e(r)}}function Re(t,e){if(ce(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var n=[],r=0,i=e.length;r<i;++r){var o=Re(t,e[r]);n.push(o)}return n}var a=e.indexOf(".");if(a!==-1){var s=t[e.substr(0,a)];return s===void 0?void 0:Re(s,e.substr(a+1))}}function ge(t,e,n){if(!(!t||e===void 0)&&!("isFrozen"in Object&&Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){mt(typeof n!="string"&&"length"in n);for(var r=0,i=e.length;r<i;++r)ge(t,e[r],n[r])}else{var o=e.indexOf(".");if(o!==-1){var a=e.substr(0,o),s=e.substr(o+1);if(s==="")n===void 0?ie(t)&&!isNaN(parseInt(a))?t.splice(a,1):delete t[a]:t[a]=n;else{var u=t[a];(!u||!ce(t,a))&&(u=t[a]={}),ge(u,s,n)}}else n===void 0?ie(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=n}}function ha(t,e){typeof e=="string"?ge(t,e,void 0):"length"in e&&[].map.call(e,function(n){ge(t,n,void 0)})}function $i(t){var e={};for(var n in t)ce(t,n)&&(e[n]=t[n]);return e}var pa=[].concat;function Hi(t){return pa.apply([],t)}var Wi="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Hi([8,16,32,64].map(function(t){return["Int","Uint","Float"].map(function(e){return e+t+"Array"})}))).filter(function(t){return V[t]}),va=Wi.map(function(t){return V[t]});Ui(Wi,function(t){return[t,!0]});var Le=null;function Lt(t){Le=typeof WeakMap<"u"&&new WeakMap;var e=Vn(t);return Le=null,e}function Vn(t){if(!t||typeof t!="object")return t;var e=Le&&Le.get(t);if(e)return e;if(ie(t)){e=[],Le&&Le.set(t,e);for(var n=0,r=t.length;n<r;++n)e.push(Vn(t[n]))}else if(va.indexOf(t.constructor)>=0)e=t;else{var i=Tt(t);e=i===Object.prototype?{}:Object.create(i),Le&&Le.set(t,e);for(var o in t)ce(t,o)&&(e[o]=Vn(t[o]))}return e}var ma={}.toString;function qn(t){return ma.call(t).slice(8,-1)}var Yn=typeof Symbol<"u"?Symbol.iterator:"@@iterator",ya=typeof Yn=="symbol"?function(t){var e;return t!=null&&(e=t[Yn])&&e.apply(t)}:function(){return null},nt={};function Ce(t){var e,n,r,i;if(arguments.length===1){if(ie(t))return t.slice();if(this===nt&&typeof t=="string")return[t];if(i=ya(t)){for(n=[];r=i.next(),!r.done;)n.push(r.value);return n}if(t==null)return[t];if(e=t.length,typeof e=="number"){for(n=new Array(e);e--;)n[e]=t[e];return n}return[t]}for(e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];return n}var Sr=typeof Symbol<"u"?function(t){return t[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Se=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Vi(t,e){Se=t,qi=e}var qi=function(){return!0},ga=!new Error("").stack;function Ze(){if(ga)try{throw Ze.arguments,new Error}catch(t){return t}return new Error}function Gn(t,e){var n=t.stack;return n?(e=e||0,n.indexOf(t.name)===0&&(e+=(t.name+t.message).split(`
`).length),n.split(`
`).slice(e).filter(qi).map(function(r){return`
`+r}).join("")):""}var _a=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"],Yi=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Ar=_a.concat(Yi),ba={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function ct(t,e){this._e=Ze(),this.name=t,this.message=e}lt(ct).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Gn(this._e,2))}},toString:function(){return this.name+": "+this.message}});function Gi(t,e){return t+". Errors: "+Object.keys(e).map(function(n){return e[n].toString()}).filter(function(n,r,i){return i.indexOf(n)===r}).join(`
`)}function yn(t,e,n,r){this._e=Ze(),this.failures=e,this.failedKeys=r,this.successCount=n,this.message=Gi(t,e)}lt(yn).from(ct);function wt(t,e){this._e=Ze(),this.name="BulkError",this.failures=Object.keys(e).map(function(n){return e[n]}),this.failuresByPos=e,this.message=Gi(t,e)}lt(wt).from(ct);var xr=Ar.reduce(function(t,e){return t[e]=e+"Error",t},{}),wa=ct,M=Ar.reduce(function(t,e){var n=e+"Error";function r(i,o){this._e=Ze(),this.name=n,i?typeof i=="string"?(this.message=""+i+(o?`
 `+o:""),this.inner=o||null):typeof i=="object"&&(this.message=i.name+" "+i.message,this.inner=i):(this.message=ba[e]||n,this.inner=null)}return lt(r).from(wa),t[e]=r,t},{});M.Syntax=SyntaxError;M.Type=TypeError;M.Range=RangeError;var Yr=Yi.reduce(function(t,e){return t[e+"Error"]=M[e],t},{});function ka(t,e){if(!t||t instanceof ct||t instanceof TypeError||t instanceof SyntaxError||!t.name||!Yr[t.name])return t;var n=new Yr[t.name](e||t.message,t);return"stack"in t&&Ie(n,"stack",{get:function(){return this.inner.stack}}),n}var Tn=Ar.reduce(function(t,e){return["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=M[e]),t},{});Tn.ModifyError=yn;Tn.DexieError=ct;Tn.BulkError=wt;function $(){}function Nt(t){return t}function Ea(t,e){return t==null||t===Nt?e:function(n){return e(t(n))}}function Ye(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function Sa(t,e){return t===$?e:function(){var n=t.apply(this,arguments);n!==void 0&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?Ye(r,this.onsuccess):r),i&&(this.onerror=this.onerror?Ye(i,this.onerror):i),o!==void 0?o:n}}function Aa(t,e){return t===$?e:function(){t.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?Ye(n,this.onsuccess):n),r&&(this.onerror=this.onerror?Ye(r,this.onerror):r)}}function xa(t,e){return t===$?e:function(n){var r=t.apply(this,arguments);se(n,r);var i=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var a=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?Ye(i,this.onsuccess):i),o&&(this.onerror=this.onerror?Ye(o,this.onerror):o),r===void 0?a===void 0?void 0:a:se(r,a)}}function Ca(t,e){return t===$?e:function(){return e.apply(this,arguments)===!1?!1:t.apply(this,arguments)}}function Cr(t,e){return t===$?e:function(){var n=t.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,i=arguments.length,o=new Array(i);i--;)o[i]=arguments[i];return n.then(function(){return e.apply(r,o)})}return e.apply(this,arguments)}}var Dt={},Ba=100,Ta=20,Qi=100,Br=typeof Promise>"u"?[]:function(){var t=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[t,Tt(t),t];var e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,Tt(e),t]}(),Qn=Br[0],gn=Br[1],Xn=Br[2],Xi=gn&&gn.then,on=Qn&&Qn.constructor,Tr=!!Xn,Jn=!1,Da=Xn?function(){Xn.then(qt)}:V.setImmediate?setImmediate.bind(null,qt):V.MutationObserver?function(){var t=document.createElement("div");new MutationObserver(function(){qt(),t=null}).observe(t,{attributes:!0}),t.setAttribute("i","1")}:function(){setTimeout(qt,0)},Ot=function(t,e){yt.push([t,e]),_n&&(Da(),_n=!1)},Zn=!0,_n=!0,Ve=[],an=[],er=null,tr=Nt,it={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Xr,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(function(t){try{Xr(t[0],t[1])}catch{}})}},I=it,yt=[],qe=0,sn=[];function D(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=$,this._lib=!1;var e=this._PSD=I;if(Se&&(this._stackHolder=Ze(),this._prev=null,this._numPrev=0),typeof t!="function"){if(t!==Dt)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&rr(this,this._value);return}this._state=null,this._value=null,++e.ref,Zi(this,t)}var nr={get:function(){var t=I,e=bn;function n(r,i){var o=this,a=!t.global&&(t!==I||e!==bn),s=a&&!Ke(),u=new D(function(l,c){Dr(o,new Ji(kn(r,t,a,s),kn(i,t,a,s),l,c,t))});return Se&&no(u,this),u}return n.prototype=Dt,n},set:function(t){Ie(this,"then",t&&t.prototype===Dt?nr:{get:function(){return t},set:nr.set})}};at(D.prototype,{then:nr,_then:function(t,e){Dr(this,new Ji(null,null,t,e,I))},catch:function(t){if(arguments.length===1)return this.then(null,t);var e=arguments[0],n=arguments[1];return typeof e=="function"?this.then(null,function(r){return r instanceof e?n(r):un(r)}):this.then(null,function(r){return r&&r.name===e?n(r):un(r)})},finally:function(t){return this.then(function(e){return t(),e},function(e){return t(),un(e)})},stack:{get:function(){if(this._stack)return this._stack;try{Jn=!0;var t=to(this,[],Ta),e=t.join(`
From previous: `);return this._state!==null&&(this._stack=e),e}finally{Jn=!1}}},timeout:function(t,e){var n=this;return t<1/0?new D(function(r,i){var o=setTimeout(function(){return i(new M.Timeout(e))},t);n.then(r,i).finally(clearTimeout.bind(null,o))}):this}});typeof Symbol<"u"&&Symbol.toStringTag&&Ie(D.prototype,Symbol.toStringTag,"Dexie.Promise");it.env=ro();function Ji(t,e,n,r,i){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=n,this.reject=r,this.psd=i}at(D,{all:function(){var t=Ce.apply(null,arguments).map(wn);return new D(function(e,n){t.length===0&&e([]);var r=t.length;t.forEach(function(i,o){return D.resolve(i).then(function(a){t[o]=a,--r||e(t)},n)})})},resolve:function(t){if(t instanceof D)return t;if(t&&typeof t.then=="function")return new D(function(n,r){t.then(n,r)});var e=new D(Dt,!0,t);return no(e,er),e},reject:un,race:function(){var t=Ce.apply(null,arguments).map(wn);return new D(function(e,n){t.map(function(r){return D.resolve(r).then(e,n)})})},PSD:{get:function(){return I},set:function(t){return I=t}},totalEchoes:{get:function(){return bn}},newPSD:ze,usePSD:dt,scheduler:{get:function(){return Ot},set:function(t){Ot=t}},rejectionMapper:{get:function(){return tr},set:function(t){tr=t}},follow:function(t,e){return new D(function(n,r){return ze(function(i,o){var a=I;a.unhandleds=[],a.onunhandled=o,a.finalize=Ye(function(){var s=this;Ra(function(){s.unhandleds.length===0?i():o(s.unhandleds[0])})},a.finalize),t()},e,n,r)})}});on&&(on.allSettled&&Ie(D,"allSettled",function(){var t=Ce.apply(null,arguments).map(wn);return new D(function(e){t.length===0&&e([]);var n=t.length,r=new Array(n);t.forEach(function(i,o){return D.resolve(i).then(function(a){return r[o]={status:"fulfilled",value:a}},function(a){return r[o]={status:"rejected",reason:a}}).then(function(){return--n||e(r)})})})}),on.any&&typeof AggregateError<"u"&&Ie(D,"any",function(){var t=Ce.apply(null,arguments).map(wn);return new D(function(e,n){t.length===0&&n(new AggregateError([]));var r=t.length,i=new Array(r);t.forEach(function(o,a){return D.resolve(o).then(function(s){return e(s)},function(s){i[a]=s,--r||n(new AggregateError(i))})})})}));function Zi(t,e){try{e(function(n){if(t._state===null){if(n===t)throw new TypeError("A promise cannot be resolved with itself.");var r=t._lib&&zt();n&&typeof n.then=="function"?Zi(t,function(i,o){n instanceof D?n._then(i,o):n.then(i,o)}):(t._state=!0,t._value=n,eo(t)),r&&jt()}},rr.bind(null,t))}catch(n){rr(t,n)}}function rr(t,e){if(an.push(e),t._state===null){var n=t._lib&&zt();e=tr(e),t._state=!1,t._value=e,Se&&e!==null&&typeof e=="object"&&!e._promise&&da(function(){var r=Er(e,"stack");e._promise=t,Ie(e,"stack",{get:function(){return Jn?r&&(r.get?r.get.apply(e):r.value):t.stack}})}),Ia(t),eo(t),n&&jt()}}function eo(t){var e=t._listeners;t._listeners=[];for(var n=0,r=e.length;n<r;++n)Dr(t,e[n]);var i=t._PSD;--i.ref||i.finalize(),qe===0&&(++qe,Ot(function(){--qe===0&&Or()},[]))}function Dr(t,e){if(t._state===null){t._listeners.push(e);return}var n=t._state?e.onFulfilled:e.onRejected;if(n===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++qe,Ot(Oa,[n,t,e])}function Oa(t,e,n){try{er=e;var r,i=e._value;e._state?r=t(i):(an.length&&(an=[]),r=t(i),an.indexOf(i)===-1&&Ka(e)),n.resolve(r)}catch(o){n.reject(o)}finally{er=null,--qe===0&&Or(),--n.psd.ref||n.psd.finalize()}}function to(t,e,n){if(e.length===n)return e;var r="";if(t._state===!1){var i=t._value,o,a;i!=null?(o=i.name||"Error",a=i.message||i,r=Gn(i,0)):(o=i,a=""),e.push(o+(a?": "+a:"")+r)}return Se&&(r=Gn(t._stackHolder,2),r&&e.indexOf(r)===-1&&e.push(r),t._prev&&to(t._prev,e,n)),e}function no(t,e){var n=e?e._numPrev+1:0;n<Ba&&(t._prev=e,t._numPrev=n)}function qt(){zt()&&jt()}function zt(){var t=Zn;return Zn=!1,_n=!1,t}function jt(){var t,e,n;do for(;yt.length>0;)for(t=yt,yt=[],n=t.length,e=0;e<n;++e){var r=t[e];r[0].apply(null,r[1])}while(yt.length>0);Zn=!0,_n=!0}function Or(){var t=Ve;Ve=[],t.forEach(function(r){r._PSD.onunhandled.call(null,r._value,r)});for(var e=sn.slice(0),n=e.length;n;)e[--n]()}function Ra(t){function e(){t(),sn.splice(sn.indexOf(e),1)}sn.push(e),++qe,Ot(function(){--qe===0&&Or()},[])}function Ia(t){Ve.some(function(e){return e._value===t._value})||Ve.push(t)}function Ka(t){for(var e=Ve.length;e;)if(Ve[--e]._value===t._value){Ve.splice(e,1);return}}function un(t){return new D(Dt,!1,t)}function G(t,e){var n=I;return function(){var r=zt(),i=I;try{return je(n,!0),t.apply(this,arguments)}catch(o){e&&e(o)}finally{je(i,!1),r&&jt()}}}var re={awaits:0,echoes:0,id:0},Pa=0,ln=[],In=0,bn=0,Fa=0;function ze(t,e,n,r){var i=I,o=Object.create(i);o.parent=i,o.ref=0,o.global=!1,o.id=++Fa;var a=it.env;o.env=Tr?{Promise:D,PromiseProp:{value:D,configurable:!0,writable:!0},all:D.all,race:D.race,allSettled:D.allSettled,any:D.any,resolve:D.resolve,reject:D.reject,nthen:Gr(a.nthen,o),gthen:Gr(a.gthen,o)}:{},e&&se(o,e),++i.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()};var s=dt(o,t,n,r);return o.ref===0&&o.finalize(),s}function ft(){return re.id||(re.id=++Pa),++re.awaits,re.echoes+=Qi,re.id}function Ke(){return re.awaits?(--re.awaits===0&&(re.id=0),re.echoes=re.awaits*Qi,!0):!1}(""+Xi).indexOf("[native code]")===-1&&(ft=Ke=$);function wn(t){return re.echoes&&t&&t.constructor===on?(ft(),t.then(function(e){return Ke(),e},function(e){return Ke(),Z(e)})):t}function Ma(t){++bn,(!re.echoes||--re.echoes===0)&&(re.echoes=re.id=0),ln.push(I),je(t,!0)}function La(){var t=ln[ln.length-1];ln.pop(),je(t,!1)}function je(t,e){var n=I;if((e?re.echoes&&(!In++||t!==I):In&&(!--In||t!==I))&&io(e?Ma.bind(null,t):La),t!==I&&(I=t,n===it&&(it.env=ro()),Tr)){var r=it.env.Promise,i=t.env;gn.then=i.nthen,r.prototype.then=i.gthen,(n.global||t.global)&&(Object.defineProperty(V,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function ro(){var t=V.Promise;return Tr?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(V,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:gn.then,gthen:t.prototype.then}:{}}function dt(t,e,n,r,i){var o=I;try{return je(t,!0),e(n,r,i)}finally{je(o,!1)}}function io(t){Xi.call(Qn,t)}function kn(t,e,n,r){return typeof t!="function"?t:function(){var i=I;n&&ft(),je(e,!0);try{return t.apply(this,arguments)}finally{je(i,!1),r&&io(Ke)}}}function Gr(t,e){return function(n,r){return t.call(this,kn(n,e),kn(r,e))}}var Qr="unhandledrejection";function Xr(t,e){var n;try{n=e.onuncatched(t)}catch{}if(n!==!1)try{var r,i={promise:e,reason:t};if(V.document&&document.createEvent?(r=document.createEvent("Event"),r.initEvent(Qr,!0,!0),se(r,i)):V.CustomEvent&&(r=new CustomEvent(Qr,{detail:i}),se(r,i)),r&&V.dispatchEvent&&(dispatchEvent(r),!V.PromiseRejectionEvent&&V.onunhandledrejection))try{V.onunhandledrejection(r)}catch{}Se&&r&&!r.defaultPrevented&&console.warn("Unhandled rejection: "+(t.stack||t))}catch{}}var Z=D.reject;function ir(t,e,n,r){if(!t.idbdb||!t._state.openComplete&&!I.letThrough&&!t._vip){if(t._state.openComplete)return Z(new M.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return Z(new M.DatabaseClosed);t.open().catch($)}return t._state.dbReadyPromise.then(function(){return ir(t,e,n,r)})}else{var i=t._createTransaction(e,n,t._dbSchema);try{i.create(),t._state.PR1398_maxLoop=3}catch(o){return o.name===xr.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(function(){return ir(t,e,n,r)})):Z(o)}return i._promise(e,function(o,a){return ze(function(){return I.trans=i,r(o,a,i)})}).then(function(o){return i._completion.then(function(){return o})})}}var Jr="3.2.2",He=String.fromCharCode(65535),or=-1/0,Ae="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",oo="String expected.",kt=[],Dn=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Na=Dn,za=Dn,ao=function(t){return!/(dexie\.js|dexie\.min\.js)/.test(t)},On="__dbnames",Kn="readonly",Pn="readwrite";function Ge(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}var so={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Yt(t){return typeof t=="string"&&!/\./.test(t)?function(e){return e[t]===void 0&&t in e&&(e=Lt(e),delete e[t]),e}:function(e){return e}}var ja=function(){function t(){}return t.prototype._trans=function(e,n,r){var i=this._tx||I.trans,o=this.name;function a(u,l,c){if(!c.schema[o])throw new M.NotFound("Table "+o+" not part of transaction");return n(c.idbtrans,c)}var s=zt();try{return i&&i.db===this.db?i===I.trans?i._promise(e,a,r):ze(function(){return i._promise(e,a,r)},{trans:i,transless:I.transless||I}):ir(this.db,e,[this.name],a)}finally{s&&jt()}},t.prototype.get=function(e,n){var r=this;return e&&e.constructor===Object?this.where(e).first(n):this._trans("readonly",function(i){return r.core.get({trans:i,key:e}).then(function(o){return r.hook.reading.fire(o)})}).then(n)},t.prototype.where=function(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(ie(e))return new this.db.WhereClause(this,"["+e.join("+")+"]");var n=J(e);if(n.length===1)return this.where(n[0]).equals(e[n[0]]);var r=this.schema.indexes.concat(this.schema.primKey).filter(function(c){return c.compound&&n.every(function(f){return c.keyPath.indexOf(f)>=0})&&c.keyPath.every(function(f){return n.indexOf(f)>=0})})[0];if(r&&this.db._maxKey!==He)return this.where(r.name).equals(r.keyPath.map(function(c){return e[c]}));!r&&Se&&console.warn("The query "+JSON.stringify(e)+" on "+this.name+" would benefit of a "+("compound index ["+n.join("+")+"]"));var i=this.schema.idxByName,o=this.db._deps.indexedDB;function a(c,f){try{return o.cmp(c,f)===0}catch{return!1}}var s=n.reduce(function(c,f){var d=c[0],p=c[1],h=i[f],v=e[f];return[d||h,d||!h?Ge(p,h&&h.multi?function(m){var _=Re(m,f);return ie(_)&&_.some(function(w){return a(v,w)})}:function(m){return a(v,Re(m,f))}):p]},[null,null]),u=s[0],l=s[1];return u?this.where(u.name).equals(e[u.keyPath]).filter(l):r?this.filter(l):this.where(n).equals("")},t.prototype.filter=function(e){return this.toCollection().and(e)},t.prototype.count=function(e){return this.toCollection().count(e)},t.prototype.offset=function(e){return this.toCollection().offset(e)},t.prototype.limit=function(e){return this.toCollection().limit(e)},t.prototype.each=function(e){return this.toCollection().each(e)},t.prototype.toArray=function(e){return this.toCollection().toArray(e)},t.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},t.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,ie(e)?"["+e.join("+")+"]":e))},t.prototype.reverse=function(){return this.toCollection().reverse()},t.prototype.mapToClass=function(e){this.schema.mappedClass=e;var n=function(r){if(!r)return r;var i=Object.create(e.prototype);for(var o in r)if(ce(r,o))try{i[o]=r[o]}catch{}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=n,this.hook("reading",n),e},t.prototype.defineClass=function(){function e(n){se(this,n)}return this.mapToClass(e)},t.prototype.add=function(e,n){var r=this,i=this.schema.primKey,o=i.auto,a=i.keyPath,s=e;return a&&o&&(s=Yt(a)(e)),this._trans("readwrite",function(u){return r.core.mutate({trans:u,type:"add",keys:n!=null?[n]:null,values:[s]})}).then(function(u){return u.numFailures?D.reject(u.failures[0]):u.lastResult}).then(function(u){if(a)try{ge(e,a,u)}catch{}return u})},t.prototype.update=function(e,n){if(typeof e=="object"&&!ie(e)){var r=Re(e,this.schema.primKey.keyPath);if(r===void 0)return Z(new M.InvalidArgument("Given object does not contain its primary key"));try{typeof n!="function"?J(n).forEach(function(i){ge(e,i,n[i])}):n(e,{value:e,primKey:r})}catch{}return this.where(":id").equals(r).modify(n)}else return this.where(":id").equals(e).modify(n)},t.prototype.put=function(e,n){var r=this,i=this.schema.primKey,o=i.auto,a=i.keyPath,s=e;return a&&o&&(s=Yt(a)(e)),this._trans("readwrite",function(u){return r.core.mutate({trans:u,type:"put",values:[s],keys:n!=null?[n]:null})}).then(function(u){return u.numFailures?D.reject(u.failures[0]):u.lastResult}).then(function(u){if(a)try{ge(e,a,u)}catch{}return u})},t.prototype.delete=function(e){var n=this;return this._trans("readwrite",function(r){return n.core.mutate({trans:r,type:"delete",keys:[e]})}).then(function(r){return r.numFailures?D.reject(r.failures[0]):void 0})},t.prototype.clear=function(){var e=this;return this._trans("readwrite",function(n){return e.core.mutate({trans:n,type:"deleteRange",range:so})}).then(function(n){return n.numFailures?D.reject(n.failures[0]):void 0})},t.prototype.bulkGet=function(e){var n=this;return this._trans("readonly",function(r){return n.core.getMany({keys:e,trans:r}).then(function(i){return i.map(function(o){return n.hook.reading.fire(o)})})})},t.prototype.bulkAdd=function(e,n,r){var i=this,o=Array.isArray(n)?n:void 0;r=r||(o?void 0:n);var a=r?r.allKeys:void 0;return this._trans("readwrite",function(s){var u=i.schema.primKey,l=u.auto,c=u.keyPath;if(c&&o)throw new M.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(o&&o.length!==e.length)throw new M.InvalidArgument("Arguments objects and keys must have the same length");var f=e.length,d=c&&l?e.map(Yt(c)):e;return i.core.mutate({trans:s,type:"add",keys:o,values:d,wantResults:a}).then(function(p){var h=p.numFailures,v=p.results,m=p.lastResult,_=p.failures,w=a?v:m;if(h===0)return w;throw new wt(i.name+".bulkAdd(): "+h+" of "+f+" operations failed",_)})})},t.prototype.bulkPut=function(e,n,r){var i=this,o=Array.isArray(n)?n:void 0;r=r||(o?void 0:n);var a=r?r.allKeys:void 0;return this._trans("readwrite",function(s){var u=i.schema.primKey,l=u.auto,c=u.keyPath;if(c&&o)throw new M.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(o&&o.length!==e.length)throw new M.InvalidArgument("Arguments objects and keys must have the same length");var f=e.length,d=c&&l?e.map(Yt(c)):e;return i.core.mutate({trans:s,type:"put",keys:o,values:d,wantResults:a}).then(function(p){var h=p.numFailures,v=p.results,m=p.lastResult,_=p.failures,w=a?v:m;if(h===0)return w;throw new wt(i.name+".bulkPut(): "+h+" of "+f+" operations failed",_)})})},t.prototype.bulkDelete=function(e){var n=this,r=e.length;return this._trans("readwrite",function(i){return n.core.mutate({trans:i,type:"delete",keys:e})}).then(function(i){var o=i.numFailures,a=i.lastResult,s=i.failures;if(o===0)return a;throw new wt(n.name+".bulkDelete(): "+o+" of "+r+" operations failed",s)})},t}();function Ut(t){var e={},n=function(s,u){if(u){for(var l=arguments.length,c=new Array(l-1);--l;)c[l-1]=arguments[l];return e[s].subscribe.apply(null,c),t}else if(typeof s=="string")return e[s]};n.addEventType=o;for(var r=1,i=arguments.length;r<i;++r)o(arguments[r]);return n;function o(s,u,l){if(typeof s=="object")return a(s);u||(u=Ca),l||(l=$);var c={subscribers:[],fire:l,subscribe:function(f){c.subscribers.indexOf(f)===-1&&(c.subscribers.push(f),c.fire=u(c.fire,f))},unsubscribe:function(f){c.subscribers=c.subscribers.filter(function(d){return d!==f}),c.fire=c.subscribers.reduce(u,l)}};return e[s]=n[s]=c,c}function a(s){J(s).forEach(function(u){var l=s[u];if(ie(l))o(u,s[u][0],s[u][1]);else if(l==="asap")var c=o(u,Nt,function(){for(var d=arguments.length,p=new Array(d);d--;)p[d]=arguments[d];c.subscribers.forEach(function(h){ji(function(){h.apply(null,p)})})});else throw new M.InvalidArgument("Invalid event config")})}}function $t(t,e){return lt(e).from({prototype:t}),e}function Ua(t){return $t(ja.prototype,function(n,r,i){this.db=t,this._tx=i,this.name=n,this.schema=r,this.hook=t._allTables[n]?t._allTables[n].hook:Ut(null,{creating:[Sa,$],reading:[Ea,Nt],updating:[xa,$],deleting:[Aa,$]})})}function et(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function Fn(t,e){t.filter=Ge(t.filter,e)}function Mn(t,e,n){var r=t.replayFilter;t.replayFilter=r?function(){return Ge(r(),e())}:e,t.justLimit=n&&!r}function $a(t,e){t.isMatch=Ge(t.isMatch,e)}function cn(t,e){if(t.isPrimKey)return e.primaryKey;var n=e.getIndexByKeyPath(t.index);if(!n)throw new M.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return n}function Zr(t,e,n){var r=cn(t,e.schema);return e.openCursor({trans:n,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:r,range:t.range}})}function Gt(t,e,n,r){var i=t.replayFilter?Ge(t.filter,t.replayFilter()):t.filter;if(t.or){var o={},a=function(s,u,l){if(!i||i(u,l,function(d){return u.stop(d)},function(d){return u.fail(d)})){var c=u.primaryKey,f=""+c;f==="[object ArrayBuffer]"&&(f=""+new Uint8Array(c)),ce(o,f)||(o[f]=!0,e(s,u,l))}};return Promise.all([t.or._iterate(a,n),ei(Zr(t,r,n),t.algorithm,a,!t.keysOnly&&t.valueMapper)])}else return ei(Zr(t,r,n),Ge(t.algorithm,i),e,!t.keysOnly&&t.valueMapper)}function ei(t,e,n,r){var i=r?function(a,s,u){return n(r(a),s,u)}:n,o=G(i);return t.then(function(a){if(a)return a.start(function(){var s=function(){return a.continue()};(!e||e(a,function(u){return s=u},function(u){a.stop(u),s=$},function(u){a.fail(u),s=$}))&&o(a.value,a,function(u){return s=u}),s()})})}function ae(t,e){try{var n=ti(t),r=ti(e);if(n!==r)return n==="Array"?1:r==="Array"?-1:n==="binary"?1:r==="binary"?-1:n==="string"?1:r==="string"?-1:n==="Date"?1:r!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return Wa(ni(t),ni(e));case"Array":return Ha(t,e)}}catch{}return NaN}function Ha(t,e){for(var n=t.length,r=e.length,i=n<r?n:r,o=0;o<i;++o){var a=ae(t[o],e[o]);if(a!==0)return a}return n===r?0:n<r?-1:1}function Wa(t,e){for(var n=t.length,r=e.length,i=n<r?n:r,o=0;o<i;++o)if(t[o]!==e[o])return t[o]<e[o]?-1:1;return n===r?0:n<r?-1:1}function ti(t){var e=typeof t;if(e!=="object")return e;if(ArrayBuffer.isView(t))return"binary";var n=qn(t);return n==="ArrayBuffer"?"binary":n}function ni(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}var Va=function(){function t(){}return t.prototype._read=function(e,n){var r=this._ctx;return r.error?r.table._trans(null,Z.bind(null,r.error)):r.table._trans("readonly",e).then(n)},t.prototype._write=function(e){var n=this._ctx;return n.error?n.table._trans(null,Z.bind(null,n.error)):n.table._trans("readwrite",e,"locked")},t.prototype._addAlgorithm=function(e){var n=this._ctx;n.algorithm=Ge(n.algorithm,e)},t.prototype._iterate=function(e,n){return Gt(this._ctx,e,n,this._ctx.table.core)},t.prototype.clone=function(e){var n=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&se(r,e),n._ctx=r,n},t.prototype.raw=function(){return this._ctx.valueMapper=null,this},t.prototype.each=function(e){var n=this._ctx;return this._read(function(r){return Gt(n,e,r,n.table.core)})},t.prototype.count=function(e){var n=this;return this._read(function(r){var i=n._ctx,o=i.table.core;if(et(i,!0))return o.count({trans:r,query:{index:cn(i,o.schema),range:i.range}}).then(function(s){return Math.min(s,i.limit)});var a=0;return Gt(i,function(){return++a,!1},r,o).then(function(){return a})}).then(e)},t.prototype.sortBy=function(e,n){var r=e.split(".").reverse(),i=r[0],o=r.length-1;function a(l,c){return c?a(l[r[c]],c-1):l[i]}var s=this._ctx.dir==="next"?1:-1;function u(l,c){var f=a(l,o),d=a(c,o);return f<d?-s:f>d?s:0}return this.toArray(function(l){return l.sort(u)}).then(n)},t.prototype.toArray=function(e){var n=this;return this._read(function(r){var i=n._ctx;if(i.dir==="next"&&et(i,!0)&&i.limit>0){var o=i.valueMapper,a=cn(i,i.table.core.schema);return i.table.core.query({trans:r,limit:i.limit,values:!0,query:{index:a,range:i.range}}).then(function(u){var l=u.result;return o?l.map(o):l})}else{var s=[];return Gt(i,function(u){return s.push(u)},r,i.table.core).then(function(){return s})}},e)},t.prototype.offset=function(e){var n=this._ctx;return e<=0?this:(n.offset+=e,et(n)?Mn(n,function(){var r=e;return function(i,o){return r===0?!0:r===1?(--r,!1):(o(function(){i.advance(r),r=0}),!1)}}):Mn(n,function(){var r=e;return function(){return--r<0}}),this)},t.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Mn(this._ctx,function(){var n=e;return function(r,i,o){return--n<=0&&i(o),n>=0}},!0),this},t.prototype.until=function(e,n){return Fn(this._ctx,function(r,i,o){return e(r.value)?(i(o),n):!0}),this},t.prototype.first=function(e){return this.limit(1).toArray(function(n){return n[0]}).then(e)},t.prototype.last=function(e){return this.reverse().first(e)},t.prototype.filter=function(e){return Fn(this._ctx,function(n){return e(n.value)}),$a(this._ctx,e),this},t.prototype.and=function(e){return this.filter(e)},t.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},t.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},t.prototype.desc=function(){return this.reverse()},t.prototype.eachKey=function(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){e(i.key,i)})},t.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},t.prototype.eachPrimaryKey=function(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){e(i.primaryKey,i)})},t.prototype.keys=function(e){var n=this._ctx;n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,o){r.push(o.key)}).then(function(){return r}).then(e)},t.prototype.primaryKeys=function(e){var n=this._ctx;if(n.dir==="next"&&et(n,!0)&&n.limit>0)return this._read(function(i){var o=cn(n,n.table.core.schema);return n.table.core.query({trans:i,values:!1,limit:n.limit,query:{index:o,range:n.range}})}).then(function(i){var o=i.result;return o}).then(e);n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,o){r.push(o.primaryKey)}).then(function(){return r}).then(e)},t.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},t.prototype.firstKey=function(e){return this.limit(1).keys(function(n){return n[0]}).then(e)},t.prototype.lastKey=function(e){return this.reverse().firstKey(e)},t.prototype.distinct=function(){var e=this._ctx,n=e.index&&e.table.schema.idxByName[e.index];if(!n||!n.multi)return this;var r={};return Fn(this._ctx,function(i){var o=i.primaryKey.toString(),a=ce(r,o);return r[o]=!0,!a}),this},t.prototype.modify=function(e){var n=this,r=this._ctx;return this._write(function(i){var o;if(typeof e=="function")o=e;else{var a=J(e),s=a.length;o=function(_){for(var w=!1,y=0;y<s;++y){var k=a[y],b=e[k];Re(_,k)!==b&&(ge(_,k,b),w=!0)}return w}}var u=r.table.core,l=u.schema.primaryKey,c=l.outbound,f=l.extractKey,d=n.db._options.modifyChunkSize||200,p=[],h=0,v=[],m=function(_,w){var y=w.failures,k=w.numFailures;h+=_-k;for(var b=0,g=J(y);b<g.length;b++){var A=g[b];p.push(y[A])}};return n.clone().primaryKeys().then(function(_){var w=function(y){var k=Math.min(d,_.length-y);return u.getMany({trans:i,keys:_.slice(y,y+k),cache:"immutable"}).then(function(b){for(var g=[],A=[],S=c?[]:null,E=[],x=0;x<k;++x){var B=b[x],C={value:Lt(B),primKey:_[y+x]};o.call(C,C.value,C)!==!1&&(C.value==null?E.push(_[y+x]):!c&&ae(f(B),f(C.value))!==0?(E.push(_[y+x]),g.push(C.value)):(A.push(C.value),c&&S.push(_[y+x])))}var N=et(r)&&r.limit===1/0&&(typeof e!="function"||e===Ln)&&{index:r.index,range:r.range};return Promise.resolve(g.length>0&&u.mutate({trans:i,type:"add",values:g}).then(function(H){for(var P in H.failures)E.splice(parseInt(P),1);m(g.length,H)})).then(function(){return(A.length>0||N&&typeof e=="object")&&u.mutate({trans:i,type:"put",keys:S,values:A,criteria:N,changeSpec:typeof e!="function"&&e}).then(function(H){return m(A.length,H)})}).then(function(){return(E.length>0||N&&e===Ln)&&u.mutate({trans:i,type:"delete",keys:E,criteria:N}).then(function(H){return m(E.length,H)})}).then(function(){return _.length>y+k&&w(y+d)})})};return w(0).then(function(){if(p.length>0)throw new yn("Error modifying one or more objects",p,h,v);return _.length})})})},t.prototype.delete=function(){var e=this._ctx,n=e.range;return et(e)&&(e.isPrimKey&&!za||n.type===3)?this._write(function(r){var i=e.table.core.schema.primaryKey,o=n;return e.table.core.count({trans:r,query:{index:i,range:o}}).then(function(a){return e.table.core.mutate({trans:r,type:"deleteRange",range:o}).then(function(s){var u=s.failures;s.lastResult,s.results;var l=s.numFailures;if(l)throw new yn("Could not delete some values",Object.keys(u).map(function(c){return u[c]}),a-l);return a-l})})}):this.modify(Ln)},t}(),Ln=function(t,e){return e.value=null};function qa(t){return $t(Va.prototype,function(n,r){this.db=t;var i=so,o=null;if(r)try{i=r()}catch(l){o=l}var a=n._ctx,s=a.table,u=s.hook.reading.fire;this._ctx={table:s,index:a.index,isPrimKey:!a.index||s.schema.primKey.keyPath&&a.index===s.schema.primKey.name,range:i,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:o,or:a.or,valueMapper:u!==Nt?u:null}})}function Ya(t,e){return t<e?-1:t===e?0:1}function Ga(t,e){return t>e?-1:t===e?0:1}function ue(t,e,n){var r=t instanceof lo?new t.Collection(t):t;return r._ctx.error=n?new n(e):new TypeError(e),r}function tt(t){return new t.Collection(t,function(){return uo("")}).limit(0)}function Qa(t){return t==="next"?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()}}function Xa(t){return t==="next"?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()}}function Ja(t,e,n,r,i,o){for(var a=Math.min(t.length,r.length),s=-1,u=0;u<a;++u){var l=e[u];if(l!==r[u])return i(t[u],n[u])<0?t.substr(0,u)+n[u]+n.substr(u+1):i(t[u],r[u])<0?t.substr(0,u)+r[u]+n.substr(u+1):s>=0?t.substr(0,s)+e[s]+n.substr(s+1):null;i(t[u],l)<0&&(s=u)}return a<r.length&&o==="next"?t+n.substr(t.length):a<t.length&&o==="prev"?t.substr(0,n.length):s<0?null:t.substr(0,s)+r[s]+n.substr(s+1)}function Qt(t,e,n,r){var i,o,a,s,u,l,c,f=n.length;if(!n.every(function(v){return typeof v=="string"}))return ue(t,oo);function d(v){i=Qa(v),o=Xa(v),a=v==="next"?Ya:Ga;var m=n.map(function(_){return{lower:o(_),upper:i(_)}}).sort(function(_,w){return a(_.lower,w.lower)});s=m.map(function(_){return _.upper}),u=m.map(function(_){return _.lower}),l=v,c=v==="next"?"":r}d("next");var p=new t.Collection(t,function(){return Me(s[0],u[f-1]+r)});p._ondirectionchange=function(v){d(v)};var h=0;return p._addAlgorithm(function(v,m,_){var w=v.key;if(typeof w!="string")return!1;var y=o(w);if(e(y,u,h))return!0;for(var k=null,b=h;b<f;++b){var g=Ja(w,y,s[b],u[b],a,l);g===null&&k===null?h=b+1:(k===null||a(k,g)>0)&&(k=g)}return m(k!==null?function(){v.continue(k+c)}:_),!1}),p}function Me(t,e,n,r){return{type:2,lower:t,upper:e,lowerOpen:n,upperOpen:r}}function uo(t){return{type:1,lower:t,upper:t}}var lo=function(){function t(){}return Object.defineProperty(t.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),t.prototype.between=function(e,n,r,i){r=r!==!1,i=i===!0;try{return this._cmp(e,n)>0||this._cmp(e,n)===0&&(r||i)&&!(r&&i)?tt(this):new this.Collection(this,function(){return Me(e,n,!r,!i)})}catch{return ue(this,Ae)}},t.prototype.equals=function(e){return e==null?ue(this,Ae):new this.Collection(this,function(){return uo(e)})},t.prototype.above=function(e){return e==null?ue(this,Ae):new this.Collection(this,function(){return Me(e,void 0,!0)})},t.prototype.aboveOrEqual=function(e){return e==null?ue(this,Ae):new this.Collection(this,function(){return Me(e,void 0,!1)})},t.prototype.below=function(e){return e==null?ue(this,Ae):new this.Collection(this,function(){return Me(void 0,e,!1,!0)})},t.prototype.belowOrEqual=function(e){return e==null?ue(this,Ae):new this.Collection(this,function(){return Me(void 0,e)})},t.prototype.startsWith=function(e){return typeof e!="string"?ue(this,oo):this.between(e,e+He,!0,!0)},t.prototype.startsWithIgnoreCase=function(e){return e===""?this.startsWith(e):Qt(this,function(n,r){return n.indexOf(r[0])===0},[e],He)},t.prototype.equalsIgnoreCase=function(e){return Qt(this,function(n,r){return n===r[0]},[e],"")},t.prototype.anyOfIgnoreCase=function(){var e=Ce.apply(nt,arguments);return e.length===0?tt(this):Qt(this,function(n,r){return r.indexOf(n)!==-1},e,"")},t.prototype.startsWithAnyOfIgnoreCase=function(){var e=Ce.apply(nt,arguments);return e.length===0?tt(this):Qt(this,function(n,r){return r.some(function(i){return n.indexOf(i)===0})},e,He)},t.prototype.anyOf=function(){var e=this,n=Ce.apply(nt,arguments),r=this._cmp;try{n.sort(r)}catch{return ue(this,Ae)}if(n.length===0)return tt(this);var i=new this.Collection(this,function(){return Me(n[0],n[n.length-1])});i._ondirectionchange=function(a){r=a==="next"?e._ascending:e._descending,n.sort(r)};var o=0;return i._addAlgorithm(function(a,s,u){for(var l=a.key;r(l,n[o])>0;)if(++o,o===n.length)return s(u),!1;return r(l,n[o])===0?!0:(s(function(){a.continue(n[o])}),!1)}),i},t.prototype.notEqual=function(e){return this.inAnyRange([[or,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},t.prototype.noneOf=function(){var e=Ce.apply(nt,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return ue(this,Ae)}var n=e.reduce(function(r,i){return r?r.concat([[r[r.length-1][1],i]]):[[or,i]]},null);return n.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})},t.prototype.inAnyRange=function(e,n){var r=this,i=this._cmp,o=this._ascending,a=this._descending,s=this._min,u=this._max;if(e.length===0)return tt(this);if(!e.every(function(b){return b[0]!==void 0&&b[1]!==void 0&&o(b[0],b[1])<=0}))return ue(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",M.InvalidArgument);var l=!n||n.includeLowers!==!1,c=n&&n.includeUppers===!0;function f(b,g){for(var A=0,S=b.length;A<S;++A){var E=b[A];if(i(g[0],E[1])<0&&i(g[1],E[0])>0){E[0]=s(E[0],g[0]),E[1]=u(E[1],g[1]);break}}return A===S&&b.push(g),b}var d=o;function p(b,g){return d(b[0],g[0])}var h;try{h=e.reduce(f,[]),h.sort(p)}catch{return ue(this,Ae)}var v=0,m=c?function(b){return o(b,h[v][1])>0}:function(b){return o(b,h[v][1])>=0},_=l?function(b){return a(b,h[v][0])>0}:function(b){return a(b,h[v][0])>=0};function w(b){return!m(b)&&!_(b)}var y=m,k=new this.Collection(this,function(){return Me(h[0][0],h[h.length-1][1],!l,!c)});return k._ondirectionchange=function(b){b==="next"?(y=m,d=o):(y=_,d=a),h.sort(p)},k._addAlgorithm(function(b,g,A){for(var S=b.key;y(S);)if(++v,v===h.length)return g(A),!1;return w(S)?!0:(r._cmp(S,h[v][1])===0||r._cmp(S,h[v][0])===0||g(function(){d===o?b.continue(h[v][0]):b.continue(h[v][1])}),!1)}),k},t.prototype.startsWithAnyOf=function(){var e=Ce.apply(nt,arguments);return e.every(function(n){return typeof n=="string"})?e.length===0?tt(this):this.inAnyRange(e.map(function(n){return[n,n+He]})):ue(this,"startsWithAnyOf() only works with strings")},t}();function Za(t){return $t(lo.prototype,function(n,r,i){this.db=t,this._ctx={table:n,index:r===":id"?null:r,or:i};var o=t._deps.indexedDB;if(!o)throw new M.MissingAPI;this._cmp=this._ascending=o.cmp.bind(o),this._descending=function(a,s){return o.cmp(s,a)},this._max=function(a,s){return o.cmp(a,s)>0?a:s},this._min=function(a,s){return o.cmp(a,s)<0?a:s},this._IDBKeyRange=t._deps.IDBKeyRange})}function we(t){return G(function(e){return Rt(e),t(e.target.error),!1})}function Rt(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}var It="storagemutated",Ne="x-storagemutated-1",Ue=Ut(null,It),es=function(){function t(){}return t.prototype._lock=function(){return mt(!I.global),++this._reculock,this._reculock===1&&!I.global&&(I.lockOwnerFor=this),this},t.prototype._unlock=function(){if(mt(!I.global),--this._reculock===0)for(I.global||(I.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{dt(e[1],e[0])}catch{}}return this},t.prototype._locked=function(){return this._reculock&&I.lockOwnerFor!==this},t.prototype.create=function(e){var n=this;if(!this.mode)return this;var r=this.db.idbdb,i=this.db._state.dbOpenError;if(mt(!this.idbtrans),!e&&!r)switch(i&&i.name){case"DatabaseClosedError":throw new M.DatabaseClosed(i);case"MissingAPIError":throw new M.MissingAPI(i.message,i);default:throw new M.OpenFailed(i)}if(!this.active)throw new M.TransactionInactive;return mt(this._completion._state===null),e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):r.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})),e.onerror=G(function(o){Rt(o),n._reject(e.error)}),e.onabort=G(function(o){Rt(o),n.active&&n._reject(new M.Abort(e.error)),n.active=!1,n.on("abort").fire(o)}),e.oncomplete=G(function(){n.active=!1,n._resolve(),"mutatedParts"in e&&Ue.storagemutated.fire(e.mutatedParts)}),this},t.prototype._promise=function(e,n,r){var i=this;if(e==="readwrite"&&this.mode!=="readwrite")return Z(new M.ReadOnly("Transaction is readonly"));if(!this.active)return Z(new M.TransactionInactive);if(this._locked())return new D(function(a,s){i._blockedFuncs.push([function(){i._promise(e,n,r).then(a,s)},I])});if(r)return ze(function(){var a=new D(function(s,u){i._lock();var l=n(s,u,i);l&&l.then&&l.then(s,u)});return a.finally(function(){return i._unlock()}),a._lib=!0,a});var o=new D(function(a,s){var u=n(a,s,i);u&&u.then&&u.then(a,s)});return o._lib=!0,o},t.prototype._root=function(){return this.parent?this.parent._root():this},t.prototype.waitFor=function(e){var n=this._root(),r=D.resolve(e);if(n._waitingFor)n._waitingFor=n._waitingFor.then(function(){return r});else{n._waitingFor=r,n._waitingQueue=[];var i=n.idbtrans.objectStore(n.storeNames[0]);(function a(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(i.get(-1/0).onsuccess=a)})()}var o=n._waitingFor;return new D(function(a,s){r.then(function(u){return n._waitingQueue.push(G(a.bind(null,u)))},function(u){return n._waitingQueue.push(G(s.bind(null,u)))}).finally(function(){n._waitingFor===o&&(n._waitingFor=null)})})},t.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new M.Abort))},t.prototype.table=function(e){var n=this._memoizedTables||(this._memoizedTables={});if(ce(n,e))return n[e];var r=this.schema[e];if(!r)throw new M.NotFound("Table "+e+" not part of transaction");var i=new this.db.Table(e,r,this);return i.core=this.db.core.table(e),n[e]=i,i},t}();function ts(t){return $t(es.prototype,function(n,r,i,o,a){var s=this;this.db=t,this.mode=n,this.storeNames=r,this.schema=i,this.chromeTransactionDurability=o,this.idbtrans=null,this.on=Ut(this,"complete","error","abort"),this.parent=a||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new D(function(u,l){s._resolve=u,s._reject=l}),this._completion.then(function(){s.active=!1,s.on.complete.fire()},function(u){var l=s.active;return s.active=!1,s.on.error.fire(u),s.parent?s.parent._reject(u):l&&s.idbtrans&&s.idbtrans.abort(),Z(u)})})}function ar(t,e,n,r,i,o,a){return{name:t,keyPath:e,unique:n,multi:r,auto:i,compound:o,src:(n&&!a?"&":"")+(r?"*":"")+(i?"++":"")+co(e)}}function co(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function fo(t,e,n){return{name:t,primKey:e,indexes:n,mappedClass:null,idxByName:Ui(n,function(r){return[r.name,r]})}}function ns(t){return t.length===1?t[0]:t}var Kt=function(t){try{return t.only([[]]),Kt=function(){return[[]]},[[]]}catch{return Kt=function(){return He},He}};function sr(t){return t==null?function(){}:typeof t=="string"?rs(t):function(e){return Re(e,t)}}function rs(t){var e=t.split(".");return e.length===1?function(n){return n[t]}:function(n){return Re(n,t)}}function ri(t){return[].slice.call(t)}var is=0;function Et(t){return t==null?":id":typeof t=="string"?t:"["+t.join("+")+"]"}function os(t,e,n){function r(f,d){var p=ri(f.objectStoreNames);return{schema:{name:f.name,tables:p.map(function(h){return d.objectStore(h)}).map(function(h){var v=h.keyPath,m=h.autoIncrement,_=ie(v),w=v==null,y={},k={name:h.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:w,compound:_,keyPath:v,autoIncrement:m,unique:!0,extractKey:sr(v)},indexes:ri(h.indexNames).map(function(b){return h.index(b)}).map(function(b){var g=b.name,A=b.unique,S=b.multiEntry,E=b.keyPath,x=ie(E),B={name:g,compound:x,keyPath:E,unique:A,multiEntry:S,extractKey:sr(E)};return y[Et(E)]=B,B}),getIndexByKeyPath:function(b){return y[Et(b)]}};return y[":id"]=k.primaryKey,v!=null&&(y[Et(v)]=k.primaryKey),k})},hasGetAll:p.length>0&&"getAll"in d.objectStore(p[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function i(f){if(f.type===3)return null;if(f.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var d=f.lower,p=f.upper,h=f.lowerOpen,v=f.upperOpen,m=d===void 0?p===void 0?null:e.upperBound(p,!!v):p===void 0?e.lowerBound(d,!!h):e.bound(d,p,!!h,!!v);return m}function o(f){var d=f.name;function p(m){var _=m.trans,w=m.type,y=m.keys,k=m.values,b=m.range;return new Promise(function(g,A){g=G(g);var S=_.objectStore(d),E=S.keyPath==null,x=w==="put"||w==="add";if(!x&&w!=="delete"&&w!=="deleteRange")throw new Error("Invalid operation type: "+w);var B=(y||k||{length:1}).length;if(y&&k&&y.length!==k.length)throw new Error("Given keys array must have same length as given values array.");if(B===0)return g({numFailures:0,failures:{},results:[],lastResult:void 0});var C,N=[],H=[],P=0,W=function(be){++P,Rt(be)};if(w==="deleteRange"){if(b.type===4)return g({numFailures:P,failures:H,results:[],lastResult:void 0});b.type===3?N.push(C=S.clear()):N.push(C=S.delete(i(b)))}else{var Y=x?E?[k,y]:[k,null]:[y,null],Pe=Y[0],_e=Y[1];if(x)for(var de=0;de<B;++de)N.push(C=_e&&_e[de]!==void 0?S[w](Pe[de],_e[de]):S[w](Pe[de])),C.onerror=W;else for(var de=0;de<B;++de)N.push(C=S[w](Pe[de])),C.onerror=W}var Fe=function(be){var ht=be.target.result;N.forEach(function(pe,Ht){return pe.error!=null&&(H[Ht]=pe.error)}),g({numFailures:P,failures:H,results:w==="delete"?y:N.map(function(pe){return pe.result}),lastResult:ht})};C.onerror=function(be){W(be),Fe(be)},C.onsuccess=Fe})}function h(m){var _=m.trans,w=m.values,y=m.query,k=m.reverse,b=m.unique;return new Promise(function(g,A){g=G(g);var S=y.index,E=y.range,x=_.objectStore(d),B=S.isPrimaryKey?x:x.index(S.name),C=k?b?"prevunique":"prev":b?"nextunique":"next",N=w||!("openKeyCursor"in B)?B.openCursor(i(E),C):B.openKeyCursor(i(E),C);N.onerror=we(A),N.onsuccess=G(function(H){var P=N.result;if(!P){g(null);return}P.___id=++is,P.done=!1;var W=P.continue.bind(P),Y=P.continuePrimaryKey;Y&&(Y=Y.bind(P));var Pe=P.advance.bind(P),_e=function(){throw new Error("Cursor not started")},de=function(){throw new Error("Cursor not stopped")};P.trans=_,P.stop=P.continue=P.continuePrimaryKey=P.advance=_e,P.fail=G(A),P.next=function(){var Fe=this,be=1;return this.start(function(){return be--?Fe.continue():Fe.stop()}).then(function(){return Fe})},P.start=function(Fe){var be=new Promise(function(pe,Ht){pe=G(pe),N.onerror=we(Ht),P.fail=Ht,P.stop=function(Ro){P.stop=P.continue=P.continuePrimaryKey=P.advance=de,pe(Ro)}}),ht=function(){if(N.result)try{Fe()}catch(pe){P.fail(pe)}else P.done=!0,P.start=function(){throw new Error("Cursor behind last entry")},P.stop()};return N.onsuccess=G(function(pe){N.onsuccess=ht,ht()}),P.continue=W,P.continuePrimaryKey=Y,P.advance=Pe,ht(),be},g(P)},A)})}function v(m){return function(_){return new Promise(function(w,y){w=G(w);var k=_.trans,b=_.values,g=_.limit,A=_.query,S=g===1/0?void 0:g,E=A.index,x=A.range,B=k.objectStore(d),C=E.isPrimaryKey?B:B.index(E.name),N=i(x);if(g===0)return w({result:[]});if(m){var H=b?C.getAll(N,S):C.getAllKeys(N,S);H.onsuccess=function(Pe){return w({result:Pe.target.result})},H.onerror=we(y)}else{var P=0,W=b||!("openKeyCursor"in C)?C.openCursor(N):C.openKeyCursor(N),Y=[];W.onsuccess=function(Pe){var _e=W.result;if(!_e)return w({result:Y});if(Y.push(b?_e.value:_e.primaryKey),++P===g)return w({result:Y});_e.continue()},W.onerror=we(y)}})}}return{name:d,schema:f,mutate:p,getMany:function(m){var _=m.trans,w=m.keys;return new Promise(function(y,k){y=G(y);for(var b=_.objectStore(d),g=w.length,A=new Array(g),S=0,E=0,x,B=function(P){var W=P.target;(A[W._pos]=W.result)!=null,++E===S&&y(A)},C=we(k),N=0;N<g;++N){var H=w[N];H!=null&&(x=b.get(w[N]),x._pos=N,x.onsuccess=B,x.onerror=C,++S)}S===0&&y(A)})},get:function(m){var _=m.trans,w=m.key;return new Promise(function(y,k){y=G(y);var b=_.objectStore(d),g=b.get(w);g.onsuccess=function(A){return y(A.target.result)},g.onerror=we(k)})},query:v(u),openCursor:h,count:function(m){var _=m.query,w=m.trans,y=_.index,k=_.range;return new Promise(function(b,g){var A=w.objectStore(d),S=y.isPrimaryKey?A:A.index(y.name),E=i(k),x=E?S.count(E):S.count();x.onsuccess=G(function(B){return b(B.target.result)}),x.onerror=we(g)})}}}var a=r(t,n),s=a.schema,u=a.hasGetAll,l=s.tables.map(function(f){return o(f)}),c={};return l.forEach(function(f){return c[f.name]=f}),{stack:"dbcore",transaction:t.transaction.bind(t),table:function(f){var d=c[f];if(!d)throw new Error("Table '"+f+"' not found");return c[f]},MIN_KEY:-1/0,MAX_KEY:Kt(e),schema:s}}function as(t,e){return e.reduce(function(n,r){var i=r.create;return j(j({},n),i(n))},t)}function ss(t,e,n,r){var i=n.IDBKeyRange;n.indexedDB;var o=as(os(e,i,r),t.dbcore);return{dbcore:o}}function Rr(t,e){var n=t._novip,r=e.db,i=ss(n._middlewares,r,n._deps,e);n.core=i.dbcore,n.tables.forEach(function(o){var a=o.name;n.core.schema.tables.some(function(s){return s.name===a})&&(o.core=n.core.table(a),n[a]instanceof n.Table&&(n[a].core=o.core))})}function En(t,e,n,r){var i=t._novip;n.forEach(function(o){var a=r[o];e.forEach(function(s){var u=Er(s,o);(!u||"value"in u&&u.value===void 0)&&(s===i.Transaction.prototype||s instanceof i.Transaction?Ie(s,o,{get:function(){return this.table(o)},set:function(l){Ni(this,o,{value:l,writable:!0,configurable:!0,enumerable:!0})}}):s[o]=new i.Table(o,a))})})}function ur(t,e){var n=t._novip;e.forEach(function(r){for(var i in r)r[i]instanceof n.Table&&delete r[i]})}function us(t,e){return t._cfg.version-e._cfg.version}function ls(t,e,n,r){var i=t._dbSchema,o=t._createTransaction("readwrite",t._storeNames,i);o.create(n),o._completion.catch(r);var a=o._reject.bind(o),s=I.transless||I;ze(function(){I.trans=o,I.transless=s,e===0?(J(i).forEach(function(u){Ir(n,u,i[u].primKey,i[u].indexes)}),Rr(t,n),D.follow(function(){return t.on.populate.fire(o)}).catch(a)):cs(t,e,o,n).catch(a)})}function cs(t,e,n,r){var i=t._novip,o=[],a=i._versions,s=i._dbSchema=Kr(i,i.idbdb,r),u=!1,l=a.filter(function(f){return f._cfg.version>=e});l.forEach(function(f){o.push(function(){var d=s,p=f._cfg.dbschema;cr(i,d,r),cr(i,p,r),s=i._dbSchema=p;var h=ho(d,p);h.add.forEach(function(k){Ir(r,k[0],k[1].primKey,k[1].indexes)}),h.change.forEach(function(k){if(k.recreate)throw new M.Upgrade("Not yet support for changing primary key");var b=r.objectStore(k.name);k.add.forEach(function(g){return lr(b,g)}),k.change.forEach(function(g){b.deleteIndex(g.name),lr(b,g)}),k.del.forEach(function(g){return b.deleteIndex(g)})});var v=f._cfg.contentUpgrade;if(v&&f._cfg.version>e){Rr(i,r),n._memoizedTables={},u=!0;var m=$i(p);h.del.forEach(function(k){m[k]=d[k]}),ur(i,[i.Transaction.prototype]),En(i,[i.Transaction.prototype],J(m),m),n.schema=m;var _=Sr(v);_&&ft();var w,y=D.follow(function(){if(w=v(n),w&&_){var k=Ke.bind(null,null);w.then(k,k)}});return w&&typeof w.then=="function"?D.resolve(w):y.then(function(){return w})}}),o.push(function(d){if(!u||!Na){var p=f._cfg.dbschema;ds(p,d)}ur(i,[i.Transaction.prototype]),En(i,[i.Transaction.prototype],i._storeNames,i._dbSchema),n.schema=i._dbSchema})});function c(){return o.length?D.resolve(o.shift()(n.idbtrans)).then(c):D.resolve()}return c().then(function(){fs(s,r)})}function ho(t,e){var n={del:[],add:[],change:[]},r;for(r in t)e[r]||n.del.push(r);for(r in e){var i=t[r],o=e[r];if(!i)n.add.push([r,o]);else{var a={name:r,def:o,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(o.primKey.keyPath||"")||i.primKey.auto!==o.primKey.auto&&!Dn)a.recreate=!0,n.change.push(a);else{var s=i.idxByName,u=o.idxByName,l=void 0;for(l in s)u[l]||a.del.push(l);for(l in u){var c=s[l],f=u[l];c?c.src!==f.src&&a.change.push(f):a.add.push(f)}(a.del.length>0||a.add.length>0||a.change.length>0)&&n.change.push(a)}}}return n}function Ir(t,e,n,r){var i=t.db.createObjectStore(e,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(function(o){return lr(i,o)}),i}function fs(t,e){J(t).forEach(function(n){e.db.objectStoreNames.contains(n)||Ir(e,n,t[n].primKey,t[n].indexes)})}function ds(t,e){[].slice.call(e.db.objectStoreNames).forEach(function(n){return t[n]==null&&e.db.deleteObjectStore(n)})}function lr(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function Kr(t,e,n){var r={},i=Bn(e.objectStoreNames,0);return i.forEach(function(o){for(var a=n.objectStore(o),s=a.keyPath,u=ar(co(s),s||"",!1,!1,!!a.autoIncrement,s&&typeof s!="string",!0),l=[],c=0;c<a.indexNames.length;++c){var f=a.index(a.indexNames[c]);s=f.keyPath;var d=ar(f.name,s,!!f.unique,!!f.multiEntry,!1,s&&typeof s!="string",!1);l.push(d)}r[o]=fo(o,u,l)}),r}function hs(t,e,n){var r=t._novip;r.verno=e.version/10;var i=r._dbSchema=Kr(r,e,n);r._storeNames=Bn(e.objectStoreNames,0),En(r,[r._allTables],J(i),i)}function ps(t,e){var n=Kr(t,t.idbdb,e),r=ho(n,t._dbSchema);return!(r.add.length||r.change.some(function(i){return i.add.length||i.change.length}))}function cr(t,e,n){for(var r=t._novip,i=n.db.objectStoreNames,o=0;o<i.length;++o){var a=i[o],s=n.objectStore(a);r._hasGetAll="getAll"in s;for(var u=0;u<s.indexNames.length;++u){var l=s.indexNames[u],c=s.index(l).keyPath,f=typeof c=="string"?c:"["+Bn(c).join("+")+"]";if(e[a]){var d=e[a].idxByName[f];d&&(d.name=l,delete e[a].idxByName[f],e[a].idxByName[l]=d)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&V.WorkerGlobalScope&&V instanceof V.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(r._hasGetAll=!1)}function vs(t){return t.split(",").map(function(e,n){e=e.trim();var r=e.replace(/([&*]|\+\+)/g,""),i=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return ar(r,i||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),ie(i),n===0)})}var ms=function(){function t(){}return t.prototype._parseStoresSpec=function(e,n){J(e).forEach(function(r){if(e[r]!==null){var i=vs(e[r]),o=i.shift();if(o.multi)throw new M.Schema("Primary key cannot be multi-valued");i.forEach(function(a){if(a.auto)throw new M.Schema("Only primary key can be marked as autoIncrement (++)");if(!a.keyPath)throw new M.Schema("Index must have a name and cannot be an empty string")}),n[r]=fo(r,o,i)}})},t.prototype.stores=function(e){var n=this.db;this._cfg.storesSource=this._cfg.storesSource?se(this._cfg.storesSource,e):e;var r=n._versions,i={},o={};return r.forEach(function(a){se(i,a._cfg.storesSource),o=a._cfg.dbschema={},a._parseStoresSpec(i,o)}),n._dbSchema=o,ur(n,[n._allTables,n,n.Transaction.prototype]),En(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],J(o),o),n._storeNames=J(o),this},t.prototype.upgrade=function(e){return this._cfg.contentUpgrade=Cr(this._cfg.contentUpgrade||$,e),this},t}();function ys(t){return $t(ms.prototype,function(n){this.db=t,this._cfg={version:n,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function Pr(t,e){var n=t._dbNamesDB;return n||(n=t._dbNamesDB=new Nr(On,{addons:[],indexedDB:t,IDBKeyRange:e}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function Fr(t){return t&&typeof t.databases=="function"}function gs(t){var e=t.indexedDB,n=t.IDBKeyRange;return Fr(e)?Promise.resolve(e.databases()).then(function(r){return r.map(function(i){return i.name}).filter(function(i){return i!==On})}):Pr(e,n).toCollection().primaryKeys()}function _s(t,e){var n=t.indexedDB,r=t.IDBKeyRange;!Fr(n)&&e!==On&&Pr(n,r).put({name:e}).catch($)}function bs(t,e){var n=t.indexedDB,r=t.IDBKeyRange;!Fr(n)&&e!==On&&Pr(n,r).delete(e).catch($)}function fr(t){return ze(function(){return I.letThrough=!0,t()})}function ws(){var t=!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent);if(!t||!indexedDB.databases)return Promise.resolve();var e;return new Promise(function(n){var r=function(){return indexedDB.databases().finally(n)};e=setInterval(r,100),r()}).finally(function(){return clearInterval(e)})}function ks(t){var e=t._state,n=t._deps.indexedDB;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(function(){return e.dbOpenError?Z(e.dbOpenError):t});Se&&(e.openCanceller._stackHolder=Ze()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;var r=e.openCanceller;function i(){if(e.openCanceller!==r)throw new M.DatabaseClosed("db.open() was cancelled")}var o=e.dbReadyResolve,a=null,s=!1;return D.race([r,(typeof navigator>"u"?D.resolve():ws()).then(function(){return new D(function(u,l){if(i(),!n)throw new M.MissingAPI;var c=t.name,f=e.autoSchema?n.open(c):n.open(c,Math.round(t.verno*10));if(!f)throw new M.MissingAPI;f.onerror=we(l),f.onblocked=G(t._fireOnBlocked),f.onupgradeneeded=G(function(d){if(a=f.transaction,e.autoSchema&&!t._options.allowEmptyDB){f.onerror=Rt,a.abort(),f.result.close();var p=n.deleteDatabase(c);p.onsuccess=p.onerror=G(function(){l(new M.NoSuchDatabase("Database "+c+" doesnt exist"))})}else{a.onerror=we(l);var h=d.oldVersion>Math.pow(2,62)?0:d.oldVersion;s=h<1,t._novip.idbdb=f.result,ls(t,h/10,a,l)}},l),f.onsuccess=G(function(){a=null;var d=t._novip.idbdb=f.result,p=Bn(d.objectStoreNames);if(p.length>0)try{var h=d.transaction(ns(p),"readonly");e.autoSchema?hs(t,d,h):(cr(t,t._dbSchema,h),ps(t,h)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),Rr(t,h)}catch{}kt.push(t),d.onversionchange=G(function(v){e.vcFired=!0,t.on("versionchange").fire(v)}),d.onclose=G(function(v){t.on("close").fire(v)}),s&&_s(t._deps,c),u()},l)})})]).then(function(){return i(),e.onReadyBeingFired=[],D.resolve(fr(function(){return t.on.ready.fire(t.vip)})).then(function u(){if(e.onReadyBeingFired.length>0){var l=e.onReadyBeingFired.reduce(Cr,$);return e.onReadyBeingFired=[],D.resolve(fr(function(){return l(t.vip)})).then(u)}})}).finally(function(){e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(function(){return t}).catch(function(u){e.dbOpenError=u;try{a&&a.abort()}catch{}return r===e.openCanceller&&t._close(),Z(u)}).finally(function(){e.openComplete=!0,o()})}function dr(t){var e=function(a){return t.next(a)},n=function(a){return t.throw(a)},r=o(e),i=o(n);function o(a){return function(s){var u=a(s),l=u.value;return u.done?l:!l||typeof l.then!="function"?ie(l)?Promise.all(l).then(r,i):r(l):l.then(r,i)}}return o(e)()}function Es(t,e,n){var r=arguments.length;if(r<2)throw new M.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];n=i.pop();var o=Hi(i);return[t,o,n]}function po(t,e,n,r,i){return D.resolve().then(function(){var o=I.transless||I,a=t._createTransaction(e,n,t._dbSchema,r),s={trans:a,transless:o};if(r)a.idbtrans=r.idbtrans;else try{a.create(),t._state.PR1398_maxLoop=3}catch(f){return f.name===xr.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(function(){return po(t,e,n,null,i)})):Z(f)}var u=Sr(i);u&&ft();var l,c=D.follow(function(){if(l=i.call(a,a),l)if(u){var f=Ke.bind(null,null);l.then(f,f)}else typeof l.next=="function"&&typeof l.throw=="function"&&(l=dr(l))},s);return(l&&typeof l.then=="function"?D.resolve(l).then(function(f){return a.active?f:Z(new M.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):c.then(function(){return l})).then(function(f){return r&&a._resolve(),a._completion.then(function(){return f})}).catch(function(f){return a._reject(f),Z(f)})})}function Xt(t,e,n){for(var r=ie(t)?t.slice():[t],i=0;i<n;++i)r.push(e);return r}function Ss(t){return j(j({},t),{table:function(e){var n=t.table(e),r=n.schema,i={},o=[];function a(v,m,_){var w=Et(v),y=i[w]=i[w]||[],k=v==null?0:typeof v=="string"?1:v.length,b=m>0,g=j(j({},_),{isVirtual:b,keyTail:m,keyLength:k,extractKey:sr(v),unique:!b&&_.unique});if(y.push(g),g.isPrimaryKey||o.push(g),k>1){var A=k===2?v[0]:v.slice(0,k-1);a(A,m+1,_)}return y.sort(function(S,E){return S.keyTail-E.keyTail}),g}var s=a(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[s];for(var u=0,l=r.indexes;u<l.length;u++){var c=l[u];a(c.keyPath,0,c)}function f(v){var m=i[Et(v)];return m&&m[0]}function d(v,m){return{type:v.type===1?2:v.type,lower:Xt(v.lower,v.lowerOpen?t.MAX_KEY:t.MIN_KEY,m),lowerOpen:!0,upper:Xt(v.upper,v.upperOpen?t.MIN_KEY:t.MAX_KEY,m),upperOpen:!0}}function p(v){var m=v.query.index;return m.isVirtual?j(j({},v),{query:{index:m,range:d(v.query.range,m.keyTail)}}):v}var h=j(j({},n),{schema:j(j({},r),{primaryKey:s,indexes:o,getIndexByKeyPath:f}),count:function(v){return n.count(p(v))},query:function(v){return n.query(p(v))},openCursor:function(v){var m=v.query.index,_=m.keyTail,w=m.isVirtual,y=m.keyLength;if(!w)return n.openCursor(v);function k(b){function g(S){S!=null?b.continue(Xt(S,v.reverse?t.MAX_KEY:t.MIN_KEY,_)):v.unique?b.continue(b.key.slice(0,y).concat(v.reverse?t.MIN_KEY:t.MAX_KEY,_)):b.continue()}var A=Object.create(b,{continue:{value:g},continuePrimaryKey:{value:function(S,E){b.continuePrimaryKey(Xt(S,t.MAX_KEY,_),E)}},primaryKey:{get:function(){return b.primaryKey}},key:{get:function(){var S=b.key;return y===1?S[0]:S.slice(0,y)}},value:{get:function(){return b.value}}});return A}return n.openCursor(p(v)).then(function(b){return b&&k(b)})}});return h}})}var As={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:Ss};function Mr(t,e,n,r){return n=n||{},r=r||"",J(t).forEach(function(i){if(!ce(e,i))n[r+i]=void 0;else{var o=t[i],a=e[i];if(typeof o=="object"&&typeof a=="object"&&o&&a){var s=qn(o),u=qn(a);s!==u?n[r+i]=e[i]:s==="Object"?Mr(o,a,n,r+i+"."):o!==a&&(n[r+i]=e[i])}else o!==a&&(n[r+i]=e[i])}}),J(e).forEach(function(i){ce(t,i)||(n[r+i]=e[i])}),n}function xs(t,e){return e.type==="delete"?e.keys:e.keys||e.values.map(t.extractKey)}var Cs={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(t){return j(j({},t),{table:function(e){var n=t.table(e),r=n.schema.primaryKey,i=j(j({},n),{mutate:function(o){var a=I.trans,s=a.table(e).hook,u=s.deleting,l=s.creating,c=s.updating;switch(o.type){case"add":if(l.fire===$)break;return a._promise("readwrite",function(){return f(o)},!0);case"put":if(l.fire===$&&c.fire===$)break;return a._promise("readwrite",function(){return f(o)},!0);case"delete":if(u.fire===$)break;return a._promise("readwrite",function(){return f(o)},!0);case"deleteRange":if(u.fire===$)break;return a._promise("readwrite",function(){return d(o)},!0)}return n.mutate(o);function f(h){var v=I.trans,m=h.keys||xs(r,h);if(!m)throw new Error("Keys missing");return h=h.type==="add"||h.type==="put"?j(j({},h),{keys:m}):j({},h),h.type!=="delete"&&(h.values=Wn([],h.values,!0)),h.keys&&(h.keys=Wn([],h.keys,!0)),Bs(n,h,m).then(function(_){var w=m.map(function(y,k){var b=_[k],g={onerror:null,onsuccess:null};if(h.type==="delete")u.fire.call(g,y,b,v);else if(h.type==="add"||b===void 0){var A=l.fire.call(g,y,h.values[k],v);y==null&&A!=null&&(y=A,h.keys[k]=y,r.outbound||ge(h.values[k],r.keyPath,y))}else{var S=Mr(b,h.values[k]),E=c.fire.call(g,S,y,b,v);if(E){var x=h.values[k];Object.keys(E).forEach(function(B){ce(x,B)?x[B]=E[B]:ge(x,B,E[B])})}}return g});return n.mutate(h).then(function(y){for(var k=y.failures,b=y.results,g=y.numFailures,A=y.lastResult,S=0;S<m.length;++S){var E=b?b[S]:m[S],x=w[S];E==null?x.onerror&&x.onerror(k[S]):x.onsuccess&&x.onsuccess(h.type==="put"&&_[S]?h.values[S]:E)}return{failures:k,results:b,numFailures:g,lastResult:A}}).catch(function(y){return w.forEach(function(k){return k.onerror&&k.onerror(y)}),Promise.reject(y)})})}function d(h){return p(h.trans,h.range,1e4)}function p(h,v,m){return n.query({trans:h,values:!1,query:{index:r,range:v},limit:m}).then(function(_){var w=_.result;return f({type:"delete",keys:w,trans:h}).then(function(y){return y.numFailures>0?Promise.reject(y.failures[0]):w.length<m?{failures:[],numFailures:0,lastResult:void 0}:p(h,j(j({},v),{lower:w[w.length-1],lowerOpen:!0}),m)})})}}});return i}})}};function Bs(t,e,n){return e.type==="add"?Promise.resolve([]):t.getMany({trans:e.trans,keys:n,cache:"immutable"})}function vo(t,e,n){try{if(!e||e.keys.length<t.length)return null;for(var r=[],i=0,o=0;i<e.keys.length&&o<t.length;++i)ae(e.keys[i],t[o])===0&&(r.push(n?Lt(e.values[i]):e.values[i]),++o);return r.length===t.length?r:null}catch{return null}}var Ts={stack:"dbcore",level:-1,create:function(t){return{table:function(e){var n=t.table(e);return j(j({},n),{getMany:function(r){if(!r.cache)return n.getMany(r);var i=vo(r.keys,r.trans._cache,r.cache==="clone");return i?D.resolve(i):n.getMany(r).then(function(o){return r.trans._cache={keys:r.keys,values:r.cache==="clone"?Lt(o):o},o})},mutate:function(r){return r.type!=="add"&&(r.trans._cache=null),n.mutate(r)}})}}}},Nn;function Lr(t){return!("from"in t)}var xe=function(t,e){if(this)se(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0});else{var n=new xe;return t&&"d"in t&&se(n,t),n}};at(xe.prototype,(Nn={add:function(t){return Sn(this,t),this},addKey:function(t){return Pt(this,t,t),this},addKeys:function(t){var e=this;return t.forEach(function(n){return Pt(e,n,n)}),this}},Nn[Yn]=function(){return hr(this)},Nn));function Pt(t,e,n){var r=ae(e,n);if(!isNaN(r)){if(r>0)throw RangeError();if(Lr(t))return se(t,{from:e,to:n,d:1});var i=t.l,o=t.r;if(ae(n,t.from)<0)return i?Pt(i,e,n):t.l={from:e,to:n,d:1,l:null,r:null},ii(t);if(ae(e,t.to)>0)return o?Pt(o,e,n):t.r={from:e,to:n,d:1,l:null,r:null},ii(t);ae(e,t.from)<0&&(t.from=e,t.l=null,t.d=o?o.d+1:1),ae(n,t.to)>0&&(t.to=n,t.r=null,t.d=t.l?t.l.d+1:1);var a=!t.r;i&&!t.l&&Sn(t,i),o&&a&&Sn(t,o)}}function Sn(t,e){function n(r,i){var o=i.from,a=i.to,s=i.l,u=i.r;Pt(r,o,a),s&&n(r,s),u&&n(r,u)}Lr(e)||n(t,e)}function Ds(t,e){var n=hr(e),r=n.next();if(r.done)return!1;for(var i=r.value,o=hr(t),a=o.next(i.from),s=a.value;!r.done&&!a.done;){if(ae(s.from,i.to)<=0&&ae(s.to,i.from)>=0)return!0;ae(i.from,s.from)<0?i=(r=n.next(s.from)).value:s=(a=o.next(i.from)).value}return!1}function hr(t){var e=Lr(t)?null:{s:0,n:t};return{next:function(n){for(var r=arguments.length>0;e;)switch(e.s){case 0:if(e.s=1,r)for(;e.n.l&&ae(n,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!r||ae(n,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function ii(t){var e,n,r=(((e=t.r)===null||e===void 0?void 0:e.d)||0)-(((n=t.l)===null||n===void 0?void 0:n.d)||0),i=r>1?"r":r<-1?"l":"";if(i){var o=i==="r"?"l":"r",a=j({},t),s=t[i];t.from=s.from,t.to=s.to,t[i]=s[i],a[i]=s[o],t[o]=a,a.d=oi(a)}t.d=oi(t)}function oi(t){var e=t.r,n=t.l;return(e?n?Math.max(e.d,n.d):e.d:n?n.d:0)+1}var Os={stack:"dbcore",level:0,create:function(t){var e=t.schema.name,n=new xe(t.MIN_KEY,t.MAX_KEY);return j(j({},t),{table:function(r){var i=t.table(r),o=i.schema,a=o.primaryKey,s=a.extractKey,u=a.outbound,l=j(j({},i),{mutate:function(d){var p=d.trans,h=p.mutatedParts||(p.mutatedParts={}),v=function(A){var S="idb://"+e+"/"+r+"/"+A;return h[S]||(h[S]=new xe)},m=v(""),_=v(":dels"),w=d.type,y=d.type==="deleteRange"?[d.range]:d.type==="delete"?[d.keys]:d.values.length<50?[[],d.values]:[],k=y[0],b=y[1],g=d.trans._cache;return i.mutate(d).then(function(A){if(ie(k)){w!=="delete"&&(k=A.results),m.addKeys(k);var S=vo(k,g);!S&&w!=="add"&&_.addKeys(k),(S||b)&&Rs(v,o,S,b)}else if(k){var E={from:k.lower,to:k.upper};_.add(E),m.add(E)}else m.add(n),_.add(n),o.indexes.forEach(function(x){return v(x.name).add(n)});return A})}}),c=function(d){var p,h,v=d.query,m=v.index,_=v.range;return[m,new xe((p=_.lower)!==null&&p!==void 0?p:t.MIN_KEY,(h=_.upper)!==null&&h!==void 0?h:t.MAX_KEY)]},f={get:function(d){return[a,new xe(d.key)]},getMany:function(d){return[a,new xe().addKeys(d.keys)]},count:c,query:c,openCursor:c};return J(f).forEach(function(d){l[d]=function(p){var h=I.subscr;if(h){var v=function(g){var A="idb://"+e+"/"+r+"/"+g;return h[A]||(h[A]=new xe)},m=v(""),_=v(":dels"),w=f[d](p),y=w[0],k=w[1];if(v(y.name||"").add(k),!y.isPrimaryKey)if(d==="count")_.add(n);else{var b=d==="query"&&u&&p.values&&i.query(j(j({},p),{values:!1}));return i[d].apply(this,arguments).then(function(g){if(d==="query"){if(u&&p.values)return b.then(function(x){var B=x.result;return m.addKeys(B),g});var A=p.values?g.result.map(s):g.result;p.values?m.addKeys(A):_.addKeys(A)}else if(d==="openCursor"){var S=g,E=p.values;return S&&Object.create(S,{key:{get:function(){return _.addKey(S.primaryKey),S.key}},primaryKey:{get:function(){var x=S.primaryKey;return _.addKey(x),x}},value:{get:function(){return E&&m.addKey(S.primaryKey),S.value}}})}return g})}}return i[d].apply(this,arguments)}}),l}})}};function Rs(t,e,n,r){function i(o){var a=t(o.name||"");function s(l){return l!=null?o.extractKey(l):null}var u=function(l){return o.multiEntry&&ie(l)?l.forEach(function(c){return a.addKey(c)}):a.addKey(l)};(n||r).forEach(function(l,c){var f=n&&s(n[c]),d=r&&s(r[c]);ae(f,d)!==0&&(f!=null&&u(f),d!=null&&u(d))})}e.indexes.forEach(i)}var Nr=function(){function t(e,n){var r=this;this._middlewares={},this.verno=0;var i=t.dependencies;this._options=n=j({addons:t.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange},n),this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};var o=n.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var a={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:$,dbReadyPromise:null,cancelOpen:$,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};a.dbReadyPromise=new D(function(s){a.dbReadyResolve=s}),a.openCanceller=new D(function(s,u){a.cancelOpen=u}),this._state=a,this.name=e,this.on=Ut(this,"populate","blocked","versionchange","close",{ready:[Cr,$]}),this.on.ready.subscribe=zi(this.on.ready.subscribe,function(s){return function(u,l){t.vip(function(){var c=r._state;if(c.openComplete)c.dbOpenError||D.resolve().then(u),l&&s(u);else if(c.onReadyBeingFired)c.onReadyBeingFired.push(u),l&&s(u);else{s(u);var f=r;l||s(function d(){f.on.ready.unsubscribe(u),f.on.ready.unsubscribe(d)})}})}}),this.Collection=qa(this),this.Table=Ua(this),this.Transaction=ts(this),this.Version=ys(this),this.WhereClause=Za(this),this.on("versionchange",function(s){s.newVersion>0?console.warn("Another connection wants to upgrade database '"+r.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+r.name+"'. Closing db now to resume the delete request."),r.close()}),this.on("blocked",function(s){!s.newVersion||s.newVersion<s.oldVersion?console.warn("Dexie.delete('"+r.name+"') was blocked"):console.warn("Upgrade '"+r.name+"' blocked by other connection holding version "+s.oldVersion/10)}),this._maxKey=Kt(n.IDBKeyRange),this._createTransaction=function(s,u,l,c){return new r.Transaction(s,u,l,r._options.chromeTransactionDurability,c)},this._fireOnBlocked=function(s){r.on("blocked").fire(s),kt.filter(function(u){return u.name===r.name&&u!==r&&!u._state.vcFired}).map(function(u){return u.on("versionchange").fire(s)})},this.use(As),this.use(Cs),this.use(Os),this.use(Ts),this.vip=Object.create(this,{_vip:{value:!0}}),o.forEach(function(s){return s(r)})}return t.prototype.version=function(e){if(isNaN(e)||e<.1)throw new M.Type("Given version is not a positive number");if(e=Math.round(e*10)/10,this.idbdb||this._state.isBeingOpened)throw new M.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var n=this._versions,r=n.filter(function(i){return i._cfg.version===e})[0];return r||(r=new this.Version(e),n.push(r),n.sort(us),r.stores({}),this._state.autoSchema=!1,r)},t.prototype._whenReady=function(e){var n=this;return this.idbdb&&(this._state.openComplete||I.letThrough||this._vip)?e():new D(function(r,i){if(n._state.openComplete)return i(new M.DatabaseClosed(n._state.dbOpenError));if(!n._state.isBeingOpened){if(!n._options.autoOpen){i(new M.DatabaseClosed);return}n.open().catch($)}n._state.dbReadyPromise.then(r,i)}).then(e)},t.prototype.use=function(e){var n=e.stack,r=e.create,i=e.level,o=e.name;o&&this.unuse({stack:n,name:o});var a=this._middlewares[n]||(this._middlewares[n]=[]);return a.push({stack:n,create:r,level:i==null?10:i,name:o}),a.sort(function(s,u){return s.level-u.level}),this},t.prototype.unuse=function(e){var n=e.stack,r=e.name,i=e.create;return n&&this._middlewares[n]&&(this._middlewares[n]=this._middlewares[n].filter(function(o){return i?o.create!==i:r?o.name!==r:!1})),this},t.prototype.open=function(){return ks(this)},t.prototype._close=function(){var e=this._state,n=kt.indexOf(this);if(n>=0&&kt.splice(n,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}e.dbReadyPromise=new D(function(r){e.dbReadyResolve=r}),e.openCanceller=new D(function(r,i){e.cancelOpen=i})},t.prototype.close=function(){this._close();var e=this._state;this._options.autoOpen=!1,e.dbOpenError=new M.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)},t.prototype.delete=function(){var e=this,n=arguments.length>0,r=this._state;return new D(function(i,o){var a=function(){e.close();var s=e._deps.indexedDB.deleteDatabase(e.name);s.onsuccess=G(function(){bs(e._deps,e.name),i()}),s.onerror=we(o),s.onblocked=e._fireOnBlocked};if(n)throw new M.InvalidArgument("Arguments not allowed in db.delete()");r.isBeingOpened?r.dbReadyPromise.then(a):a()})},t.prototype.backendDB=function(){return this.idbdb},t.prototype.isOpen=function(){return this.idbdb!==null},t.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"},t.prototype.hasFailed=function(){return this._state.dbOpenError!==null},t.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(t.prototype,"tables",{get:function(){var e=this;return J(this._allTables).map(function(n){return e._allTables[n]})},enumerable:!1,configurable:!0}),t.prototype.transaction=function(){var e=Es.apply(this,arguments);return this._transaction.apply(this,e)},t.prototype._transaction=function(e,n,r){var i=this,o=I.trans;(!o||o.db!==this||e.indexOf("!")!==-1)&&(o=null);var a=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");var s,u;try{if(u=n.map(function(c){var f=c instanceof i.Table?c.name:c;if(typeof f!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return f}),e=="r"||e===Kn)s=Kn;else if(e=="rw"||e==Pn)s=Pn;else throw new M.InvalidArgument("Invalid transaction mode: "+e);if(o){if(o.mode===Kn&&s===Pn)if(a)o=null;else throw new M.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");o&&u.forEach(function(c){if(o&&o.storeNames.indexOf(c)===-1)if(a)o=null;else throw new M.SubTransaction("Table "+c+" not included in parent transaction.")}),a&&o&&!o.active&&(o=null)}}catch(c){return o?o._promise(null,function(f,d){d(c)}):Z(c)}var l=po.bind(null,this,s,u,o,r);return o?o._promise(s,l,"lock"):I.trans?dt(I.transless,function(){return i._whenReady(l)}):this._whenReady(l)},t.prototype.table=function(e){if(!ce(this._allTables,e))throw new M.InvalidTable("Table "+e+" does not exist");return this._allTables[e]},t}(),Is=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Ks=function(){function t(e){this._subscribe=e}return t.prototype.subscribe=function(e,n,r){return this._subscribe(!e||typeof e=="function"?{next:e,error:n,complete:r}:e)},t.prototype[Is]=function(){return this},t}();function mo(t,e){return J(e).forEach(function(n){var r=t[n]||(t[n]=new xe);Sn(r,e[n])}),t}function yo(t){return new Ks(function(e){var n=Sr(t);function r(p){n&&ft();var h=function(){return ze(t,{subscr:p,trans:null})},v=I.trans?dt(I.transless,h):h();return n&&v.then(Ke,Ke),v}var i=!1,o={},a={},s={get closed(){return i},unsubscribe:function(){i=!0,Ue.storagemutated.unsubscribe(f)}};e.start&&e.start(s);var u=!1,l=!1;function c(){return J(a).some(function(p){return o[p]&&Ds(o[p],a[p])})}var f=function(p){mo(o,p),c()&&d()},d=function(){if(!(u||i)){o={};var p={},h=r(p);l||(Ue(It,f),l=!0),u=!0,Promise.resolve(h).then(function(v){u=!1,!i&&(c()?d():(o={},a=p,e.next&&e.next(v)))},function(v){u=!1,e.error&&e.error(v),s.unsubscribe()})}};return d(),s})}var pr;try{pr={indexedDB:V.indexedDB||V.mozIndexedDB||V.webkitIndexedDB||V.msIndexedDB,IDBKeyRange:V.IDBKeyRange||V.webkitIDBKeyRange}}catch{pr={indexedDB:null,IDBKeyRange:null}}var $e=Nr;at($e,j(j({},Tn),{delete:function(t){var e=new $e(t,{addons:[]});return e.delete()},exists:function(t){return new $e(t,{addons:[]}).open().then(function(e){return e.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(t){try{return gs($e.dependencies).then(t)}catch{return Z(new M.MissingAPI)}},defineClass:function(){function t(e){se(this,e)}return t},ignoreTransaction:function(t){return I.trans?dt(I.transless,t):t()},vip:fr,async:function(t){return function(){try{var e=dr(t.apply(this,arguments));return!e||typeof e.then!="function"?D.resolve(e):e}catch(n){return Z(n)}}},spawn:function(t,e,n){try{var r=dr(t.apply(n,e||[]));return!r||typeof r.then!="function"?D.resolve(r):r}catch(i){return Z(i)}},currentTransaction:{get:function(){return I.trans||null}},waitFor:function(t,e){var n=D.resolve(typeof t=="function"?$e.ignoreTransaction(t):t).timeout(e||6e4);return I.trans?I.trans.waitFor(n):n},Promise:D,debug:{get:function(){return Se},set:function(t){Vi(t,t==="dexie"?function(){return!0}:ao)}},derive:lt,extend:se,props:at,override:zi,Events:Ut,on:Ue,liveQuery:yo,extendObservabilitySet:mo,getByKeyPath:Re,setByKeyPath:ge,delByKeyPath:ha,shallowClone:$i,deepClone:Lt,getObjectDiff:Mr,cmp:ae,asap:ji,minKey:or,addons:[],connections:kt,errnames:xr,dependencies:pr,semVer:Jr,version:Jr.split(".").map(function(t){return parseInt(t)}).reduce(function(t,e,n){return t+e/Math.pow(10,n*2)})}));$e.maxKey=Kt($e.dependencies.IDBKeyRange);typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Ue(It,function(t){if(!Te){var e;Dn?(e=document.createEvent("CustomEvent"),e.initCustomEvent(Ne,!0,!0,t)):e=new CustomEvent(Ne,{detail:t}),Te=!0,dispatchEvent(e),Te=!1}}),addEventListener(Ne,function(t){var e=t.detail;Te||An(e)}));function An(t){var e=Te;try{Te=!0,Ue.storagemutated.fire(t)}finally{Te=e}}var Te=!1;if(typeof BroadcastChannel<"u"){var ai=new BroadcastChannel(Ne);Ue(It,function(t){Te||ai.postMessage(t)}),ai.onmessage=function(t){t.data&&An(t.data)}}else if(typeof self<"u"&&typeof navigator<"u"){Ue(It,function(t){try{Te||(typeof localStorage<"u"&&localStorage.setItem(Ne,JSON.stringify({trig:Math.random(),changedParts:t})),typeof self.clients=="object"&&Wn([],self.clients.matchAll({includeUncontrolled:!0}),!0).forEach(function(e){return e.postMessage({type:Ne,changedParts:t})}))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",function(t){if(t.key===Ne){var e=JSON.parse(t.newValue);e&&An(e.changedParts)}});var si=self.document&&navigator.serviceWorker;si&&si.addEventListener("message",Ps)}function Ps(t){var e=t.data;e&&e.type===Ne&&An(e.changedParts)}D.rejectionMapper=ka;Vi(Se,ao);class Fs extends Nr{constructor(){super("bookDB");jr(this,"books");this.version(4).stores({books:"++id, meta, contents, toc, files, progress"})}}const ke=new Fs,Ms=async t=>{for(let e of await ke.books.toArray())if(e.meta.title===t.meta.title)return e.id;try{return await ke.books.add(t)}catch(e){console.log(e)}};function go(t){return t.arrayBuffer?t.arrayBuffer():new Promise((e,n)=>{const r=new FileReader;r.addEventListener("loadend",()=>{e(r.result)}),r.addEventListener("error",n),r.readAsArrayBuffer(t)})}async function Ls(t){const e=await go(t);return new Uint8Array(e)}function _o(t){return typeof Blob<"u"&&t instanceof Blob}function Ft(t){return typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}const Ns=typeof process<"u"&&process.versions&&typeof process.versions.node<"u"&&typeof process.versions.electron>"u";function zs(t){return t.byteOffset===0&&t.byteLength===t.buffer.byteLength}class ui{constructor(e){this.typedArray=e instanceof ArrayBuffer||Ft(e)?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}async getLength(){return this.typedArray.byteLength}async read(e,n){return new Uint8Array(this.typedArray.buffer,this.typedArray.byteOffset+e,n)}}class li{constructor(e){this.blob=e}async getLength(){return this.blob.size}async read(e,n){const r=this.blob.slice(e,e+n),i=await go(r);return new Uint8Array(i)}async sliceAsBlob(e,n,r=""){return this.blob.slice(e,e+n,r)}}function js(t,e){var n=Uint8Array;if(t[0]==3&&t[1]==0)return e||new n(0);var r=$s,i=bo,o=Us,a=wo,s=e==null;s&&(e=new n(t.length>>>2<<3));for(var u=0,l=0,c=0,f=0,d=0,p=0,h=0,v=0,m=0,_,w;u==0;){if(u=r(t,m,1),l=r(t,m+1,2),m+=3,l==0){(m&7)!=0&&(m+=8-(m&7));var y=(m>>>3)+4,k=t[y-4]|t[y-3]<<8;s&&(e=zn(e,v+k)),e.set(new n(t.buffer,t.byteOffset+y,k),v),m=y+k<<3,v+=k;continue}if(s&&(e=zn(e,v+(1<<17))),l==1&&(_=K.flmap,w=K.fdmap,p=(1<<9)-1,h=(1<<5)-1),l==2){c=i(t,m,5)+257,f=i(t,m+5,5)+1,d=i(t,m+10,4)+4,m+=14;for(var b=0;b<38;b+=2)K.itree[b]=0,K.itree[b+1]=0;for(var g=1,b=0;b<d;b++){var A=i(t,m+b*3,3);K.itree[(K.ordr[b]<<1)+1]=A,A>g&&(g=A)}m+=3*d,St(K.itree,g),At(K.itree,g,K.imap),_=K.lmap,w=K.dmap,m=o(K.imap,(1<<g)-1,c+f,t,m,K.ttree);var S=ci(K.ttree,0,c,K.ltree);p=(1<<S)-1;var E=ci(K.ttree,c,f,K.dtree);h=(1<<E)-1,St(K.ltree,S),At(K.ltree,S,_),St(K.dtree,E),At(K.dtree,E,w)}for(;;){var x=_[a(t,m)&p];m+=x&15;var B=x>>>4;if(B>>>8==0)e[v++]=B;else{if(B==256)break;var C=v+B-254;if(B>264){var N=K.ldef[B-257];C=v+(N>>>3)+i(t,m,N&7),m+=N&7}var H=w[a(t,m)&h];m+=H&15;var P=H>>>4,W=K.ddef[P],Y=(W>>>4)+r(t,m,W&15);for(m+=W&15,s&&(e=zn(e,v+(1<<17)));v<C;)e[v]=e[v++-Y],e[v]=e[v++-Y],e[v]=e[v++-Y],e[v]=e[v++-Y];v=C}}}return e.length==v?e:e.slice(0,v)}function zn(t,e){var n=t.length;if(e<=n)return t;var r=new Uint8Array(Math.max(n<<1,e));return r.set(t,0),r}function Us(t,e,n,r,i,o){for(var a=bo,s=wo,u=0;u<n;){var l=t[s(r,i)&e];i+=l&15;var c=l>>>4;if(c<=15)o[u]=c,u++;else{var f=0,d=0;c==16?(d=3+a(r,i,2),i+=2,f=o[u-1]):c==17?(d=3+a(r,i,3),i+=3):c==18&&(d=11+a(r,i,7),i+=7);for(var p=u+d;u<p;)o[u]=f,u++}}return i}function ci(t,e,n,r){for(var i=0,o=0,a=r.length>>>1;o<n;){var s=t[o+e];r[o<<1]=0,r[(o<<1)+1]=s,s>i&&(i=s),o++}for(;o<a;)r[o<<1]=0,r[(o<<1)+1]=0,o++;return i}function St(t,e){for(var n=t.length,r,i,o,a,s,u=K.bl_count,a=0;a<=e;a++)u[a]=0;for(a=1;a<n;a+=2)u[t[a]]++;var l=K.next_code;for(r=0,u[0]=0,i=1;i<=e;i++)r=r+u[i-1]<<1,l[i]=r;for(o=0;o<n;o+=2)s=t[o+1],s!=0&&(t[o]=l[s],l[s]++)}function At(t,e,n){for(var r=t.length,i=K.rev15,o=0;o<r;o+=2)if(t[o+1]!=0)for(var a=o>>1,s=t[o+1],u=a<<4|s,l=e-s,c=t[o]<<l,f=c+(1<<l);c!=f;){var d=i[c]>>>15-e;n[d]=u,c++}}function fi(t,e){for(var n=K.rev15,r=15-e,i=0;i<t.length;i+=2){var o=t[i]<<e-t[i+1];t[i]=n[o]>>>r}}function bo(t,e,n){return(t[e>>>3]|t[(e>>>3)+1]<<8)>>>(e&7)&(1<<n)-1}function $s(t,e,n){return(t[e>>>3]|t[(e>>>3)+1]<<8|t[(e>>>3)+2]<<16)>>>(e&7)&(1<<n)-1}function wo(t,e){return(t[e>>>3]|t[(e>>>3)+1]<<8|t[(e>>>3)+2]<<16)>>>(e&7)}const K=function(){var t=Uint16Array,e=Uint32Array;return{next_code:new t(16),bl_count:new t(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new t(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new e(32),flmap:new t(512),fltree:[],fdmap:new t(32),fdtree:[],lmap:new t(32768),ltree:[],ttree:[],dmap:new t(32768),dtree:[],imap:new t(512),itree:[],rev15:new t(1<<15),lhst:new e(286),dhst:new e(30),ihst:new e(19),lits:new e(15e3),strt:new t(1<<16),prev:new t(1<<15)}}();(function(){for(var t=32768,e=0;e<t;e++){var n=e;n=(n&2863311530)>>>1|(n&1431655765)<<1,n=(n&3435973836)>>>2|(n&858993459)<<2,n=(n&4042322160)>>>4|(n&252645135)<<4,n=(n&4278255360)>>>8|(n&16711935)<<8,K.rev15[e]=(n>>>16|n<<16)>>>17}function r(i,o,a){for(;o--!=0;)i.push(0,a)}for(var e=0;e<32;e++)K.ldef[e]=K.of0[e]<<3|K.exb[e],K.ddef[e]=K.df0[e]<<4|K.dxb[e];r(K.fltree,144,8),r(K.fltree,255-143,9),r(K.fltree,279-255,7),r(K.fltree,287-279,8),St(K.fltree,9),At(K.fltree,9,K.flmap),fi(K.fltree,9),r(K.fdtree,32,5),St(K.fdtree,5),At(K.fdtree,5,K.fdmap),fi(K.fdtree,5),r(K.itree,19,0),r(K.ltree,286,0),r(K.dtree,30,0),r(K.ttree,320,0)})();const di={table:function(){for(var t=new Uint32Array(256),e=0;e<256;e++){for(var n=e,r=0;r<8;r++)n&1?n=3988292384^n>>>1:n=n>>>1;t[e]=n}return t}(),update:function(t,e,n,r){for(var i=0;i<r;i++)t=di.table[(t^e[n+i])&255]^t>>>8;return t},crc:function(t,e,n){return di.update(4294967295,t,e,n)^4294967295}};function Hs(t,e){return js(t,e)}const hi={numWorkers:1,workerURL:"",useWorkers:!1};let Ws=0;const fn=[];function jn(t){return new Promise((e,n)=>{const r=new Worker(t);r.onmessage=i=>{i.data==="start"?(r.onerror=void 0,r.onmessage=void 0,e(r)):n(new Error(`unexpected message: ${i.data}`))},r.onerror=n})}function Vs(t,e){return t.require(e)}(function(){if(Ns){const{Worker:t}=Vs(Oo,"worker_threads");return{async createWorker(e){return new t(e)},addEventListener(e,n){e.on("message",r=>{n({target:e,data:r})})},async terminate(e){await e.terminate()}}}else return{async createWorker(t){try{return await jn(t)}catch{console.warn("could not load worker:",t)}let e;try{const n=await fetch(t,{mode:"cors"});if(!n.ok)throw new Error(`could not load: ${t}`);e=await n.text(),t=URL.createObjectURL(new Blob([e],{type:"application/javascript"}));const r=await jn(t);return hi.workerURL=t,r}catch{console.warn("could not load worker via fetch:",t)}if(e!==void 0)try{t=`data:application/javascript;base64,${btoa(e)}`;const n=await jn(t);return hi.workerURL=t,n}catch{console.warn("could not load worker via dataURI")}throw console.warn("workers will not be used"),new Error("can not start workers")},addEventListener(t,e){t.addEventListener("message",e)},async terminate(t){t.terminate()}}})();function qs(t,e,n,r){const i=new Uint8Array(e);Hs(t,i),r(n?new Blob([i],{type:n}):i.buffer)}async function Ys(){if(fn.length!==0)for(;fn.length;){const{src:t,uncompressedSize:e,type:n,resolve:r}=fn.shift();let i=t;_o(t)&&(i=await Ls(t)),qs(i,e,n,r)}}function ko(t,e,n){return new Promise((r,i)=>{fn.push({src:t,uncompressedSize:e,type:n,resolve:r,reject:i,id:Ws++}),Ys()})}function Gs(t,e){const n=t&31,r=(t>>5&15)-1,i=(t>>9&127)+1980,o=0,a=(e&31)*2,s=e>>5&63,u=e>>11&31;return new Date(i,r,n,u,s,a,o)}class Qs{constructor(e,n){this._reader=e,this._rawEntry=n,this.name=n.name,this.nameBytes=n.nameBytes,this.size=n.uncompressedSize,this.compressedSize=n.compressedSize,this.comment=n.comment,this.commentBytes=n.commentBytes,this.compressionMethod=n.compressionMethod,this.lastModDate=Gs(n.lastModFileDate,n.lastModFileTime),this.isDirectory=n.uncompressedSize===0&&n.name.endsWith("/"),this.encrypted=!!(n.generalPurposeBitFlag&1),this.externalFileAttributes=n.externalFileAttributes,this.versionMadeBy=n.versionMadeBy}async blob(e="application/octet-stream"){return await su(this._reader,this._rawEntry,e)}async arrayBuffer(){return await au(this._reader,this._rawEntry)}async text(){const e=await this.arrayBuffer();return xt(new Uint8Array(e))}async json(){const e=await this.text();return JSON.parse(e)}}const Un=22,Xs=65535,Js=101010256,Zs=101075792;async function st(t,e,n){return await t.read(e,n)}async function vr(t,e,n,r){return t.sliceAsBlob?await t.sliceAsBlob(e,n,r):await t.read(e,n)}const eu={unsigned(){return 0}};function te(t,e){return t[e]+t[e+1]*256}function oe(t,e){return t[e]+t[e+1]*256+t[e+2]*65536+t[e+3]*16777216}function We(t,e){return oe(t,e)+oe(t,e+4)*4294967296}const tu=new TextDecoder;function xt(t,e){return Ft(t.buffer)&&(t=new Uint8Array(t)),tu.decode(t)}async function nu(t,e){const n=Math.min(Un+Xs,e),r=e-n,i=await st(t,r,n);for(let o=n-Un;o>=0;--o){if(oe(i,o)!==Js)continue;const a=new Uint8Array(i.buffer,i.byteOffset+o,i.byteLength-o),s=te(a,4);if(s!==0)throw new Error(`multi-volume zip files are not supported. This is volume: ${s}`);const u=te(a,10),l=oe(a,12),c=oe(a,16),f=te(a,20),d=a.length-Un;if(f!==d)throw new Error(`invalid comment length. expected: ${d}, actual: ${f}`);const p=new Uint8Array(a.buffer,a.byteOffset+22,f),h=xt(p);return u===65535||c===4294967295?await iu(t,r+o,h,p):await Eo(t,c,l,u,h,p)}throw new Error("could not find end of central directory. maybe not zip file")}const ru=117853008;async function iu(t,e,n,r){const i=e-20,o=await st(t,i,20);if(oe(o,0)!==ru)throw new Error("invalid zip64 end of central directory locator signature");const a=We(o,8),s=await st(t,a,56);if(oe(s,0)!==Zs)throw new Error("invalid zip64 end of central directory record signature");const u=We(s,32),l=We(s,40),c=We(s,48);return Eo(t,c,l,u,n,r)}const ou=33639248;async function Eo(t,e,n,r,i,o){let a=0;const s=await st(t,e,n),u=[];for(let c=0;c<r;++c){const f=s.subarray(a,a+46),d=oe(f,0);if(d!==ou)throw new Error(`invalid central directory file header signature: 0x${d.toString(16)}`);const p={versionMadeBy:te(f,4),versionNeededToExtract:te(f,6),generalPurposeBitFlag:te(f,8),compressionMethod:te(f,10),lastModFileTime:te(f,12),lastModFileDate:te(f,14),crc32:oe(f,16),compressedSize:oe(f,20),uncompressedSize:oe(f,24),fileNameLength:te(f,28),extraFieldLength:te(f,30),fileCommentLength:te(f,32),internalFileAttributes:te(f,36),externalFileAttributes:oe(f,38),relativeOffsetOfLocalHeader:oe(f,42)};if(p.generalPurposeBitFlag&64)throw new Error("strong encryption is not supported");a+=46;const h=s.subarray(a,a+p.fileNameLength+p.extraFieldLength+p.fileCommentLength);p.nameBytes=h.slice(0,p.fileNameLength),p.name=xt(p.nameBytes);const v=p.fileNameLength+p.extraFieldLength,m=h.slice(p.fileNameLength,v);p.extraFields=[];let _=0;for(;_<m.length-3;){const y=te(m,_+0),k=te(m,_+2),b=_+4,g=b+k;if(g>m.length)throw new Error("extra field length exceeds extra field buffer size");p.extraFields.push({id:y,data:m.slice(b,g)}),_=g}if(p.commentBytes=h.slice(v,v+p.fileCommentLength),p.comment=xt(p.commentBytes),a+=h.length,p.uncompressedSize===4294967295||p.compressedSize===4294967295||p.relativeOffsetOfLocalHeader===4294967295){const y=p.extraFields.find(g=>g.id===1);if(!y)throw new Error("expected zip64 extended information extra field");const k=y.data;let b=0;if(p.uncompressedSize===4294967295){if(b+8>k.length)throw new Error("zip64 extended information extra field does not include uncompressed size");p.uncompressedSize=We(k,b),b+=8}if(p.compressedSize===4294967295){if(b+8>k.length)throw new Error("zip64 extended information extra field does not include compressed size");p.compressedSize=We(k,b),b+=8}if(p.relativeOffsetOfLocalHeader===4294967295){if(b+8>k.length)throw new Error("zip64 extended information extra field does not include relative header offset");p.relativeOffsetOfLocalHeader=We(k,b),b+=8}}const w=p.extraFields.find(y=>y.id===28789&&y.data.length>=6&&y.data[0]===1&&oe(y.data,1),eu.unsigned(p.nameBytes));if(w&&(p.fileName=xt(w.data.slice(5))),p.compressionMethod===0){let y=p.uncompressedSize;if((p.generalPurposeBitFlag&1)!==0&&(y+=12),p.compressedSize!==y)throw new Error(`compressed size mismatch for stored file: ${p.compressedSize} != ${y}`)}u.push(p)}return{zip:{comment:i,commentBytes:o},entries:u.map(c=>new Qs(t,c))}}async function So(t,e){if(e.generalPurposeBitFlag&1)throw new Error("encrypted entries not supported");const n=await st(t,e.relativeOffsetOfLocalHeader,30),r=await t.getLength(),i=oe(n,0);if(i!==67324752)throw new Error(`invalid local file header signature: 0x${i.toString(16)}`);const o=te(n,26),a=te(n,28),s=e.relativeOffsetOfLocalHeader+n.length+o+a;let u;if(e.compressionMethod===0)u=!1;else if(e.compressionMethod===8)u=!0;else throw new Error(`unsupported compression method: ${e.compressionMethod}`);const l=s,c=l+e.compressedSize;if(e.compressedSize!==0&&c>r)throw new Error(`file data overflows file bounds: ${l} +  ${e.compressedSize}  > ${r}`);return{decompress:u,fileDataStart:l}}async function au(t,e){const{decompress:n,fileDataStart:r}=await So(t,e);if(!n){const a=await st(t,r,e.compressedSize);return zs(a)?a.buffer:a.slice().buffer}const i=await vr(t,r,e.compressedSize);return await ko(i,e.uncompressedSize)}async function su(t,e,n){const{decompress:r,fileDataStart:i}=await So(t,e);if(!r){const s=await vr(t,i,e.compressedSize,n);return _o(s)?s:new Blob([Ft(s.buffer)?new Uint8Array(s):s],{type:n})}const o=await vr(t,i,e.compressedSize);return await ko(o,e.uncompressedSize,n)}async function uu(t){let e;if(typeof Blob<"u"&&t instanceof Blob)e=new li(t);else if(t instanceof ArrayBuffer||t&&t.buffer&&t.buffer instanceof ArrayBuffer)e=new ui(t);else if(Ft(t)||Ft(t.buffer))e=new ui(t);else if(typeof t=="string"){const r=await fetch(t);if(!r.ok)throw new Error(`failed http request ${t}, status: ${r.status}: ${r.statusText}`);const i=await r.blob();e=new li(i)}else if(typeof t.getLength=="function"&&typeof t.read=="function")e=t;else throw new Error("unsupported source type");const n=await e.getLength();if(n>Number.MAX_SAFE_INTEGER)throw new Error(`file too large. size: ${n}. Only file sizes up 4503599627370496 bytes are supported`);return await nu(e,n)}async function lu(t){const{zip:e,entries:n}=await uu(t);return{zip:e,entries:Object.fromEntries(n.map(r=>[r.name,r]))}}let dn=[],ot=[],mr=[],gt=[],yr=[],Ao="",xo,Co;const xn=new DOMParser,cu=t=>{const e=xn.parseFromString(t,"text/xml"),n=hu(e.querySelector("manifest").children);xo=du(e.querySelector("metadata")),pu(e.querySelector("spine"),n)},fu=async t=>{const{entries:e}=await lu(t);let n="";for(const[r,i]of Object.entries(e))switch(r.substring(r.lastIndexOf("."))){case".opf":n=await i.text();break;case".png":case".jpg":case".jpeg":case".gif":{const o=await i.blob();ot.push({name:r,blob:o});break}case".css":{const o=await i.text();gt.push({name:r,css:o});break}case".htm":case".xml":case".html":case".xhtml":{const o=await i.text();mr.push({href:r,html:o});break}case".otf":case".ttf":case".woff":{const o=await i.blob();yr.push({name:r,blob:o});break}case".ncx":{Co=await i.text();break}}return n},du=t=>{const e=t.querySelector("title").textContent,n=[];for(let i of t.querySelectorAll("creator"))n.push(i.textContent);let r=ot[0].blob;for(let{name:i,blob:o}of ot)if(i.includes(Ao)){r=o;break}else i.includes("cover")&&(r=o);return{title:e,author:n,cover:r}},hu=t=>{const e=[];for(const n of t)n.attributes["media-type"].value==="application/xhtml+xml"?e.push({id:n.attributes.id.value,href:n.attributes.href.value}):n.attributes["media-type"].value.includes("image")&&n.attributes.id.value.includes("cover")&&(Ao=n.attributes.href.value);return e},pu=(t,e)=>{const n=[];t.querySelectorAll("itemref").forEach(r=>n.push(r.attributes.idref.value)),dn=n.map(r=>e.find(i=>i.id===r))},gr=t=>t.split("\\").pop().split("/").pop(),pi=(t,e)=>{for(const[n,{name:r}]of e.entries())if(r.includes(t))return"ESSENCE-READER-IMAGE-"+n;return""},vu=(t,e)=>{let n=xn.parseFromString(t,"application/xhtml+xml");n.querySelector("parsererror")&&(n=xn.parseFromString(t,"text/html"));for(const i of n.querySelectorAll("[src],[href], image"))switch(i.tagName){case"img":{const o=gr(i.getAttribute("src"));i.setAttribute("src",pi(o,e)),i.style.cssText+="max-height: 100%; max-width: 100%; object-fit: scale-down;";break}case"image":{const o=gr(i.getAttributeNS("http://www.w3.org/1999/xlink","href"));i.setAttributeNS("http://www.w3.org/1999/xlink","href",pi(o,e));break}default:{i.getAttribute("href")!==null&&!i.getAttribute("href").includes("http")?i.removeAttribute("href"):i.getAttribute("src")!==null&&!i.getAttribute("src").includes("http")&&i.removeAttribute("src");break}}return n.body.innerHTML},mu=(t,e)=>{let n=[];return t=t.replace(/@(-moz-|-webkit-|-ms-)*keyframes\s(.*?){([0-9%a-zA-Z,\s.]*{(.*?)})*[\s\n]*}/g,r=>n.push(r)&&"__keyframes__"),t=t.replace(/([^\r\n,{}]+)(,(?=[^}]*{)|\s*{)/g,r=>r.trim()[0]==="@"?r:r.replace(/(\s*)/,"$1"+e+" ")),t.replace(/__keyframes__/g,r=>n.shift())},yu=()=>{const t=[],e=xn.parseFromString(Co,"application/xml").querySelectorAll("navPoint");for(const n of e){let r=n.querySelector("text").textContent,i=decodeURI(n.querySelector("content").attributes.src.value);const o=n.parentElement.nodeName==="navPoint";t.push({name:r,href:i,isChild:o})}return t},gu=async t=>{ot=[],dn=[],mr=[],yr=[];try{cu(await fu(t))}catch{throw new Error(t.name+" does not appear to be a valid EPUB file")}const e=[],n=[];for(let i=0;i<dn.length;i++)for(const{href:o,html:a}of mr)if(o.includes(dn[i].href)){const s=n.push(vu(a,ot))-1;e.push({href:o,index:s});break}const r=[];for(const{name:i,href:o,isChild:a}of yu())for(const{href:s,index:u}of e)o.includes(gr(s))&&r.push({name:i,index:u,isChild:a});for(let i=0;i<gt.length;i++)gt[i].css=mu(gt[i].css,"#container");return{meta:xo,contents:n,toc:r,files:{images:ot,fonts:yr,styles:gt},progress:0}},_u=(t,e,n)=>t.replace(/url\((?!['"]?(?:data):)['"]?([^'"\)]*)['"]?\)/g,function(i,o){const a=o.split("\\").pop().split("/").pop();let s=[".png",".jpg",".jpeg",".gif"],u=[".otf",".ttf",".woff"],l=[];return s.some(c=>a.endsWith(c))?l=e:u.some(c=>a.endsWith(c))&&(l=n),"url("+bu(a,l)+")"}),bu=(t,e)=>{for(const{name:n,blob:r}of e)if(n.includes(t))return URL.createObjectURL(r);return""},wu=(t,e)=>t.replace(/ESSENCE-READER-IMAGE-(\d*)/g,function(n,r){return URL.createObjectURL(e[r].blob)}),ku=t=>{for(let n=0;n<t.contents.length;n++)t.contents[n]=wu(t.contents[n],t.files.images);let e=t.files.styles;for(let n=0;n<e.length;n++)e[n].css=_u(e[n].css,t.files.images,t.files.fonts);return{meta:t.meta,contents:t.contents,toc:t.toc,files:t.files,progress:t.progress}};function Bo(t){const e=t-1;return e*e*e+1}function Mt(t,{delay:e=0,duration:n=400,easing:r=Cn}={}){const i=+getComputedStyle(t).opacity;return{delay:e,duration:n,easing:r,css:o=>`opacity: ${o*i}`}}function vi(t,{delay:e=0,duration:n=400,easing:r=Bo,x:i=0,y:o=0,opacity:a=0}={}){const s=getComputedStyle(t),u=+s.opacity,l=s.transform==="none"?"":s.transform,c=u*(1-a);return{delay:e,duration:n,easing:r,css:(f,d)=>`
			transform: ${l} translate(${(1-f)*i}px, ${(1-f)*o}px);
			opacity: ${u-c*d}`}}const Eu=t=>({}),mi=t=>({}),Su=t=>({}),yi=t=>({}),Au=t=>({}),gi=t=>({});function xu(t){let e,n,r,i,o,a,s;const u=t[1].leftbar,l=Jt(u,t,t[0],gi),c=t[1].toptext,f=Jt(c,t,t[0],yi),d=t[1].rightbar,p=Jt(d,t,t[0],mi);return{c(){e=O("div"),n=O("div"),l&&l.c(),r=z(),i=O("div"),f&&f.c(),o=z(),a=O("div"),p&&p.c(),R(n,"class","buttonbar svelte-zszyaf"),R(n,"id","leftbar"),R(i,"id","toptext"),R(i,"class","svelte-zszyaf"),R(a,"class","buttonbar svelte-zszyaf"),R(a,"id","rightbar"),R(e,"id","topbar"),R(e,"class","svelte-zszyaf")},m(h,v){L(h,e,v),T(e,n),l&&l.m(n,null),T(e,r),T(e,i),f&&f.m(i,null),T(e,o),T(e,a),p&&p.m(a,null),s=!0},p(h,[v]){l&&l.p&&(!s||v&1)&&en(l,u,h,h[0],s?Zt(u,h[0],v,Au):tn(h[0]),gi),f&&f.p&&(!s||v&1)&&en(f,c,h,h[0],s?Zt(c,h[0],v,Su):tn(h[0]),yi),p&&p.p&&(!s||v&1)&&en(p,d,h,h[0],s?Zt(d,h[0],v,Eu):tn(h[0]),mi)},i(h){s||(q(l,h),q(f,h),q(p,h),s=!0)},o(h){ee(l,h),ee(f,h),ee(p,h),s=!1},d(h){h&&F(e),l&&l.d(h),f&&f.d(h),p&&p.d(h)}}}function Cu(t,e,n){let{$$slots:r={},$$scope:i}=e;return t.$$set=o=>{"$$scope"in o&&n(0,i=o.$$scope)},[i,r]}class To extends Je{constructor(e){super(),Xe(this,e,Cu,xu,Qe,{})}}function _i(t){let e,n,r,i,o;const a=t[4].default,s=Jt(a,t,t[3],null);return{c(){e=O("div"),s&&s.c(),R(e,"id","popover"),U(e,"top",t[1]),U(e,"right",t[2]),R(e,"class","svelte-gioso9")},m(u,l){L(u,e,l),s&&s.m(e,null),r=!0,i||(o=[zo(Tu.call(null,e)),X(e,"outclick",t[5])],i=!0)},p(u,l){s&&s.p&&(!r||l&8)&&en(s,a,u,u[3],r?Zt(a,u[3],l,null):tn(u[3]),null),(!r||l&2)&&U(e,"top",u[1]),(!r||l&4)&&U(e,"right",u[2])},i(u){r||(q(s,u),le(()=>{n||(n=qr(e,vi,{x:50,duration:200},!0)),n.run(1)}),r=!0)},o(u){ee(s,u),n||(n=qr(e,vi,{x:50,duration:200},!1)),n.run(0),r=!1},d(u){u&&F(e),s&&s.d(u),u&&n&&n.end(),i=!1,fe(o)}}}function Bu(t){let e,n,r=t[0]&&_i(t);return{c(){r&&r.c(),e=kr()},m(i,o){r&&r.m(i,o),L(i,e,o),n=!0},p(i,[o]){i[0]?r?(r.p(i,o),o&1&&q(r,1)):(r=_i(i),r.c(),q(r,1),r.m(e.parentNode,e)):r&&(Fi(),ee(r,1,1,()=>{r=null}),Mi())},i(i){n||(q(r),n=!0)},o(i){ee(r),n=!1},d(i){r&&r.d(i),i&&F(e)}}}function Tu(t){const e=n=>{n.target instanceof Element&&!t.contains(n.target)&&n.target.id!=="settingsBtn"&&t.dispatchEvent(new CustomEvent("outclick"))};return document.addEventListener("click",e,!0),{destroy(){document.removeEventListener("click",e,!0)}}}function Du(t,e,n){let{$$slots:r={},$$scope:i}=e,{visible:o}=e,{top:a}=e,{right:s}=e;const u=()=>n(0,o=!1);return t.$$set=l=>{"visible"in l&&n(0,o=l.visible),"top"in l&&n(1,a=l.top),"right"in l&&n(2,s=l.right),"$$scope"in l&&n(3,i=l.$$scope)},[o,a,s,i,r,u]}class zr extends Je{constructor(e){super(),Xe(this,e,Du,Bu,Qe,{visible:0,top:1,right:2})}}function Ou(t){let e,n,r,i,o,a,s,u,l;return{c(){e=O("button"),e.textContent="warm",n=z(),r=O("button"),r.textContent="black",i=z(),o=O("button"),o.textContent="dark",a=z(),s=O("button"),s.textContent="light",U(e,"background-color","#f6e4bd"),U(e,"color","#000"),R(e,"class","svelte-k014sn"),U(r,"background-color","#000"),U(r,"color","#e9e9e9"),R(r,"class","svelte-k014sn"),U(o,"background-color","#032038"),U(o,"color","#e9e9e9"),R(o,"class","svelte-k014sn"),U(s,"background-color","#fff"),U(s,"color","#000"),R(s,"class","svelte-k014sn")},m(c,f){L(c,e,f),L(c,n,f),L(c,r,f),L(c,i,f),L(c,o,f),L(c,a,f),L(c,s,f),u||(l=[X(e,"click",t[1]),X(r,"click",t[2]),X(o,"click",t[3]),X(s,"click",t[4])],u=!0)},p:Q,i:Q,o:Q,d(c){c&&F(e),c&&F(n),c&&F(r),c&&F(i),c&&F(o),c&&F(a),c&&F(s),u=!1,fe(l)}}}function Ru(t){const e=a=>{document.documentElement.setAttribute("data-theme",a),localStorage.setItem("theme",a)};return[e,()=>e("warm"),()=>e("black"),()=>e("dark"),()=>e("light")]}class Do extends Je{constructor(e){super(),Xe(this,e,Ru,Ou,Qe,{})}}function Iu(t){let e,n,r,i,o,a,s,u,l,c,f,d,p,h,v,m,_,w,y,k,b,g,A,S;return b=new Do({}),{c(){e=O("label"),e.textContent="Font:",n=z(),r=O("br"),i=z(),o=O("select"),a=O("option"),a.textContent="Default",s=O("option"),s.textContent="Verdana",u=O("option"),u.textContent="Arial",l=O("option"),l.textContent="Courier New ",c=O("option"),c.textContent="Helvetica",f=O("option"),f.textContent="Times New Roman",d=z(),p=O("br"),h=z(),v=O("label"),v.textContent="Scale:",m=z(),_=O("br"),w=z(),y=O("input"),k=z(),Ee(b.$$.fragment),R(e,"for","fontpicker"),a.__value="Default",a.value=a.__value,U(s,"font-family","'Verdana'"),s.__value="Verdana",s.value=s.__value,U(u,"font-family","'Arial'"),u.__value="Arial",u.value=u.__value,U(l,"font-family","'Courier New '"),l.__value="Courier New ",l.value=l.__value,U(c,"font-family","'Helvetica'"),c.__value="Helvetica",c.value=c.__value,U(f,"font-family","'Times New Roman'"),f.__value="Times New Roman",f.value=f.__value,R(o,"name","fontpicker"),U(o,"width","100%"),t[0].fontFamily===void 0&&le(()=>t[2].call(o)),R(v,"for","scale"),R(y,"name","scale"),R(y,"type","range"),R(y,"min","5"),R(y,"max","30")},m(E,x){L(E,e,x),L(E,n,x),L(E,r,x),L(E,i,x),L(E,o,x),T(o,a),T(o,s),T(o,u),T(o,l),T(o,c),T(o,f),Vr(o,t[0].fontFamily),L(E,d,x),L(E,p,x),L(E,h,x),L(E,v,x),L(E,m,x),L(E,_,x),L(E,w,x),L(E,y,x),Wr(y,t[0].scale),L(E,k,x),me(b,E,x),g=!0,A||(S=[X(o,"change",t[2]),X(y,"change",t[3]),X(y,"input",t[3])],A=!0)},p(E,x){x&1&&Vr(o,E[0].fontFamily),x&1&&Wr(y,E[0].scale)},i(E){g||(q(b.$$.fragment,E),g=!0)},o(E){ee(b.$$.fragment,E),g=!1},d(E){E&&F(e),E&&F(n),E&&F(r),E&&F(i),E&&F(o),E&&F(d),E&&F(p),E&&F(h),E&&F(v),E&&F(m),E&&F(_),E&&F(w),E&&F(y),E&&F(k),ye(b,E),A=!1,fe(S)}}}function Ku(t){let e,n,r;function i(a){t[4](a)}let o={top:"3.1em",right:"1%",$$slots:{default:[Iu]},$$scope:{ctx:t}};return t[1]!==void 0&&(o.visible=t[1]),e=new zr({props:o}),ve.push(()=>Oe(e,"visible",i)),{c(){Ee(e.$$.fragment)},m(a,s){me(e,a,s),r=!0},p(a,[s]){const u={};s&33&&(u.$$scope={dirty:s,ctx:a}),!n&&s&2&&(n=!0,u.visible=a[1],De(()=>n=!1)),e.$set(u)},i(a){r||(q(e.$$.fragment,a),r=!0)},o(a){ee(e.$$.fragment,a),r=!1},d(a){ye(e,a)}}}function Pu(t,e,n){let{settings:r}=e,{settingsVisible:i=!1}=e;function o(){r.fontFamily=Vo(this),n(0,r)}function a(){r.scale=Ho(this.value),n(0,r)}function s(u){i=u,n(1,i)}return t.$$set=u=>{"settings"in u&&n(0,r=u.settings),"settingsVisible"in u&&n(1,i=u.settingsVisible)},[r,i,o,a,s]}class Fu extends Je{constructor(e){super(),Xe(this,e,Pu,Ku,Qe,{settings:0,settingsVisible:1})}}const{document:bi}=ia;function wi(t,e,n){const r=t.slice();return r[25]=e[n],r}function Mu(t){let e,n,r;return{c(){e=O("button"),e.textContent="<",R(e,"slot","leftbar"),U(e,"opacity","0.5")},m(i,o){L(i,e,o),n||(r=X(e,"click",t[16]),n=!0)},p:Q,d(i){i&&F(e),n=!1,r()}}}function Lu(t){let e,n,r,i=t[1]!==void 0?t[1].meta.title+" - ":"",o,a,s=(t[1]!==void 0?t[1].meta.author:"")+"",u,l,c,f,d,p=t[1].contents.length-1+"",h,v;return{c(){e=O("div"),n=O("h4"),r=O("b"),o=ne(i),a=z(),u=ne(s),l=z(),c=O("p"),f=ne(t[3]),d=ne("/"),h=ne(p),R(n,"class","svelte-1kjs1nu"),R(c,"id","progress"),R(c,"class","svelte-1kjs1nu"),R(e,"slot","toptext"),R(e,"style",v="transition: opacity 0.3s; "+(t[5]>100?"opacity: 0.5;":""))},m(m,_){L(m,e,_),T(e,n),T(n,r),T(r,o),T(n,a),T(n,u),T(e,l),T(e,c),T(c,f),T(c,d),T(c,h)},p(m,_){_&2&&i!==(i=m[1]!==void 0?m[1].meta.title+" - ":"")&&he(o,i),_&2&&s!==(s=(m[1]!==void 0?m[1].meta.author:"")+"")&&he(u,s),_&8&&he(f,m[3]),_&2&&p!==(p=m[1].contents.length-1+"")&&he(h,p),_&32&&v!==(v="transition: opacity 0.3s; "+(m[5]>100?"opacity: 0.5;":""))&&R(e,"style",v)},d(m){m&&F(e)}}}function Nu(t){let e,n,r,i,o,a,s,u,l,c;return{c(){e=O("div"),n=O("button"),n.textContent="\u2630",r=z(),i=O("button"),i.textContent="\u2699",o=z(),a=O("button"),a.textContent="\xAB",s=z(),u=O("button"),u.textContent="\xBB",R(n,"id","settingsBtn"),R(i,"id","settingsBtn"),R(e,"slot","rightbar"),U(e,"display","inline-block")},m(f,d){L(f,e,d),T(e,n),T(e,r),T(e,i),T(e,o),T(e,a),T(e,s),T(e,u),l||(c=[X(n,"click",t[12]),X(i,"click",t[13]),X(a,"click",t[14]),X(u,"click",t[15])],l=!0)},p:Q,d(f){f&&F(e),l=!1,fe(c)}}}function ki(t){let e,n=(t[25].isChild,""),r,i,o=t[25].name+"",a,s,u,l;function c(){return t[17](t[25])}return{c(){e=O("button"),r=ne(n),i=z(),a=ne(o),R(e,"class","tocButton svelte-1kjs1nu"),R(e,"style",s=(t[3]===t[25].index?"border: 1px solid lightblue; font-weight: bold;":"")+" "+(t[25].isChild?"padding-left: 2em;":""))},m(f,d){L(f,e,d),T(e,r),T(e,i),T(e,a),u||(l=X(e,"click",c),u=!0)},p(f,d){t=f,d&2&&n!==(n=(t[25].isChild,""))&&he(r,n),d&2&&o!==(o=t[25].name+"")&&he(a,o),d&10&&s!==(s=(t[3]===t[25].index?"border: 1px solid lightblue; font-weight: bold;":"")+" "+(t[25].isChild?"padding-left: 2em;":""))&&R(e,"style",s)},d(f){f&&F(e),u=!1,l()}}}function zu(t){let e,n=t[1].toc,r=[];for(let i=0;i<n.length;i+=1)r[i]=ki(wi(t,n,i));return{c(){for(let i=0;i<r.length;i+=1)r[i].c();e=kr()},m(i,o){for(let a=0;a<r.length;a+=1)r[a].m(i,o);L(i,e,o)},p(i,o){if(o&138){n=i[1].toc;let a;for(a=0;a<n.length;a+=1){const s=wi(i,n,a);r[a]?r[a].p(s,o):(r[a]=ki(s),r[a].c(),r[a].m(e.parentNode,e))}for(;a<r.length;a+=1)r[a].d(1);r.length=n.length}},d(i){$o(r,i),i&&F(e)}}}function ju(t){let e=!1,n=()=>{e=!1},r,i,o,a,s,u,l,c,f,d,p=t[1].contents[t[3]]+"",h,v,m,_,w,y,k,b;le(t[11]),bi.title=i=`
        `+(t[1].meta.title+" - "+t[1].meta.author)+`
    `,s=new To({props:{$$slots:{rightbar:[Nu],toptext:[Lu],leftbar:[Mu]},$$scope:{ctx:t}}});function g(B){t[18](B)}let A={top:"3em",right:"1em",$$slots:{default:[zu]},$$scope:{ctx:t}};t[6]!==void 0&&(A.visible=t[6]),l=new zr({props:A}),ve.push(()=>Oe(l,"visible",g));function S(B){t[19](B)}function E(B){t[20](B)}let x={};return t[4]!==void 0&&(x.settingsVisible=t[4]),t[2]!==void 0&&(x.settings=t[2]),m=new Fu({props:x}),ve.push(()=>Oe(m,"settingsVisible",S)),ve.push(()=>Oe(m,"settings",E)),{c(){o=z(),a=O("div"),Ee(s.$$.fragment),u=z(),Ee(l.$$.fragment),f=z(),d=O("div"),v=z(),Ee(m.$$.fragment),R(d,"id","container"),R(d,"class","svelte-1kjs1nu")},m(B,C){L(B,o,C),L(B,a,C),me(s,a,null),T(a,u),me(l,a,null),T(a,f),T(a,d),d.innerHTML=p,L(B,v,C),me(m,B,C),y=!0,k||(b=[X(window,"keydown",t[9]),X(window,"scroll",()=>{e=!0,clearTimeout(r),r=setTimeout(n,100),t[11]()})],k=!0)},p(B,[C]){C&32&&!e&&(e=!0,clearTimeout(r),scrollTo(window.pageXOffset,B[5]),r=setTimeout(n,100)),(!y||C&2)&&i!==(i=`
        `+(B[1].meta.title+" - "+B[1].meta.author)+`
    `)&&(bi.title=i);const N={};C&268435579&&(N.$$scope={dirty:C,ctx:B}),s.$set(N);const H={};C&268435466&&(H.$$scope={dirty:C,ctx:B}),!c&&C&64&&(c=!0,H.visible=B[6],De(()=>c=!1)),l.$set(H),(!y||C&10)&&p!==(p=B[1].contents[B[3]]+"")&&(d.innerHTML=p);const P={};!_&&C&16&&(_=!0,P.settingsVisible=B[4],De(()=>_=!1)),!w&&C&4&&(w=!0,P.settings=B[2],De(()=>w=!1)),m.$set(P)},i(B){y||(q(s.$$.fragment,B),q(l.$$.fragment,B),h||le(()=>{h=Bt(a,Mt,{duration:200}),h.start()}),q(m.$$.fragment,B),y=!0)},o(B){ee(s.$$.fragment,B),ee(l.$$.fragment,B),ee(m.$$.fragment,B),y=!1},d(B){B&&F(o),B&&F(a),ye(s),ye(l),B&&F(v),ye(m,B),k=!1,fe(b)}}}function Uu(t,e,n){let{currentBook:r}=e,{reading:i}=e,{currentId:o}=e,a=0,s=!1,u=JSON.parse(localStorage.getItem("settings"))||{scale:10,fontFamily:"Default"};const l=()=>{let C=document.getElementById("user-settings");C||(C=document.createElement("style"),C.id="user-settings",document.head.appendChild(C)),C.innerText="#container { transform: scale("+u.scale/10+"); width: "+50/(u.scale/10)+"%; } @media (max-width: 1500px) {#container { width: "+90/(u.scale/10)+"%}}"+(u.fontFamily!=="Default"?" #container p, #container a, #container span { font-family: "+u.fontFamily+" !important;}":""),localStorage.setItem("settings",JSON.stringify(u))};let c=0,f=r.meta.title;ea(()=>{f!==r.meta.title&&(n(3,a=0),f=r.meta.title,d())});const d=()=>{for(const C of document.getElementsByClassName("essence-reader"))C.remove();r.files.styles.forEach(C=>{const N=document.createElement("style");N.innerText=C.css,N.className="essence-reader",document.head.appendChild(N)})};Ii(()=>{isNaN(r.progress)||n(3,a=Math.floor(r.progress))});const p=C=>{o!==-1&&ke.books.update(o,{progress:C})},h=C=>{0<=C&&C<r.contents.length&&(n(3,a=C),n(5,c=0),p(a))},v=C=>{h(a+C)};d();const m=({key:C})=>{switch(C){case"ArrowLeft":v(-1);break;case"ArrowRight":v(1);break}};let _=!1;function w(){n(5,c=window.pageYOffset)}const y=()=>n(6,_=!_),k=()=>n(4,s=!s),b=()=>v(-1),g=()=>v(1),A=()=>{n(0,i=!1),document.title="Essence Reader",location.hash=""},S=C=>h(C.index);function E(C){_=C,n(6,_)}function x(C){s=C,n(4,s)}function B(C){u=C,n(2,u)}return t.$$set=C=>{"currentBook"in C&&n(1,r=C.currentBook),"reading"in C&&n(0,i=C.reading),"currentId"in C&&n(10,o=C.currentId)},t.$$.update=()=>{t.$$.dirty&4&&l()},[i,r,u,a,s,c,_,h,v,m,o,w,y,k,b,g,A,S,E,x,B]}class $u extends Je{constructor(e){super(),Xe(this,e,Uu,ju,Qe,{currentBook:1,reading:0,currentId:10})}}function Hu(t,{from:e,to:n},r={}){const i=getComputedStyle(t),o=i.transform==="none"?"":i.transform,[a,s]=i.transformOrigin.split(" ").map(parseFloat),u=e.left+e.width*a/n.width-(n.left+a),l=e.top+e.height*s/n.height-(n.top+s),{delay:c=0,duration:f=p=>Math.sqrt(p)*120,easing:d=Bo}=r;return{delay:c,duration:ut(f)?f(Math.sqrt(u*u+l*l)):f,easing:d,css:(p,h)=>{const v=h*u,m=h*l,_=p+h*e.width/n.width,w=p+h*e.height/n.height;return`transform: ${o} translate(${v}px, ${m}px) scale(${_}, ${w});`}}}function Ei(t,e,n){const r=t.slice();return r[19]=e[n],r}function Wu(t){let e;return{c(){e=O("h3"),e.textContent="Essence Reader",R(e,"slot","toptext"),U(e,"display","inline")},m(n,r){L(n,e,r)},p:Q,d(n){n&&F(e)}}}function Vu(t){let e,n,r;return{c(){e=O("button"),e.textContent="\u2699",R(e,"id","settingsBtn"),R(e,"slot","rightbar")},m(i,o){L(i,e,o),n||(r=X(e,"click",t[12]),n=!0)},p:Q,d(i){i&&F(e),n=!1,r()}}}function qu(t){let e,n,r,i,o,a,s,u,l,c,f,d,p,h,v,m;return p=new Do({}),{c(){e=O("div"),n=O("label"),r=O("input"),i=ne(`
                Save books
            `),o=O("br"),a=z(),s=O("button"),s.textContent="Remove all",u=z(),l=O("hr"),c=z(),f=O("p"),f.textContent="Select theme",d=z(),Ee(p.$$.fragment),R(r,"type","checkbox"),U(n,"user-select","none"),U(f,"display","inline"),U(e,"width","8em")},m(_,w){L(_,e,w),T(e,n),T(n,r),r.checked=t[0],T(n,i),T(e,o),T(e,a),T(e,s),T(e,u),T(e,l),T(e,c),T(e,f),T(e,d),me(p,e,null),h=!0,v||(m=[X(r,"change",t[13]),X(s,"click",t[10])],v=!0)},p(_,w){w&1&&(r.checked=_[0])},i(_){h||(q(p.$$.fragment,_),h=!0)},o(_){ee(p.$$.fragment,_),h=!1},d(_){_&&F(e),ye(p),v=!1,fe(m)}}}function Si(t){let e=[],n=new Map,r,i=t[6];const o=a=>a[19].id;for(let a=0;a<i.length;a+=1){let s=Ei(t,i,a),u=o(s);n.set(u,e[a]=Ai(u,s))}return{c(){for(let a=0;a<e.length;a+=1)e[a].c();r=kr()},m(a,s){for(let u=0;u<e.length;u+=1)e[u].m(a,s);L(a,r,s)},p(a,s){if(s&578){i=a[6];for(let u=0;u<e.length;u+=1)e[u].r();e=sa(e,s,o,1,a,i,n,r.parentNode,aa,Ai,r,Ei);for(let u=0;u<e.length;u+=1)e[u].a()}},i(a){for(let s=0;s<i.length;s+=1)q(e[s])},o:Q,d(a){for(let s=0;s<e.length;s+=1)e[s].d(a);a&&F(r)}}}function Ai(t,e){let n,r,i,o,a,s,u,l,c,f=e[19].meta.author+"",d,p,h,v=e[19].meta.title+"",m,_,w,y=e[19].progress+"",k,b,g=e[19].contents.length-1+"",A,S,E,x,B=Q,C,N;function H(...W){return e[15](e[19],...W)}function P(){return e[16](e[19])}return{key:t,first:null,c(){n=O("button"),r=O("button"),r.textContent="\u2715",i=z(),o=O("img"),u=z(),l=O("div"),c=O("h4"),d=ne(f),p=z(),h=O("h3"),m=ne(v),_=z(),w=O("p"),k=ne(y),b=ne(" / "),A=ne(g),E=z(),R(r,"class","deleteBtn svelte-is49rk"),$r(o.src,a=e[19].meta.cover!==void 0?URL.createObjectURL(e[19].meta.cover):"")||R(o,"src",a),R(o,"alt","cover"),R(o,"class","svelte-is49rk"),R(h,"class","svelte-is49rk"),R(l,"class","bookInfo svelte-is49rk"),R(n,"class","book svelte-is49rk"),this.first=n},m(W,Y){L(W,n,Y),T(n,r),T(n,i),T(n,o),T(n,u),T(n,l),T(l,c),T(c,d),T(l,p),T(l,h),T(h,m),T(l,_),T(l,w),T(w,k),T(w,b),T(w,A),T(n,E),C||(N=[X(r,"click",H),X(n,"click",P)],C=!0)},p(W,Y){e=W,Y&64&&!$r(o.src,a=e[19].meta.cover!==void 0?URL.createObjectURL(e[19].meta.cover):"")&&R(o,"src",a),Y&64&&f!==(f=e[19].meta.author+"")&&he(d,f),Y&64&&v!==(v=e[19].meta.title+"")&&he(m,v),Y&64&&y!==(y=e[19].progress+"")&&he(k,y),Y&64&&g!==(g=e[19].contents.length-1+"")&&he(A,g)},r(){x=n.getBoundingClientRect()},f(){Jo(n),B()},a(){B(),B=Xo(n,x,Hu,{duration:200})},i(W){s||le(()=>{s=Bt(o,Mt,{duration:200}),s.start()}),S||le(()=>{S=Bt(l,Mt,{duration:200}),S.start()})},o:Q,d(W){W&&F(n),C=!1,fe(N)}}}function Yu(t){let e,n,r,i=t[4]?"+":"Drop anywhere or click to select a file",o;return{c(){e=O("h1"),e.textContent="\u{1F4DA}",n=z(),r=O("h2"),o=ne(i),R(e,"class","svelte-is49rk")},m(a,s){L(a,e,s),L(a,n,s),L(a,r,s),T(r,o)},p(a,s){s&16&&i!==(i=a[4]?"+":"Drop anywhere or click to select a file")&&he(o,i)},d(a){a&&F(e),a&&F(n),a&&F(r)}}}function Gu(t){let e,n,r;return{c(){e=O("h1"),e.textContent="\u{1F4DA}",n=z(),r=O("h2"),r.textContent="...",R(e,"class","svelte-is49rk")},m(i,o){L(i,e,o),L(i,n,o),L(i,r,o)},p:Q,d(i){i&&F(e),i&&F(n),i&&F(r)}}}function xi(t){let e,n,r,i,o=t[3]?"Loading":"Drop anywhere or click to select a file",a;return{c(){e=O("div"),n=O("h4"),n.textContent="Load new book",r=z(),i=O("h3"),a=ne(o),U(i,"color",t[2]?"#87CEFA":""),R(i,"class","svelte-is49rk"),R(e,"class","bookInfo svelte-is49rk")},m(s,u){L(s,e,u),T(e,n),T(e,r),T(e,i),T(i,a)},p(s,u){u&8&&o!==(o=s[3]?"Loading":"Drop anywhere or click to select a file")&&he(a,o),u&4&&U(i,"color",s[2]?"#87CEFA":"")},d(s){s&&F(e)}}}function Qu(t){let e,n,r,i,o,a,s,u,l,c,f,d,p,h,v,m,_;n=new To({props:{$$slots:{rightbar:[Vu],toptext:[Wu]},$$scope:{ctx:t}}});function w(E){t[14](E)}let y={top:"3.1em",right:"1%",$$slots:{default:[qu]},$$scope:{ctx:t}};t[5]!==void 0&&(y.visible=t[5]),i=new zr({props:y}),ve.push(()=>Oe(i,"visible",w));let k=t[6]&&Si(t);function b(E,x){return E[3]?Gu:Yu}let g=b(t),A=g(t),S=t[4]&&xi(t);return{c(){e=O("div"),Ee(n.$$.fragment),r=z(),Ee(i.$$.fragment),a=z(),s=O("div"),k&&k.c(),u=z(),l=O("button"),c=O("div"),A.c(),d=z(),S&&S.c(),R(c,"id","dropInfo"),R(c,"class",f=Hr(t[3]?"loading":"")+" svelte-is49rk"),U(c,"max-width",t[4]?"":"100% "),U(c,"background-color",t[2]?" #87CEFA":""),R(l,"class","book svelte-is49rk"),R(l,"style",p=t[4]?"":"max-width: 50vw"),R(s,"id","parent"),R(s,"class","svelte-is49rk")},m(E,x){L(E,e,x),me(n,e,null),T(e,r),me(i,e,null),T(e,a),T(e,s),k&&k.m(s,null),T(s,u),T(s,l),T(l,c),A.m(c,null),T(l,d),S&&S.m(l,null),v=!0,m||(_=X(l,"click",t[17]),m=!0)},p(E,[x]){const B={};x&4194336&&(B.$$scope={dirty:x,ctx:E}),n.$set(B);const C={};x&4194305&&(C.$$scope={dirty:x,ctx:E}),!o&&x&32&&(o=!0,C.visible=E[5],De(()=>o=!1)),i.$set(C),E[6]?k?(k.p(E,x),x&64&&q(k,1)):(k=Si(E),k.c(),q(k,1),k.m(s,u)):k&&(k.d(1),k=null),g===(g=b(E))&&A?A.p(E,x):(A.d(1),A=g(E),A&&(A.c(),A.m(c,null))),(!v||x&8&&f!==(f=Hr(E[3]?"loading":"")+" svelte-is49rk"))&&R(c,"class",f),(!v||x&16)&&U(c,"max-width",E[4]?"":"100% "),(!v||x&4)&&U(c,"background-color",E[2]?" #87CEFA":""),E[4]?S?S.p(E,x):(S=xi(E),S.c(),S.m(l,null)):S&&(S.d(1),S=null),(!v||x&16&&p!==(p=E[4]?"":"max-width: 50vw"))&&R(l,"style",p)},i(E){v||(q(n.$$.fragment,E),q(i.$$.fragment,E),q(k),h||le(()=>{h=Bt(e,Mt,{duration:200}),h.start()}),v=!0)},o(E){ee(n.$$.fragment,E),ee(i.$$.fragment,E),v=!1},d(E){E&&F(e),ye(n),ye(i),k&&k.d(),A.d(),S&&S.d(),m=!1,_()}}}function Xu(t,e,n){let r,{readFiles:i=g=>{}}=e,{openExisting:o=g=>{}}=e,{dragging:a}=e,{saveBooksOn:s}=e,{loading:u}=e,l=yo(()=>ke.books.toArray());No(t,l,g=>n(6,r=g));let c=!1,f=!1;const d=()=>{let g=document.createElement("input");g.type="file",g.onchange=A=>{i(A.target.files[0])},g.click()};async function p(g){await ke.books.delete(g)}const h=async()=>{confirm("Are you sure you want to remove all saved books?")&&await ke.books.clear()};async function v(){if(s){const g=await ke.books.count().catch(()=>n(0,s=!1));n(4,c=g>0)}}v();const m=()=>n(5,f=!f);function _(){s=this.checked,n(0,s)}function w(g){f=g,n(5,f)}const y=(g,A)=>{A.stopPropagation(),p(g.id)},k=g=>o(g.id),b=()=>d();return t.$$set=g=>{"readFiles"in g&&n(11,i=g.readFiles),"openExisting"in g&&n(1,o=g.openExisting),"dragging"in g&&n(2,a=g.dragging),"saveBooksOn"in g&&n(0,s=g.saveBooksOn),"loading"in g&&n(3,u=g.loading)},[s,o,a,u,c,f,r,l,d,p,h,i,m,_,w,y,k,b]}class Ju extends Je{constructor(e){super(),Xe(this,e,Xu,Qu,Qe,{readFiles:11,openExisting:1,dragging:2,saveBooksOn:0,loading:3})}}function Zu(t){let e,n,r,i;function o(u){t[11](u)}function a(u){t[12](u)}let s={readFiles:t[7],openExisting:t[8],dragging:t[3]};return t[0]!==void 0&&(s.saveBooksOn=t[0]),t[4]!==void 0&&(s.loading=t[4]),e=new Ju({props:s}),ve.push(()=>Oe(e,"saveBooksOn",o)),ve.push(()=>Oe(e,"loading",a)),{c(){Ee(e.$$.fragment)},m(u,l){me(e,u,l),i=!0},p(u,l){const c={};l&8&&(c.dragging=u[3]),!n&&l&1&&(n=!0,c.saveBooksOn=u[0],De(()=>n=!1)),!r&&l&16&&(r=!0,c.loading=u[4],De(()=>r=!1)),e.$set(c)},i(u){i||(q(e.$$.fragment,u),i=!0)},o(u){ee(e.$$.fragment,u),i=!1},d(u){ye(e,u)}}}function el(t){let e,n;return{c(){e=O("p"),e.textContent="Loading",U(e,"text-align","center")},m(r,i){L(r,e,i)},p:Q,i(r){n||le(()=>{n=Bt(e,Mt,{}),n.start()})},o:Q,d(r){r&&F(e)}}}function tl(t){let e,n,r,i;function o(u){t[9](u)}function a(u){t[10](u)}let s={currentBook:t[1]};return t[2]!==void 0&&(s.reading=t[2]),t[5]!==void 0&&(s.currentId=t[5]),e=new $u({props:s}),ve.push(()=>Oe(e,"reading",o)),ve.push(()=>Oe(e,"currentId",a)),{c(){Ee(e.$$.fragment)},m(u,l){me(e,u,l),i=!0},p(u,l){const c={};l&2&&(c.currentBook=u[1]),!n&&l&4&&(n=!0,c.reading=u[2],De(()=>n=!1)),!r&&l&32&&(r=!0,c.currentId=u[5],De(()=>r=!1)),e.$set(c)},i(u){i||(q(e.$$.fragment,u),i=!0)},o(u){ee(e.$$.fragment,u),i=!1},d(u){ye(e,u)}}}function nl(t){let e,n,r,i;const o=[tl,el,Zu],a=[];function s(u,l){return u[2]?0:u[6]?1:2}return n=s(t),r=a[n]=o[n](t),{c(){e=O("main"),r.c()},m(u,l){L(u,e,l),a[n].m(e,null),i=!0},p(u,[l]){let c=n;n=s(u),n===c?a[n].p(u,l):(Fi(),ee(a[c],1,1,()=>{a[c]=null}),Mi(),r=a[n],r?r.p(u,l):(r=a[n]=o[n](u),r.c()),q(r,1),r.m(e,null))},i(u){i||(q(r),i=!0)},o(u){ee(r),i=!1},d(u){u&&F(e),a[n].d()}}}function rl(t,e,n){let r,i=!1,o=!1,a=!1;const s=async w=>{try{n(4,a=!0);const y=await gu(w);if(u&&w.size<3e7){const k=await Ms(y);c(y,k)}else c(y)}catch(y){alert(y)}n(4,a=!1)};let u;localStorage.getItem("saveBooksOn")!==null?u=JSON.parse(localStorage.getItem("saveBooksOn")):u=!0;const l=()=>{localStorage.setItem("saveBooksOn",JSON.stringify(u))};window.addEventListener("dragenter",w=>{w.dataTransfer.types.includes("Files")&&n(3,o=!0)}),window.addEventListener("dragleave",w=>{n(3,o=!1),w.preventDefault()});const c=(w,y)=>{n(1,r=ku(w)),n(2,i=!0),location.hash=y?y.toString():"",n(5,d=y||-1)},f=w=>{n(6,p=!0),ke.transaction("r",ke.books,async()=>{let y=await ke.books.get(w);y?c(y,y.id):(location.hash="",n(6,p=!1))})};Ii(()=>{location.hash!==""&&(n(6,p=!0),f(parseInt(location.hash.substring(1))))}),window.onhashchange=()=>{u&&location.hash===""?(document.title="Essence Reader",n(2,i=!1),history.replaceState(null,""," "),n(6,p=!1)):u&&location.hash!==""&&f(parseInt(location.hash.substring(1)))},window.addEventListener("dragover",w=>w.preventDefault()),window.addEventListener("drop",w=>{w.preventDefault(),n(3,o=!1),s(w.dataTransfer.files[0])});let d=-1,p=!1;function h(w){i=w,n(2,i)}function v(w){d=w,n(5,d)}function m(w){u=w,n(0,u)}function _(w){a=w,n(4,a)}return t.$$.update=()=>{t.$$.dirty&1&&l()},[u,r,i,o,a,d,p,s,f,h,v,m,_]}class il extends Je{constructor(e){super(),Xe(this,e,rl,nl,Qe,{})}}new il({target:document.getElementById("app")})});export default ol();
