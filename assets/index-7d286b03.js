var ys=Object.defineProperty;var bs=(t,e,n)=>e in t?ys(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var _s=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Mr=(t,e,n)=>(bs(t,typeof e!="symbol"?e+"":e,n),n);var jl=_s((Nl,gs)=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();function z(){}const On=t=>t;function Q(t,e){for(const n in e)t[n]=e[n];return t}function wi(t){return t()}function Rr(){return Object.create(null)}function ke(t){t.forEach(wi)}function $e(t){return typeof t=="function"}function de(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let Jt;function Tr(t,e){return Jt||(Jt=document.createElement("a")),Jt.href=e,t===Jt.href}function vs(t){return Object.keys(t).length===0}function ws(t,...e){if(t==null)return z;const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function ks(t,e,n){t.$$.on_destroy.push(ws(e,n))}function kt(t,e,n,r){if(t){const i=ki(t,e,n,r);return t[0](i)}}function ki(t,e,n,r){return t[1]&&r?Q(n.ctx.slice(),t[1](r(e))):n.ctx}function Et(t,e,n,r){if(t[2]&&r){const i=t[2](r(n));if(e.dirty===void 0)return i;if(typeof i=="object"){const o=[],s=Math.max(e.dirty.length,i.length);for(let a=0;a<s;a+=1)o[a]=e.dirty[a]|i[a];return o}return e.dirty|i}return e.dirty}function xt(t,e,n,r,i,o){if(i){const s=ki(e,n,r,o);t.p(s,i)}}function At(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let r=0;r<n;r++)e[r]=-1;return e}return-1}function pe(t){const e={};for(const n in t)n[0]!=="$"&&(e[n]=t[n]);return e}function ge(t,e){const n={};e=new Set(e);for(const r in t)!e.has(r)&&r[0]!=="$"&&(n[r]=t[r]);return n}function Dr(t){return t??""}function Es(t){return t&&$e(t.destroy)?t.destroy:z}function Ir(t){const e=typeof t=="string"&&t.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return e?[parseFloat(e[1]),e[2]||"px"]:[t,"px"]}const Ei=typeof window<"u";let mr=Ei?()=>window.performance.now():()=>Date.now(),pr=Ei?t=>requestAnimationFrame(t):z;const at=new Set;function xi(t){at.forEach(e=>{e.c(t)||(at.delete(e),e.f())}),at.size!==0&&pr(xi)}function gr(t){let e;return at.size===0&&pr(xi),{promise:new Promise(n=>{at.add(e={c:t,f:n})}),abort(){at.delete(e)}}}function A(t,e){t.appendChild(e)}function Ai(t){if(!t)return document;const e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function xs(t){const e=M("style");return As(Ai(t),e),e.sheet}function As(t,e){return A(t.head||t,e),e.sheet}function C(t,e,n){t.insertBefore(e,n||null)}function S(t){t.parentNode&&t.parentNode.removeChild(t)}function Ss(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function M(t){return document.createElement(t)}function G(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function H(t){return document.createTextNode(t)}function N(){return H(" ")}function yr(){return H("")}function X(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function P(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function ye(t,e){for(const n in e)P(t,n,e[n])}function Cs(t){return t===""?null:+t}function Os(t){return Array.from(t.childNodes)}function $(t,e){e=""+e,t.data!==e&&(t.data=e)}function Kr(t,e){t.value=e??""}function W(t,e,n,r){n===null?t.style.removeProperty(e):t.style.setProperty(e,n,r?"important":"")}function jr(t,e,n){for(let r=0;r<t.options.length;r+=1){const i=t.options[r];if(i.__value===e){i.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function Bs(t){const e=t.querySelector(":checked");return e&&e.__value}function Ps(t,e,{bubbles:n=!1,cancelable:r=!1}={}){const i=document.createEvent("CustomEvent");return i.initCustomEvent(t,n,r,e),i}const pn=new Map;let gn=0;function Ms(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}function Rs(t,e){const n={stylesheet:xs(e),rules:{}};return pn.set(t,n),n}function yn(t,e,n,r,i,o,s,a=0){const l=16.666/r;let u=`{
`;for(let g=0;g<=1;g+=l){const _=e+(n-e)*o(g);u+=g*100+`%{${s(_,1-_)}}
`}const c=u+`100% {${s(n,1-n)}}
}`,f=`__svelte_${Ms(c)}_${a}`,h=Ai(t),{stylesheet:m,rules:p}=pn.get(h)||Rs(h,t);p[f]||(p[f]=!0,m.insertRule(`@keyframes ${f} ${c}`,m.cssRules.length));const d=t.style.animation||"";return t.style.animation=`${d?`${d}, `:""}${f} ${r}ms linear ${i}ms 1 both`,gn+=1,f}function bn(t,e){const n=(t.style.animation||"").split(", "),r=n.filter(e?o=>o.indexOf(e)<0:o=>o.indexOf("__svelte")===-1),i=n.length-r.length;i&&(t.style.animation=r.join(", "),gn-=i,gn||Ts())}function Ts(){pr(()=>{gn||(pn.forEach(t=>{const{ownerNode:e}=t.stylesheet;e&&S(e)}),pn.clear())})}function Ds(t,e,n,r){if(!e)return z;const i=t.getBoundingClientRect();if(e.left===i.left&&e.right===i.right&&e.top===i.top&&e.bottom===i.bottom)return z;const{delay:o=0,duration:s=300,easing:a=On,start:l=mr()+o,end:u=l+s,tick:c=z,css:f}=n(t,{from:e,to:i},r);let h=!0,m=!1,p;function d(){f&&(p=yn(t,0,1,s,o,a,f)),o||(m=!0)}function g(){f&&bn(t,p),h=!1}return gr(_=>{if(!m&&_>=l&&(m=!0),m&&_>=u&&(c(1,0),g()),!h)return!1;if(m){const y=_-l,b=0+1*a(y/s);c(b,1-b)}return!0}),d(),c(0,1),g}function Is(t){const e=getComputedStyle(t);if(e.position!=="absolute"&&e.position!=="fixed"){const{width:n,height:r}=e,i=t.getBoundingClientRect();t.style.position="absolute",t.style.width=n,t.style.height=r,Ks(t,i)}}function Ks(t,e){const n=t.getBoundingClientRect();if(e.left!==n.left||e.top!==n.top){const r=getComputedStyle(t),i=r.transform==="none"?"":r.transform;t.style.transform=`${i} translate(${e.left-n.left}px, ${e.top-n.top}px)`}}let Kt;function St(t){Kt=t}function js(){if(!Kt)throw new Error("Function called outside component initialization");return Kt}function br(t){js().$$.on_mount.push(t)}const st=[],Ke=[];let lt=[];const Fn=[],zs=Promise.resolve();let Ln=!1;function Ns(){Ln||(Ln=!0,zs.then(Si))}function be(t){lt.push(t)}function jt(t){Fn.push(t)}const Mn=new Set;let nt=0;function Si(){if(nt!==0)return;const t=Kt;do{try{for(;nt<st.length;){const e=st[nt];nt++,St(e),Fs(e.$$)}}catch(e){throw st.length=0,nt=0,e}for(St(null),st.length=0,nt=0;Ke.length;)Ke.pop()();for(let e=0;e<lt.length;e+=1){const n=lt[e];Mn.has(n)||(Mn.add(n),n())}lt.length=0}while(st.length);for(;Fn.length;)Fn.pop()();Ln=!1,Mn.clear(),St(t)}function Fs(t){if(t.fragment!==null){t.update(),ke(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(be)}}function Ls(t){const e=[],n=[];lt.forEach(r=>t.indexOf(r)===-1?e.push(r):n.push(r)),n.forEach(r=>r()),lt=e}let bt;function Ci(){return bt||(bt=Promise.resolve(),bt.then(()=>{bt=null})),bt}function Ct(t,e,n){t.dispatchEvent(Ps(`${e?"intro":"outro"}${n}`))}const on=new Set;let Re;function mt(){Re={r:0,c:[],p:Re}}function pt(){Re.r||ke(Re.c),Re=Re.p}function j(t,e){t&&t.i&&(on.delete(t),t.i(e))}function F(t,e,n,r){if(t&&t.o){if(on.has(t))return;on.add(t),Re.c.push(()=>{on.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}const Oi={duration:0};function zt(t,e,n){const r={direction:"in"};let i=e(t,n,r),o=!1,s,a,l=0;function u(){s&&bn(t,s)}function c(){const{delay:h=0,duration:m=300,easing:p=On,tick:d=z,css:g}=i||Oi;g&&(s=yn(t,0,1,m,h,p,g,l++)),d(0,1);const _=mr()+h,y=_+m;a&&a.abort(),o=!0,be(()=>Ct(t,!0,"start")),a=gr(b=>{if(o){if(b>=y)return d(1,0),Ct(t,!0,"end"),u(),o=!1;if(b>=_){const v=p((b-_)/m);d(v,1-v)}}return o})}let f=!1;return{start(){f||(f=!0,bn(t),$e(i)?(i=i(r),Ci().then(c)):c())},invalidate(){f=!1},end(){o&&(u(),o=!1)}}}function _n(t,e,n,r){const i={direction:"both"};let o=e(t,n,i),s=r?0:1,a=null,l=null,u=null;function c(){u&&bn(t,u)}function f(m,p){const d=m.b-s;return p*=Math.abs(d),{a:s,b:m.b,d,duration:p,start:m.start,end:m.start+p,group:m.group}}function h(m){const{delay:p=0,duration:d=300,easing:g=On,tick:_=z,css:y}=o||Oi,b={start:mr()+p,b:m};m||(b.group=Re,Re.r+=1),a||l?l=b:(y&&(c(),u=yn(t,s,m,d,p,g,y)),m&&_(0,1),a=f(b,d),be(()=>Ct(t,m,"start")),gr(v=>{if(l&&v>l.start&&(a=f(l,d),l=null,Ct(t,a.b,"start"),y&&(c(),u=yn(t,s,a.b,a.duration,0,g,o.css))),a){if(v>=a.end)_(s=a.b,1-s),Ct(t,a.b,"end"),l||(a.b?c():--a.group.r||ke(a.group.c)),a=null;else if(v>=a.start){const w=v-a.start;s=a.a+a.d*g(w/a.duration),_(s,1-s)}}return!!(a||l)}))}return{run(m){$e(o)?Ci().then(()=>{o=o(i),h(m)}):h(m)},end(){c(),a=l=null}}}const qs=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Us(t,e){F(t,1,1,()=>{e.delete(t.key)})}function Hs(t,e){t.f(),Us(t,e)}function Vs(t,e,n,r,i,o,s,a,l,u,c,f){let h=t.length,m=o.length,p=h;const d={};for(;p--;)d[t[p].key]=p;const g=[],_=new Map,y=new Map,b=[];for(p=m;p--;){const x=f(i,o,p),O=n(x);let k=s.get(O);k?r&&b.push(()=>k.p(x,e)):(k=u(O,x),k.c()),_.set(O,g[p]=k),O in d&&y.set(O,Math.abs(p-d[O]))}const v=new Set,w=new Set;function E(x){j(x,1),x.m(a,c),s.set(x.key,x),c=x.first,m--}for(;h&&m;){const x=g[m-1],O=t[h-1],k=x.key,T=O.key;x===O?(c=x.first,h--,m--):_.has(T)?!s.has(k)||v.has(k)?E(x):w.has(T)?h--:y.get(k)>y.get(T)?(w.add(k),E(x)):(v.add(T),h--):(l(O,s),h--)}for(;h--;){const x=t[h];_.has(x.key)||l(x,s)}for(;m;)E(g[m-1]);return ke(b),g}function et(t,e){const n={},r={},i={$$scope:1};let o=t.length;for(;o--;){const s=t[o],a=e[o];if(a){for(const l in s)l in a||(r[l]=1);for(const l in a)i[l]||(n[l]=a[l],i[l]=1);t[o]=a}else for(const l in s)i[l]=1}for(const s in r)s in n||(n[s]=void 0);return n}function Nt(t,e,n){const r=t.$$.props[e];r!==void 0&&(t.$$.bound[r]=n,n(t.$$.ctx[r]))}function ie(t){t&&t.c()}function ee(t,e,n,r){const{fragment:i,after_update:o}=t.$$;i&&i.m(e,n),r||be(()=>{const s=t.$$.on_mount.map(wi).filter($e);t.$$.on_destroy?t.$$.on_destroy.push(...s):ke(s),t.$$.on_mount=[]}),o.forEach(be)}function te(t,e){const n=t.$$;n.fragment!==null&&(Ls(n.after_update),ke(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Ys(t,e){t.$$.dirty[0]===-1&&(st.push(t),Ns(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function he(t,e,n,r,i,o,s,a=[-1]){const l=Kt;St(t);const u=t.$$={fragment:null,ctx:[],props:o,update:z,not_equal:i,bound:Rr(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:Rr(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};s&&s(u.root);let c=!1;if(u.ctx=n?n(t,e.props||{},(f,h,...m)=>{const p=m.length?m[0]:h;return u.ctx&&i(u.ctx[f],u.ctx[f]=p)&&(!u.skip_bound&&u.bound[f]&&u.bound[f](p),c&&Ys(t,f)),h}):[],u.update(),c=!0,ke(u.before_update),u.fragment=r?r(u.ctx):!1,e.target){if(e.hydrate){const f=Os(e.target);u.fragment&&u.fragment.l(f),f.forEach(S)}else u.fragment&&u.fragment.c();e.intro&&j(t.$$.fragment),ee(t,e.target,e.anchor,e.customElement),Si()}St(l)}class me{$destroy(){te(this,1),this.$destroy=z}$on(e,n){if(!$e(n))return z;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!vs(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const V=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,ne=Object.keys,le=Array.isArray;function fe(t,e){return typeof e!="object"||ne(e).forEach(function(n){t[n]=e[n]}),t}typeof Promise>"u"||V.Promise||(V.Promise=Promise);const Ft=Object.getPrototypeOf,Ws={}.hasOwnProperty;function we(t,e){return Ws.call(t,e)}function dt(t,e){typeof e=="function"&&(e=e(Ft(t))),(typeof Reflect>"u"?ne:Reflect.ownKeys)(e).forEach(n=>{De(t,n,e[n])})}const Bi=Object.defineProperty;function De(t,e,n,r){Bi(t,e,fe(n&&we(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function ut(t){return{from:function(e){return t.prototype=Object.create(e.prototype),De(t.prototype,"constructor",t),{extend:dt.bind(null,t.prototype)}}}}const Gs=Object.getOwnPropertyDescriptor;function _r(t,e){let n;return Gs(t,e)||(n=Ft(t))&&_r(n,e)}const Zs=[].slice;function vn(t,e,n){return Zs.call(t,e,n)}function Pi(t,e){return e(t)}function vt(t){if(!t)throw new Error("Assertion Failed")}function Mi(t){V.setImmediate?setImmediate(t):setTimeout(t,0)}function Ri(t,e){return t.reduce((n,r,i)=>{var o=e(r,i);return o&&(n[o[0]]=o[1]),n},{})}function Ie(t,e){if(we(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var n=[],r=0,i=e.length;r<i;++r){var o=Ie(t,e[r]);n.push(o)}return n}var s=e.indexOf(".");if(s!==-1){var a=t[e.substr(0,s)];return a===void 0?void 0:Ie(a,e.substr(s+1))}}function Se(t,e,n){if(t&&e!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){vt(typeof n!="string"&&"length"in n);for(var r=0,i=e.length;r<i;++r)Se(t,e[r],n[r])}else{var o=e.indexOf(".");if(o!==-1){var s=e.substr(0,o),a=e.substr(o+1);if(a==="")n===void 0?le(t)&&!isNaN(parseInt(s))?t.splice(s,1):delete t[s]:t[s]=n;else{var l=t[s];l&&we(t,s)||(l=t[s]={}),Se(l,a,n)}}else n===void 0?le(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=n}}function Ti(t){var e={};for(var n in t)we(t,n)&&(e[n]=t[n]);return e}const Qs=[].concat;function Di(t){return Qs.apply([],t)}const Ii="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Di([8,16,32,64].map(t=>["Int","Uint","Float"].map(e=>e+t+"Array")))).filter(t=>V[t]),Js=Ii.map(t=>V[t]);Ri(Ii,t=>[t,!0]);let Ne=null;function Gt(t){Ne=typeof WeakMap<"u"&&new WeakMap;const e=qn(t);return Ne=null,e}function qn(t){if(!t||typeof t!="object")return t;let e=Ne&&Ne.get(t);if(e)return e;if(le(t)){e=[],Ne&&Ne.set(t,e);for(var n=0,r=t.length;n<r;++n)e.push(qn(t[n]))}else if(Js.indexOf(t.constructor)>=0)e=t;else{const o=Ft(t);for(var i in e=o===Object.prototype?{}:Object.create(o),Ne&&Ne.set(t,e),t)we(t,i)&&(e[i]=qn(t[i]))}return e}const{toString:Xs}={};function Un(t){return Xs.call(t).slice(8,-1)}const Hn=typeof Symbol<"u"?Symbol.iterator:"@@iterator",$s=typeof Hn=="symbol"?function(t){var e;return t!=null&&(e=t[Hn])&&e.apply(t)}:function(){return null},ot={};function Me(t){var e,n,r,i;if(arguments.length===1){if(le(t))return t.slice();if(this===ot&&typeof t=="string")return[t];if(i=$s(t)){for(n=[];!(r=i.next()).done;)n.push(r.value);return n}if(t==null)return[t];if(typeof(e=t.length)=="number"){for(n=new Array(e);e--;)n[e]=t[e];return n}return[t]}for(e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];return n}const vr=typeof Symbol<"u"?t=>t[Symbol.toStringTag]==="AsyncFunction":()=>!1;var Oe=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Ki(t,e){Oe=t,ji=e}var ji=()=>!0;const eo=!new Error("").stack;function tt(){if(eo)try{throw tt.arguments,new Error}catch(t){return t}return new Error}function Vn(t,e){var n=t.stack;return n?(e=e||0,n.indexOf(t.name)===0&&(e+=(t.name+t.message).split(`
`).length),n.split(`
`).slice(e).filter(ji).map(r=>`
`+r).join("")):""}var zi=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],wr=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(zi),to={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function ct(t,e){this._e=tt(),this.name=t,this.message=e}function Ni(t,e){return t+". Errors: "+Object.keys(e).map(n=>e[n].toString()).filter((n,r,i)=>i.indexOf(n)===r).join(`
`)}function wn(t,e,n,r){this._e=tt(),this.failures=e,this.failedKeys=r,this.successCount=n,this.message=Ni(t,e)}function Ot(t,e){this._e=tt(),this.name="BulkError",this.failures=Object.keys(e).map(n=>e[n]),this.failuresByPos=e,this.message=Ni(t,e)}ut(ct).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Vn(this._e,2))}},toString:function(){return this.name+": "+this.message}}),ut(wn).from(ct),ut(Ot).from(ct);var kr=wr.reduce((t,e)=>(t[e]=e+"Error",t),{});const no=ct;var K=wr.reduce((t,e)=>{var n=e+"Error";function r(i,o){this._e=tt(),this.name=n,i?typeof i=="string"?(this.message=`${i}${o?`
 `+o:""}`,this.inner=o||null):typeof i=="object"&&(this.message=`${i.name} ${i.message}`,this.inner=i):(this.message=to[e]||n,this.inner=null)}return ut(r).from(no),t[e]=r,t},{});K.Syntax=SyntaxError,K.Type=TypeError,K.Range=RangeError;var zr=zi.reduce((t,e)=>(t[e+"Error"]=K[e],t),{}),an=wr.reduce((t,e)=>(["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=K[e]),t),{});function U(){}function Lt(t){return t}function ro(t,e){return t==null||t===Lt?e:function(n){return e(t(n))}}function Qe(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function io(t,e){return t===U?e:function(){var n=t.apply(this,arguments);n!==void 0&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?Qe(r,this.onsuccess):r),i&&(this.onerror=this.onerror?Qe(i,this.onerror):i),o!==void 0?o:n}}function so(t,e){return t===U?e:function(){t.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?Qe(n,this.onsuccess):n),r&&(this.onerror=this.onerror?Qe(r,this.onerror):r)}}function oo(t,e){return t===U?e:function(n){var r=t.apply(this,arguments);fe(n,r);var i=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var s=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?Qe(i,this.onsuccess):i),o&&(this.onerror=this.onerror?Qe(o,this.onerror):o),r===void 0?s===void 0?void 0:s:fe(r,s)}}function ao(t,e){return t===U?e:function(){return e.apply(this,arguments)!==!1&&t.apply(this,arguments)}}function Er(t,e){return t===U?e:function(){var n=t.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,i=arguments.length,o=new Array(i);i--;)o[i]=arguments[i];return n.then(function(){return e.apply(r,o)})}return e.apply(this,arguments)}}an.ModifyError=wn,an.DexieError=ct,an.BulkError=Ot;var qt={};const[Yn,kn,Wn]=typeof Promise>"u"?[]:(()=>{let t=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[t,Ft(t),t];const e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,Ft(e),t]})(),Fi=kn&&kn.then,ln=Yn&&Yn.constructor,xr=!!Wn;var Gn=!1,lo=Wn?()=>{Wn.then(Xt)}:V.setImmediate?setImmediate.bind(null,Xt):V.MutationObserver?()=>{var t=document.createElement("div");new MutationObserver(()=>{Xt(),t=null}).observe(t,{attributes:!0}),t.setAttribute("i","1")}:()=>{setTimeout(Xt,0)},Bt=function(t,e){wt.push([t,e]),En&&(lo(),En=!1)},Zn=!0,En=!0,We=[],un=[],Qn=null,Jn=Lt,ft={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Fr,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(t=>{try{Fr(t[0],t[1])}catch{}})}},D=ft,wt=[],Ge=0,cn=[];function B(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=U,this._lib=!1;var e=this._PSD=D;if(Oe&&(this._stackHolder=tt(),this._prev=null,this._numPrev=0),typeof t!="function"){if(t!==qt)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&$n(this,this._value))}this._state=null,this._value=null,++e.ref,qi(this,t)}const Xn={get:function(){var t=D,e=xn;function n(r,i){var o=!t.global&&(t!==D||e!==xn);const s=o&&!je();var a=new B((l,u)=>{Ar(this,new Li(An(r,t,o,s),An(i,t,o,s),l,u,t))});return Oe&&Vi(a,this),a}return n.prototype=qt,n},set:function(t){De(this,"then",t&&t.prototype===qt?Xn:{get:function(){return t},set:Xn.set})}};function Li(t,e,n,r,i){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=n,this.reject=r,this.psd=i}function qi(t,e){try{e(n=>{if(t._state===null){if(n===t)throw new TypeError("A promise cannot be resolved with itself.");var r=t._lib&&Zt();n&&typeof n.then=="function"?qi(t,(i,o)=>{n instanceof B?n._then(i,o):n.then(i,o)}):(t._state=!0,t._value=n,Ui(t)),r&&Qt()}},$n.bind(null,t))}catch(n){$n(t,n)}}function $n(t,e){if(un.push(e),t._state===null){var n=t._lib&&Zt();e=Jn(e),t._state=!1,t._value=e,Oe&&e!==null&&typeof e=="object"&&!e._promise&&function(r,i,o){try{r.apply(null,o)}catch(s){i&&i(s)}}(()=>{var r=_r(e,"stack");e._promise=t,De(e,"stack",{get:()=>Gn?r&&(r.get?r.get.apply(e):r.value):t.stack})}),function(r){We.some(i=>i._value===r._value)||We.push(r)}(t),Ui(t),n&&Qt()}}function Ui(t){var e=t._listeners;t._listeners=[];for(var n=0,r=e.length;n<r;++n)Ar(t,e[n]);var i=t._PSD;--i.ref||i.finalize(),Ge===0&&(++Ge,Bt(()=>{--Ge==0&&Sr()},[]))}function Ar(t,e){if(t._state!==null){var n=t._state?e.onFulfilled:e.onRejected;if(n===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++Ge,Bt(uo,[n,t,e])}else t._listeners.push(e)}function uo(t,e,n){try{Qn=e;var r,i=e._value;e._state?r=t(i):(un.length&&(un=[]),r=t(i),un.indexOf(i)===-1&&function(o){for(var s=We.length;s;)if(We[--s]._value===o._value)return void We.splice(s,1)}(e)),n.resolve(r)}catch(o){n.reject(o)}finally{Qn=null,--Ge==0&&Sr(),--n.psd.ref||n.psd.finalize()}}function Hi(t,e,n){if(e.length===n)return e;var r="";if(t._state===!1){var i,o,s=t._value;s!=null?(i=s.name||"Error",o=s.message||s,r=Vn(s,0)):(i=s,o=""),e.push(i+(o?": "+o:"")+r)}return Oe&&((r=Vn(t._stackHolder,2))&&e.indexOf(r)===-1&&e.push(r),t._prev&&Hi(t._prev,e,n)),e}function Vi(t,e){var n=e?e._numPrev+1:0;n<100&&(t._prev=e,t._numPrev=n)}function Xt(){Zt()&&Qt()}function Zt(){var t=Zn;return Zn=!1,En=!1,t}function Qt(){var t,e,n;do for(;wt.length>0;)for(t=wt,wt=[],n=t.length,e=0;e<n;++e){var r=t[e];r[0].apply(null,r[1])}while(wt.length>0);Zn=!0,En=!0}function Sr(){var t=We;We=[],t.forEach(r=>{r._PSD.onunhandled.call(null,r._value,r)});for(var e=cn.slice(0),n=e.length;n;)e[--n]()}function $t(t){return new B(qt,!1,t)}function Y(t,e){var n=D;return function(){var r=Zt(),i=D;try{return qe(n,!0),t.apply(this,arguments)}catch(o){e&&e(o)}finally{qe(i,!1),r&&Qt()}}}dt(B.prototype,{then:Xn,_then:function(t,e){Ar(this,new Li(null,null,t,e,D))},catch:function(t){if(arguments.length===1)return this.then(null,t);var e=arguments[0],n=arguments[1];return typeof e=="function"?this.then(null,r=>r instanceof e?n(r):$t(r)):this.then(null,r=>r&&r.name===e?n(r):$t(r))},finally:function(t){return this.then(e=>(t(),e),e=>(t(),$t(e)))},stack:{get:function(){if(this._stack)return this._stack;try{Gn=!0;var t=Hi(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=t),t}finally{Gn=!1}}},timeout:function(t,e){return t<1/0?new B((n,r)=>{var i=setTimeout(()=>r(new K.Timeout(e)),t);this.then(n,r).finally(clearTimeout.bind(null,i))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&De(B.prototype,Symbol.toStringTag,"Dexie.Promise"),ft.env=Yi(),dt(B,{all:function(){var t=Me.apply(null,arguments).map(en);return new B(function(e,n){t.length===0&&e([]);var r=t.length;t.forEach((i,o)=>B.resolve(i).then(s=>{t[o]=s,--r||e(t)},n))})},resolve:t=>{if(t instanceof B)return t;if(t&&typeof t.then=="function")return new B((n,r)=>{t.then(n,r)});var e=new B(qt,!0,t);return Vi(e,Qn),e},reject:$t,race:function(){var t=Me.apply(null,arguments).map(en);return new B((e,n)=>{t.map(r=>B.resolve(r).then(e,n))})},PSD:{get:()=>D,set:t=>D=t},totalEchoes:{get:()=>xn},newPSD:Le,usePSD:yt,scheduler:{get:()=>Bt,set:t=>{Bt=t}},rejectionMapper:{get:()=>Jn,set:t=>{Jn=t}},follow:(t,e)=>new B((n,r)=>Le((i,o)=>{var s=D;s.unhandleds=[],s.onunhandled=o,s.finalize=Qe(function(){(function(a){function l(){a(),cn.splice(cn.indexOf(l),1)}cn.push(l),++Ge,Bt(()=>{--Ge==0&&Sr()},[])})(()=>{this.unhandleds.length===0?i():o(this.unhandleds[0])})},s.finalize),t()},e,n,r))}),ln&&(ln.allSettled&&De(B,"allSettled",function(){const t=Me.apply(null,arguments).map(en);return new B(e=>{t.length===0&&e([]);let n=t.length;const r=new Array(n);t.forEach((i,o)=>B.resolve(i).then(s=>r[o]={status:"fulfilled",value:s},s=>r[o]={status:"rejected",reason:s}).then(()=>--n||e(r)))})}),ln.any&&typeof AggregateError<"u"&&De(B,"any",function(){const t=Me.apply(null,arguments).map(en);return new B((e,n)=>{t.length===0&&n(new AggregateError([]));let r=t.length;const i=new Array(r);t.forEach((o,s)=>B.resolve(o).then(a=>e(a),a=>{i[s]=a,--r||n(new AggregateError(i))}))})}));const ae={awaits:0,echoes:0,id:0};var co=0,fn=[],Rn=0,xn=0,fo=0;function Le(t,e,n,r){var i=D,o=Object.create(i);o.parent=i,o.ref=0,o.global=!1,o.id=++fo;var s=ft.env;o.env=xr?{Promise:B,PromiseProp:{value:B,configurable:!0,writable:!0},all:B.all,race:B.race,allSettled:B.allSettled,any:B.any,resolve:B.resolve,reject:B.reject,nthen:Nr(s.nthen,o),gthen:Nr(s.gthen,o)}:{},e&&fe(o,e),++i.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=yt(o,t,n,r);return o.ref===0&&o.finalize(),a}function gt(){return ae.id||(ae.id=++co),++ae.awaits,ae.echoes+=100,ae.id}function je(){return!!ae.awaits&&(--ae.awaits==0&&(ae.id=0),ae.echoes=100*ae.awaits,!0)}function en(t){return ae.echoes&&t&&t.constructor===ln?(gt(),t.then(e=>(je(),e),e=>(je(),se(e)))):t}function ho(t){++xn,ae.echoes&&--ae.echoes!=0||(ae.echoes=ae.id=0),fn.push(D),qe(t,!0)}function mo(){var t=fn[fn.length-1];fn.pop(),qe(t,!1)}function qe(t,e){var n=D;if((e?!ae.echoes||Rn++&&t===D:!Rn||--Rn&&t===D)||Wi(e?ho.bind(null,t):mo),t!==D&&(D=t,n===ft&&(ft.env=Yi()),xr)){var r=ft.env.Promise,i=t.env;kn.then=i.nthen,r.prototype.then=i.gthen,(n.global||t.global)&&(Object.defineProperty(V,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function Yi(){var t=V.Promise;return xr?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(V,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:kn.then,gthen:t.prototype.then}:{}}function yt(t,e,n,r,i){var o=D;try{return qe(t,!0),e(n,r,i)}finally{qe(o,!1)}}function Wi(t){Fi.call(Yn,t)}function An(t,e,n,r){return typeof t!="function"?t:function(){var i=D;n&&gt(),qe(e,!0);try{return t.apply(this,arguments)}finally{qe(i,!1),r&&Wi(je)}}}function Nr(t,e){return function(n,r){return t.call(this,An(n,e),An(r,e))}}(""+Fi).indexOf("[native code]")===-1&&(gt=je=U);function Fr(t,e){var n;try{n=e.onuncatched(t)}catch{}if(n!==!1)try{var r,i={promise:e,reason:t};if(V.document&&document.createEvent?((r=document.createEvent("Event")).initEvent("unhandledrejection",!0,!0),fe(r,i)):V.CustomEvent&&fe(r=new CustomEvent("unhandledrejection",{detail:i}),i),r&&V.dispatchEvent&&(dispatchEvent(r),!V.PromiseRejectionEvent&&V.onunhandledrejection))try{V.onunhandledrejection(r)}catch{}Oe&&r&&!r.defaultPrevented&&console.warn(`Unhandled rejection: ${t.stack||t}`)}catch{}}var se=B.reject;function er(t,e,n,r){if(t.idbdb&&(t._state.openComplete||D.letThrough||t._vip)){var i=t._createTransaction(e,n,t._dbSchema);try{i.create(),t._state.PR1398_maxLoop=3}catch(o){return o.name===kr.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>er(t,e,n,r))):se(o)}return i._promise(e,(o,s)=>Le(()=>(D.trans=i,r(o,s,i)))).then(o=>i._completion.then(()=>o))}if(t._state.openComplete)return se(new K.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return se(new K.DatabaseClosed);t.open().catch(U)}return t._state.dbReadyPromise.then(()=>er(t,e,n,r))}const Ve=String.fromCharCode(65535),Be="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Pt=[],Bn=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),po=Bn,go=Bn,Gi=t=>!/(dexie\.js|dexie\.min\.js)/.test(t);function Je(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}const Zi={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function tn(t){return typeof t!="string"||/\./.test(t)?e=>e:e=>(e[t]===void 0&&t in e&&delete(e=Gt(e))[t],e)}class yo{_trans(e,n,r){const i=this._tx||D.trans,o=this.name;function s(l,u,c){if(!c.schema[o])throw new K.NotFound("Table "+o+" not part of transaction");return n(c.idbtrans,c)}const a=Zt();try{return i&&i.db===this.db?i===D.trans?i._promise(e,s,r):Le(()=>i._promise(e,s,r),{trans:i,transless:D.transless||D}):er(this.db,e,[this.name],s)}finally{a&&Qt()}}get(e,n){return e&&e.constructor===Object?this.where(e).first(n):this._trans("readonly",r=>this.core.get({trans:r,key:e}).then(i=>this.hook.reading.fire(i))).then(n)}where(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(le(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);const n=ne(e);if(n.length===1)return this.where(n[0]).equals(e[n[0]]);const r=this.schema.indexes.concat(this.schema.primKey).filter(u=>u.compound&&n.every(c=>u.keyPath.indexOf(c)>=0)&&u.keyPath.every(c=>n.indexOf(c)>=0))[0];if(r&&this.db._maxKey!==Ve)return this.where(r.name).equals(r.keyPath.map(u=>e[u]));!r&&Oe&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${n.join("+")}]`);const{idxByName:i}=this.schema,o=this.db._deps.indexedDB;function s(u,c){try{return o.cmp(u,c)===0}catch{return!1}}const[a,l]=n.reduce(([u,c],f)=>{const h=i[f],m=e[f];return[u||h,u||!h?Je(c,h&&h.multi?p=>{const d=Ie(p,f);return le(d)&&d.some(g=>s(m,g))}:p=>s(m,Ie(p,f))):c]},[null,null]);return a?this.where(a.name).equals(e[a.keyPath]).filter(l):r?this.filter(l):this.where(n).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,le(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;const n=r=>{if(!r)return r;const i=Object.create(e.prototype);for(var o in r)if(we(r,o))try{i[o]=r[o]}catch{}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=n,this.hook("reading",n),e}defineClass(){return this.mapToClass(function(e){fe(this,e)})}add(e,n){const{auto:r,keyPath:i}=this.schema.primKey;let o=e;return i&&r&&(o=tn(i)(e)),this._trans("readwrite",s=>this.core.mutate({trans:s,type:"add",keys:n!=null?[n]:null,values:[o]})).then(s=>s.numFailures?B.reject(s.failures[0]):s.lastResult).then(s=>{if(i)try{Se(e,i,s)}catch{}return s})}update(e,n){if(typeof e!="object"||le(e))return this.where(":id").equals(e).modify(n);{const r=Ie(e,this.schema.primKey.keyPath);if(r===void 0)return se(new K.InvalidArgument("Given object does not contain its primary key"));try{typeof n!="function"?ne(n).forEach(i=>{Se(e,i,n[i])}):n(e,{value:e,primKey:r})}catch{}return this.where(":id").equals(r).modify(n)}}put(e,n){const{auto:r,keyPath:i}=this.schema.primKey;let o=e;return i&&r&&(o=tn(i)(e)),this._trans("readwrite",s=>this.core.mutate({trans:s,type:"put",values:[o],keys:n!=null?[n]:null})).then(s=>s.numFailures?B.reject(s.failures[0]):s.lastResult).then(s=>{if(i)try{Se(e,i,s)}catch{}return s})}delete(e){return this._trans("readwrite",n=>this.core.mutate({trans:n,type:"delete",keys:[e]})).then(n=>n.numFailures?B.reject(n.failures[0]):void 0)}clear(){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"deleteRange",range:Zi})).then(e=>e.numFailures?B.reject(e.failures[0]):void 0)}bulkGet(e){return this._trans("readonly",n=>this.core.getMany({keys:e,trans:n}).then(r=>r.map(i=>this.hook.reading.fire(i))))}bulkAdd(e,n,r){const i=Array.isArray(n)?n:void 0,o=(r=r||(i?void 0:n))?r.allKeys:void 0;return this._trans("readwrite",s=>{const{auto:a,keyPath:l}=this.schema.primKey;if(l&&i)throw new K.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new K.InvalidArgument("Arguments objects and keys must have the same length");const u=e.length;let c=l&&a?e.map(tn(l)):e;return this.core.mutate({trans:s,type:"add",keys:i,values:c,wantResults:o}).then(({numFailures:f,results:h,lastResult:m,failures:p})=>{if(f===0)return o?h:m;throw new Ot(`${this.name}.bulkAdd(): ${f} of ${u} operations failed`,p)})})}bulkPut(e,n,r){const i=Array.isArray(n)?n:void 0,o=(r=r||(i?void 0:n))?r.allKeys:void 0;return this._trans("readwrite",s=>{const{auto:a,keyPath:l}=this.schema.primKey;if(l&&i)throw new K.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new K.InvalidArgument("Arguments objects and keys must have the same length");const u=e.length;let c=l&&a?e.map(tn(l)):e;return this.core.mutate({trans:s,type:"put",keys:i,values:c,wantResults:o}).then(({numFailures:f,results:h,lastResult:m,failures:p})=>{if(f===0)return o?h:m;throw new Ot(`${this.name}.bulkPut(): ${f} of ${u} operations failed`,p)})})}bulkDelete(e){const n=e.length;return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:e})).then(({numFailures:r,lastResult:i,failures:o})=>{if(r===0)return i;throw new Ot(`${this.name}.bulkDelete(): ${r} of ${n} operations failed`,o)})}}function Mt(t){var e={},n=function(a,l){if(l){for(var u=arguments.length,c=new Array(u-1);--u;)c[u-1]=arguments[u];return e[a].subscribe.apply(null,c),t}if(typeof a=="string")return e[a]};n.addEventType=o;for(var r=1,i=arguments.length;r<i;++r)o(arguments[r]);return n;function o(a,l,u){if(typeof a=="object")return s(a);l||(l=ao),u||(u=U);var c={subscribers:[],fire:u,subscribe:function(f){c.subscribers.indexOf(f)===-1&&(c.subscribers.push(f),c.fire=l(c.fire,f))},unsubscribe:function(f){c.subscribers=c.subscribers.filter(function(h){return h!==f}),c.fire=c.subscribers.reduce(l,u)}};return e[a]=n[a]=c,c}function s(a){ne(a).forEach(function(l){var u=a[l];if(le(u))o(l,a[l][0],a[l][1]);else{if(u!=="asap")throw new K.InvalidArgument("Invalid event config");var c=o(l,Lt,function(){for(var f=arguments.length,h=new Array(f);f--;)h[f]=arguments[f];c.subscribers.forEach(function(m){Mi(function(){m.apply(null,h)})})})}})}}function _t(t,e){return ut(e).from({prototype:t}),e}function rt(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function Tn(t,e){t.filter=Je(t.filter,e)}function Dn(t,e,n){var r=t.replayFilter;t.replayFilter=r?()=>Je(r(),e()):e,t.justLimit=n&&!r}function dn(t,e){if(t.isPrimKey)return e.primaryKey;const n=e.getIndexByKeyPath(t.index);if(!n)throw new K.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return n}function Lr(t,e,n){const r=dn(t,e.schema);return e.openCursor({trans:n,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:r,range:t.range}})}function nn(t,e,n,r){const i=t.replayFilter?Je(t.filter,t.replayFilter()):t.filter;if(t.or){const o={},s=(a,l,u)=>{if(!i||i(l,u,h=>l.stop(h),h=>l.fail(h))){var c=l.primaryKey,f=""+c;f==="[object ArrayBuffer]"&&(f=""+new Uint8Array(c)),we(o,f)||(o[f]=!0,e(a,l,u))}};return Promise.all([t.or._iterate(s,n),qr(Lr(t,r,n),t.algorithm,s,!t.keysOnly&&t.valueMapper)])}return qr(Lr(t,r,n),Je(t.algorithm,i),e,!t.keysOnly&&t.valueMapper)}function qr(t,e,n,r){var i=Y(r?(o,s,a)=>n(r(o),s,a):n);return t.then(o=>{if(o)return o.start(()=>{var s=()=>o.continue();e&&!e(o,a=>s=a,a=>{o.stop(a),s=U},a=>{o.fail(a),s=U})||i(o.value,o,a=>s=a),s()})})}function ce(t,e){try{const n=Ur(t),r=Ur(e);if(n!==r)return n==="Array"?1:r==="Array"?-1:n==="binary"?1:r==="binary"?-1:n==="string"?1:r==="string"?-1:n==="Date"?1:r!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return function(i,o){const s=i.length,a=o.length,l=s<a?s:a;for(let u=0;u<l;++u)if(i[u]!==o[u])return i[u]<o[u]?-1:1;return s===a?0:s<a?-1:1}(Hr(t),Hr(e));case"Array":return function(i,o){const s=i.length,a=o.length,l=s<a?s:a;for(let u=0;u<l;++u){const c=ce(i[u],o[u]);if(c!==0)return c}return s===a?0:s<a?-1:1}(t,e)}}catch{}return NaN}function Ur(t){const e=typeof t;if(e!=="object")return e;if(ArrayBuffer.isView(t))return"binary";const n=Un(t);return n==="ArrayBuffer"?"binary":n}function Hr(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}class bo{_read(e,n){var r=this._ctx;return r.error?r.table._trans(null,se.bind(null,r.error)):r.table._trans("readonly",e).then(n)}_write(e){var n=this._ctx;return n.error?n.table._trans(null,se.bind(null,n.error)):n.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var n=this._ctx;n.algorithm=Je(n.algorithm,e)}_iterate(e,n){return nn(this._ctx,e,n,this._ctx.table.core)}clone(e){var n=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&fe(r,e),n._ctx=r,n}raw(){return this._ctx.valueMapper=null,this}each(e){var n=this._ctx;return this._read(r=>nn(n,e,r,n.table.core))}count(e){return this._read(n=>{const r=this._ctx,i=r.table.core;if(rt(r,!0))return i.count({trans:n,query:{index:dn(r,i.schema),range:r.range}}).then(s=>Math.min(s,r.limit));var o=0;return nn(r,()=>(++o,!1),n,i).then(()=>o)}).then(e)}sortBy(e,n){const r=e.split(".").reverse(),i=r[0],o=r.length-1;function s(u,c){return c?s(u[r[c]],c-1):u[i]}var a=this._ctx.dir==="next"?1:-1;function l(u,c){var f=s(u,o),h=s(c,o);return f<h?-a:f>h?a:0}return this.toArray(function(u){return u.sort(l)}).then(n)}toArray(e){return this._read(n=>{var r=this._ctx;if(r.dir==="next"&&rt(r,!0)&&r.limit>0){const{valueMapper:i}=r,o=dn(r,r.table.core.schema);return r.table.core.query({trans:n,limit:r.limit,values:!0,query:{index:o,range:r.range}}).then(({result:s})=>i?s.map(i):s)}{const i=[];return nn(r,o=>i.push(o),n,r.table.core).then(()=>i)}},e)}offset(e){var n=this._ctx;return e<=0||(n.offset+=e,rt(n)?Dn(n,()=>{var r=e;return(i,o)=>r===0||(r===1?(--r,!1):(o(()=>{i.advance(r),r=0}),!1))}):Dn(n,()=>{var r=e;return()=>--r<0})),this}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Dn(this._ctx,()=>{var n=e;return function(r,i,o){return--n<=0&&i(o),n>=0}},!0),this}until(e,n){return Tn(this._ctx,function(r,i,o){return!e(r.value)||(i(o),n)}),this}first(e){return this.limit(1).toArray(function(n){return n[0]}).then(e)}last(e){return this.reverse().first(e)}filter(e){var n,r;return Tn(this._ctx,function(i){return e(i.value)}),n=this._ctx,r=e,n.isMatch=Je(n.isMatch,r),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){e(i.key,i)})}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){e(i.primaryKey,i)})}keys(e){var n=this._ctx;n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,o){r.push(o.key)}).then(function(){return r}).then(e)}primaryKeys(e){var n=this._ctx;if(n.dir==="next"&&rt(n,!0)&&n.limit>0)return this._read(i=>{var o=dn(n,n.table.core.schema);return n.table.core.query({trans:i,values:!1,limit:n.limit,query:{index:o,range:n.range}})}).then(({result:i})=>i).then(e);n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,o){r.push(o.primaryKey)}).then(function(){return r}).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys(function(n){return n[0]}).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,n=e.index&&e.table.schema.idxByName[e.index];if(!n||!n.multi)return this;var r={};return Tn(this._ctx,function(i){var o=i.primaryKey.toString(),s=we(r,o);return r[o]=!0,!s}),this}modify(e){var n=this._ctx;return this._write(r=>{var i;if(typeof e=="function")i=e;else{var o=ne(e),s=o.length;i=function(d){for(var g=!1,_=0;_<s;++_){var y=o[_],b=e[y];Ie(d,y)!==b&&(Se(d,y,b),g=!0)}return g}}const a=n.table.core,{outbound:l,extractKey:u}=a.schema.primaryKey,c=this.db._options.modifyChunkSize||200,f=[];let h=0;const m=[],p=(d,g)=>{const{failures:_,numFailures:y}=g;h+=d-y;for(let b of ne(_))f.push(_[b])};return this.clone().primaryKeys().then(d=>{const g=_=>{const y=Math.min(c,d.length-_);return a.getMany({trans:r,keys:d.slice(_,_+y),cache:"immutable"}).then(b=>{const v=[],w=[],E=l?[]:null,x=[];for(let k=0;k<y;++k){const T=b[k],R={value:Gt(T),primKey:d[_+k]};i.call(R,R.value,R)!==!1&&(R.value==null?x.push(d[_+k]):l||ce(u(T),u(R.value))===0?(w.push(R.value),l&&E.push(d[_+k])):(x.push(d[_+k]),v.push(R.value)))}const O=rt(n)&&n.limit===1/0&&(typeof e!="function"||e===In)&&{index:n.index,range:n.range};return Promise.resolve(v.length>0&&a.mutate({trans:r,type:"add",values:v}).then(k=>{for(let T in k.failures)x.splice(parseInt(T),1);p(v.length,k)})).then(()=>(w.length>0||O&&typeof e=="object")&&a.mutate({trans:r,type:"put",keys:E,values:w,criteria:O,changeSpec:typeof e!="function"&&e}).then(k=>p(w.length,k))).then(()=>(x.length>0||O&&e===In)&&a.mutate({trans:r,type:"delete",keys:x,criteria:O}).then(k=>p(x.length,k))).then(()=>d.length>_+y&&g(_+c))})};return g(0).then(()=>{if(f.length>0)throw new wn("Error modifying one or more objects",f,h,m);return d.length})})})}delete(){var e=this._ctx,n=e.range;return rt(e)&&(e.isPrimKey&&!go||n.type===3)?this._write(r=>{const{primaryKey:i}=e.table.core.schema,o=n;return e.table.core.count({trans:r,query:{index:i,range:o}}).then(s=>e.table.core.mutate({trans:r,type:"deleteRange",range:o}).then(({failures:a,lastResult:l,results:u,numFailures:c})=>{if(c)throw new wn("Could not delete some values",Object.keys(a).map(f=>a[f]),s-c);return s-c}))}):this.modify(In)}}const In=(t,e)=>e.value=null;function _o(t,e){return t<e?-1:t===e?0:1}function vo(t,e){return t>e?-1:t===e?0:1}function ve(t,e,n){var r=t instanceof Ji?new t.Collection(t):t;return r._ctx.error=n?new n(e):new TypeError(e),r}function it(t){return new t.Collection(t,()=>Qi("")).limit(0)}function wo(t,e,n,r,i,o){for(var s=Math.min(t.length,r.length),a=-1,l=0;l<s;++l){var u=e[l];if(u!==r[l])return i(t[l],n[l])<0?t.substr(0,l)+n[l]+n.substr(l+1):i(t[l],r[l])<0?t.substr(0,l)+r[l]+n.substr(l+1):a>=0?t.substr(0,a)+e[a]+n.substr(a+1):null;i(t[l],u)<0&&(a=l)}return s<r.length&&o==="next"?t+n.substr(t.length):s<t.length&&o==="prev"?t.substr(0,n.length):a<0?null:t.substr(0,a)+r[a]+n.substr(a+1)}function rn(t,e,n,r){var i,o,s,a,l,u,c,f=n.length;if(!n.every(d=>typeof d=="string"))return ve(t,"String expected.");function h(d){i=function(_){return _==="next"?y=>y.toUpperCase():y=>y.toLowerCase()}(d),o=function(_){return _==="next"?y=>y.toLowerCase():y=>y.toUpperCase()}(d),s=d==="next"?_o:vo;var g=n.map(function(_){return{lower:o(_),upper:i(_)}}).sort(function(_,y){return s(_.lower,y.lower)});a=g.map(function(_){return _.upper}),l=g.map(function(_){return _.lower}),u=d,c=d==="next"?"":r}h("next");var m=new t.Collection(t,()=>ze(a[0],l[f-1]+r));m._ondirectionchange=function(d){h(d)};var p=0;return m._addAlgorithm(function(d,g,_){var y=d.key;if(typeof y!="string")return!1;var b=o(y);if(e(b,l,p))return!0;for(var v=null,w=p;w<f;++w){var E=wo(y,b,a[w],l[w],s,u);E===null&&v===null?p=w+1:(v===null||s(v,E)>0)&&(v=E)}return g(v!==null?function(){d.continue(v+c)}:_),!1}),m}function ze(t,e,n,r){return{type:2,lower:t,upper:e,lowerOpen:n,upperOpen:r}}function Qi(t){return{type:1,lower:t,upper:t}}class Ji{get Collection(){return this._ctx.table.db.Collection}between(e,n,r,i){r=r!==!1,i=i===!0;try{return this._cmp(e,n)>0||this._cmp(e,n)===0&&(r||i)&&(!r||!i)?it(this):new this.Collection(this,()=>ze(e,n,!r,!i))}catch{return ve(this,Be)}}equals(e){return e==null?ve(this,Be):new this.Collection(this,()=>Qi(e))}above(e){return e==null?ve(this,Be):new this.Collection(this,()=>ze(e,void 0,!0))}aboveOrEqual(e){return e==null?ve(this,Be):new this.Collection(this,()=>ze(e,void 0,!1))}below(e){return e==null?ve(this,Be):new this.Collection(this,()=>ze(void 0,e,!1,!0))}belowOrEqual(e){return e==null?ve(this,Be):new this.Collection(this,()=>ze(void 0,e))}startsWith(e){return typeof e!="string"?ve(this,"String expected."):this.between(e,e+Ve,!0,!0)}startsWithIgnoreCase(e){return e===""?this.startsWith(e):rn(this,(n,r)=>n.indexOf(r[0])===0,[e],Ve)}equalsIgnoreCase(e){return rn(this,(n,r)=>n===r[0],[e],"")}anyOfIgnoreCase(){var e=Me.apply(ot,arguments);return e.length===0?it(this):rn(this,(n,r)=>r.indexOf(n)!==-1,e,"")}startsWithAnyOfIgnoreCase(){var e=Me.apply(ot,arguments);return e.length===0?it(this):rn(this,(n,r)=>r.some(i=>n.indexOf(i)===0),e,Ve)}anyOf(){const e=Me.apply(ot,arguments);let n=this._cmp;try{e.sort(n)}catch{return ve(this,Be)}if(e.length===0)return it(this);const r=new this.Collection(this,()=>ze(e[0],e[e.length-1]));r._ondirectionchange=o=>{n=o==="next"?this._ascending:this._descending,e.sort(n)};let i=0;return r._addAlgorithm((o,s,a)=>{const l=o.key;for(;n(l,e[i])>0;)if(++i,i===e.length)return s(a),!1;return n(l,e[i])===0||(s(()=>{o.continue(e[i])}),!1)}),r}notEqual(e){return this.inAnyRange([[-(1/0),e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const e=Me.apply(ot,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return ve(this,Be)}const n=e.reduce((r,i)=>r?r.concat([[r[r.length-1][1],i]]):[[-(1/0),i]],null);return n.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,n){const r=this._cmp,i=this._ascending,o=this._descending,s=this._min,a=this._max;if(e.length===0)return it(this);if(!e.every(y=>y[0]!==void 0&&y[1]!==void 0&&i(y[0],y[1])<=0))return ve(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",K.InvalidArgument);const l=!n||n.includeLowers!==!1,u=n&&n.includeUppers===!0;let c,f=i;function h(y,b){return f(y[0],b[0])}try{c=e.reduce(function(y,b){let v=0,w=y.length;for(;v<w;++v){const E=y[v];if(r(b[0],E[1])<0&&r(b[1],E[0])>0){E[0]=s(E[0],b[0]),E[1]=a(E[1],b[1]);break}}return v===w&&y.push(b),y},[]),c.sort(h)}catch{return ve(this,Be)}let m=0;const p=u?y=>i(y,c[m][1])>0:y=>i(y,c[m][1])>=0,d=l?y=>o(y,c[m][0])>0:y=>o(y,c[m][0])>=0;let g=p;const _=new this.Collection(this,()=>ze(c[0][0],c[c.length-1][1],!l,!u));return _._ondirectionchange=y=>{y==="next"?(g=p,f=i):(g=d,f=o),c.sort(h)},_._addAlgorithm((y,b,v)=>{for(var w=y.key;g(w);)if(++m,m===c.length)return b(v),!1;return!!function(E){return!p(E)&&!d(E)}(w)||(this._cmp(w,c[m][1])===0||this._cmp(w,c[m][0])===0||b(()=>{f===i?y.continue(c[m][0]):y.continue(c[m][1])}),!1)}),_}startsWithAnyOf(){const e=Me.apply(ot,arguments);return e.every(n=>typeof n=="string")?e.length===0?it(this):this.inAnyRange(e.map(n=>[n,n+Ve])):ve(this,"startsWithAnyOf() only works with strings")}}function Ce(t){return Y(function(e){return Ut(e),t(e.target.error),!1})}function Ut(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}const Ue=Mt(null,"storagemutated");class ko{_lock(){return vt(!D.global),++this._reculock,this._reculock!==1||D.global||(D.lockOwnerFor=this),this}_unlock(){if(vt(!D.global),--this._reculock==0)for(D.global||(D.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{yt(e[1],e[0])}catch{}}return this}_locked(){return this._reculock&&D.lockOwnerFor!==this}create(e){if(!this.mode)return this;const n=this.db.idbdb,r=this.db._state.dbOpenError;if(vt(!this.idbtrans),!e&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new K.DatabaseClosed(r);case"MissingAPIError":throw new K.MissingAPI(r.message,r);default:throw new K.OpenFailed(r)}if(!this.active)throw new K.TransactionInactive;return vt(this._completion._state===null),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):n.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=Y(i=>{Ut(i),this._reject(e.error)}),e.onabort=Y(i=>{Ut(i),this.active&&this._reject(new K.Abort(e.error)),this.active=!1,this.on("abort").fire(i)}),e.oncomplete=Y(()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&Ue.storagemutated.fire(e.mutatedParts)}),this}_promise(e,n,r){if(e==="readwrite"&&this.mode!=="readwrite")return se(new K.ReadOnly("Transaction is readonly"));if(!this.active)return se(new K.TransactionInactive);if(this._locked())return new B((o,s)=>{this._blockedFuncs.push([()=>{this._promise(e,n,r).then(o,s)},D])});if(r)return Le(()=>{var o=new B((s,a)=>{this._lock();const l=n(s,a,this);l&&l.then&&l.then(s,a)});return o.finally(()=>this._unlock()),o._lib=!0,o});var i=new B((o,s)=>{var a=n(o,s,this);a&&a.then&&a.then(o,s)});return i._lib=!0,i}_root(){return this.parent?this.parent._root():this}waitFor(e){var n=this._root();const r=B.resolve(e);if(n._waitingFor)n._waitingFor=n._waitingFor.then(()=>r);else{n._waitingFor=r,n._waitingQueue=[];var i=n.idbtrans.objectStore(n.storeNames[0]);(function s(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(i.get(-1/0).onsuccess=s)})()}var o=n._waitingFor;return new B((s,a)=>{r.then(l=>n._waitingQueue.push(Y(s.bind(null,l))),l=>n._waitingQueue.push(Y(a.bind(null,l)))).finally(()=>{n._waitingFor===o&&(n._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new K.Abort))}table(e){const n=this._memoizedTables||(this._memoizedTables={});if(we(n,e))return n[e];const r=this.schema[e];if(!r)throw new K.NotFound("Table "+e+" not part of transaction");const i=new this.db.Table(e,r,this);return i.core=this.db.core.table(e),n[e]=i,i}}function tr(t,e,n,r,i,o,s){return{name:t,keyPath:e,unique:n,multi:r,auto:i,compound:o,src:(n&&!s?"&":"")+(r?"*":"")+(i?"++":"")+Xi(e)}}function Xi(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function $i(t,e,n){return{name:t,primKey:e,indexes:n,mappedClass:null,idxByName:Ri(n,r=>[r.name,r])}}let Ht=t=>{try{return t.only([[]]),Ht=()=>[[]],[[]]}catch{return Ht=()=>Ve,Ve}};function nr(t){return t==null?()=>{}:typeof t=="string"?function(e){return e.split(".").length===1?n=>n[e]:n=>Ie(n,e)}(t):e=>Ie(e,t)}function Vr(t){return[].slice.call(t)}let Eo=0;function Rt(t){return t==null?":id":typeof t=="string"?t:`[${t.join("+")}]`}function xo(t,e,n){function r(l){if(l.type===3)return null;if(l.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:u,upper:c,lowerOpen:f,upperOpen:h}=l;return u===void 0?c===void 0?null:e.upperBound(c,!!h):c===void 0?e.lowerBound(u,!!f):e.bound(u,c,!!f,!!h)}const{schema:i,hasGetAll:o}=function(l,u){const c=Vr(l.objectStoreNames);return{schema:{name:l.name,tables:c.map(f=>u.objectStore(f)).map(f=>{const{keyPath:h,autoIncrement:m}=f,p=le(h),d=h==null,g={},_={name:f.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:d,compound:p,keyPath:h,autoIncrement:m,unique:!0,extractKey:nr(h)},indexes:Vr(f.indexNames).map(y=>f.index(y)).map(y=>{const{name:b,unique:v,multiEntry:w,keyPath:E}=y,x={name:b,compound:le(E),keyPath:E,unique:v,multiEntry:w,extractKey:nr(E)};return g[Rt(E)]=x,x}),getIndexByKeyPath:y=>g[Rt(y)]};return g[":id"]=_.primaryKey,h!=null&&(g[Rt(h)]=_.primaryKey),_})},hasGetAll:c.length>0&&"getAll"in u.objectStore(c[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(t,n),s=i.tables.map(l=>function(u){const c=u.name;return{name:c,schema:u,mutate:function({trans:f,type:h,keys:m,values:p,range:d}){return new Promise((g,_)=>{g=Y(g);const y=f.objectStore(c),b=y.keyPath==null,v=h==="put"||h==="add";if(!v&&h!=="delete"&&h!=="deleteRange")throw new Error("Invalid operation type: "+h);const{length:w}=m||p||{length:1};if(m&&p&&m.length!==p.length)throw new Error("Given keys array must have same length as given values array.");if(w===0)return g({numFailures:0,failures:{},results:[],lastResult:void 0});let E;const x=[],O=[];let k=0;const T=Z=>{++k,Ut(Z)};if(h==="deleteRange"){if(d.type===4)return g({numFailures:k,failures:O,results:[],lastResult:void 0});d.type===3?x.push(E=y.clear()):x.push(E=y.delete(r(d)))}else{const[Z,L]=v?b?[p,m]:[p,null]:[m,null];if(v)for(let q=0;q<w;++q)x.push(E=L&&L[q]!==void 0?y[h](Z[q],L[q]):y[h](Z[q])),E.onerror=T;else for(let q=0;q<w;++q)x.push(E=y[h](Z[q])),E.onerror=T}const R=Z=>{const L=Z.target.result;x.forEach((q,xe)=>q.error!=null&&(O[xe]=q.error)),g({numFailures:k,failures:O,results:h==="delete"?m:x.map(q=>q.result),lastResult:L})};E.onerror=Z=>{T(Z),R(Z)},E.onsuccess=R})},getMany:({trans:f,keys:h})=>new Promise((m,p)=>{m=Y(m);const d=f.objectStore(c),g=h.length,_=new Array(g);let y,b=0,v=0;const w=x=>{const O=x.target;_[O._pos]=O.result,++v===b&&m(_)},E=Ce(p);for(let x=0;x<g;++x)h[x]!=null&&(y=d.get(h[x]),y._pos=x,y.onsuccess=w,y.onerror=E,++b);b===0&&m(_)}),get:({trans:f,key:h})=>new Promise((m,p)=>{m=Y(m);const d=f.objectStore(c).get(h);d.onsuccess=g=>m(g.target.result),d.onerror=Ce(p)}),query:function(f){return h=>new Promise((m,p)=>{m=Y(m);const{trans:d,values:g,limit:_,query:y}=h,b=_===1/0?void 0:_,{index:v,range:w}=y,E=d.objectStore(c),x=v.isPrimaryKey?E:E.index(v.name),O=r(w);if(_===0)return m({result:[]});if(f){const k=g?x.getAll(O,b):x.getAllKeys(O,b);k.onsuccess=T=>m({result:T.target.result}),k.onerror=Ce(p)}else{let k=0;const T=g||!("openKeyCursor"in x)?x.openCursor(O):x.openKeyCursor(O),R=[];T.onsuccess=Z=>{const L=T.result;return L?(R.push(g?L.value:L.primaryKey),++k===_?m({result:R}):void L.continue()):m({result:R})},T.onerror=Ce(p)}})}(o),openCursor:function({trans:f,values:h,query:m,reverse:p,unique:d}){return new Promise((g,_)=>{g=Y(g);const{index:y,range:b}=m,v=f.objectStore(c),w=y.isPrimaryKey?v:v.index(y.name),E=p?d?"prevunique":"prev":d?"nextunique":"next",x=h||!("openKeyCursor"in w)?w.openCursor(r(b),E):w.openKeyCursor(r(b),E);x.onerror=Ce(_),x.onsuccess=Y(O=>{const k=x.result;if(!k)return void g(null);k.___id=++Eo,k.done=!1;const T=k.continue.bind(k);let R=k.continuePrimaryKey;R&&(R=R.bind(k));const Z=k.advance.bind(k),L=()=>{throw new Error("Cursor not stopped")};k.trans=f,k.stop=k.continue=k.continuePrimaryKey=k.advance=()=>{throw new Error("Cursor not started")},k.fail=Y(_),k.next=function(){let q=1;return this.start(()=>q--?this.continue():this.stop()).then(()=>this)},k.start=q=>{const xe=new Promise((J,re)=>{J=Y(J),x.onerror=Ce(re),k.fail=re,k.stop=_e=>{k.stop=k.continue=k.continuePrimaryKey=k.advance=L,J(_e)}}),Ee=()=>{if(x.result)try{q()}catch(J){k.fail(J)}else k.done=!0,k.start=()=>{throw new Error("Cursor behind last entry")},k.stop()};return x.onsuccess=Y(J=>{x.onsuccess=Ee,Ee()}),k.continue=T,k.continuePrimaryKey=R,k.advance=Z,Ee(),xe},g(k)},_)})},count({query:f,trans:h}){const{index:m,range:p}=f;return new Promise((d,g)=>{const _=h.objectStore(c),y=m.isPrimaryKey?_:_.index(m.name),b=r(p),v=b?y.count(b):y.count();v.onsuccess=Y(w=>d(w.target.result)),v.onerror=Ce(g)})}}}(l)),a={};return s.forEach(l=>a[l.name]=l),{stack:"dbcore",transaction:t.transaction.bind(t),table(l){if(!a[l])throw new Error(`Table '${l}' not found`);return a[l]},MIN_KEY:-1/0,MAX_KEY:Ht(e),schema:i}}function rr({_novip:t},e){const n=e.db,r=function(i,o,{IDBKeyRange:s,indexedDB:a},l){return{dbcore:function(c,f){return f.reduce((h,{create:m})=>({...h,...m(h)}),c)}(xo(o,s,l),i.dbcore)}}(t._middlewares,n,t._deps,e);t.core=r.dbcore,t.tables.forEach(i=>{const o=i.name;t.core.schema.tables.some(s=>s.name===o)&&(i.core=t.core.table(o),t[o]instanceof t.Table&&(t[o].core=i.core))})}function Sn({_novip:t},e,n,r){n.forEach(i=>{const o=r[i];e.forEach(s=>{const a=_r(s,i);(!a||"value"in a&&a.value===void 0)&&(s===t.Transaction.prototype||s instanceof t.Transaction?De(s,i,{get(){return this.table(i)},set(l){Bi(this,i,{value:l,writable:!0,configurable:!0,enumerable:!0})}}):s[i]=new t.Table(i,o))})})}function ir({_novip:t},e){e.forEach(n=>{for(let r in n)n[r]instanceof t.Table&&delete n[r]})}function Ao(t,e){return t._cfg.version-e._cfg.version}function So(t,e,n,r){const i=t._dbSchema,o=t._createTransaction("readwrite",t._storeNames,i);o.create(n),o._completion.catch(r);const s=o._reject.bind(o),a=D.transless||D;Le(()=>{D.trans=o,D.transless=a,e===0?(ne(i).forEach(l=>{Kn(n,l,i[l].primKey,i[l].indexes)}),rr(t,n),B.follow(()=>t.on.populate.fire(o)).catch(s)):function({_novip:l},u,c,f){const h=[],m=l._versions;let p=l._dbSchema=or(l,l.idbdb,f),d=!1;function g(){return h.length?B.resolve(h.shift()(c.idbtrans)).then(g):B.resolve()}return m.filter(_=>_._cfg.version>=u).forEach(_=>{h.push(()=>{const y=p,b=_._cfg.dbschema;ar(l,y,f),ar(l,b,f),p=l._dbSchema=b;const v=es(y,b);v.add.forEach(E=>{Kn(f,E[0],E[1].primKey,E[1].indexes)}),v.change.forEach(E=>{if(E.recreate)throw new K.Upgrade("Not yet support for changing primary key");{const x=f.objectStore(E.name);E.add.forEach(O=>sr(x,O)),E.change.forEach(O=>{x.deleteIndex(O.name),sr(x,O)}),E.del.forEach(O=>x.deleteIndex(O))}});const w=_._cfg.contentUpgrade;if(w&&_._cfg.version>u){rr(l,f),c._memoizedTables={},d=!0;let E=Ti(b);v.del.forEach(T=>{E[T]=y[T]}),ir(l,[l.Transaction.prototype]),Sn(l,[l.Transaction.prototype],ne(E),E),c.schema=E;const x=vr(w);let O;x&&gt();const k=B.follow(()=>{if(O=w(c),O&&x){var T=je.bind(null,null);O.then(T,T)}});return O&&typeof O.then=="function"?B.resolve(O):k.then(()=>O)}}),h.push(y=>{(!d||!po)&&function(b,v){[].slice.call(v.db.objectStoreNames).forEach(w=>b[w]==null&&v.db.deleteObjectStore(w))}(_._cfg.dbschema,y),ir(l,[l.Transaction.prototype]),Sn(l,[l.Transaction.prototype],l._storeNames,l._dbSchema),c.schema=l._dbSchema})}),g().then(()=>{var _,y;y=f,ne(_=p).forEach(b=>{y.db.objectStoreNames.contains(b)||Kn(y,b,_[b].primKey,_[b].indexes)})})}(t,e,o,n).catch(s)})}function es(t,e){const n={del:[],add:[],change:[]};let r;for(r in t)e[r]||n.del.push(r);for(r in e){const i=t[r],o=e[r];if(i){const s={name:r,def:o,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(o.primKey.keyPath||"")||i.primKey.auto!==o.primKey.auto&&!Bn)s.recreate=!0,n.change.push(s);else{const a=i.idxByName,l=o.idxByName;let u;for(u in a)l[u]||s.del.push(u);for(u in l){const c=a[u],f=l[u];c?c.src!==f.src&&s.change.push(f):s.add.push(f)}(s.del.length>0||s.add.length>0||s.change.length>0)&&n.change.push(s)}}else n.add.push([r,o])}return n}function Kn(t,e,n,r){const i=t.db.createObjectStore(e,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(o=>sr(i,o)),i}function sr(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function or(t,e,n){const r={};return vn(e.objectStoreNames,0).forEach(i=>{const o=n.objectStore(i);let s=o.keyPath;const a=tr(Xi(s),s||"",!1,!1,!!o.autoIncrement,s&&typeof s!="string",!0),l=[];for(let c=0;c<o.indexNames.length;++c){const f=o.index(o.indexNames[c]);s=f.keyPath;var u=tr(f.name,s,!!f.unique,!!f.multiEntry,!1,s&&typeof s!="string",!1);l.push(u)}r[i]=$i(i,a,l)}),r}function ar({_novip:t},e,n){const r=n.db.objectStoreNames;for(let i=0;i<r.length;++i){const o=r[i],s=n.objectStore(o);t._hasGetAll="getAll"in s;for(let a=0;a<s.indexNames.length;++a){const l=s.indexNames[a],u=s.index(l).keyPath,c=typeof u=="string"?u:"["+vn(u).join("+")+"]";if(e[o]){const f=e[o].idxByName[c];f&&(f.name=l,delete e[o].idxByName[c],e[o].idxByName[l]=f)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&V.WorkerGlobalScope&&V instanceof V.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}class Co{_parseStoresSpec(e,n){ne(e).forEach(r=>{if(e[r]!==null){var i=e[r].split(",").map((s,a)=>{const l=(s=s.trim()).replace(/([&*]|\+\+)/g,""),u=/^\[/.test(l)?l.match(/^\[(.*)\]$/)[1].split("+"):l;return tr(l,u||null,/\&/.test(s),/\*/.test(s),/\+\+/.test(s),le(u),a===0)}),o=i.shift();if(o.multi)throw new K.Schema("Primary key cannot be multi-valued");i.forEach(s=>{if(s.auto)throw new K.Schema("Only primary key can be marked as autoIncrement (++)");if(!s.keyPath)throw new K.Schema("Index must have a name and cannot be an empty string")}),n[r]=$i(r,o,i)}})}stores(e){const n=this.db;this._cfg.storesSource=this._cfg.storesSource?fe(this._cfg.storesSource,e):e;const r=n._versions,i={};let o={};return r.forEach(s=>{fe(i,s._cfg.storesSource),o=s._cfg.dbschema={},s._parseStoresSpec(i,o)}),n._dbSchema=o,ir(n,[n._allTables,n,n.Transaction.prototype]),Sn(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],ne(o),o),n._storeNames=ne(o),this}upgrade(e){return this._cfg.contentUpgrade=Er(this._cfg.contentUpgrade||U,e),this}}function Cr(t,e){let n=t._dbNamesDB;return n||(n=t._dbNamesDB=new Ze("__dbnames",{addons:[],indexedDB:t,IDBKeyRange:e}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function Or(t){return t&&typeof t.databases=="function"}function lr(t){return Le(function(){return D.letThrough=!0,t()})}function Oo(){var t;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(e){var n=function(){return indexedDB.databases().finally(e)};t=setInterval(n,100),n()}).finally(function(){return clearInterval(t)}):Promise.resolve()}function Bo(t){const e=t._state,{indexedDB:n}=t._deps;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(()=>e.dbOpenError?se(e.dbOpenError):t);Oe&&(e.openCanceller._stackHolder=tt()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;const r=e.openCanceller;function i(){if(e.openCanceller!==r)throw new K.DatabaseClosed("db.open() was cancelled")}let o=e.dbReadyResolve,s=null,a=!1;return B.race([r,(typeof navigator>"u"?B.resolve():Oo()).then(()=>new B((l,u)=>{if(i(),!n)throw new K.MissingAPI;const c=t.name,f=e.autoSchema?n.open(c):n.open(c,Math.round(10*t.verno));if(!f)throw new K.MissingAPI;f.onerror=Ce(u),f.onblocked=Y(t._fireOnBlocked),f.onupgradeneeded=Y(h=>{if(s=f.transaction,e.autoSchema&&!t._options.allowEmptyDB){f.onerror=Ut,s.abort(),f.result.close();const p=n.deleteDatabase(c);p.onsuccess=p.onerror=Y(()=>{u(new K.NoSuchDatabase(`Database ${c} doesnt exist`))})}else{s.onerror=Ce(u);var m=h.oldVersion>Math.pow(2,62)?0:h.oldVersion;a=m<1,t._novip.idbdb=f.result,So(t,m/10,s,u)}},u),f.onsuccess=Y(()=>{s=null;const h=t._novip.idbdb=f.result,m=vn(h.objectStoreNames);if(m.length>0)try{const d=h.transaction((p=m).length===1?p[0]:p,"readonly");e.autoSchema?function({_novip:g},_,y){g.verno=_.version/10;const b=g._dbSchema=or(0,_,y);g._storeNames=vn(_.objectStoreNames,0),Sn(g,[g._allTables],ne(b),b)}(t,h,d):(ar(t,t._dbSchema,d),function(g,_){const y=es(or(0,g.idbdb,_),g._dbSchema);return!(y.add.length||y.change.some(b=>b.add.length||b.change.length))}(t,d)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),rr(t,d)}catch{}var p;Pt.push(t),h.onversionchange=Y(d=>{e.vcFired=!0,t.on("versionchange").fire(d)}),h.onclose=Y(d=>{t.on("close").fire(d)}),a&&function({indexedDB:d,IDBKeyRange:g},_){!Or(d)&&_!=="__dbnames"&&Cr(d,g).put({name:_}).catch(U)}(t._deps,c),l()},u)}))]).then(()=>(i(),e.onReadyBeingFired=[],B.resolve(lr(()=>t.on.ready.fire(t.vip))).then(function l(){if(e.onReadyBeingFired.length>0){let u=e.onReadyBeingFired.reduce(Er,U);return e.onReadyBeingFired=[],B.resolve(lr(()=>u(t.vip))).then(l)}}))).finally(()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(()=>t).catch(l=>{e.dbOpenError=l;try{s&&s.abort()}catch{}return r===e.openCanceller&&t._close(),se(l)}).finally(()=>{e.openComplete=!0,o()})}function ur(t){var e=o=>t.next(o),n=i(e),r=i(o=>t.throw(o));function i(o){return s=>{var a=o(s),l=a.value;return a.done?l:l&&typeof l.then=="function"?l.then(n,r):le(l)?Promise.all(l).then(n,r):n(l)}}return i(e)()}function Po(t,e,n){var r=arguments.length;if(r<2)throw new K.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];n=i.pop();var o=Di(i);return[t,o,n]}function ts(t,e,n,r,i){return B.resolve().then(()=>{const o=D.transless||D,s=t._createTransaction(e,n,t._dbSchema,r),a={trans:s,transless:o};if(r)s.idbtrans=r.idbtrans;else try{s.create(),t._state.PR1398_maxLoop=3}catch(f){return f.name===kr.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>ts(t,e,n,null,i))):se(f)}const l=vr(i);let u;l&&gt();const c=B.follow(()=>{if(u=i.call(s,s),u)if(l){var f=je.bind(null,null);u.then(f,f)}else typeof u.next=="function"&&typeof u.throw=="function"&&(u=ur(u))},a);return(u&&typeof u.then=="function"?B.resolve(u).then(f=>s.active?f:se(new K.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):c.then(()=>u)).then(f=>(r&&s._resolve(),s._completion.then(()=>f))).catch(f=>(s._reject(f),se(f)))})}function sn(t,e,n){const r=le(t)?t.slice():[t];for(let i=0;i<n;++i)r.push(e);return r}const Mo={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(t){return{...t,table(e){const n=t.table(e),{schema:r}=n,i={},o=[];function s(c,f,h){const m=Rt(c),p=i[m]=i[m]||[],d=c==null?0:typeof c=="string"?1:c.length,g=f>0,_={...h,isVirtual:g,keyTail:f,keyLength:d,extractKey:nr(c),unique:!g&&h.unique};return p.push(_),_.isPrimaryKey||o.push(_),d>1&&s(d===2?c[0]:c.slice(0,d-1),f+1,h),p.sort((y,b)=>y.keyTail-b.keyTail),_}const a=s(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[a];for(const c of r.indexes)s(c.keyPath,0,c);function l(c){const f=c.query.index;return f.isVirtual?{...c,query:{index:f,range:(h=c.query.range,m=f.keyTail,{type:h.type===1?2:h.type,lower:sn(h.lower,h.lowerOpen?t.MAX_KEY:t.MIN_KEY,m),lowerOpen:!0,upper:sn(h.upper,h.upperOpen?t.MIN_KEY:t.MAX_KEY,m),upperOpen:!0})}}:c;var h,m}return{...n,schema:{...r,primaryKey:a,indexes:o,getIndexByKeyPath:function(c){const f=i[Rt(c)];return f&&f[0]}},count:c=>n.count(l(c)),query:c=>n.query(l(c)),openCursor(c){const{keyTail:f,isVirtual:h,keyLength:m}=c.query.index;return h?n.openCursor(l(c)).then(p=>p&&function(d){return Object.create(d,{continue:{value:function(_){_!=null?d.continue(sn(_,c.reverse?t.MAX_KEY:t.MIN_KEY,f)):c.unique?d.continue(d.key.slice(0,m).concat(c.reverse?t.MIN_KEY:t.MAX_KEY,f)):d.continue()}},continuePrimaryKey:{value(_,y){d.continuePrimaryKey(sn(_,t.MAX_KEY,f),y)}},primaryKey:{get:()=>d.primaryKey},key:{get(){const _=d.key;return m===1?_[0]:_.slice(0,m)}},value:{get:()=>d.value}})}(p)):n.openCursor(c)}}}}}};function Br(t,e,n,r){return n=n||{},r=r||"",ne(t).forEach(i=>{if(we(e,i)){var o=t[i],s=e[i];if(typeof o=="object"&&typeof s=="object"&&o&&s){const a=Un(o);a!==Un(s)?n[r+i]=e[i]:a==="Object"?Br(o,s,n,r+i+"."):o!==s&&(n[r+i]=e[i])}else o!==s&&(n[r+i]=e[i])}else n[r+i]=void 0}),ne(e).forEach(i=>{we(t,i)||(n[r+i]=e[i])}),n}const Ro={stack:"dbcore",name:"HooksMiddleware",level:2,create:t=>({...t,table(e){const n=t.table(e),{primaryKey:r}=n.schema;return{...n,mutate(o){const s=D.trans,{deleting:a,creating:l,updating:u}=s.table(e).hook;switch(o.type){case"add":if(l.fire===U)break;return s._promise("readwrite",()=>c(o),!0);case"put":if(l.fire===U&&u.fire===U)break;return s._promise("readwrite",()=>c(o),!0);case"delete":if(a.fire===U)break;return s._promise("readwrite",()=>c(o),!0);case"deleteRange":if(a.fire===U)break;return s._promise("readwrite",()=>function(h){return f(h.trans,h.range,1e4)}(o),!0)}return n.mutate(o);function c(h){const m=D.trans,p=h.keys||function(d,g){return g.type==="delete"?g.keys:g.keys||g.values.map(d.extractKey)}(r,h);if(!p)throw new Error("Keys missing");return(h=h.type==="add"||h.type==="put"?{...h,keys:p}:{...h}).type!=="delete"&&(h.values=[...h.values]),h.keys&&(h.keys=[...h.keys]),function(d,g,_){return g.type==="add"?Promise.resolve([]):d.getMany({trans:g.trans,keys:_,cache:"immutable"})}(n,h,p).then(d=>{const g=p.map((_,y)=>{const b=d[y],v={onerror:null,onsuccess:null};if(h.type==="delete")a.fire.call(v,_,b,m);else if(h.type==="add"||b===void 0){const w=l.fire.call(v,_,h.values[y],m);_==null&&w!=null&&(_=w,h.keys[y]=_,r.outbound||Se(h.values[y],r.keyPath,_))}else{const w=Br(b,h.values[y]),E=u.fire.call(v,w,_,b,m);if(E){const x=h.values[y];Object.keys(E).forEach(O=>{we(x,O)?x[O]=E[O]:Se(x,O,E[O])})}}return v});return n.mutate(h).then(({failures:_,results:y,numFailures:b,lastResult:v})=>{for(let w=0;w<p.length;++w){const E=y?y[w]:p[w],x=g[w];E==null?x.onerror&&x.onerror(_[w]):x.onsuccess&&x.onsuccess(h.type==="put"&&d[w]?h.values[w]:E)}return{failures:_,results:y,numFailures:b,lastResult:v}}).catch(_=>(g.forEach(y=>y.onerror&&y.onerror(_)),Promise.reject(_)))})}function f(h,m,p){return n.query({trans:h,values:!1,query:{index:r,range:m},limit:p}).then(({result:d})=>c({type:"delete",keys:d,trans:h}).then(g=>g.numFailures>0?Promise.reject(g.failures[0]):d.length<p?{failures:[],numFailures:0,lastResult:void 0}:f(h,{...m,lower:d[d.length-1],lowerOpen:!0},p)))}}}}})};function ns(t,e,n){try{if(!e||e.keys.length<t.length)return null;const r=[];for(let i=0,o=0;i<e.keys.length&&o<t.length;++i)ce(e.keys[i],t[o])===0&&(r.push(n?Gt(e.values[i]):e.values[i]),++o);return r.length===t.length?r:null}catch{return null}}const To={stack:"dbcore",level:-1,create:t=>({table:e=>{const n=t.table(e);return{...n,getMany:r=>{if(!r.cache)return n.getMany(r);const i=ns(r.keys,r.trans._cache,r.cache==="clone");return i?B.resolve(i):n.getMany(r).then(o=>(r.trans._cache={keys:r.keys,values:r.cache==="clone"?Gt(o):o},o))},mutate:r=>(r.type!=="add"&&(r.trans._cache=null),n.mutate(r))}}})};function Pr(t){return!("from"in t)}const Pe=function(t,e){if(!this){const n=new Pe;return t&&"d"in t&&fe(n,t),n}fe(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0})};function Vt(t,e,n){const r=ce(e,n);if(isNaN(r))return;if(r>0)throw RangeError();if(Pr(t))return fe(t,{from:e,to:n,d:1});const i=t.l,o=t.r;if(ce(n,t.from)<0)return i?Vt(i,e,n):t.l={from:e,to:n,d:1,l:null,r:null},Yr(t);if(ce(e,t.to)>0)return o?Vt(o,e,n):t.r={from:e,to:n,d:1,l:null,r:null},Yr(t);ce(e,t.from)<0&&(t.from=e,t.l=null,t.d=o?o.d+1:1),ce(n,t.to)>0&&(t.to=n,t.r=null,t.d=t.l?t.l.d+1:1);const s=!t.r;i&&!t.l&&Cn(t,i),o&&s&&Cn(t,o)}function Cn(t,e){Pr(e)||function n(r,{from:i,to:o,l:s,r:a}){Vt(r,i,o),s&&n(r,s),a&&n(r,a)}(t,e)}function Do(t,e){const n=cr(e);let r=n.next();if(r.done)return!1;let i=r.value;const o=cr(t);let s=o.next(i.from),a=s.value;for(;!r.done&&!s.done;){if(ce(a.from,i.to)<=0&&ce(a.to,i.from)>=0)return!0;ce(i.from,a.from)<0?i=(r=n.next(a.from)).value:a=(s=o.next(i.from)).value}return!1}function cr(t){let e=Pr(t)?null:{s:0,n:t};return{next(n){const r=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,r)for(;e.n.l&&ce(n,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!r||ce(n,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function Yr(t){var e,n;const r=(((e=t.r)===null||e===void 0?void 0:e.d)||0)-(((n=t.l)===null||n===void 0?void 0:n.d)||0),i=r>1?"r":r<-1?"l":"";if(i){const o=i==="r"?"l":"r",s={...t},a=t[i];t.from=a.from,t.to=a.to,t[i]=a[i],s[i]=a[o],t[o]=s,s.d=Wr(s)}t.d=Wr(t)}function Wr({r:t,l:e}){return(t?e?Math.max(t.d,e.d):t.d:e?e.d:0)+1}dt(Pe.prototype,{add(t){return Cn(this,t),this},addKey(t){return Vt(this,t,t),this},addKeys(t){return t.forEach(e=>Vt(this,e,e)),this},[Hn](){return cr(this)}});const Io={stack:"dbcore",level:0,create:t=>{const e=t.schema.name,n=new Pe(t.MIN_KEY,t.MAX_KEY);return{...t,table:r=>{const i=t.table(r),{schema:o}=i,{primaryKey:s}=o,{extractKey:a,outbound:l}=s,u={...i,mutate:h=>{const m=h.trans,p=m.mutatedParts||(m.mutatedParts={}),d=E=>{const x=`idb://${e}/${r}/${E}`;return p[x]||(p[x]=new Pe)},g=d(""),_=d(":dels"),{type:y}=h;let[b,v]=h.type==="deleteRange"?[h.range]:h.type==="delete"?[h.keys]:h.values.length<50?[[],h.values]:[];const w=h.trans._cache;return i.mutate(h).then(E=>{if(le(b)){y!=="delete"&&(b=E.results),g.addKeys(b);const x=ns(b,w);x||y==="add"||_.addKeys(b),(x||v)&&function(O,k,T,R){function Z(L){const q=O(L.name||"");function xe(J){return J!=null?L.extractKey(J):null}const Ee=J=>L.multiEntry&&le(J)?J.forEach(re=>q.addKey(re)):q.addKey(J);(T||R).forEach((J,re)=>{const _e=T&&xe(T[re]),Pn=R&&xe(R[re]);ce(_e,Pn)!==0&&(_e!=null&&Ee(_e),Pn!=null&&Ee(Pn))})}k.indexes.forEach(Z)}(d,o,x,v)}else if(b){const x={from:b.lower,to:b.upper};_.add(x),g.add(x)}else g.add(n),_.add(n),o.indexes.forEach(x=>d(x.name).add(n));return E})}},c=({query:{index:h,range:m}})=>{var p,d;return[h,new Pe((p=m.lower)!==null&&p!==void 0?p:t.MIN_KEY,(d=m.upper)!==null&&d!==void 0?d:t.MAX_KEY)]},f={get:h=>[s,new Pe(h.key)],getMany:h=>[s,new Pe().addKeys(h.keys)],count:c,query:c,openCursor:c};return ne(f).forEach(h=>{u[h]=function(m){const{subscr:p}=D;if(p){const d=v=>{const w=`idb://${e}/${r}/${v}`;return p[w]||(p[w]=new Pe)},g=d(""),_=d(":dels"),[y,b]=f[h](m);if(d(y.name||"").add(b),!y.isPrimaryKey){if(h!=="count"){const v=h==="query"&&l&&m.values&&i.query({...m,values:!1});return i[h].apply(this,arguments).then(w=>{if(h==="query"){if(l&&m.values)return v.then(({result:x})=>(g.addKeys(x),w));const E=m.values?w.result.map(a):w.result;m.values?g.addKeys(E):_.addKeys(E)}else if(h==="openCursor"){const E=w,x=m.values;return E&&Object.create(E,{key:{get:()=>(_.addKey(E.primaryKey),E.key)},primaryKey:{get(){const O=E.primaryKey;return _.addKey(O),O}},value:{get:()=>(x&&g.addKey(E.primaryKey),E.value)}})}return w})}_.add(n)}}return i[h].apply(this,arguments)}}),u}}}};class Ze{constructor(e,n){this._middlewares={},this.verno=0;const r=Ze.dependencies;this._options=n={addons:Ze.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,...n},this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};const{addons:i}=n;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const o={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:U,dbReadyPromise:null,cancelOpen:U,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var s;o.dbReadyPromise=new B(a=>{o.dbReadyResolve=a}),o.openCanceller=new B((a,l)=>{o.cancelOpen=l}),this._state=o,this.name=e,this.on=Mt(this,"populate","blocked","versionchange","close",{ready:[Er,U]}),this.on.ready.subscribe=Pi(this.on.ready.subscribe,a=>(l,u)=>{Ze.vip(()=>{const c=this._state;if(c.openComplete)c.dbOpenError||B.resolve().then(l),u&&a(l);else if(c.onReadyBeingFired)c.onReadyBeingFired.push(l),u&&a(l);else{a(l);const f=this;u||a(function h(){f.on.ready.unsubscribe(l),f.on.ready.unsubscribe(h)})}})}),this.Collection=(s=this,_t(bo.prototype,function(a,l){this.db=s;let u=Zi,c=null;if(l)try{u=l()}catch(p){c=p}const f=a._ctx,h=f.table,m=h.hook.reading.fire;this._ctx={table:h,index:f.index,isPrimKey:!f.index||h.schema.primKey.keyPath&&f.index===h.schema.primKey.name,range:u,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:c,or:f.or,valueMapper:m!==Lt?m:null}})),this.Table=function(a){return _t(yo.prototype,function(l,u,c){this.db=a,this._tx=c,this.name=l,this.schema=u,this.hook=a._allTables[l]?a._allTables[l].hook:Mt(null,{creating:[io,U],reading:[ro,Lt],updating:[oo,U],deleting:[so,U]})})}(this),this.Transaction=function(a){return _t(ko.prototype,function(l,u,c,f,h){this.db=a,this.mode=l,this.storeNames=u,this.schema=c,this.chromeTransactionDurability=f,this.idbtrans=null,this.on=Mt(this,"complete","error","abort"),this.parent=h||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new B((m,p)=>{this._resolve=m,this._reject=p}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},m=>{var p=this.active;return this.active=!1,this.on.error.fire(m),this.parent?this.parent._reject(m):p&&this.idbtrans&&this.idbtrans.abort(),se(m)})})}(this),this.Version=function(a){return _t(Co.prototype,function(l){this.db=a,this._cfg={version:l,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(a){return _t(Ji.prototype,function(l,u,c){this.db=a,this._ctx={table:l,index:u===":id"?null:u,or:c};const f=a._deps.indexedDB;if(!f)throw new K.MissingAPI;this._cmp=this._ascending=f.cmp.bind(f),this._descending=(h,m)=>f.cmp(m,h),this._max=(h,m)=>f.cmp(h,m)>0?h:m,this._min=(h,m)=>f.cmp(h,m)<0?h:m,this._IDBKeyRange=a._deps.IDBKeyRange})}(this),this.on("versionchange",a=>{a.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",a=>{!a.newVersion||a.newVersion<a.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${a.oldVersion/10}`)}),this._maxKey=Ht(n.IDBKeyRange),this._createTransaction=(a,l,u,c)=>new this.Transaction(a,l,u,this._options.chromeTransactionDurability,c),this._fireOnBlocked=a=>{this.on("blocked").fire(a),Pt.filter(l=>l.name===this.name&&l!==this&&!l._state.vcFired).map(l=>l.on("versionchange").fire(a))},this.use(Mo),this.use(Ro),this.use(Io),this.use(To),this.vip=Object.create(this,{_vip:{value:!0}}),i.forEach(a=>a(this))}version(e){if(isNaN(e)||e<.1)throw new K.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new K.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);const n=this._versions;var r=n.filter(i=>i._cfg.version===e)[0];return r||(r=new this.Version(e),n.push(r),n.sort(Ao),r.stores({}),this._state.autoSchema=!1,r)}_whenReady(e){return this.idbdb&&(this._state.openComplete||D.letThrough||this._vip)?e():new B((n,r)=>{if(this._state.openComplete)return r(new K.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void r(new K.DatabaseClosed);this.open().catch(U)}this._state.dbReadyPromise.then(n,r)}).then(e)}use({stack:e,create:n,level:r,name:i}){i&&this.unuse({stack:e,name:i});const o=this._middlewares[e]||(this._middlewares[e]=[]);return o.push({stack:e,create:n,level:r??10,name:i}),o.sort((s,a)=>s.level-a.level),this}unuse({stack:e,name:n,create:r}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(i=>r?i.create!==r:!!n&&i.name!==n)),this}open(){return Bo(this)}_close(){const e=this._state,n=Pt.indexOf(this);if(n>=0&&Pt.splice(n,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}e.dbReadyPromise=new B(r=>{e.dbReadyResolve=r}),e.openCanceller=new B((r,i)=>{e.cancelOpen=i})}close(){this._close();const e=this._state;this._options.autoOpen=!1,e.dbOpenError=new K.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){const e=arguments.length>0,n=this._state;return new B((r,i)=>{const o=()=>{this.close();var s=this._deps.indexedDB.deleteDatabase(this.name);s.onsuccess=Y(()=>{(function({indexedDB:a,IDBKeyRange:l},u){!Or(a)&&u!=="__dbnames"&&Cr(a,l).delete(u).catch(U)})(this._deps,this.name),r()}),s.onerror=Ce(i),s.onblocked=this._fireOnBlocked};if(e)throw new K.InvalidArgument("Arguments not allowed in db.delete()");n.isBeingOpened?n.dbReadyPromise.then(o):o()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return ne(this._allTables).map(e=>this._allTables[e])}transaction(){const e=Po.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,n,r){let i=D.trans;i&&i.db===this&&e.indexOf("!")===-1||(i=null);const o=e.indexOf("?")!==-1;let s,a;e=e.replace("!","").replace("?","");try{if(a=n.map(u=>{var c=u instanceof this.Table?u.name:u;if(typeof c!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return c}),e=="r"||e==="readonly")s="readonly";else{if(e!="rw"&&e!="readwrite")throw new K.InvalidArgument("Invalid transaction mode: "+e);s="readwrite"}if(i){if(i.mode==="readonly"&&s==="readwrite"){if(!o)throw new K.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&a.forEach(u=>{if(i&&i.storeNames.indexOf(u)===-1){if(!o)throw new K.SubTransaction("Table "+u+" not included in parent transaction.");i=null}}),o&&i&&!i.active&&(i=null)}}catch(u){return i?i._promise(null,(c,f)=>{f(u)}):se(u)}const l=ts.bind(null,this,s,a,i,r);return i?i._promise(s,l,"lock"):D.trans?yt(D.transless,()=>this._whenReady(l)):this._whenReady(l)}table(e){if(!we(this._allTables,e))throw new K.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}}const Ko=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class jo{constructor(e){this._subscribe=e}subscribe(e,n,r){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:n,complete:r})}[Ko](){return this}}function rs(t,e){return ne(e).forEach(n=>{Cn(t[n]||(t[n]=new Pe),e[n])}),t}function is(t){return new jo(e=>{const n=vr(t);let r=!1,i={},o={};const s={get closed(){return r},unsubscribe:()=>{r=!0,Ue.storagemutated.unsubscribe(c)}};e.start&&e.start(s);let a=!1,l=!1;function u(){return ne(o).some(h=>i[h]&&Do(i[h],o[h]))}const c=h=>{rs(i,h),u()&&f()},f=()=>{if(a||r)return;i={};const h={},m=function(p){n&&gt();const d=()=>Le(t,{subscr:p,trans:null}),g=D.trans?yt(D.transless,d):d();return n&&g.then(je,je),g}(h);l||(Ue("storagemutated",c),l=!0),a=!0,Promise.resolve(m).then(p=>{a=!1,r||(u()?f():(i={},o=h,e.next&&e.next(p)))},p=>{a=!1,e.error&&e.error(p),s.unsubscribe()})};return f(),s})}let fr;try{fr={indexedDB:V.indexedDB||V.mozIndexedDB||V.webkitIndexedDB||V.msIndexedDB,IDBKeyRange:V.IDBKeyRange||V.webkitIDBKeyRange}}catch{fr={indexedDB:null,IDBKeyRange:null}}const He=Ze;function hn(t){let e=Te;try{Te=!0,Ue.storagemutated.fire(t)}finally{Te=e}}dt(He,{...an,delete:t=>new He(t,{addons:[]}).delete(),exists:t=>new He(t,{addons:[]}).open().then(e=>(e.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(t){try{return function({indexedDB:e,IDBKeyRange:n}){return Or(e)?Promise.resolve(e.databases()).then(r=>r.map(i=>i.name).filter(i=>i!=="__dbnames")):Cr(e,n).toCollection().primaryKeys()}(He.dependencies).then(t)}catch{return se(new K.MissingAPI)}},defineClass:()=>function(t){fe(this,t)},ignoreTransaction:t=>D.trans?yt(D.transless,t):t(),vip:lr,async:function(t){return function(){try{var e=ur(t.apply(this,arguments));return e&&typeof e.then=="function"?e:B.resolve(e)}catch(n){return se(n)}}},spawn:function(t,e,n){try{var r=ur(t.apply(n,e||[]));return r&&typeof r.then=="function"?r:B.resolve(r)}catch(i){return se(i)}},currentTransaction:{get:()=>D.trans||null},waitFor:function(t,e){const n=B.resolve(typeof t=="function"?He.ignoreTransaction(t):t).timeout(e||6e4);return D.trans?D.trans.waitFor(n):n},Promise:B,debug:{get:()=>Oe,set:t=>{Ki(t,t==="dexie"?()=>!0:Gi)}},derive:ut,extend:fe,props:dt,override:Pi,Events:Mt,on:Ue,liveQuery:is,extendObservabilitySet:rs,getByKeyPath:Ie,setByKeyPath:Se,delByKeyPath:function(t,e){typeof e=="string"?Se(t,e,void 0):"length"in e&&[].map.call(e,function(n){Se(t,n,void 0)})},shallowClone:Ti,deepClone:Gt,getObjectDiff:Br,cmp:ce,asap:Mi,minKey:-(1/0),addons:[],connections:Pt,errnames:kr,dependencies:fr,semVer:"3.2.3",version:"3.2.3".split(".").map(t=>parseInt(t)).reduce((t,e,n)=>t+e/Math.pow(10,2*n))}),He.maxKey=Ht(He.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Ue("storagemutated",t=>{if(!Te){let e;Bn?(e=document.createEvent("CustomEvent"),e.initCustomEvent("x-storagemutated-1",!0,!0,t)):e=new CustomEvent("x-storagemutated-1",{detail:t}),Te=!0,dispatchEvent(e),Te=!1}}),addEventListener("x-storagemutated-1",({detail:t})=>{Te||hn(t)}));let Te=!1;if(typeof BroadcastChannel<"u"){const t=new BroadcastChannel("x-storagemutated-1");typeof t.unref=="function"&&t.unref(),Ue("storagemutated",e=>{Te||t.postMessage(e)}),t.onmessage=e=>{e.data&&hn(e.data)}}else if(typeof self<"u"&&typeof navigator<"u"){Ue("storagemutated",e=>{try{Te||(typeof localStorage<"u"&&localStorage.setItem("x-storagemutated-1",JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(n=>n.postMessage({type:"x-storagemutated-1",changedParts:e})))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",e=>{if(e.key==="x-storagemutated-1"){const n=JSON.parse(e.newValue);n&&hn(n.changedParts)}});const t=self.document&&navigator.serviceWorker;t&&t.addEventListener("message",function({data:e}){e&&e.type==="x-storagemutated-1"&&hn(e.changedParts)})}B.rejectionMapper=function(t,e){if(!t||t instanceof ct||t instanceof TypeError||t instanceof SyntaxError||!t.name||!zr[t.name])return t;var n=new zr[t.name](e||t.message,t);return"stack"in t&&De(n,"stack",{get:function(){return this.inner.stack}}),n},Ki(Oe,Gi);class zo extends Ze{constructor(){super("bookDB");Mr(this,"books");this.version(5).stores({books:"++id, meta, contents, spine, toc, files, progress"})}}const Ae=new zo,No=async t=>{for(let e of await Ae.books.toArray())if(e.meta.title===t.meta.title)return e.id;try{return await Ae.books.add(t)}catch(e){console.log(e)}};function ss(t){return t.arrayBuffer?t.arrayBuffer():new Promise((e,n)=>{const r=new FileReader;r.addEventListener("loadend",()=>{e(r.result)}),r.addEventListener("error",n),r.readAsArrayBuffer(t)})}async function Fo(t){const e=await ss(t);return new Uint8Array(e)}function os(t){return typeof Blob<"u"&&t instanceof Blob}function Yt(t){return typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}const Lo=typeof process<"u"&&process.versions&&typeof process.versions.node<"u"&&typeof process.versions.electron>"u";function qo(t){return t.byteOffset===0&&t.byteLength===t.buffer.byteLength}class Gr{constructor(e){this.typedArray=e instanceof ArrayBuffer||Yt(e)?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}async getLength(){return this.typedArray.byteLength}async read(e,n){return new Uint8Array(this.typedArray.buffer,this.typedArray.byteOffset+e,n)}}class Zr{constructor(e){this.blob=e}async getLength(){return this.blob.size}async read(e,n){const r=this.blob.slice(e,e+n),i=await ss(r);return new Uint8Array(i)}async sliceAsBlob(e,n,r=""){return this.blob.slice(e,e+n,r)}}function Uo(t,e){var n=Uint8Array;if(t[0]==3&&t[1]==0)return e||new n(0);var r=Vo,i=as,o=Ho,s=ls,a=e==null;a&&(e=new n(t.length>>>2<<3));for(var l=0,u=0,c=0,f=0,h=0,m=0,p=0,d=0,g=0,_,y;l==0;){if(l=r(t,g,1),u=r(t,g+1,2),g+=3,u==0){g&7&&(g+=8-(g&7));var b=(g>>>3)+4,v=t[b-4]|t[b-3]<<8;a&&(e=jn(e,d+v)),e.set(new n(t.buffer,t.byteOffset+b,v),d),g=b+v<<3,d+=v;continue}if(a&&(e=jn(e,d+(1<<17))),u==1&&(_=I.flmap,y=I.fdmap,m=(1<<9)-1,p=(1<<5)-1),u==2){c=i(t,g,5)+257,f=i(t,g+5,5)+1,h=i(t,g+10,4)+4,g+=14;for(var w=0;w<38;w+=2)I.itree[w]=0,I.itree[w+1]=0;for(var E=1,w=0;w<h;w++){var x=i(t,g+w*3,3);I.itree[(I.ordr[w]<<1)+1]=x,x>E&&(E=x)}g+=3*h,Tt(I.itree,E),Dt(I.itree,E,I.imap),_=I.lmap,y=I.dmap,g=o(I.imap,(1<<E)-1,c+f,t,g,I.ttree);var O=Qr(I.ttree,0,c,I.ltree);m=(1<<O)-1;var k=Qr(I.ttree,c,f,I.dtree);p=(1<<k)-1,Tt(I.ltree,O),Dt(I.ltree,O,_),Tt(I.dtree,k),Dt(I.dtree,k,y)}for(;;){var T=_[s(t,g)&m];g+=T&15;var R=T>>>4;if(!(R>>>8))e[d++]=R;else{if(R==256)break;var Z=d+R-254;if(R>264){var L=I.ldef[R-257];Z=d+(L>>>3)+i(t,g,L&7),g+=L&7}var q=y[s(t,g)&p];g+=q&15;var xe=q>>>4,Ee=I.ddef[xe],J=(Ee>>>4)+r(t,g,Ee&15);for(g+=Ee&15,a&&(e=jn(e,d+(1<<17)));d<Z;)e[d]=e[d++-J],e[d]=e[d++-J],e[d]=e[d++-J],e[d]=e[d++-J];d=Z}}}return e.length==d?e:e.slice(0,d)}function jn(t,e){var n=t.length;if(e<=n)return t;var r=new Uint8Array(Math.max(n<<1,e));return r.set(t,0),r}function Ho(t,e,n,r,i,o){for(var s=as,a=ls,l=0;l<n;){var u=t[a(r,i)&e];i+=u&15;var c=u>>>4;if(c<=15)o[l]=c,l++;else{var f=0,h=0;c==16?(h=3+s(r,i,2),i+=2,f=o[l-1]):c==17?(h=3+s(r,i,3),i+=3):c==18&&(h=11+s(r,i,7),i+=7);for(var m=l+h;l<m;)o[l]=f,l++}}return i}function Qr(t,e,n,r){for(var i=0,o=0,s=r.length>>>1;o<n;){var a=t[o+e];r[o<<1]=0,r[(o<<1)+1]=a,a>i&&(i=a),o++}for(;o<s;)r[o<<1]=0,r[(o<<1)+1]=0,o++;return i}function Tt(t,e){for(var n=t.length,r,i,o,s,a,l=I.bl_count,s=0;s<=e;s++)l[s]=0;for(s=1;s<n;s+=2)l[t[s]]++;var u=I.next_code;for(r=0,l[0]=0,i=1;i<=e;i++)r=r+l[i-1]<<1,u[i]=r;for(o=0;o<n;o+=2)a=t[o+1],a!=0&&(t[o]=u[a],u[a]++)}function Dt(t,e,n){for(var r=t.length,i=I.rev15,o=0;o<r;o+=2)if(t[o+1]!=0)for(var s=o>>1,a=t[o+1],l=s<<4|a,u=e-a,c=t[o]<<u,f=c+(1<<u);c!=f;){var h=i[c]>>>15-e;n[h]=l,c++}}function Jr(t,e){for(var n=I.rev15,r=15-e,i=0;i<t.length;i+=2){var o=t[i]<<e-t[i+1];t[i]=n[o]>>>r}}function as(t,e,n){return(t[e>>>3]|t[(e>>>3)+1]<<8)>>>(e&7)&(1<<n)-1}function Vo(t,e,n){return(t[e>>>3]|t[(e>>>3)+1]<<8|t[(e>>>3)+2]<<16)>>>(e&7)&(1<<n)-1}function ls(t,e){return(t[e>>>3]|t[(e>>>3)+1]<<8|t[(e>>>3)+2]<<16)>>>(e&7)}const I=function(){var t=Uint16Array,e=Uint32Array;return{next_code:new t(16),bl_count:new t(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new t(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new e(32),flmap:new t(512),fltree:[],fdmap:new t(32),fdtree:[],lmap:new t(32768),ltree:[],ttree:[],dmap:new t(32768),dtree:[],imap:new t(512),itree:[],rev15:new t(1<<15),lhst:new e(286),dhst:new e(30),ihst:new e(19),lits:new e(15e3),strt:new t(1<<16),prev:new t(1<<15)}}();(function(){for(var t=32768,e=0;e<t;e++){var n=e;n=(n&2863311530)>>>1|(n&1431655765)<<1,n=(n&3435973836)>>>2|(n&858993459)<<2,n=(n&4042322160)>>>4|(n&252645135)<<4,n=(n&4278255360)>>>8|(n&16711935)<<8,I.rev15[e]=(n>>>16|n<<16)>>>17}function r(i,o,s){for(;o--!=0;)i.push(0,s)}for(var e=0;e<32;e++)I.ldef[e]=I.of0[e]<<3|I.exb[e],I.ddef[e]=I.df0[e]<<4|I.dxb[e];r(I.fltree,144,8),r(I.fltree,255-143,9),r(I.fltree,279-255,7),r(I.fltree,287-279,8),Tt(I.fltree,9),Dt(I.fltree,9,I.flmap),Jr(I.fltree,9),r(I.fdtree,32,5),Tt(I.fdtree,5),Dt(I.fdtree,5,I.fdmap),Jr(I.fdtree,5),r(I.itree,19,0),r(I.ltree,286,0),r(I.dtree,30,0),r(I.ttree,320,0)})();const Xr={table:function(){for(var t=new Uint32Array(256),e=0;e<256;e++){for(var n=e,r=0;r<8;r++)n&1?n=3988292384^n>>>1:n=n>>>1;t[e]=n}return t}(),update:function(t,e,n,r){for(var i=0;i<r;i++)t=Xr.table[(t^e[n+i])&255]^t>>>8;return t},crc:function(t,e,n){return Xr.update(4294967295,t,e,n)^4294967295}};function Yo(t,e){return Uo(t,e)}const $r={numWorkers:1,workerURL:"",useWorkers:!1};let Wo=0;const mn=[];function zn(t){return new Promise((e,n)=>{const r=new Worker(t);r.onmessage=i=>{i.data==="start"?(r.onerror=void 0,r.onmessage=void 0,e(r)):n(new Error(`unexpected message: ${i.data}`))},r.onerror=n})}function Go(t,e){return t.require?t.require(e):{}}(function(){if(Lo){const{Worker:t}=Go(gs,"worker_threads");return{async createWorker(e){return new t(e)},addEventListener(e,n){e.on("message",r=>{n({target:e,data:r})})},async terminate(e){await e.terminate()}}}else return{async createWorker(t){try{return await zn(t)}catch{console.warn("could not load worker:",t)}let e;try{const n=await fetch(t,{mode:"cors"});if(!n.ok)throw new Error(`could not load: ${t}`);e=await n.text(),t=URL.createObjectURL(new Blob([e],{type:"application/javascript"}));const r=await zn(t);return $r.workerURL=t,r}catch{console.warn("could not load worker via fetch:",t)}if(e!==void 0)try{t=`data:application/javascript;base64,${btoa(e)}`;const n=await zn(t);return $r.workerURL=t,n}catch{console.warn("could not load worker via dataURI")}throw console.warn("workers will not be used"),new Error("can not start workers")},addEventListener(t,e){t.addEventListener("message",e)},async terminate(t){t.terminate()}}})();function Zo(t,e,n,r){const i=new Uint8Array(e);Yo(t,i),r(n?new Blob([i],{type:n}):i.buffer)}async function Qo(){if(mn.length!==0)for(;mn.length;){const{src:t,uncompressedSize:e,type:n,resolve:r}=mn.shift();let i=t;os(t)&&(i=await Fo(t)),Zo(i,e,n,r)}}function us(t,e,n){return new Promise((r,i)=>{mn.push({src:t,uncompressedSize:e,type:n,resolve:r,reject:i,id:Wo++}),Qo()})}function Jo(t,e){const n=t&31,r=(t>>5&15)-1,i=(t>>9&127)+1980,o=0,s=(e&31)*2,a=e>>5&63,l=e>>11&31;return new Date(i,r,n,l,a,s,o)}class Xo{constructor(e,n){this._reader=e,this._rawEntry=n,this.name=n.name,this.nameBytes=n.nameBytes,this.size=n.uncompressedSize,this.compressedSize=n.compressedSize,this.comment=n.comment,this.commentBytes=n.commentBytes,this.compressionMethod=n.compressionMethod,this.lastModDate=Jo(n.lastModFileDate,n.lastModFileTime),this.isDirectory=n.uncompressedSize===0&&n.name.endsWith("/"),this.encrypted=!!(n.generalPurposeBitFlag&1),this.externalFileAttributes=n.externalFileAttributes,this.versionMadeBy=n.versionMadeBy}async blob(e="application/octet-stream"){return await ua(this._reader,this._rawEntry,e)}async arrayBuffer(){return await la(this._reader,this._rawEntry)}async text(){const e=await this.arrayBuffer();return It(new Uint8Array(e))}async json(){const e=await this.text();return JSON.parse(e)}}const Nn=22,$o=65535,ea=101010256,ta=101075792;async function ht(t,e,n){return await t.read(e,n)}async function dr(t,e,n,r){return t.sliceAsBlob?await t.sliceAsBlob(e,n,r):await t.read(e,n)}const na={unsigned(){return 0}};function oe(t,e){return t[e]+t[e+1]*256}function ue(t,e){return t[e]+t[e+1]*256+t[e+2]*65536+t[e+3]*16777216}function Ye(t,e){return ue(t,e)+ue(t,e+4)*4294967296}const ra=new TextDecoder;function It(t,e){return Yt(t.buffer)&&(t=new Uint8Array(t)),ra.decode(t)}async function ia(t,e){const n=Math.min(Nn+$o,e),r=e-n,i=await ht(t,r,n);for(let o=n-Nn;o>=0;--o){if(ue(i,o)!==ea)continue;const s=new Uint8Array(i.buffer,i.byteOffset+o,i.byteLength-o),a=oe(s,4);if(a!==0)throw new Error(`multi-volume zip files are not supported. This is volume: ${a}`);const l=oe(s,10),u=ue(s,12),c=ue(s,16),f=oe(s,20),h=s.length-Nn;if(f!==h)throw new Error(`invalid comment length. expected: ${h}, actual: ${f}`);const m=new Uint8Array(s.buffer,s.byteOffset+22,f),p=It(m);return l===65535||c===4294967295?await oa(t,r+o,p,m):await cs(t,c,u,l,p,m)}throw new Error("could not find end of central directory. maybe not zip file")}const sa=117853008;async function oa(t,e,n,r){const i=e-20,o=await ht(t,i,20);if(ue(o,0)!==sa)throw new Error("invalid zip64 end of central directory locator signature");const s=Ye(o,8),a=await ht(t,s,56);if(ue(a,0)!==ta)throw new Error("invalid zip64 end of central directory record signature");const l=Ye(a,32),u=Ye(a,40),c=Ye(a,48);return cs(t,c,u,l,n,r)}const aa=33639248;async function cs(t,e,n,r,i,o){let s=0;const a=await ht(t,e,n),l=[];for(let c=0;c<r;++c){const f=a.subarray(s,s+46),h=ue(f,0);if(h!==aa)throw new Error(`invalid central directory file header signature: 0x${h.toString(16)}`);const m={versionMadeBy:oe(f,4),versionNeededToExtract:oe(f,6),generalPurposeBitFlag:oe(f,8),compressionMethod:oe(f,10),lastModFileTime:oe(f,12),lastModFileDate:oe(f,14),crc32:ue(f,16),compressedSize:ue(f,20),uncompressedSize:ue(f,24),fileNameLength:oe(f,28),extraFieldLength:oe(f,30),fileCommentLength:oe(f,32),internalFileAttributes:oe(f,36),externalFileAttributes:ue(f,38),relativeOffsetOfLocalHeader:ue(f,42)};if(m.generalPurposeBitFlag&64)throw new Error("strong encryption is not supported");s+=46;const p=a.subarray(s,s+m.fileNameLength+m.extraFieldLength+m.fileCommentLength);m.nameBytes=p.slice(0,m.fileNameLength),m.name=It(m.nameBytes);const d=m.fileNameLength+m.extraFieldLength,g=p.slice(m.fileNameLength,d);m.extraFields=[];let _=0;for(;_<g.length-3;){const b=oe(g,_+0),v=oe(g,_+2),w=_+4,E=w+v;if(E>g.length)throw new Error("extra field length exceeds extra field buffer size");m.extraFields.push({id:b,data:g.slice(w,E)}),_=E}if(m.commentBytes=p.slice(d,d+m.fileCommentLength),m.comment=It(m.commentBytes),s+=p.length,m.uncompressedSize===4294967295||m.compressedSize===4294967295||m.relativeOffsetOfLocalHeader===4294967295){const b=m.extraFields.find(E=>E.id===1);if(!b)throw new Error("expected zip64 extended information extra field");const v=b.data;let w=0;if(m.uncompressedSize===4294967295){if(w+8>v.length)throw new Error("zip64 extended information extra field does not include uncompressed size");m.uncompressedSize=Ye(v,w),w+=8}if(m.compressedSize===4294967295){if(w+8>v.length)throw new Error("zip64 extended information extra field does not include compressed size");m.compressedSize=Ye(v,w),w+=8}if(m.relativeOffsetOfLocalHeader===4294967295){if(w+8>v.length)throw new Error("zip64 extended information extra field does not include relative header offset");m.relativeOffsetOfLocalHeader=Ye(v,w),w+=8}}const y=m.extraFields.find(b=>b.id===28789&&b.data.length>=6&&b.data[0]===1&&ue(b.data,1),na.unsigned(m.nameBytes));if(y&&(m.fileName=It(y.data.slice(5))),m.compressionMethod===0){let b=m.uncompressedSize;if(m.generalPurposeBitFlag&1&&(b+=12),m.compressedSize!==b)throw new Error(`compressed size mismatch for stored file: ${m.compressedSize} != ${b}`)}l.push(m)}return{zip:{comment:i,commentBytes:o},entries:l.map(c=>new Xo(t,c))}}async function fs(t,e){if(e.generalPurposeBitFlag&1)throw new Error("encrypted entries not supported");const n=await ht(t,e.relativeOffsetOfLocalHeader,30),r=await t.getLength(),i=ue(n,0);if(i!==67324752)throw new Error(`invalid local file header signature: 0x${i.toString(16)}`);const o=oe(n,26),s=oe(n,28),a=e.relativeOffsetOfLocalHeader+n.length+o+s;let l;if(e.compressionMethod===0)l=!1;else if(e.compressionMethod===8)l=!0;else throw new Error(`unsupported compression method: ${e.compressionMethod}`);const u=a,c=u+e.compressedSize;if(e.compressedSize!==0&&c>r)throw new Error(`file data overflows file bounds: ${u} +  ${e.compressedSize}  > ${r}`);return{decompress:l,fileDataStart:u}}async function la(t,e){const{decompress:n,fileDataStart:r}=await fs(t,e);if(!n){const s=await ht(t,r,e.compressedSize);return qo(s)?s.buffer:s.slice().buffer}const i=await dr(t,r,e.compressedSize);return await us(i,e.uncompressedSize)}async function ua(t,e,n){const{decompress:r,fileDataStart:i}=await fs(t,e);if(!r){const a=await dr(t,i,e.compressedSize,n);return os(a)?a:new Blob([Yt(a.buffer)?new Uint8Array(a):a],{type:n})}const o=await dr(t,i,e.compressedSize);return await us(o,e.uncompressedSize,n)}async function ca(t){let e;if(typeof Blob<"u"&&t instanceof Blob)e=new Zr(t);else if(t instanceof ArrayBuffer||t&&t.buffer&&t.buffer instanceof ArrayBuffer)e=new Gr(t);else if(Yt(t)||Yt(t.buffer))e=new Gr(t);else if(typeof t=="string"){const r=await fetch(t);if(!r.ok)throw new Error(`failed http request ${t}, status: ${r.status}: ${r.statusText}`);const i=await r.blob();e=new Zr(i)}else if(typeof t.getLength=="function"&&typeof t.read=="function")e=t;else throw new Error("unsupported source type");const n=await e.getLength();if(n>Number.MAX_SAFE_INTEGER)throw new Error(`file too large. size: ${n}. Only file sizes up 4503599627370496 bytes are supported`);return await ia(e,n)}async function fa(t){const{zip:e,entries:n}=await ca(t);return{zip:e,entries:Object.fromEntries(n.map(r=>[r.name,r]))}}const Wt=new DOMParser,da=(t,e)=>{const n=Wt.parseFromString(t,"text/xml"),{title:r,author:i,coverId:o}=ma(n.querySelector("metadata")),s=pa(n.querySelector("manifest")),a=ga(n.querySelector("spine"),s),l=s.has(o)?e.get(s.get(o)):void 0;return{meta:{title:r,author:i,cover:l},spine:a}},ha=async t=>{const{entries:e}=await fa(t),n=new Map,r=new Map,i=new Map,o=new Map;let s="",a="";for(const[l,u]of Object.entries(e))switch(l.substring(l.lastIndexOf("."))){case".opf":a=await u.text();break;case".png":case".jpg":case".jpeg":case".gif":{const c=await u.blob();n.set(Fe(l),c);break}case".css":{const c=await u.text();i.set(l,_a(c,"#container"));break}case".htm":case".xml":case".html":case".xhtml":{const c=await u.text();r.set(Fe(l),c);break}case".otf":case".ttf":case".woff":{const c=await u.blob();o.set(Fe(l),c);break}case".ncx":{s=await u.text();break}}return{images:n,htmls:r,styles:i,fonts:o,tocNcx:s,opf:a}},ma=t=>{var i;const e=t.querySelector("title").textContent,n=Array.from(t.querySelectorAll("creator")).map(o=>o.textContent),r=(i=t.querySelector("[name='cover']"))==null?void 0:i.attributes.content.value;return{title:e,author:n,coverId:r}},pa=t=>{const e=new Map;for(const n of t.children)e.set(n.attributes.id.value,Fe(n.attributes.href.value));return e},ga=(t,e)=>Array.from(t.children).map(n=>e.get(n.attributes.idref.value)),Fe=t=>decodeURI(t.split("\\").pop().split("/").pop()),ya=(t,e)=>{const n=Wt.parseFromString(t,"application/xhtml+xml").querySelector("img");if(n&&n.hasAttribute("src"))return e.get(Fe(n.getAttribute("src")))},ba=t=>{let e=Wt.parseFromString(t,"application/xhtml+xml");e.querySelector("parsererror")&&(e=Wt.parseFromString(t,"text/html"));for(const r of e.querySelectorAll("[src],[href], image"))switch(r.tagName){case"img":{const i=Fe(r.getAttribute("src"));r.setAttribute("src","ESSENCE-READER-IMAGE-"+i),r.style.cssText+="max-height: 100%; max-width: 100%; object-fit: scale-down;";break}case"image":{const i=Fe(r.getAttributeNS("http://www.w3.org/1999/xlink","href"));r.setAttributeNS("http://www.w3.org/1999/xlink","href","ESSENCE-READER-IMAGE-"+i);break}default:{r.getAttribute("src")!==null&&!r.getAttribute("src").includes("http")&&r.removeAttribute("src");break}}return e.body.innerHTML},_a=(t,e)=>{let n=[];return t=t.replace(/@(-moz-|-webkit-|-ms-)*keyframes\s(.*?){([0-9%a-zA-Z,\s.]*{(.*?)})*[\s\n]*}/g,r=>n.push(r)&&"__keyframes__"),t=t.replace(/([^\r\n,{}]+)(,(?=[^}]*{)|\s*{)/g,r=>r.trim()[0]==="@"?r:r.replace(/(\s*)/,"$1"+e+" ")),t.replace(/__keyframes__/g,r=>n.shift())},va=(t,e)=>{const n=[],r=Wt.parseFromString(t,"application/xml").querySelectorAll("navPoint");for(const i of r){const o=i.querySelector("text").textContent;let s=Fe(i.querySelector("content").attributes.src.value);s.includes("#")&&(s=s.substring(0,s.indexOf("#")));const a=e.get(s).index,l=i.parentElement.nodeName==="navPoint";n.push({name:o,index:a,isChild:l})}return n},wa=async t=>{try{const{images:e,htmls:n,styles:r,fonts:i,tocNcx:o,opf:s}=await ha(t),{meta:a,spine:l}=da(s,e);a.cover===void 0&&(a.cover=ya(n.get(l[0]),e));const u=new Map;l.forEach((f,h)=>{u.set(f,{index:h,html:n.has(f)?ba(n.get(f)):null})});const c=va(o,u);return{meta:a,contents:u,spine:l,toc:c,files:{images:e,fonts:i,styles:r},progress:0}}catch{throw new Error(t.name+" does not appear to be a valid EPUB file")}},ka=(t,e,n)=>t.replace(/url\((?!['"]?(?:data):)['"]?([^'"\)]*)['"]?\)/g,function(i,o){const s=o.split("\\").pop().split("/").pop(),a=[".png",".jpg",".jpeg",".gif"],l=[".otf",".ttf",".woff"];return a.some(u=>s.endsWith(u))&&e.has(s)?"url("+URL.createObjectURL(e.get(s))+")":l.some(u=>s.endsWith(u))&&n.has(s)?"url("+URL.createObjectURL(n.get(s))+")":""}),Ea=(t,e)=>t.replace(/ESSENCE-READER-IMAGE-([^?#"']*)/g,function(n,r){return e.has(r)?URL.createObjectURL(e.get(r)):""}),xa=t=>{try{return t.contents.forEach((e,n,r)=>r.set(n,{index:e.index,html:Ea(e.html,t.files.images)})),t.files.styles.forEach((e,n,r)=>r.set(n,ka(e,t.files.images,t.files.fonts))),t}catch{alert("An error occured when opening book, please try removing it and adding it again")}};function ds(t){const e=t-1;return e*e*e+1}function Xe(t,{delay:e=0,duration:n=400,easing:r=On}={}){const i=+getComputedStyle(t).opacity;return{delay:e,duration:n,easing:r,css:o=>`opacity: ${o*i}`}}function ei(t,{delay:e=0,duration:n=400,easing:r=ds,x:i=0,y:o=0,opacity:s=0}={}){const a=getComputedStyle(t),l=+a.opacity,u=a.transform==="none"?"":a.transform,c=l*(1-s),[f,h]=Ir(i),[m,p]=Ir(o);return{delay:e,duration:n,easing:r,css:(d,g)=>`
			transform: ${u} translate(${(1-d)*f}${h}, ${(1-d)*m}${p});
			opacity: ${l-c*g}`}}const Aa=t=>({}),ti=t=>({}),Sa=t=>({}),ni=t=>({}),Ca=t=>({}),ri=t=>({});function Oa(t){let e,n,r,i,o,s,a,l;const u=t[2].leftbar,c=kt(u,t,t[1],ri),f=t[2].toptext,h=kt(f,t,t[1],ni),m=t[2].rightbar,p=kt(m,t,t[1],ti);return{c(){e=M("div"),n=M("div"),c&&c.c(),r=N(),i=M("div"),h&&h.c(),o=N(),s=M("div"),p&&p.c(),P(n,"class","buttonbar svelte-ybjroz"),P(n,"id","leftbar"),P(i,"id","toptext"),P(i,"class","svelte-ybjroz"),P(s,"class","buttonbar svelte-ybjroz"),P(s,"id","rightbar"),P(e,"id","topbar"),P(e,"style",a=t[0]?"color: rgba(var(--primary-color), 0.6);":" "),P(e,"class","svelte-ybjroz")},m(d,g){C(d,e,g),A(e,n),c&&c.m(n,null),A(e,r),A(e,i),h&&h.m(i,null),A(e,o),A(e,s),p&&p.m(s,null),l=!0},p(d,[g]){c&&c.p&&(!l||g&2)&&xt(c,u,d,d[1],l?Et(u,d[1],g,Ca):At(d[1]),ri),h&&h.p&&(!l||g&2)&&xt(h,f,d,d[1],l?Et(f,d[1],g,Sa):At(d[1]),ni),p&&p.p&&(!l||g&2)&&xt(p,m,d,d[1],l?Et(m,d[1],g,Aa):At(d[1]),ti),(!l||g&1&&a!==(a=d[0]?"color: rgba(var(--primary-color), 0.6);":" "))&&P(e,"style",a)},i(d){l||(j(c,d),j(h,d),j(p,d),l=!0)},o(d){F(c,d),F(h,d),F(p,d),l=!1},d(d){d&&S(e),c&&c.d(d),h&&h.d(d),p&&p.d(d)}}}function Ba(t,e,n){let{$$slots:r={},$$scope:i}=e,{toned:o=!1}=e;return t.$$set=s=>{"toned"in s&&n(0,o=s.toned),"$$scope"in s&&n(1,i=s.$$scope)},[o,i,r]}class hs extends me{constructor(e){super(),he(this,e,Ba,Oa,de,{toned:0})}}function Pa(t){let e,n,r,i,o,s,a,l,u;return{c(){e=M("button"),e.textContent="warm",n=N(),r=M("button"),r.textContent="black",i=N(),o=M("button"),o.textContent="dark",s=N(),a=M("button"),a.textContent="light",W(e,"background-color","#f6e4bd"),W(e,"color","#000"),P(e,"class","svelte-k014sn"),W(r,"background-color","#000"),W(r,"color","#e9e9e9"),P(r,"class","svelte-k014sn"),W(o,"background-color","#032038"),W(o,"color","#e9e9e9"),P(o,"class","svelte-k014sn"),W(a,"background-color","#fff"),W(a,"color","#000"),P(a,"class","svelte-k014sn")},m(c,f){C(c,e,f),C(c,n,f),C(c,r,f),C(c,i,f),C(c,o,f),C(c,s,f),C(c,a,f),l||(u=[X(e,"click",t[1]),X(r,"click",t[2]),X(o,"click",t[3]),X(a,"click",t[4])],l=!0)},p:z,i:z,o:z,d(c){c&&S(e),c&&S(n),c&&S(r),c&&S(i),c&&S(o),c&&S(s),c&&S(a),l=!1,ke(u)}}}function Ma(t){const e=s=>{document.documentElement.setAttribute("data-theme",s),localStorage.setItem("theme",s)};return[e,()=>e("warm"),()=>e("black"),()=>e("dark"),()=>e("light")]}class ms extends me{constructor(e){super(),he(this,e,Ma,Pa,de,{})}}function Ra(t){let e,n,r,i,o,s,a,l,u,c,f,h,m,p,d,g,_,y,b,v,w,E,x,O;return w=new ms({}),{c(){e=M("label"),e.textContent="Font:",n=N(),r=M("br"),i=N(),o=M("select"),s=M("option"),s.textContent="Default",a=M("option"),a.textContent="Verdana",l=M("option"),l.textContent="Arial",u=M("option"),u.textContent="Courier New ",c=M("option"),c.textContent="Helvetica",f=M("option"),f.textContent="Times New Roman",h=N(),m=M("br"),p=N(),d=M("label"),d.textContent="Scale:",g=N(),_=M("br"),y=N(),b=M("input"),v=N(),ie(w.$$.fragment),P(e,"for","fontpicker"),s.__value="Default",s.value=s.__value,W(a,"font-family","'Verdana'"),a.__value="Verdana",a.value=a.__value,W(l,"font-family","'Arial'"),l.__value="Arial",l.value=l.__value,W(u,"font-family","'Courier New '"),u.__value="Courier New ",u.value=u.__value,W(c,"font-family","'Helvetica'"),c.__value="Helvetica",c.value=c.__value,W(f,"font-family","'Times New Roman'"),f.__value="Times New Roman",f.value=f.__value,P(o,"name","fontpicker"),W(o,"width","100%"),t[0].fontFamily===void 0&&be(()=>t[1].call(o)),P(d,"for","scale"),P(b,"name","scale"),P(b,"type","range"),P(b,"min","5"),P(b,"max","30")},m(k,T){C(k,e,T),C(k,n,T),C(k,r,T),C(k,i,T),C(k,o,T),A(o,s),A(o,a),A(o,l),A(o,u),A(o,c),A(o,f),jr(o,t[0].fontFamily,!0),C(k,h,T),C(k,m,T),C(k,p,T),C(k,d,T),C(k,g,T),C(k,_,T),C(k,y,T),C(k,b,T),Kr(b,t[0].scale),C(k,v,T),ee(w,k,T),E=!0,x||(O=[X(o,"change",t[1]),X(b,"change",t[2]),X(b,"input",t[2])],x=!0)},p(k,[T]){T&1&&jr(o,k[0].fontFamily),T&1&&Kr(b,k[0].scale)},i(k){E||(j(w.$$.fragment,k),E=!0)},o(k){F(w.$$.fragment,k),E=!1},d(k){k&&S(e),k&&S(n),k&&S(r),k&&S(i),k&&S(o),k&&S(h),k&&S(m),k&&S(p),k&&S(d),k&&S(g),k&&S(_),k&&S(y),k&&S(b),k&&S(v),te(w,k),x=!1,ke(O)}}}function Ta(t,e,n){let{settings:r}=e;function i(){r.fontFamily=Bs(this),n(0,r)}function o(){r.scale=Cs(this.value),n(0,r)}return t.$$set=s=>{"settings"in s&&n(0,r=s.settings)},[r,i,o]}class Da extends me{constructor(e){super(),he(this,e,Ta,Ra,de,{settings:0})}}const Ia=t=>({}),ii=t=>({});function si(t){let e,n,r,i,o,s;const a=t[4].default,l=kt(a,t,t[3],null);return{c(){e=M("div"),n=M("div"),l&&l.c(),P(n,"class","wrapper svelte-1xij5ih"),P(e,"class","popover svelte-1xij5ih")},m(u,c){C(u,e,c),A(e,n),l&&l.m(n,null),i=!0,o||(s=Es(t[2].call(null,e)),o=!0)},p(u,c){l&&l.p&&(!i||c&8)&&xt(l,a,u,u[3],i?Et(a,u[3],c,null):At(u[3]),null)},i(u){i||(j(l,u),be(()=>{i&&(r||(r=_n(e,ei,{x:50,duration:200},!0)),r.run(1))}),i=!0)},o(u){F(l,u),r||(r=_n(e,ei,{x:50,duration:200},!1)),r.run(0),i=!1},d(u){u&&S(e),l&&l.d(u),u&&r&&r.end(),o=!1,s()}}}function Ka(t){let e,n,r,i,o,s;const a=t[4].icon,l=kt(a,t,t[3],ii);let u=t[0]&&si(t);return{c(){e=M("button"),l&&l.c(),n=N(),u&&u.c(),r=yr(),P(e,"class","popoverBtn svelte-1xij5ih")},m(c,f){C(c,e,f),l&&l.m(e,null),t[5](e),C(c,n,f),u&&u.m(c,f),C(c,r,f),i=!0,o||(s=X(e,"click",t[6]),o=!0)},p(c,[f]){l&&l.p&&(!i||f&8)&&xt(l,a,c,c[3],i?Et(a,c[3],f,Ia):At(c[3]),ii),c[0]?u?(u.p(c,f),f&1&&j(u,1)):(u=si(c),u.c(),j(u,1),u.m(r.parentNode,r)):u&&(mt(),F(u,1,1,()=>{u=null}),pt())},i(c){i||(j(l,c),j(u),i=!0)},o(c){F(l,c),F(u),i=!1},d(c){c&&S(e),l&&l.d(c),t[5](null),c&&S(n),u&&u.d(c),c&&S(r),o=!1,s()}}}function ja(t,e,n){let{$$slots:r={},$$scope:i}=e,o,s;function a(c){const f=h=>{h.target instanceof Element&&!c.contains(h.target)&&h.target!==s&&n(0,o=!1)};return document.addEventListener("click",f,!0),{destroy(){document.removeEventListener("click",f,!0)}}}function l(c){Ke[c?"unshift":"push"](()=>{s=c,n(1,s)})}const u=()=>n(0,o=!o);return t.$$set=c=>{"$$scope"in c&&n(3,i=c.$$scope)},[o,s,a,i,r,l,u]}class hr extends me{constructor(e){super(),he(this,e,ja,Ka,de,{})}}function za(t){let e,n=t[0].name+"",r,i,o,s=t[0].index+"",a,l,u,c;return{c(){e=M("button"),r=H(n),i=N(),o=M("span"),a=H(s),P(e,"class","tocButton svelte-t3fdsg"),P(e,"style",l=(t[2]?"border: 1px solid lightblue; font-weight: bold;":"")+" "+(t[0].isChild?"padding-left: 2em;":""))},m(f,h){C(f,e,h),A(e,r),A(e,i),A(e,o),A(o,a),u||(c=X(e,"click",function(){$e(t[1])&&t[1].apply(this,arguments)}),u=!0)},p(f,[h]){t=f,h&1&&n!==(n=t[0].name+"")&&$(r,n),h&1&&s!==(s=t[0].index+"")&&$(a,s),h&5&&l!==(l=(t[2]?"border: 1px solid lightblue; font-weight: bold;":"")+" "+(t[0].isChild?"padding-left: 2em;":""))&&P(e,"style",l)},i:z,o:z,d(f){f&&S(e),u=!1,c()}}}function Na(t,e,n){let{tocitem:r}=e,{onclick:i}=e,{selected:o}=e;return t.$$set=s=>{"tocitem"in s&&n(0,r=s.tocitem),"onclick"in s&&n(1,i=s.onclick),"selected"in s&&n(2,o=s.selected)},[r,i,o]}class Fa extends me{constructor(e){super(),he(this,e,Na,za,de,{tocitem:0,onclick:1,selected:2})}}const La=t=>{let e=document.getElementById("user-settings");e||(e=document.createElement("style"),e.id="user-settings",document.head.appendChild(e)),e.innerText="#container { transform: scale("+t.scale/10+"); width: "+50/(t.scale/10)+"%; } @media (max-width: 1500px) {#container { width: "+90/(t.scale/10)+"%}}"+(t.fontFamily!=="Default"?" #container p, #container a, #container span { font-family: "+t.fontFamily+" !important;}":""),localStorage.setItem("settings",JSON.stringify(t))},qa=t=>{for(const e of document.getElementsByClassName("essence-reader"))e.remove();t.forEach(e=>{const n=document.createElement("style");n.innerText=e,n.className="essence-reader",document.head.appendChild(n)})},Ua=(t,e)=>{t!==-1&&Ae.books.update(t,{progress:e})},Ha=(t,e)=>{for(const n of t)if(n.getAttribute("href").includes("http"))n.setAttribute("target","_blank");else{let r=n.getAttribute("href").split("\\").pop().split("/").pop();n.addEventListener("click",i=>{i.preventDefault(),r.includes("#")&&(r=r.substring(0,r.indexOf("#"))),e(r)})}};function oi(t){let e,n;return{c(){e=G("title"),n=H(t[1])},m(r,i){C(r,e,i),A(e,n)},p(r,i){i&2&&$(n,r[1])},d(r){r&&S(e)}}}function Va(t){let e,n,r,i=t[1]&&oi(t),o=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:t[0]},{height:t[0]},t[2],t[3]],s={};for(let a=0;a<o.length;a+=1)s=Q(s,o[a]);return{c(){e=G("svg"),i&&i.c(),n=G("path"),r=G("path"),P(n,"d","M27,16.76c0-.25,0-.5,0-.76s0-.51,0-.77l1.92-1.68A2,2,0,0,0,29.3,11L26.94,7a2,2,0,0,0-1.73-1,2,2,0,0,0-.64.1l-2.43.82a11.35,11.35,0,0,0-1.31-.75l-.51-2.52a2,2,0,0,0-2-1.61H13.64a2,2,0,0,0-2,1.61l-.51,2.52a11.48,11.48,0,0,0-1.32.75L7.43,6.06A2,2,0,0,0,6.79,6,2,2,0,0,0,5.06,7L2.7,11a2,2,0,0,0,.41,2.51L5,15.24c0,.25,0,.5,0,.76s0,.51,0,.77L3.11,18.45A2,2,0,0,0,2.7,21L5.06,25a2,2,0,0,0,1.73,1,2,2,0,0,0,.64-.1l2.43-.82a11.35,11.35,0,0,0,1.31.75l.51,2.52a2,2,0,0,0,2,1.61h4.72a2,2,0,0,0,2-1.61l.51-2.52a11.48,11.48,0,0,0,1.32-.75l2.42.82a2,2,0,0,0,.64.1,2,2,0,0,0,1.73-1L29.3,21a2,2,0,0,0-.41-2.51ZM25.21,24l-3.43-1.16a8.86,8.86,0,0,1-2.71,1.57L18.36,28H13.64l-.71-3.55a9.36,9.36,0,0,1-2.7-1.57L6.79,24,4.43,20l2.72-2.4a8.9,8.9,0,0,1,0-3.13L4.43,12,6.79,8l3.43,1.16a8.86,8.86,0,0,1,2.71-1.57L13.64,4h4.72l.71,3.55a9.36,9.36,0,0,1,2.7,1.57L25.21,8,27.57,12l-2.72,2.4a8.9,8.9,0,0,1,0,3.13L27.57,20Z"),P(r,"d","M16,22a6,6,0,1,1,6-6A5.94,5.94,0,0,1,16,22Zm0-10a3.91,3.91,0,0,0-4,4,3.91,3.91,0,0,0,4,4,3.91,3.91,0,0,0,4-4A3.91,3.91,0,0,0,16,12Z"),ye(e,s)},m(a,l){C(a,e,l),i&&i.m(e,null),A(e,n),A(e,r)},p(a,[l]){a[1]?i?i.p(a,l):(i=oi(a),i.c(),i.m(e,n)):i&&(i.d(1),i=null),ye(e,s=et(o,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},l&1&&{width:a[0]},l&1&&{height:a[0]},l&4&&a[2],l&8&&a[3]]))},i:z,o:z,d(a){a&&S(e),i&&i.d()}}}function Ya(t,e,n){let r,i;const o=["size","title"];let s=ge(e,o),{size:a=16}=e,{title:l=void 0}=e;return t.$$set=u=>{n(5,e=Q(Q({},e),pe(u))),n(3,s=ge(e,o)),"size"in u&&n(0,a=u.size),"title"in u&&n(1,l=u.title)},t.$$.update=()=>{n(4,r=e["aria-label"]||e["aria-labelledby"]||l),n(2,i={"aria-hidden":r?void 0:!0,role:r?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=pe(e),[a,l,i,s,r]}class ps extends me{constructor(e){super(),he(this,e,Ya,Va,de,{size:0,title:1})}}function ai(t){let e,n;return{c(){e=G("title"),n=H(t[1])},m(r,i){C(r,e,i),A(e,n)},p(r,i){i&2&&$(n,r[1])},d(r){r&&S(e)}}}function Wa(t){let e,n,r=t[1]&&ai(t),i=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:t[0]},{height:t[0]},t[2],t[3]],o={};for(let s=0;s<i.length;s+=1)o=Q(o,i[s]);return{c(){e=G("svg"),r&&r.c(),n=G("path"),P(n,"d","M4 6H22V8H4zM4 12H22V14H4zM4 18H22V20H4zM4 24H22V26H4zM26 6H28V8H26zM26 12H28V14H26zM26 18H28V20H26zM26 24H28V26H26z"),ye(e,o)},m(s,a){C(s,e,a),r&&r.m(e,null),A(e,n)},p(s,[a]){s[1]?r?r.p(s,a):(r=ai(s),r.c(),r.m(e,n)):r&&(r.d(1),r=null),ye(e,o=et(i,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},a&1&&{width:s[0]},a&1&&{height:s[0]},a&4&&s[2],a&8&&s[3]]))},i:z,o:z,d(s){s&&S(e),r&&r.d()}}}function Ga(t,e,n){let r,i;const o=["size","title"];let s=ge(e,o),{size:a=16}=e,{title:l=void 0}=e;return t.$$set=u=>{n(5,e=Q(Q({},e),pe(u))),n(3,s=ge(e,o)),"size"in u&&n(0,a=u.size),"title"in u&&n(1,l=u.title)},t.$$.update=()=>{n(4,r=e["aria-label"]||e["aria-labelledby"]||l),n(2,i={"aria-hidden":r?void 0:!0,role:r?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=pe(e),[a,l,i,s,r]}class Za extends me{constructor(e){super(),he(this,e,Ga,Wa,de,{size:0,title:1})}}function li(t){let e,n;return{c(){e=G("title"),n=H(t[1])},m(r,i){C(r,e,i),A(e,n)},p(r,i){i&2&&$(n,r[1])},d(r){r&&S(e)}}}function Qa(t){let e,n,r=t[1]&&li(t),i=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:t[0]},{height:t[0]},t[2],t[3]],o={};for(let s=0;s<i.length;s+=1)o=Q(o,i[s]);return{c(){e=G("svg"),r&&r.c(),n=G("path"),P(n,"d","M18 6L16.57 7.393 24.15 15 4 15 4 17 24.15 17 16.57 24.573 18 26 28 16 18 6z"),ye(e,o)},m(s,a){C(s,e,a),r&&r.m(e,null),A(e,n)},p(s,[a]){s[1]?r?r.p(s,a):(r=li(s),r.c(),r.m(e,n)):r&&(r.d(1),r=null),ye(e,o=et(i,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},a&1&&{width:s[0]},a&1&&{height:s[0]},a&4&&s[2],a&8&&s[3]]))},i:z,o:z,d(s){s&&S(e),r&&r.d()}}}function Ja(t,e,n){let r,i;const o=["size","title"];let s=ge(e,o),{size:a=16}=e,{title:l=void 0}=e;return t.$$set=u=>{n(5,e=Q(Q({},e),pe(u))),n(3,s=ge(e,o)),"size"in u&&n(0,a=u.size),"title"in u&&n(1,l=u.title)},t.$$.update=()=>{n(4,r=e["aria-label"]||e["aria-labelledby"]||l),n(2,i={"aria-hidden":r?void 0:!0,role:r?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=pe(e),[a,l,i,s,r]}class Xa extends me{constructor(e){super(),he(this,e,Ja,Qa,de,{size:0,title:1})}}function ui(t){let e,n;return{c(){e=G("title"),n=H(t[1])},m(r,i){C(r,e,i),A(e,n)},p(r,i){i&2&&$(n,r[1])},d(r){r&&S(e)}}}function $a(t){let e,n,r=t[1]&&ui(t),i=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:t[0]},{height:t[0]},t[2],t[3]],o={};for(let s=0;s<i.length;s+=1)o=Q(o,i[s]);return{c(){e=G("svg"),r&&r.c(),n=G("path"),P(n,"d","M14 26L15.41 24.59 7.83 17 28 17 28 15 7.83 15 15.41 7.41 14 6 4 16 14 26z"),ye(e,o)},m(s,a){C(s,e,a),r&&r.m(e,null),A(e,n)},p(s,[a]){s[1]?r?r.p(s,a):(r=ui(s),r.c(),r.m(e,n)):r&&(r.d(1),r=null),ye(e,o=et(i,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},a&1&&{width:s[0]},a&1&&{height:s[0]},a&4&&s[2],a&8&&s[3]]))},i:z,o:z,d(s){s&&S(e),r&&r.d()}}}function el(t,e,n){let r,i;const o=["size","title"];let s=ge(e,o),{size:a=16}=e,{title:l=void 0}=e;return t.$$set=u=>{n(5,e=Q(Q({},e),pe(u))),n(3,s=ge(e,o)),"size"in u&&n(0,a=u.size),"title"in u&&n(1,l=u.title)},t.$$.update=()=>{n(4,r=e["aria-label"]||e["aria-labelledby"]||l),n(2,i={"aria-hidden":r?void 0:!0,role:r?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=pe(e),[a,l,i,s,r]}class tl extends me{constructor(e){super(),he(this,e,el,$a,de,{size:0,title:1})}}function ci(t){let e,n;return{c(){e=G("title"),n=H(t[1])},m(r,i){C(r,e,i),A(e,n)},p(r,i){i&2&&$(n,r[1])},d(r){r&&S(e)}}}function nl(t){let e,n,r=t[1]&&ci(t),i=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:t[0]},{height:t[0]},t[2],t[3]],o={};for(let s=0;s<i.length;s+=1)o=Q(o,i[s]);return{c(){e=G("svg"),r&&r.c(),n=G("path"),P(n,"d","M10 16L20 6 21.4 7.4 12.8 16 21.4 24.6 20 26z"),ye(e,o)},m(s,a){C(s,e,a),r&&r.m(e,null),A(e,n)},p(s,[a]){s[1]?r?r.p(s,a):(r=ci(s),r.c(),r.m(e,n)):r&&(r.d(1),r=null),ye(e,o=et(i,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},a&1&&{width:s[0]},a&1&&{height:s[0]},a&4&&s[2],a&8&&s[3]]))},i:z,o:z,d(s){s&&S(e),r&&r.d()}}}function rl(t,e,n){let r,i;const o=["size","title"];let s=ge(e,o),{size:a=16}=e,{title:l=void 0}=e;return t.$$set=u=>{n(5,e=Q(Q({},e),pe(u))),n(3,s=ge(e,o)),"size"in u&&n(0,a=u.size),"title"in u&&n(1,l=u.title)},t.$$.update=()=>{n(4,r=e["aria-label"]||e["aria-labelledby"]||l),n(2,i={"aria-hidden":r?void 0:!0,role:r?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=pe(e),[a,l,i,s,r]}class il extends me{constructor(e){super(),he(this,e,rl,nl,de,{size:0,title:1})}}function fi(t){let e,n;return{c(){e=G("title"),n=H(t[1])},m(r,i){C(r,e,i),A(e,n)},p(r,i){i&2&&$(n,r[1])},d(r){r&&S(e)}}}function sl(t){let e,n,r,i=t[1]&&fi(t),o=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:t[0]},{height:t[0]},t[2],t[3]],s={};for(let a=0;a<o.length;a+=1)s=Q(s,o[a]);return{c(){e=G("svg"),i&&i.c(),n=G("path"),r=G("path"),P(n,"d","M16 20H18V28H16z"),P(r,"d","M23,4a7.0078,7.0078,0,0,0-7,7v3h2V11a5,5,0,1,1,5,5H5.8281l4.586-4.5859L9,10,2,17l7,7,1.4141-1.4141L5.8281,18H23A7,7,0,0,0,23,4Z"),ye(e,s)},m(a,l){C(a,e,l),i&&i.m(e,null),A(e,n),A(e,r)},p(a,[l]){a[1]?i?i.p(a,l):(i=fi(a),i.c(),i.m(e,n)):i&&(i.d(1),i=null),ye(e,s=et(o,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},l&1&&{width:a[0]},l&1&&{height:a[0]},l&4&&a[2],l&8&&a[3]]))},i:z,o:z,d(a){a&&S(e),i&&i.d()}}}function ol(t,e,n){let r,i;const o=["size","title"];let s=ge(e,o),{size:a=16}=e,{title:l=void 0}=e;return t.$$set=u=>{n(5,e=Q(Q({},e),pe(u))),n(3,s=ge(e,o)),"size"in u&&n(0,a=u.size),"title"in u&&n(1,l=u.title)},t.$$.update=()=>{n(4,r=e["aria-label"]||e["aria-labelledby"]||l),n(2,i={"aria-hidden":r?void 0:!0,role:r?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=pe(e),[a,l,i,s,r]}class al extends me{constructor(e){super(),he(this,e,ol,sl,de,{size:0,title:1})}}const{document:di}=qs;function hi(t,e,n){const r=t.slice();return r[24]=e[n],r}function ll(t){let e,n,r,i,o;return n=new il({props:{size:24}}),{c(){e=M("button"),ie(n.$$.fragment),P(e,"slot","leftbar")},m(s,a){C(s,e,a),ee(n,e,null),r=!0,i||(o=X(e,"click",t[18]),i=!0)},p:z,i(s){r||(j(n.$$.fragment,s),r=!0)},o(s){F(n.$$.fragment,s),r=!1},d(s){s&&S(e),te(n),i=!1,o()}}}function ul(t){let e,n,r=t[1].meta.title+"",i,o,s,a=t[1].meta.author+"",l,u,c,f,h,m=t[1].spine.length-1+"",p;return{c(){e=M("h4"),n=M("b"),i=H(r),o=H(" -"),s=N(),l=H(a),u=N(),c=M("p"),f=H(t[4]),h=H("/"),p=H(m)},m(d,g){C(d,e,g),A(e,n),A(n,i),A(n,o),A(e,s),A(e,l),C(d,u,g),C(d,c,g),A(c,f),A(c,h),A(c,p)},p(d,g){g&2&&r!==(r=d[1].meta.title+"")&&$(i,r),g&2&&a!==(a=d[1].meta.author+"")&&$(l,a),g&16&&$(f,d[4]),g&2&&m!==(m=d[1].spine.length-1+"")&&$(p,m)},d(d){d&&S(e),d&&S(u),d&&S(c)}}}function mi(t){let e,n,r,i=t[6][t[6].length-1]+"",o,s,a,l,u;return n=new al({}),{c(){e=M("button"),ie(n.$$.fragment),r=N(),o=H(i),P(e,"id","jumpbtn"),P(e,"class","svelte-1si9v5y")},m(c,f){C(c,e,f),ee(n,e,null),A(e,r),A(e,o),a=!0,l||(u=X(e,"click",t[13]),l=!0)},p(c,f){(!a||f&64)&&i!==(i=c[6][c[6].length-1]+"")&&$(o,i)},i(c){a||(j(n.$$.fragment,c),be(()=>{a&&(s||(s=_n(e,Xe,{duration:200},!0)),s.run(1))}),a=!0)},o(c){F(n.$$.fragment,c),s||(s=_n(e,Xe,{duration:200},!1)),s.run(0),a=!1},d(c){c&&S(e),te(n),c&&s&&s.end(),l=!1,u()}}}function pi(t){let e,n;function r(){return t[14](t[24])}return e=new Fa({props:{tocitem:t[24],selected:t[4]===t[24].index,onclick:r}}),{c(){ie(e.$$.fragment)},m(i,o){ee(e,i,o),n=!0},p(i,o){t=i;const s={};o&2&&(s.tocitem=t[24]),o&18&&(s.selected=t[4]===t[24].index),o&2&&(s.onclick=r),e.$set(s)},i(i){n||(j(e.$$.fragment,i),n=!0)},o(i){F(e.$$.fragment,i),n=!1},d(i){te(e,i)}}}function cl(t){let e,n,r=t[1].toc,i=[];for(let s=0;s<r.length;s+=1)i[s]=pi(hi(t,r,s));const o=s=>F(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=yr()},m(s,a){for(let l=0;l<i.length;l+=1)i[l]&&i[l].m(s,a);C(s,e,a),n=!0},p(s,a){if(a&530){r=s[1].toc;let l;for(l=0;l<r.length;l+=1){const u=hi(s,r,l);i[l]?(i[l].p(u,a),j(i[l],1)):(i[l]=pi(u),i[l].c(),j(i[l],1),i[l].m(e.parentNode,e))}for(mt(),l=r.length;l<i.length;l+=1)o(l);pt()}},i(s){if(!n){for(let a=0;a<r.length;a+=1)j(i[a]);n=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)F(i[a]);n=!1},d(s){Ss(i,s),s&&S(e)}}}function fl(t){let e,n;return e=new Za({props:{size:24,slot:"icon"}}),{c(){ie(e.$$.fragment)},m(r,i){ee(e,r,i),n=!0},p:z,i(r){n||(j(e.$$.fragment,r),n=!0)},o(r){F(e.$$.fragment,r),n=!1},d(r){te(e,r)}}}function dl(t){let e,n,r;function i(s){t[15](s)}let o={};return t[2]!==void 0&&(o.settings=t[2]),e=new Da({props:o}),Ke.push(()=>Nt(e,"settings",i)),{c(){ie(e.$$.fragment)},m(s,a){ee(e,s,a),r=!0},p(s,a){const l={};!n&&a&4&&(n=!0,l.settings=s[2],jt(()=>n=!1)),e.$set(l)},i(s){r||(j(e.$$.fragment,s),r=!0)},o(s){F(e.$$.fragment,s),r=!1},d(s){te(e,s)}}}function hl(t){let e,n;return e=new ps({props:{size:24,slot:"icon"}}),{c(){ie(e.$$.fragment)},m(r,i){ee(e,r,i),n=!0},p:z,i(r){n||(j(e.$$.fragment,r),n=!0)},o(r){F(e.$$.fragment,r),n=!1},d(r){te(e,r)}}}function ml(t){let e,n,r,i,o,s,a,l,u,c,f,h,m,p=t[6].length!==0&&mi(t);return n=new hr({props:{$$slots:{icon:[fl],default:[cl]},$$scope:{ctx:t}}}),i=new hr({props:{$$slots:{icon:[hl],default:[dl]},$$scope:{ctx:t}}}),a=new tl({props:{size:24}}),c=new Xa({props:{size:24}}),{c(){p&&p.c(),e=N(),ie(n.$$.fragment),r=N(),ie(i.$$.fragment),o=N(),s=M("button"),ie(a.$$.fragment),l=N(),u=M("button"),ie(c.$$.fragment)},m(d,g){p&&p.m(d,g),C(d,e,g),ee(n,d,g),C(d,r,g),ee(i,d,g),C(d,o,g),C(d,s,g),ee(a,s,null),C(d,l,g),C(d,u,g),ee(c,u,null),f=!0,h||(m=[X(s,"click",t[16]),X(u,"click",t[17])],h=!0)},p(d,g){d[6].length!==0?p?(p.p(d,g),g&64&&j(p,1)):(p=mi(d),p.c(),j(p,1),p.m(e.parentNode,e)):p&&(mt(),F(p,1,1,()=>{p=null}),pt());const _={};g&134217746&&(_.$$scope={dirty:g,ctx:d}),n.$set(_);const y={};g&134217732&&(y.$$scope={dirty:g,ctx:d}),i.$set(y)},i(d){f||(j(p),j(n.$$.fragment,d),j(i.$$.fragment,d),j(a.$$.fragment,d),j(c.$$.fragment,d),f=!0)},o(d){F(p),F(n.$$.fragment,d),F(i.$$.fragment,d),F(a.$$.fragment,d),F(c.$$.fragment,d),f=!1},d(d){p&&p.d(d),d&&S(e),te(n,d),d&&S(r),te(i,d),d&&S(o),d&&S(s),te(a),d&&S(l),d&&S(u),te(c),h=!1,ke(m)}}}function pl(t){let e=!1,n=()=>{e=!1},r,i,o,s,a,l,u,c,f,h,m;return be(t[12]),di.title=i=`
        `+(t[1].meta.title+" - "+t[1].meta.author)+`
    `,a=new hs({props:{toned:t[5]>100,$$slots:{rightbar:[ml],toptext:[ul],leftbar:[ll]},$$scope:{ctx:t}}}),{c(){o=N(),s=M("div"),ie(a.$$.fragment),l=N(),u=M("div"),P(u,"id","container"),P(u,"class","svelte-1si9v5y")},m(p,d){C(p,o,d),C(p,s,d),ee(a,s,null),A(s,l),A(s,u),t[19](u),f=!0,h||(m=[X(window,"keydown",t[10]),X(window,"scroll",()=>{e=!0,clearTimeout(r),r=setTimeout(n,100),t[12]()})],h=!0)},p(p,[d]){d&32&&!e&&(e=!0,clearTimeout(r),scrollTo(window.pageXOffset,p[5]),r=setTimeout(n,100)),(!f||d&2)&&i!==(i=`
        `+(p[1].meta.title+" - "+p[1].meta.author)+`
    `)&&(di.title=i);const g={};d&32&&(g.toned=p[5]>100),d&134217815&&(g.$$scope={dirty:d,ctx:p}),a.$set(g)},i(p){f||(j(a.$$.fragment,p),c||be(()=>{c=zt(s,Xe,{duration:200}),c.start()}),f=!0)},o(p){F(a.$$.fragment,p),f=!1},d(p){p&&S(o),p&&S(s),te(a),t[19](null),h=!1,ke(m)}}}function gl(t,e,n){let{currentBook:r}=e,{reading:i}=e,{currentId:o}=e,s,a=0,l=0,u=r.meta.title,c=JSON.parse(localStorage.getItem("settings"))||{scale:10,fontFamily:"Default"};const f=()=>{isNaN(r.progress)?m(0):m(Math.floor(r.progress)),qa(r.files.styles)},h=()=>{u!==r.meta.title&&(u=r.meta.title,f())};br(f);const m=R=>{0<=R&&R<r.spine.length&&(n(4,a=R),n(5,l=0),Ua(o,a),p())},p=()=>{n(3,s.innerHTML=r.contents.get(r.spine[a]).html,s),Ha(s.querySelectorAll("[href]"),R=>_(r.contents.get(R).index))};let d=[];const g=R=>{m(a+R),d.length!==0&&n(6,d=[])},_=R=>{n(6,d=[...d,a]),m(R)},y=({key:R})=>{switch(R){case"ArrowLeft":g(-1);break;case"ArrowRight":g(1);break}};function b(){n(5,l=window.pageYOffset)}const v=()=>{m(d.pop()),n(6,d)},w=R=>_(R.index);function E(R){c=R,n(2,c)}const x=()=>g(-1),O=()=>g(1),k=()=>{n(0,i=!1),document.title="Essence Reader",location.hash=""};function T(R){Ke[R?"unshift":"push"](()=>{s=R,n(3,s)})}return t.$$set=R=>{"currentBook"in R&&n(1,r=R.currentBook),"reading"in R&&n(0,i=R.reading),"currentId"in R&&n(11,o=R.currentId)},t.$$.update=()=>{t.$$.dirty&4&&La(c),t.$$.dirty&2&&h()},[i,r,c,s,a,l,d,m,g,_,y,o,b,v,w,E,x,O,k,T]}class yl extends me{constructor(e){super(),he(this,e,gl,pl,de,{currentBook:1,reading:0,currentId:11})}}function bl(t,{from:e,to:n},r={}){const i=getComputedStyle(t),o=i.transform==="none"?"":i.transform,[s,a]=i.transformOrigin.split(" ").map(parseFloat),l=e.left+e.width*s/n.width-(n.left+s),u=e.top+e.height*a/n.height-(n.top+a),{delay:c=0,duration:f=m=>Math.sqrt(m)*120,easing:h=ds}=r;return{delay:c,duration:$e(f)?f(Math.sqrt(l*l+u*u)):f,easing:h,css:(m,p)=>{const d=p*l,g=p*u,_=m+p*e.width/n.width,y=m+p*e.height/n.height;return`transform: ${o} translate(${d}px, ${g}px) scale(${_}, ${y});`}}}function gi(t){let e,n;return{c(){e=G("title"),n=H(t[1])},m(r,i){C(r,e,i),A(e,n)},p(r,i){i&2&&$(n,r[1])},d(r){r&&S(e)}}}function _l(t){let e,n,r,i=t[1]&&gi(t),o=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:t[0]},{height:t[0]},t[2],t[3]],s={};for(let a=0;a<o.length;a+=1)s=Q(s,o[a]);return{c(){e=G("svg"),i&&i.c(),n=G("path"),r=G("path"),P(n,"d","M12 12H14V24H12zM18 12H20V24H18z"),P(r,"d","M4 6V8H6V28a2 2 0 002 2H24a2 2 0 002-2V8h2V6zM8 28V8H24V28zM12 2H20V4H12z"),ye(e,s)},m(a,l){C(a,e,l),i&&i.m(e,null),A(e,n),A(e,r)},p(a,[l]){a[1]?i?i.p(a,l):(i=gi(a),i.c(),i.m(e,n)):i&&(i.d(1),i=null),ye(e,s=et(o,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},l&1&&{width:a[0]},l&1&&{height:a[0]},l&4&&a[2],l&8&&a[3]]))},i:z,o:z,d(a){a&&S(e),i&&i.d()}}}function vl(t,e,n){let r,i;const o=["size","title"];let s=ge(e,o),{size:a=16}=e,{title:l=void 0}=e;return t.$$set=u=>{n(5,e=Q(Q({},e),pe(u))),n(3,s=ge(e,o)),"size"in u&&n(0,a=u.size),"title"in u&&n(1,l=u.title)},t.$$.update=()=>{n(4,r=e["aria-label"]||e["aria-labelledby"]||l),n(2,i={"aria-hidden":r?void 0:!0,role:r?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=pe(e),[a,l,i,s,r]}class wl extends me{constructor(e){super(),he(this,e,vl,_l,de,{size:0,title:1})}}function yi(t,e,n){const r=t.slice();return r[16]=e[n],r}function kl(t){let e;return{c(){e=M("h3"),e.textContent="Essence Reader",P(e,"slot","toptext")},m(n,r){C(n,e,r)},p:z,d(n){n&&S(e)}}}function El(t){let e,n,r,i,o,s,a,l,u,c,f,h,m,p,d,g;return m=new ms({}),{c(){e=M("div"),n=M("label"),r=M("input"),i=H(`
                    Save books
                `),o=M("br"),s=N(),a=M("button"),a.textContent="Remove all",l=N(),u=M("hr"),c=N(),f=M("p"),f.textContent="Select theme",h=N(),ie(m.$$.fragment),P(r,"type","checkbox"),W(n,"user-select","none"),W(f,"display","inline"),W(e,"width","8em")},m(_,y){C(_,e,y),A(e,n),A(n,r),r.checked=t[0],A(n,i),A(e,o),A(e,s),A(e,a),A(e,l),A(e,u),A(e,c),A(e,f),A(e,h),ee(m,e,null),p=!0,d||(g=[X(r,"change",t[11]),X(a,"click",t[9])],d=!0)},p(_,y){y&1&&(r.checked=_[0])},i(_){p||(j(m.$$.fragment,_),p=!0)},o(_){F(m.$$.fragment,_),p=!1},d(_){_&&S(e),te(m),d=!1,ke(g)}}}function xl(t){let e,n;return e=new ps({props:{slot:"icon",size:24}}),{c(){ie(e.$$.fragment)},m(r,i){ee(e,r,i),n=!0},p:z,i(r){n||(j(e.$$.fragment,r),n=!0)},o(r){F(e.$$.fragment,r),n=!1},d(r){te(e,r)}}}function Al(t){let e,n;return e=new hr({props:{slot:"rightbar",$$slots:{icon:[xl],default:[El]},$$scope:{ctx:t}}}),{c(){ie(e.$$.fragment)},m(r,i){ee(e,r,i),n=!0},p(r,i){const o={};i&524289&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){n||(j(e.$$.fragment,r),n=!0)},o(r){F(e.$$.fragment,r),n=!1},d(r){te(e,r)}}}function bi(t){let e=[],n=new Map,r,i,o=t[5];const s=a=>a[16].id;for(let a=0;a<o.length;a+=1){let l=yi(t,o,a),u=s(l);n.set(u,e[a]=_i(u,l))}return{c(){for(let a=0;a<e.length;a+=1)e[a].c();r=yr()},m(a,l){for(let u=0;u<e.length;u+=1)e[u]&&e[u].m(a,l);C(a,r,l),i=!0},p(a,l){if(l&290){o=a[5],mt();for(let u=0;u<e.length;u+=1)e[u].r();e=Vs(e,l,s,1,a,o,n,r.parentNode,Hs,_i,r,yi);for(let u=0;u<e.length;u+=1)e[u].a();pt()}},i(a){if(!i){for(let l=0;l<o.length;l+=1)j(e[l]);i=!0}},o(a){for(let l=0;l<e.length;l+=1)F(e[l]);i=!1},d(a){for(let l=0;l<e.length;l+=1)e[l].d(a);a&&S(r)}}}function _i(t,e){let n,r,i,o,s,a,l,u,c,f,h=e[16].meta.author+"",m,p,d,g=e[16].meta.title+"",_,y,b,v=e[16].progress+"",w,E,x=e[16].spine.length-1+"",O,k,T,R,Z=z,L,q,xe;i=new wl({props:{size:20}});function Ee(...re){return e[12](e[16],...re)}function J(){return e[13](e[16])}return{key:t,first:null,c(){n=M("button"),r=M("button"),ie(i.$$.fragment),o=N(),s=M("img"),u=N(),c=M("div"),f=M("h4"),m=H(h),p=N(),d=M("h3"),_=H(g),y=N(),b=M("p"),w=H(v),E=H(" / "),O=H(x),T=N(),P(r,"class","deleteBtn svelte-1flo03t"),Tr(s.src,a=e[16].meta.cover!==void 0?URL.createObjectURL(e[16].meta.cover):"")||P(s,"src",a),P(s,"alt","cover"),P(s,"class","svelte-1flo03t"),P(d,"class","svelte-1flo03t"),P(c,"class","bookInfo svelte-1flo03t"),P(n,"class","book svelte-1flo03t"),this.first=n},m(re,_e){C(re,n,_e),A(n,r),ee(i,r,null),A(n,o),A(n,s),A(n,u),A(n,c),A(c,f),A(f,m),A(c,p),A(c,d),A(d,_),A(c,y),A(c,b),A(b,w),A(b,E),A(b,O),A(n,T),L=!0,q||(xe=[X(r,"click",Ee),X(n,"click",J)],q=!0)},p(re,_e){e=re,(!L||_e&32&&!Tr(s.src,a=e[16].meta.cover!==void 0?URL.createObjectURL(e[16].meta.cover):""))&&P(s,"src",a),(!L||_e&32)&&h!==(h=e[16].meta.author+"")&&$(m,h),(!L||_e&32)&&g!==(g=e[16].meta.title+"")&&$(_,g),(!L||_e&32)&&v!==(v=e[16].progress+"")&&$(w,v),(!L||_e&32)&&x!==(x=e[16].spine.length-1+"")&&$(O,x)},r(){R=n.getBoundingClientRect()},f(){Is(n),Z()},a(){Z(),Z=Ds(n,R,bl,{duration:200})},i(re){L||(j(i.$$.fragment,re),l||be(()=>{l=zt(s,Xe,{duration:200}),l.start()}),k||be(()=>{k=zt(c,Xe,{duration:200}),k.start()}),L=!0)},o(re){F(i.$$.fragment,re),L=!1},d(re){re&&S(n),te(i),q=!1,ke(xe)}}}function Sl(t){let e,n,r,i=t[4]?"+":"Drop anywhere or click to select a file",o;return{c(){e=M("h1"),e.textContent="",n=N(),r=M("h2"),o=H(i),P(e,"class","svelte-1flo03t")},m(s,a){C(s,e,a),C(s,n,a),C(s,r,a),A(r,o)},p(s,a){a&16&&i!==(i=s[4]?"+":"Drop anywhere or click to select a file")&&$(o,i)},d(s){s&&S(e),s&&S(n),s&&S(r)}}}function Cl(t){let e,n,r;return{c(){e=M("h1"),e.textContent="",n=N(),r=M("h2"),r.textContent="...",P(e,"class","svelte-1flo03t")},m(i,o){C(i,e,o),C(i,n,o),C(i,r,o)},p:z,d(i){i&&S(e),i&&S(n),i&&S(r)}}}function vi(t){let e,n,r,i,o=t[3]?"Loading":"Drop anywhere or click to select a file",s;return{c(){e=M("div"),n=M("h4"),n.textContent="Load new book",r=N(),i=M("h3"),s=H(o),W(i,"color",t[2]?"#87CEFA":""),P(i,"class","svelte-1flo03t"),P(e,"class","bookInfo svelte-1flo03t")},m(a,l){C(a,e,l),A(e,n),A(e,r),A(e,i),A(i,s)},p(a,l){l&8&&o!==(o=a[3]?"Loading":"Drop anywhere or click to select a file")&&$(s,o),l&4&&W(i,"color",a[2]?"#87CEFA":"")},d(a){a&&S(e)}}}function Ol(t){let e,n,r,i,o,s,a,l,u,c,f,h,m,p;n=new hs({props:{$$slots:{rightbar:[Al],toptext:[kl]},$$scope:{ctx:t}}});let d=t[5]&&bi(t);function g(v,w){return v[3]?Cl:Sl}let _=g(t),y=_(t),b=t[4]&&vi(t);return{c(){e=M("div"),ie(n.$$.fragment),r=N(),i=M("div"),d&&d.c(),o=N(),s=M("button"),a=M("div"),y.c(),u=N(),b&&b.c(),P(a,"id","dropInfo"),P(a,"class",l=Dr(t[3]?"loading":"")+" svelte-1flo03t"),W(a,"max-width",t[4]?"":"100% "),W(a,"background-color",t[2]?" #87CEFA":""),P(s,"class","book svelte-1flo03t"),P(s,"style",c=t[4]?"":"max-width: 50vw"),P(i,"id","parent"),P(i,"class","svelte-1flo03t")},m(v,w){C(v,e,w),ee(n,e,null),A(e,r),A(e,i),d&&d.m(i,null),A(i,o),A(i,s),A(s,a),y.m(a,null),A(s,u),b&&b.m(s,null),h=!0,m||(p=X(s,"click",t[14]),m=!0)},p(v,[w]){const E={};w&524289&&(E.$$scope={dirty:w,ctx:v}),n.$set(E),v[5]?d?(d.p(v,w),w&32&&j(d,1)):(d=bi(v),d.c(),j(d,1),d.m(i,o)):d&&(mt(),F(d,1,1,()=>{d=null}),pt()),_===(_=g(v))&&y?y.p(v,w):(y.d(1),y=_(v),y&&(y.c(),y.m(a,null))),(!h||w&8&&l!==(l=Dr(v[3]?"loading":"")+" svelte-1flo03t"))&&P(a,"class",l),(!h||w&16)&&W(a,"max-width",v[4]?"":"100% "),(!h||w&4)&&W(a,"background-color",v[2]?" #87CEFA":""),v[4]?b?b.p(v,w):(b=vi(v),b.c(),b.m(s,null)):b&&(b.d(1),b=null),(!h||w&16&&c!==(c=v[4]?"":"max-width: 50vw"))&&P(s,"style",c)},i(v){h||(j(n.$$.fragment,v),j(d),f||be(()=>{f=zt(e,Xe,{duration:200}),f.start()}),h=!0)},o(v){F(n.$$.fragment,v),F(d),h=!1},d(v){v&&S(e),te(n),d&&d.d(),y.d(),b&&b.d(),m=!1,p()}}}function Bl(t,e,n){let r,{readFiles:i=b=>{}}=e,{openExisting:o=b=>{}}=e,{dragging:s}=e,{saveBooksOn:a}=e,{loading:l}=e,u=is(()=>Ae.books.toArray().catch(()=>(n(0,a=!1),null)));ks(t,u,b=>n(5,r=b));let c=!1;const f=()=>{let b=document.createElement("input");b.type="file",b.onchange=v=>{i(v.target.files[0])},b.click()};async function h(b){await Ae.books.delete(b)}const m=async()=>{confirm("Are you sure you want to remove all saved books?")&&await Ae.books.clear()};async function p(){if(a){const b=await Ae.books.count();n(4,c=b>0)}}br(()=>{p(),window.addEventListener("unhandledrejection",b=>{b.reason instanceof TypeError&&(Ae.books.clear(),console.log("An error was encountered and book database has been cleared"))})});function d(){a=this.checked,n(0,a)}const g=(b,v)=>{v.stopPropagation(),h(b.id)},_=b=>o(b.id),y=()=>f();return t.$$set=b=>{"readFiles"in b&&n(10,i=b.readFiles),"openExisting"in b&&n(1,o=b.openExisting),"dragging"in b&&n(2,s=b.dragging),"saveBooksOn"in b&&n(0,a=b.saveBooksOn),"loading"in b&&n(3,l=b.loading)},[a,o,s,l,c,r,u,f,h,m,i,d,g,_,y]}class Pl extends me{constructor(e){super(),he(this,e,Bl,Ol,de,{readFiles:10,openExisting:1,dragging:2,saveBooksOn:0,loading:3})}}function Ml(t){let e,n,r,i;function o(l){t[11](l)}function s(l){t[12](l)}let a={readFiles:t[7],openExisting:t[8],dragging:t[3]};return t[0]!==void 0&&(a.saveBooksOn=t[0]),t[4]!==void 0&&(a.loading=t[4]),e=new Pl({props:a}),Ke.push(()=>Nt(e,"saveBooksOn",o)),Ke.push(()=>Nt(e,"loading",s)),{c(){ie(e.$$.fragment)},m(l,u){ee(e,l,u),i=!0},p(l,u){const c={};u&8&&(c.dragging=l[3]),!n&&u&1&&(n=!0,c.saveBooksOn=l[0],jt(()=>n=!1)),!r&&u&16&&(r=!0,c.loading=l[4],jt(()=>r=!1)),e.$set(c)},i(l){i||(j(e.$$.fragment,l),i=!0)},o(l){F(e.$$.fragment,l),i=!1},d(l){te(e,l)}}}function Rl(t){let e,n;return{c(){e=M("p"),e.textContent="Loading",W(e,"text-align","center")},m(r,i){C(r,e,i)},p:z,i(r){n||be(()=>{n=zt(e,Xe,{}),n.start()})},o:z,d(r){r&&S(e)}}}function Tl(t){let e,n,r,i;function o(l){t[9](l)}function s(l){t[10](l)}let a={currentBook:t[1]};return t[2]!==void 0&&(a.reading=t[2]),t[5]!==void 0&&(a.currentId=t[5]),e=new yl({props:a}),Ke.push(()=>Nt(e,"reading",o)),Ke.push(()=>Nt(e,"currentId",s)),{c(){ie(e.$$.fragment)},m(l,u){ee(e,l,u),i=!0},p(l,u){const c={};u&2&&(c.currentBook=l[1]),!n&&u&4&&(n=!0,c.reading=l[2],jt(()=>n=!1)),!r&&u&32&&(r=!0,c.currentId=l[5],jt(()=>r=!1)),e.$set(c)},i(l){i||(j(e.$$.fragment,l),i=!0)},o(l){F(e.$$.fragment,l),i=!1},d(l){te(e,l)}}}function Dl(t){let e,n,r,i;const o=[Tl,Rl,Ml],s=[];function a(l,u){return l[2]?0:l[6]?1:2}return n=a(t),r=s[n]=o[n](t),{c(){e=M("main"),r.c()},m(l,u){C(l,e,u),s[n].m(e,null),i=!0},p(l,[u]){let c=n;n=a(l),n===c?s[n].p(l,u):(mt(),F(s[c],1,1,()=>{s[c]=null}),pt(),r=s[n],r?r.p(l,u):(r=s[n]=o[n](l),r.c()),j(r,1),r.m(e,null))},i(l){i||(j(r),i=!0)},o(l){F(r),i=!1},d(l){l&&S(e),s[n].d()}}}function Il(t,e,n){let r,i=!1,o=!1,s=!1;const a=async y=>{try{n(4,s=!0);const b=await wa(y);if(l&&y.size<3e7){const v=await No(b);c(b,v)}else c(b)}catch(b){alert(b)}n(4,s=!1)};let l;localStorage.getItem("saveBooksOn")!==null?l=JSON.parse(localStorage.getItem("saveBooksOn")):l=!0;const u=()=>{localStorage.setItem("saveBooksOn",JSON.stringify(l))};window.addEventListener("dragenter",y=>{y.dataTransfer.types.includes("Files")&&n(3,o=!0)}),window.addEventListener("dragleave",y=>{n(3,o=!1),y.preventDefault()});const c=(y,b)=>{n(1,r=xa(y)),n(2,i=!0),location.hash=b?b.toString():"",n(5,h=b||-1)},f=y=>{y===h?n(2,i=!0):(n(6,m=!0),Ae.transaction("r",Ae.books,async()=>{let b=await Ae.books.get(y);b?c(b,b.id):(location.hash="",n(6,m=!1))}))};br(()=>{location.hash!==""&&(n(6,m=!0),f(parseInt(location.hash.substring(1))))}),window.onhashchange=()=>{l&&location.hash===""?(document.title="Essence Reader",n(2,i=!1),history.replaceState(null,""," "),n(6,m=!1)):l&&location.hash!==""&&f(parseInt(location.hash.substring(1)))},window.addEventListener("dragover",y=>y.preventDefault()),window.addEventListener("drop",y=>{y.preventDefault(),n(3,o=!1),a(y.dataTransfer.files[0])});let h=-1,m=!1;function p(y){i=y,n(2,i)}function d(y){h=y,n(5,h)}function g(y){l=y,n(0,l)}function _(y){s=y,n(4,s)}return t.$$.update=()=>{t.$$.dirty&1&&u()},[l,r,i,o,s,h,m,a,f,p,d,g,_]}class Kl extends me{constructor(e){super(),he(this,e,Il,Dl,de,{})}}new Kl({target:document.getElementById("app")})});export default jl();
