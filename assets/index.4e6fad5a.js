var To=Object.defineProperty;var Do=(t,e,n)=>e in t?To(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Oo=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Pr=(t,e,n)=>(Do(t,typeof e!="symbol"?e+"":e,n),n);var nl=Oo((il,Co)=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();function Q(){}const wi=t=>t;function Ro(t,e){for(const n in e)t[n]=e[n];return t}function ki(t){return t()}function Fr(){return Object.create(null)}function ce(t){t.forEach(ki)}function Kt(t){return typeof t=="function"}function Qe(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let Ut;function Mr(t,e){return Ut||(Ut=document.createElement("a")),Ut.href=e,t===Ut.href}function Io(t){return Object.keys(t).length===0}function Ko(t,...e){if(t==null)return Q;const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function Po(t,e,n){t.$$.on_destroy.push(Ko(e,n))}function Gt(t,e,n,r){if(t){const i=Ei(t,e,n,r);return t[0](i)}}function Ei(t,e,n,r){return t[1]&&r?Ro(n.ctx.slice(),t[1](r(e))):n.ctx}function Qt(t,e,n,r){if(t[2]&&r){const i=t[2](r(n));if(e.dirty===void 0)return i;if(typeof i=="object"){const o=[],a=Math.max(e.dirty.length,i.length);for(let s=0;s<a;s+=1)o[s]=e.dirty[s]|i[s];return o}return e.dirty|i}return e.dirty}function Xt(t,e,n,r,i,o){if(i){const a=Ei(e,n,r,o);t.p(a,i)}}function Jt(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let r=0;r<n;r++)e[r]=-1;return e}return-1}function Lr(t){return t==null?"":t}function Fo(t){return t&&Kt(t.destroy)?t.destroy:Q}const Ai=typeof window<"u";let Si=Ai?()=>window.performance.now():()=>Date.now(),vr=Ai?t=>requestAnimationFrame(t):Q;const rt=new Set;function xi(t){rt.forEach(e=>{e.c(t)||(rt.delete(e),e.f())}),rt.size!==0&&vr(xi)}function Ci(t){let e;return rt.size===0&&vr(xi),{promise:new Promise(n=>{rt.add(e={c:t,f:n})}),abort(){rt.delete(e)}}}function B(t,e){t.appendChild(e)}function Bi(t){if(!t)return document;const e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function Mo(t){const e=D("style");return Lo(Bi(t),e),e.sheet}function Lo(t,e){return B(t.head||t,e),e.sheet}function F(t,e,n){t.insertBefore(e,n||null)}function I(t){t.parentNode&&t.parentNode.removeChild(t)}function zo(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function D(t){return document.createElement(t)}function ee(t){return document.createTextNode(t)}function N(){return ee(" ")}function mr(){return ee("")}function q(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function O(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function No(t){return t===""?null:+t}function $o(t){return Array.from(t.childNodes)}function de(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function zr(t,e){t.value=e==null?"":e}function U(t,e,n,r){n===null?t.style.removeProperty(e):t.style.setProperty(e,n,r?"important":"")}function Nr(t,e){for(let n=0;n<t.options.length;n+=1){const r=t.options[n];if(r.__value===e){r.selected=!0;return}}t.selectedIndex=-1}function Uo(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}function jo(t,e,{bubbles:n=!1,cancelable:r=!1}={}){const i=document.createEvent("CustomEvent");return i.initCustomEvent(t,n,r,e),i}const cn=new Map;let fn=0;function Ho(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}function Wo(t,e){const n={stylesheet:Mo(e),rules:{}};return cn.set(t,n),n}function Ln(t,e,n,r,i,o,a,s=0){const u=16.666/r;let l=`{
`;for(let m=0;m<=1;m+=u){const y=e+(n-e)*o(m);l+=m*100+`%{${a(y,1-y)}}
`}const f=l+`100% {${a(n,1-n)}}
}`,c=`__svelte_${Ho(f)}_${s}`,p=Bi(t),{stylesheet:h,rules:d}=cn.get(p)||Wo(p,t);d[c]||(d[c]=!0,h.insertRule(`@keyframes ${c} ${f}`,h.cssRules.length));const v=t.style.animation||"";return t.style.animation=`${v?`${v}, `:""}${c} ${r}ms linear ${i}ms 1 both`,fn+=1,c}function Ti(t,e){const n=(t.style.animation||"").split(", "),r=n.filter(e?o=>o.indexOf(e)<0:o=>o.indexOf("__svelte")===-1),i=n.length-r.length;i&&(t.style.animation=r.join(", "),fn-=i,fn||Vo())}function Vo(){vr(()=>{fn||(cn.forEach(t=>{const{ownerNode:e}=t.stylesheet;e&&I(e)}),cn.clear())})}function qo(t,e,n,r){if(!e)return Q;const i=t.getBoundingClientRect();if(e.left===i.left&&e.right===i.right&&e.top===i.top&&e.bottom===i.bottom)return Q;const{delay:o=0,duration:a=300,easing:s=wi,start:u=Si()+o,end:l=u+a,tick:f=Q,css:c}=n(t,{from:e,to:i},r);let p=!0,h=!1,d;function v(){c&&(d=Ln(t,0,1,a,o,s,c)),o||(h=!0)}function m(){c&&Ti(t,d),p=!1}return Ci(y=>{if(!h&&y>=u&&(h=!0),h&&y>=l&&(f(1,0),m()),!p)return!1;if(h){const b=y-u,k=0+1*s(b/a);f(k,1-k)}return!0}),v(),f(0,1),m}function Yo(t){const e=getComputedStyle(t);if(e.position!=="absolute"&&e.position!=="fixed"){const{width:n,height:r}=e,i=t.getBoundingClientRect();t.style.position="absolute",t.style.width=n,t.style.height=r,Go(t,i)}}function Go(t,e){const n=t.getBoundingClientRect();if(e.left!==n.left||e.top!==n.top){const r=getComputedStyle(t),i=r.transform==="none"?"":r.transform;t.style.transform=`${i} translate(${e.left-n.left}px, ${e.top-n.top}px)`}}let St;function gt(t){St=t}function Di(){if(!St)throw new Error("Function called outside component initialization");return St}function Oi(t){Di().$$.on_mount.push(t)}function Qo(t){Di().$$.after_update.push(t)}const pt=[],pe=[],Zt=[],zn=[],Xo=Promise.resolve();let Nn=!1;function Jo(){Nn||(Nn=!0,Xo.then(Ri))}function qe(t){Zt.push(t)}function Te(t){zn.push(t)}const xn=new Set;let jt=0;function Ri(){const t=St;do{for(;jt<pt.length;){const e=pt[jt];jt++,gt(e),Zo(e.$$)}for(gt(null),pt.length=0,jt=0;pe.length;)pe.pop()();for(let e=0;e<Zt.length;e+=1){const n=Zt[e];xn.has(n)||(xn.add(n),n())}Zt.length=0}while(pt.length);for(;zn.length;)zn.pop()();Nn=!1,xn.clear(),gt(t)}function Zo(t){if(t.fragment!==null){t.update(),ce(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(qe)}}let ht;function ea(){return ht||(ht=Promise.resolve(),ht.then(()=>{ht=null})),ht}function Cn(t,e,n){t.dispatchEvent(jo(`${e?"intro":"outro"}${n}`))}const en=new Set;let Ce;function Ii(){Ce={r:0,c:[],p:Ce}}function Ki(){Ce.r||ce(Ce.c),Ce=Ce.p}function Y(t,e){t&&t.i&&(en.delete(t),t.i(e))}function J(t,e,n,r){if(t&&t.o){if(en.has(t))return;en.add(t),Ce.c.push(()=>{en.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}const ta={duration:0};function $r(t,e,n,r){let i=e(t,n),o=r?0:1,a=null,s=null,u=null;function l(){u&&Ti(t,u)}function f(p,h){const d=p.b-o;return h*=Math.abs(d),{a:o,b:p.b,d,duration:h,start:p.start,end:p.start+h,group:p.group}}function c(p){const{delay:h=0,duration:d=300,easing:v=wi,tick:m=Q,css:y}=i||ta,b={start:Si()+h,b:p};p||(b.group=Ce,Ce.r+=1),a||s?s=b:(y&&(l(),u=Ln(t,o,p,d,h,v,y)),p&&m(0,1),a=f(b,d),qe(()=>Cn(t,p,"start")),Ci(k=>{if(s&&k>s.start&&(a=f(s,d),s=null,Cn(t,a.b,"start"),y&&(l(),u=Ln(t,o,a.b,a.duration,0,v,i.css))),a){if(k>=a.end)m(o=a.b,1-o),Cn(t,a.b,"end"),s||(a.b?l():--a.group.r||ce(a.group.c)),a=null;else if(k>=a.start){const A=k-a.start;o=a.a+a.d*v(A/a.duration),m(o,1-o)}}return!!(a||s)}))}return{run(p){Kt(i)?ea().then(()=>{i=i(),c(p)}):c(p)},end(){l(),a=s=null}}}const na=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function ra(t,e){t.d(1),e.delete(t.key)}function ia(t,e){t.f(),ra(t,e)}function oa(t,e,n,r,i,o,a,s,u,l,f,c){let p=t.length,h=o.length,d=p;const v={};for(;d--;)v[t[d].key]=d;const m=[],y=new Map,b=new Map;for(d=h;d--;){const g=c(i,o,d),S=n(g);let w=a.get(S);w?r&&w.p(g,e):(w=l(S,g),w.c()),y.set(S,m[d]=w),S in v&&b.set(S,Math.abs(d-v[S]))}const k=new Set,A=new Set;function _(g){Y(g,1),g.m(s,f),a.set(g.key,g),f=g.first,h--}for(;p&&h;){const g=m[h-1],S=t[p-1],w=g.key,E=S.key;g===S?(f=g.first,p--,h--):y.has(E)?!a.has(w)||k.has(w)?_(g):A.has(E)?p--:b.get(w)>b.get(E)?(A.add(w),_(g)):(k.add(E),p--):(u(S,a),p--)}for(;p--;){const g=t[p];y.has(g.key)||u(g,a)}for(;h;)_(m[h-1]);return m}function De(t,e,n){const r=t.$$.props[e];r!==void 0&&(t.$$.bound[r]=n,n(t.$$.ctx[r]))}function ke(t){t&&t.c()}function ve(t,e,n,r){const{fragment:i,after_update:o}=t.$$;i&&i.m(e,n),r||qe(()=>{const a=t.$$.on_mount.map(ki).filter(Kt);t.$$.on_destroy?t.$$.on_destroy.push(...a):ce(a),t.$$.on_mount=[]}),o.forEach(qe)}function me(t,e){const n=t.$$;n.fragment!==null&&(ce(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function aa(t,e){t.$$.dirty[0]===-1&&(pt.push(t),Jo(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Xe(t,e,n,r,i,o,a,s=[-1]){const u=St;gt(t);const l=t.$$={fragment:null,ctx:[],props:o,update:Q,not_equal:i,bound:Fr(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(u?u.$$.context:[])),callbacks:Fr(),dirty:s,skip_bound:!1,root:e.target||u.$$.root};a&&a(l.root);let f=!1;if(l.ctx=n?n(t,e.props||{},(c,p,...h)=>{const d=h.length?h[0]:p;return l.ctx&&i(l.ctx[c],l.ctx[c]=d)&&(!l.skip_bound&&l.bound[c]&&l.bound[c](d),f&&aa(t,c)),p}):[],l.update(),f=!0,ce(l.before_update),l.fragment=r?r(l.ctx):!1,e.target){if(e.hydrate){const c=$o(e.target);l.fragment&&l.fragment.l(c),c.forEach(I)}else l.fragment&&l.fragment.c();e.intro&&Y(t.$$.fragment),ve(t,e.target,e.anchor,e.customElement),Ri()}gt(u)}class Je{$destroy(){me(this,1),this.$destroy=Q}$on(e,n){if(!Kt(n))return Q;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!Io(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.
Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.
THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var $=function(){return $=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},$.apply(this,arguments)};function $n(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))}var W=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,G=Object.keys,ie=Array.isArray;typeof Promise<"u"&&!W.Promise&&(W.Promise=Promise);function se(t,e){return typeof e!="object"||G(e).forEach(function(n){t[n]=e[n]}),t}var xt=Object.getPrototypeOf,sa={}.hasOwnProperty;function le(t,e){return sa.call(t,e)}function at(t,e){typeof e=="function"&&(e=e(xt(t))),(typeof Reflect>"u"?G:Reflect.ownKeys)(e).forEach(function(n){Re(t,n,e[n])})}var Pi=Object.defineProperty;function Re(t,e,n,r){Pi(t,e,se(n&&le(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function ut(t){return{from:function(e){return t.prototype=Object.create(e.prototype),Re(t.prototype,"constructor",t),{extend:at.bind(null,t.prototype)}}}}var ua=Object.getOwnPropertyDescriptor;function yr(t,e){var n=ua(t,e),r;return n||(r=xt(t))&&yr(r,e)}var la=[].slice;function kn(t,e,n){return la.call(t,e,n)}function Fi(t,e){return e(t)}function vt(t){if(!t)throw new Error("Assertion Failed")}function Mi(t){W.setImmediate?setImmediate(t):setTimeout(t,0)}function Li(t,e){return t.reduce(function(n,r,i){var o=e(r,i);return o&&(n[o[0]]=o[1]),n},{})}function ca(t,e,n){try{t.apply(null,n)}catch(r){e&&e(r)}}function Oe(t,e){if(le(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var n=[],r=0,i=e.length;r<i;++r){var o=Oe(t,e[r]);n.push(o)}return n}var a=e.indexOf(".");if(a!==-1){var s=t[e.substr(0,a)];return s===void 0?void 0:Oe(s,e.substr(a+1))}}function ye(t,e,n){if(!(!t||e===void 0)&&!("isFrozen"in Object&&Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){vt(typeof n!="string"&&"length"in n);for(var r=0,i=e.length;r<i;++r)ye(t,e[r],n[r])}else{var o=e.indexOf(".");if(o!==-1){var a=e.substr(0,o),s=e.substr(o+1);if(s==="")n===void 0?ie(t)&&!isNaN(parseInt(a))?t.splice(a,1):delete t[a]:t[a]=n;else{var u=t[a];(!u||!le(t,a))&&(u=t[a]={}),ye(u,s,n)}}else n===void 0?ie(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=n}}function fa(t,e){typeof e=="string"?ye(t,e,void 0):"length"in e&&[].map.call(e,function(n){ye(t,n,void 0)})}function zi(t){var e={};for(var n in t)le(t,n)&&(e[n]=t[n]);return e}var da=[].concat;function Ni(t){return da.apply([],t)}var $i="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Ni([8,16,32,64].map(function(t){return["Int","Uint","Float"].map(function(e){return e+t+"Array"})}))).filter(function(t){return W[t]}),ha=$i.map(function(t){return W[t]});Li($i,function(t){return[t,!0]});var Me=null;function Pt(t){Me=typeof WeakMap<"u"&&new WeakMap;var e=Un(t);return Me=null,e}function Un(t){if(!t||typeof t!="object")return t;var e=Me&&Me.get(t);if(e)return e;if(ie(t)){e=[],Me&&Me.set(t,e);for(var n=0,r=t.length;n<r;++n)e.push(Un(t[n]))}else if(ha.indexOf(t.constructor)>=0)e=t;else{var i=xt(t);e=i===Object.prototype?{}:Object.create(i),Me&&Me.set(t,e);for(var o in t)le(t,o)&&(e[o]=Un(t[o]))}return e}var pa={}.toString;function jn(t){return pa.call(t).slice(8,-1)}var Hn=typeof Symbol<"u"?Symbol.iterator:"@@iterator",va=typeof Hn=="symbol"?function(t){var e;return t!=null&&(e=t[Hn])&&e.apply(t)}:function(){return null},nt={};function xe(t){var e,n,r,i;if(arguments.length===1){if(ie(t))return t.slice();if(this===nt&&typeof t=="string")return[t];if(i=va(t)){for(n=[];r=i.next(),!r.done;)n.push(r.value);return n}if(t==null)return[t];if(e=t.length,typeof e=="number"){for(n=new Array(e);e--;)n[e]=t[e];return n}return[t]}for(e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];return n}var gr=typeof Symbol<"u"?function(t){return t[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Ee=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Ui(t,e){Ee=t,ji=e}var ji=function(){return!0},ma=!new Error("").stack;function Ze(){if(ma)try{throw Ze.arguments,new Error}catch(t){return t}return new Error}function Wn(t,e){var n=t.stack;return n?(e=e||0,n.indexOf(t.name)===0&&(e+=(t.name+t.message).split(`
`).length),n.split(`
`).slice(e).filter(ji).map(function(r){return`
`+r}).join("")):""}var ya=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"],Hi=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],_r=ya.concat(Hi),ga={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function lt(t,e){this._e=Ze(),this.name=t,this.message=e}ut(lt).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Wn(this._e,2))}},toString:function(){return this.name+": "+this.message}});function Wi(t,e){return t+". Errors: "+Object.keys(e).map(function(n){return e[n].toString()}).filter(function(n,r,i){return i.indexOf(n)===r}).join(`
`)}function dn(t,e,n,r){this._e=Ze(),this.failures=e,this.failedKeys=r,this.successCount=n,this.message=Wi(t,e)}ut(dn).from(lt);function _t(t,e){this._e=Ze(),this.name="BulkError",this.failures=Object.keys(e).map(function(n){return e[n]}),this.failuresByPos=e,this.message=Wi(t,e)}ut(_t).from(lt);var br=_r.reduce(function(t,e){return t[e]=e+"Error",t},{}),_a=lt,M=_r.reduce(function(t,e){var n=e+"Error";function r(i,o){this._e=Ze(),this.name=n,i?typeof i=="string"?(this.message=""+i+(o?`
 `+o:""),this.inner=o||null):typeof i=="object"&&(this.message=i.name+" "+i.message,this.inner=i):(this.message=ga[e]||n,this.inner=null)}return ut(r).from(_a),t[e]=r,t},{});M.Syntax=SyntaxError;M.Type=TypeError;M.Range=RangeError;var Ur=Hi.reduce(function(t,e){return t[e+"Error"]=M[e],t},{});function ba(t,e){if(!t||t instanceof lt||t instanceof TypeError||t instanceof SyntaxError||!t.name||!Ur[t.name])return t;var n=new Ur[t.name](e||t.message,t);return"stack"in t&&Re(n,"stack",{get:function(){return this.inner.stack}}),n}var En=_r.reduce(function(t,e){return["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=M[e]),t},{});En.ModifyError=dn;En.DexieError=lt;En.BulkError=_t;function H(){}function Ft(t){return t}function wa(t,e){return t==null||t===Ft?e:function(n){return e(t(n))}}function Ye(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function ka(t,e){return t===H?e:function(){var n=t.apply(this,arguments);n!==void 0&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?Ye(r,this.onsuccess):r),i&&(this.onerror=this.onerror?Ye(i,this.onerror):i),o!==void 0?o:n}}function Ea(t,e){return t===H?e:function(){t.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?Ye(n,this.onsuccess):n),r&&(this.onerror=this.onerror?Ye(r,this.onerror):r)}}function Aa(t,e){return t===H?e:function(n){var r=t.apply(this,arguments);se(n,r);var i=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var a=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?Ye(i,this.onsuccess):i),o&&(this.onerror=this.onerror?Ye(o,this.onerror):o),r===void 0?a===void 0?void 0:a:se(r,a)}}function Sa(t,e){return t===H?e:function(){return e.apply(this,arguments)===!1?!1:t.apply(this,arguments)}}function wr(t,e){return t===H?e:function(){var n=t.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,i=arguments.length,o=new Array(i);i--;)o[i]=arguments[i];return n.then(function(){return e.apply(r,o)})}return e.apply(this,arguments)}}var Ct={},xa=100,Ca=20,Vi=100,kr=typeof Promise>"u"?[]:function(){var t=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[t,xt(t),t];var e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,xt(e),t]}(),Vn=kr[0],hn=kr[1],qn=kr[2],qi=hn&&hn.then,tn=Vn&&Vn.constructor,Er=!!qn,Yn=!1,Ba=qn?function(){qn.then(Ht)}:W.setImmediate?setImmediate.bind(null,Ht):W.MutationObserver?function(){var t=document.createElement("div");new MutationObserver(function(){Ht(),t=null}).observe(t,{attributes:!0}),t.setAttribute("i","1")}:function(){setTimeout(Ht,0)},Bt=function(t,e){mt.push([t,e]),pn&&(Ba(),pn=!1)},Gn=!0,pn=!0,We=[],nn=[],Qn=null,Xn=Ft,it={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Wr,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(function(t){try{Wr(t[0],t[1])}catch{}})}},R=it,mt=[],Ve=0,rn=[];function T(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=H,this._lib=!1;var e=this._PSD=R;if(Ee&&(this._stackHolder=Ze(),this._prev=null,this._numPrev=0),typeof t!="function"){if(t!==Ct)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&Zn(this,this._value);return}this._state=null,this._value=null,++e.ref,Gi(this,t)}var Jn={get:function(){var t=R,e=vn;function n(r,i){var o=this,a=!t.global&&(t!==R||e!==vn),s=a&&!Ie(),u=new T(function(l,f){Ar(o,new Yi(yn(r,t,a,s),yn(i,t,a,s),l,f,t))});return Ee&&Ji(u,this),u}return n.prototype=Ct,n},set:function(t){Re(this,"then",t&&t.prototype===Ct?Jn:{get:function(){return t},set:Jn.set})}};at(T.prototype,{then:Jn,_then:function(t,e){Ar(this,new Yi(null,null,t,e,R))},catch:function(t){if(arguments.length===1)return this.then(null,t);var e=arguments[0],n=arguments[1];return typeof e=="function"?this.then(null,function(r){return r instanceof e?n(r):on(r)}):this.then(null,function(r){return r&&r.name===e?n(r):on(r)})},finally:function(t){return this.then(function(e){return t(),e},function(e){return t(),on(e)})},stack:{get:function(){if(this._stack)return this._stack;try{Yn=!0;var t=Xi(this,[],Ca),e=t.join(`
From previous: `);return this._state!==null&&(this._stack=e),e}finally{Yn=!1}}},timeout:function(t,e){var n=this;return t<1/0?new T(function(r,i){var o=setTimeout(function(){return i(new M.Timeout(e))},t);n.then(r,i).finally(clearTimeout.bind(null,o))}):this}});typeof Symbol<"u"&&Symbol.toStringTag&&Re(T.prototype,Symbol.toStringTag,"Dexie.Promise");it.env=Zi();function Yi(t,e,n,r,i){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=n,this.reject=r,this.psd=i}at(T,{all:function(){var t=xe.apply(null,arguments).map(mn);return new T(function(e,n){t.length===0&&e([]);var r=t.length;t.forEach(function(i,o){return T.resolve(i).then(function(a){t[o]=a,--r||e(t)},n)})})},resolve:function(t){if(t instanceof T)return t;if(t&&typeof t.then=="function")return new T(function(n,r){t.then(n,r)});var e=new T(Ct,!0,t);return Ji(e,Qn),e},reject:on,race:function(){var t=xe.apply(null,arguments).map(mn);return new T(function(e,n){t.map(function(r){return T.resolve(r).then(e,n)})})},PSD:{get:function(){return R},set:function(t){return R=t}},totalEchoes:{get:function(){return vn}},newPSD:ze,usePSD:ft,scheduler:{get:function(){return Bt},set:function(t){Bt=t}},rejectionMapper:{get:function(){return Xn},set:function(t){Xn=t}},follow:function(t,e){return new T(function(n,r){return ze(function(i,o){var a=R;a.unhandleds=[],a.onunhandled=o,a.finalize=Ye(function(){var s=this;Da(function(){s.unhandleds.length===0?i():o(s.unhandleds[0])})},a.finalize),t()},e,n,r)})}});tn&&(tn.allSettled&&Re(T,"allSettled",function(){var t=xe.apply(null,arguments).map(mn);return new T(function(e){t.length===0&&e([]);var n=t.length,r=new Array(n);t.forEach(function(i,o){return T.resolve(i).then(function(a){return r[o]={status:"fulfilled",value:a}},function(a){return r[o]={status:"rejected",reason:a}}).then(function(){return--n||e(r)})})})}),tn.any&&typeof AggregateError<"u"&&Re(T,"any",function(){var t=xe.apply(null,arguments).map(mn);return new T(function(e,n){t.length===0&&n(new AggregateError([]));var r=t.length,i=new Array(r);t.forEach(function(o,a){return T.resolve(o).then(function(s){return e(s)},function(s){i[a]=s,--r||n(new AggregateError(i))})})})}));function Gi(t,e){try{e(function(n){if(t._state===null){if(n===t)throw new TypeError("A promise cannot be resolved with itself.");var r=t._lib&&Mt();n&&typeof n.then=="function"?Gi(t,function(i,o){n instanceof T?n._then(i,o):n.then(i,o)}):(t._state=!0,t._value=n,Qi(t)),r&&Lt()}},Zn.bind(null,t))}catch(n){Zn(t,n)}}function Zn(t,e){if(nn.push(e),t._state===null){var n=t._lib&&Mt();e=Xn(e),t._state=!1,t._value=e,Ee&&e!==null&&typeof e=="object"&&!e._promise&&ca(function(){var r=yr(e,"stack");e._promise=t,Re(e,"stack",{get:function(){return Yn?r&&(r.get?r.get.apply(e):r.value):t.stack}})}),Oa(t),Qi(t),n&&Lt()}}function Qi(t){var e=t._listeners;t._listeners=[];for(var n=0,r=e.length;n<r;++n)Ar(t,e[n]);var i=t._PSD;--i.ref||i.finalize(),Ve===0&&(++Ve,Bt(function(){--Ve===0&&Sr()},[]))}function Ar(t,e){if(t._state===null){t._listeners.push(e);return}var n=t._state?e.onFulfilled:e.onRejected;if(n===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++Ve,Bt(Ta,[n,t,e])}function Ta(t,e,n){try{Qn=e;var r,i=e._value;e._state?r=t(i):(nn.length&&(nn=[]),r=t(i),nn.indexOf(i)===-1&&Ra(e)),n.resolve(r)}catch(o){n.reject(o)}finally{Qn=null,--Ve===0&&Sr(),--n.psd.ref||n.psd.finalize()}}function Xi(t,e,n){if(e.length===n)return e;var r="";if(t._state===!1){var i=t._value,o,a;i!=null?(o=i.name||"Error",a=i.message||i,r=Wn(i,0)):(o=i,a=""),e.push(o+(a?": "+a:"")+r)}return Ee&&(r=Wn(t._stackHolder,2),r&&e.indexOf(r)===-1&&e.push(r),t._prev&&Xi(t._prev,e,n)),e}function Ji(t,e){var n=e?e._numPrev+1:0;n<xa&&(t._prev=e,t._numPrev=n)}function Ht(){Mt()&&Lt()}function Mt(){var t=Gn;return Gn=!1,pn=!1,t}function Lt(){var t,e,n;do for(;mt.length>0;)for(t=mt,mt=[],n=t.length,e=0;e<n;++e){var r=t[e];r[0].apply(null,r[1])}while(mt.length>0);Gn=!0,pn=!0}function Sr(){var t=We;We=[],t.forEach(function(r){r._PSD.onunhandled.call(null,r._value,r)});for(var e=rn.slice(0),n=e.length;n;)e[--n]()}function Da(t){function e(){t(),rn.splice(rn.indexOf(e),1)}rn.push(e),++Ve,Bt(function(){--Ve===0&&Sr()},[])}function Oa(t){We.some(function(e){return e._value===t._value})||We.push(t)}function Ra(t){for(var e=We.length;e;)if(We[--e]._value===t._value){We.splice(e,1);return}}function on(t){return new T(Ct,!1,t)}function V(t,e){var n=R;return function(){var r=Mt(),i=R;try{return Ne(n,!0),t.apply(this,arguments)}catch(o){e&&e(o)}finally{Ne(i,!1),r&&Lt()}}}var re={awaits:0,echoes:0,id:0},Ia=0,an=[],Bn=0,vn=0,Ka=0;function ze(t,e,n,r){var i=R,o=Object.create(i);o.parent=i,o.ref=0,o.global=!1,o.id=++Ka;var a=it.env;o.env=Er?{Promise:T,PromiseProp:{value:T,configurable:!0,writable:!0},all:T.all,race:T.race,allSettled:T.allSettled,any:T.any,resolve:T.resolve,reject:T.reject,nthen:jr(a.nthen,o),gthen:jr(a.gthen,o)}:{},e&&se(o,e),++i.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()};var s=ft(o,t,n,r);return o.ref===0&&o.finalize(),s}function ct(){return re.id||(re.id=++Ia),++re.awaits,re.echoes+=Vi,re.id}function Ie(){return re.awaits?(--re.awaits===0&&(re.id=0),re.echoes=re.awaits*Vi,!0):!1}(""+qi).indexOf("[native code]")===-1&&(ct=Ie=H);function mn(t){return re.echoes&&t&&t.constructor===tn?(ct(),t.then(function(e){return Ie(),e},function(e){return Ie(),X(e)})):t}function Pa(t){++vn,(!re.echoes||--re.echoes===0)&&(re.echoes=re.id=0),an.push(R),Ne(t,!0)}function Fa(){var t=an[an.length-1];an.pop(),Ne(t,!1)}function Ne(t,e){var n=R;if((e?re.echoes&&(!Bn++||t!==R):Bn&&(!--Bn||t!==R))&&eo(e?Pa.bind(null,t):Fa),t!==R&&(R=t,n===it&&(it.env=Zi()),Er)){var r=it.env.Promise,i=t.env;hn.then=i.nthen,r.prototype.then=i.gthen,(n.global||t.global)&&(Object.defineProperty(W,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function Zi(){var t=W.Promise;return Er?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(W,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:hn.then,gthen:t.prototype.then}:{}}function ft(t,e,n,r,i){var o=R;try{return Ne(t,!0),e(n,r,i)}finally{Ne(o,!1)}}function eo(t){qi.call(Vn,t)}function yn(t,e,n,r){return typeof t!="function"?t:function(){var i=R;n&&ct(),Ne(e,!0);try{return t.apply(this,arguments)}finally{Ne(i,!1),r&&eo(Ie)}}}function jr(t,e){return function(n,r){return t.call(this,yn(n,e),yn(r,e))}}var Hr="unhandledrejection";function Wr(t,e){var n;try{n=e.onuncatched(t)}catch{}if(n!==!1)try{var r,i={promise:e,reason:t};if(W.document&&document.createEvent?(r=document.createEvent("Event"),r.initEvent(Hr,!0,!0),se(r,i)):W.CustomEvent&&(r=new CustomEvent(Hr,{detail:i}),se(r,i)),r&&W.dispatchEvent&&(dispatchEvent(r),!W.PromiseRejectionEvent&&W.onunhandledrejection))try{W.onunhandledrejection(r)}catch{}Ee&&r&&!r.defaultPrevented&&console.warn("Unhandled rejection: "+(t.stack||t))}catch{}}var X=T.reject;function er(t,e,n,r){if(!t.idbdb||!t._state.openComplete&&!R.letThrough&&!t._vip){if(t._state.openComplete)return X(new M.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return X(new M.DatabaseClosed);t.open().catch(H)}return t._state.dbReadyPromise.then(function(){return er(t,e,n,r)})}else{var i=t._createTransaction(e,n,t._dbSchema);try{i.create(),t._state.PR1398_maxLoop=3}catch(o){return o.name===br.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(function(){return er(t,e,n,r)})):X(o)}return i._promise(e,function(o,a){return ze(function(){return R.trans=i,r(o,a,i)})}).then(function(o){return i._completion.then(function(){return o})})}}var Vr="3.2.2",je=String.fromCharCode(65535),tr=-1/0,Ae="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",to="String expected.",bt=[],An=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Ma=An,La=An,no=function(t){return!/(dexie\.js|dexie\.min\.js)/.test(t)},Sn="__dbnames",Tn="readonly",Dn="readwrite";function Ge(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}var ro={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Wt(t){return typeof t=="string"&&!/\./.test(t)?function(e){return e[t]===void 0&&t in e&&(e=Pt(e),delete e[t]),e}:function(e){return e}}var za=function(){function t(){}return t.prototype._trans=function(e,n,r){var i=this._tx||R.trans,o=this.name;function a(u,l,f){if(!f.schema[o])throw new M.NotFound("Table "+o+" not part of transaction");return n(f.idbtrans,f)}var s=Mt();try{return i&&i.db===this.db?i===R.trans?i._promise(e,a,r):ze(function(){return i._promise(e,a,r)},{trans:i,transless:R.transless||R}):er(this.db,e,[this.name],a)}finally{s&&Lt()}},t.prototype.get=function(e,n){var r=this;return e&&e.constructor===Object?this.where(e).first(n):this._trans("readonly",function(i){return r.core.get({trans:i,key:e}).then(function(o){return r.hook.reading.fire(o)})}).then(n)},t.prototype.where=function(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(ie(e))return new this.db.WhereClause(this,"["+e.join("+")+"]");var n=G(e);if(n.length===1)return this.where(n[0]).equals(e[n[0]]);var r=this.schema.indexes.concat(this.schema.primKey).filter(function(f){return f.compound&&n.every(function(c){return f.keyPath.indexOf(c)>=0})&&f.keyPath.every(function(c){return n.indexOf(c)>=0})})[0];if(r&&this.db._maxKey!==je)return this.where(r.name).equals(r.keyPath.map(function(f){return e[f]}));!r&&Ee&&console.warn("The query "+JSON.stringify(e)+" on "+this.name+" would benefit of a "+("compound index ["+n.join("+")+"]"));var i=this.schema.idxByName,o=this.db._deps.indexedDB;function a(f,c){try{return o.cmp(f,c)===0}catch{return!1}}var s=n.reduce(function(f,c){var p=f[0],h=f[1],d=i[c],v=e[c];return[p||d,p||!d?Ge(h,d&&d.multi?function(m){var y=Oe(m,c);return ie(y)&&y.some(function(b){return a(v,b)})}:function(m){return a(v,Oe(m,c))}):h]},[null,null]),u=s[0],l=s[1];return u?this.where(u.name).equals(e[u.keyPath]).filter(l):r?this.filter(l):this.where(n).equals("")},t.prototype.filter=function(e){return this.toCollection().and(e)},t.prototype.count=function(e){return this.toCollection().count(e)},t.prototype.offset=function(e){return this.toCollection().offset(e)},t.prototype.limit=function(e){return this.toCollection().limit(e)},t.prototype.each=function(e){return this.toCollection().each(e)},t.prototype.toArray=function(e){return this.toCollection().toArray(e)},t.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},t.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,ie(e)?"["+e.join("+")+"]":e))},t.prototype.reverse=function(){return this.toCollection().reverse()},t.prototype.mapToClass=function(e){this.schema.mappedClass=e;var n=function(r){if(!r)return r;var i=Object.create(e.prototype);for(var o in r)if(le(r,o))try{i[o]=r[o]}catch{}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=n,this.hook("reading",n),e},t.prototype.defineClass=function(){function e(n){se(this,n)}return this.mapToClass(e)},t.prototype.add=function(e,n){var r=this,i=this.schema.primKey,o=i.auto,a=i.keyPath,s=e;return a&&o&&(s=Wt(a)(e)),this._trans("readwrite",function(u){return r.core.mutate({trans:u,type:"add",keys:n!=null?[n]:null,values:[s]})}).then(function(u){return u.numFailures?T.reject(u.failures[0]):u.lastResult}).then(function(u){if(a)try{ye(e,a,u)}catch{}return u})},t.prototype.update=function(e,n){if(typeof e=="object"&&!ie(e)){var r=Oe(e,this.schema.primKey.keyPath);if(r===void 0)return X(new M.InvalidArgument("Given object does not contain its primary key"));try{typeof n!="function"?G(n).forEach(function(i){ye(e,i,n[i])}):n(e,{value:e,primKey:r})}catch{}return this.where(":id").equals(r).modify(n)}else return this.where(":id").equals(e).modify(n)},t.prototype.put=function(e,n){var r=this,i=this.schema.primKey,o=i.auto,a=i.keyPath,s=e;return a&&o&&(s=Wt(a)(e)),this._trans("readwrite",function(u){return r.core.mutate({trans:u,type:"put",values:[s],keys:n!=null?[n]:null})}).then(function(u){return u.numFailures?T.reject(u.failures[0]):u.lastResult}).then(function(u){if(a)try{ye(e,a,u)}catch{}return u})},t.prototype.delete=function(e){var n=this;return this._trans("readwrite",function(r){return n.core.mutate({trans:r,type:"delete",keys:[e]})}).then(function(r){return r.numFailures?T.reject(r.failures[0]):void 0})},t.prototype.clear=function(){var e=this;return this._trans("readwrite",function(n){return e.core.mutate({trans:n,type:"deleteRange",range:ro})}).then(function(n){return n.numFailures?T.reject(n.failures[0]):void 0})},t.prototype.bulkGet=function(e){var n=this;return this._trans("readonly",function(r){return n.core.getMany({keys:e,trans:r}).then(function(i){return i.map(function(o){return n.hook.reading.fire(o)})})})},t.prototype.bulkAdd=function(e,n,r){var i=this,o=Array.isArray(n)?n:void 0;r=r||(o?void 0:n);var a=r?r.allKeys:void 0;return this._trans("readwrite",function(s){var u=i.schema.primKey,l=u.auto,f=u.keyPath;if(f&&o)throw new M.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(o&&o.length!==e.length)throw new M.InvalidArgument("Arguments objects and keys must have the same length");var c=e.length,p=f&&l?e.map(Wt(f)):e;return i.core.mutate({trans:s,type:"add",keys:o,values:p,wantResults:a}).then(function(h){var d=h.numFailures,v=h.results,m=h.lastResult,y=h.failures,b=a?v:m;if(d===0)return b;throw new _t(i.name+".bulkAdd(): "+d+" of "+c+" operations failed",y)})})},t.prototype.bulkPut=function(e,n,r){var i=this,o=Array.isArray(n)?n:void 0;r=r||(o?void 0:n);var a=r?r.allKeys:void 0;return this._trans("readwrite",function(s){var u=i.schema.primKey,l=u.auto,f=u.keyPath;if(f&&o)throw new M.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(o&&o.length!==e.length)throw new M.InvalidArgument("Arguments objects and keys must have the same length");var c=e.length,p=f&&l?e.map(Wt(f)):e;return i.core.mutate({trans:s,type:"put",keys:o,values:p,wantResults:a}).then(function(h){var d=h.numFailures,v=h.results,m=h.lastResult,y=h.failures,b=a?v:m;if(d===0)return b;throw new _t(i.name+".bulkPut(): "+d+" of "+c+" operations failed",y)})})},t.prototype.bulkDelete=function(e){var n=this,r=e.length;return this._trans("readwrite",function(i){return n.core.mutate({trans:i,type:"delete",keys:e})}).then(function(i){var o=i.numFailures,a=i.lastResult,s=i.failures;if(o===0)return a;throw new _t(n.name+".bulkDelete(): "+o+" of "+r+" operations failed",s)})},t}();function zt(t){var e={},n=function(s,u){if(u){for(var l=arguments.length,f=new Array(l-1);--l;)f[l-1]=arguments[l];return e[s].subscribe.apply(null,f),t}else if(typeof s=="string")return e[s]};n.addEventType=o;for(var r=1,i=arguments.length;r<i;++r)o(arguments[r]);return n;function o(s,u,l){if(typeof s=="object")return a(s);u||(u=Sa),l||(l=H);var f={subscribers:[],fire:l,subscribe:function(c){f.subscribers.indexOf(c)===-1&&(f.subscribers.push(c),f.fire=u(f.fire,c))},unsubscribe:function(c){f.subscribers=f.subscribers.filter(function(p){return p!==c}),f.fire=f.subscribers.reduce(u,l)}};return e[s]=n[s]=f,f}function a(s){G(s).forEach(function(u){var l=s[u];if(ie(l))o(u,s[u][0],s[u][1]);else if(l==="asap")var f=o(u,Ft,function(){for(var p=arguments.length,h=new Array(p);p--;)h[p]=arguments[p];f.subscribers.forEach(function(d){Mi(function(){d.apply(null,h)})})});else throw new M.InvalidArgument("Invalid event config")})}}function Nt(t,e){return ut(e).from({prototype:t}),e}function Na(t){return Nt(za.prototype,function(n,r,i){this.db=t,this._tx=i,this.name=n,this.schema=r,this.hook=t._allTables[n]?t._allTables[n].hook:zt(null,{creating:[ka,H],reading:[wa,Ft],updating:[Aa,H],deleting:[Ea,H]})})}function et(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function On(t,e){t.filter=Ge(t.filter,e)}function Rn(t,e,n){var r=t.replayFilter;t.replayFilter=r?function(){return Ge(r(),e())}:e,t.justLimit=n&&!r}function $a(t,e){t.isMatch=Ge(t.isMatch,e)}function sn(t,e){if(t.isPrimKey)return e.primaryKey;var n=e.getIndexByKeyPath(t.index);if(!n)throw new M.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return n}function qr(t,e,n){var r=sn(t,e.schema);return e.openCursor({trans:n,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:r,range:t.range}})}function Vt(t,e,n,r){var i=t.replayFilter?Ge(t.filter,t.replayFilter()):t.filter;if(t.or){var o={},a=function(s,u,l){if(!i||i(u,l,function(p){return u.stop(p)},function(p){return u.fail(p)})){var f=u.primaryKey,c=""+f;c==="[object ArrayBuffer]"&&(c=""+new Uint8Array(f)),le(o,c)||(o[c]=!0,e(s,u,l))}};return Promise.all([t.or._iterate(a,n),Yr(qr(t,r,n),t.algorithm,a,!t.keysOnly&&t.valueMapper)])}else return Yr(qr(t,r,n),Ge(t.algorithm,i),e,!t.keysOnly&&t.valueMapper)}function Yr(t,e,n,r){var i=r?function(a,s,u){return n(r(a),s,u)}:n,o=V(i);return t.then(function(a){if(a)return a.start(function(){var s=function(){return a.continue()};(!e||e(a,function(u){return s=u},function(u){a.stop(u),s=H},function(u){a.fail(u),s=H}))&&o(a.value,a,function(u){return s=u}),s()})})}function ae(t,e){try{var n=Gr(t),r=Gr(e);if(n!==r)return n==="Array"?1:r==="Array"?-1:n==="binary"?1:r==="binary"?-1:n==="string"?1:r==="string"?-1:n==="Date"?1:r!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return ja(Qr(t),Qr(e));case"Array":return Ua(t,e)}}catch{}return NaN}function Ua(t,e){for(var n=t.length,r=e.length,i=n<r?n:r,o=0;o<i;++o){var a=ae(t[o],e[o]);if(a!==0)return a}return n===r?0:n<r?-1:1}function ja(t,e){for(var n=t.length,r=e.length,i=n<r?n:r,o=0;o<i;++o)if(t[o]!==e[o])return t[o]<e[o]?-1:1;return n===r?0:n<r?-1:1}function Gr(t){var e=typeof t;if(e!=="object")return e;if(ArrayBuffer.isView(t))return"binary";var n=jn(t);return n==="ArrayBuffer"?"binary":n}function Qr(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}var Ha=function(){function t(){}return t.prototype._read=function(e,n){var r=this._ctx;return r.error?r.table._trans(null,X.bind(null,r.error)):r.table._trans("readonly",e).then(n)},t.prototype._write=function(e){var n=this._ctx;return n.error?n.table._trans(null,X.bind(null,n.error)):n.table._trans("readwrite",e,"locked")},t.prototype._addAlgorithm=function(e){var n=this._ctx;n.algorithm=Ge(n.algorithm,e)},t.prototype._iterate=function(e,n){return Vt(this._ctx,e,n,this._ctx.table.core)},t.prototype.clone=function(e){var n=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&se(r,e),n._ctx=r,n},t.prototype.raw=function(){return this._ctx.valueMapper=null,this},t.prototype.each=function(e){var n=this._ctx;return this._read(function(r){return Vt(n,e,r,n.table.core)})},t.prototype.count=function(e){var n=this;return this._read(function(r){var i=n._ctx,o=i.table.core;if(et(i,!0))return o.count({trans:r,query:{index:sn(i,o.schema),range:i.range}}).then(function(s){return Math.min(s,i.limit)});var a=0;return Vt(i,function(){return++a,!1},r,o).then(function(){return a})}).then(e)},t.prototype.sortBy=function(e,n){var r=e.split(".").reverse(),i=r[0],o=r.length-1;function a(l,f){return f?a(l[r[f]],f-1):l[i]}var s=this._ctx.dir==="next"?1:-1;function u(l,f){var c=a(l,o),p=a(f,o);return c<p?-s:c>p?s:0}return this.toArray(function(l){return l.sort(u)}).then(n)},t.prototype.toArray=function(e){var n=this;return this._read(function(r){var i=n._ctx;if(i.dir==="next"&&et(i,!0)&&i.limit>0){var o=i.valueMapper,a=sn(i,i.table.core.schema);return i.table.core.query({trans:r,limit:i.limit,values:!0,query:{index:a,range:i.range}}).then(function(u){var l=u.result;return o?l.map(o):l})}else{var s=[];return Vt(i,function(u){return s.push(u)},r,i.table.core).then(function(){return s})}},e)},t.prototype.offset=function(e){var n=this._ctx;return e<=0?this:(n.offset+=e,et(n)?Rn(n,function(){var r=e;return function(i,o){return r===0?!0:r===1?(--r,!1):(o(function(){i.advance(r),r=0}),!1)}}):Rn(n,function(){var r=e;return function(){return--r<0}}),this)},t.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Rn(this._ctx,function(){var n=e;return function(r,i,o){return--n<=0&&i(o),n>=0}},!0),this},t.prototype.until=function(e,n){return On(this._ctx,function(r,i,o){return e(r.value)?(i(o),n):!0}),this},t.prototype.first=function(e){return this.limit(1).toArray(function(n){return n[0]}).then(e)},t.prototype.last=function(e){return this.reverse().first(e)},t.prototype.filter=function(e){return On(this._ctx,function(n){return e(n.value)}),$a(this._ctx,e),this},t.prototype.and=function(e){return this.filter(e)},t.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},t.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},t.prototype.desc=function(){return this.reverse()},t.prototype.eachKey=function(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){e(i.key,i)})},t.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},t.prototype.eachPrimaryKey=function(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){e(i.primaryKey,i)})},t.prototype.keys=function(e){var n=this._ctx;n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,o){r.push(o.key)}).then(function(){return r}).then(e)},t.prototype.primaryKeys=function(e){var n=this._ctx;if(n.dir==="next"&&et(n,!0)&&n.limit>0)return this._read(function(i){var o=sn(n,n.table.core.schema);return n.table.core.query({trans:i,values:!1,limit:n.limit,query:{index:o,range:n.range}})}).then(function(i){var o=i.result;return o}).then(e);n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,o){r.push(o.primaryKey)}).then(function(){return r}).then(e)},t.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},t.prototype.firstKey=function(e){return this.limit(1).keys(function(n){return n[0]}).then(e)},t.prototype.lastKey=function(e){return this.reverse().firstKey(e)},t.prototype.distinct=function(){var e=this._ctx,n=e.index&&e.table.schema.idxByName[e.index];if(!n||!n.multi)return this;var r={};return On(this._ctx,function(i){var o=i.primaryKey.toString(),a=le(r,o);return r[o]=!0,!a}),this},t.prototype.modify=function(e){var n=this,r=this._ctx;return this._write(function(i){var o;if(typeof e=="function")o=e;else{var a=G(e),s=a.length;o=function(y){for(var b=!1,k=0;k<s;++k){var A=a[k],_=e[A];Oe(y,A)!==_&&(ye(y,A,_),b=!0)}return b}}var u=r.table.core,l=u.schema.primaryKey,f=l.outbound,c=l.extractKey,p=n.db._options.modifyChunkSize||200,h=[],d=0,v=[],m=function(y,b){var k=b.failures,A=b.numFailures;d+=y-A;for(var _=0,g=G(k);_<g.length;_++){var S=g[_];h.push(k[S])}};return n.clone().primaryKeys().then(function(y){var b=function(k){var A=Math.min(p,y.length-k);return u.getMany({trans:i,keys:y.slice(k,k+A),cache:"immutable"}).then(function(_){for(var g=[],S=[],w=f?[]:null,E=[],x=0;x<A;++x){var C=_[x],L={value:Pt(C),primKey:y[k+x]};o.call(L,L.value,L)!==!1&&(L.value==null?E.push(y[k+x]):!f&&ae(c(C),c(L.value))!==0?(E.push(y[k+x]),g.push(L.value)):(S.push(L.value),f&&w.push(y[k+x])))}var z=et(r)&&r.limit===1/0&&(typeof e!="function"||e===In)&&{index:r.index,range:r.range};return Promise.resolve(g.length>0&&u.mutate({trans:i,type:"add",values:g}).then(function(j){for(var K in j.failures)E.splice(parseInt(K),1);m(g.length,j)})).then(function(){return(S.length>0||z&&typeof e=="object")&&u.mutate({trans:i,type:"put",keys:w,values:S,criteria:z,changeSpec:typeof e!="function"&&e}).then(function(j){return m(S.length,j)})}).then(function(){return(E.length>0||z&&e===In)&&u.mutate({trans:i,type:"delete",keys:E,criteria:z}).then(function(j){return m(E.length,j)})}).then(function(){return y.length>k+A&&b(k+p)})})};return b(0).then(function(){if(h.length>0)throw new dn("Error modifying one or more objects",h,d,v);return y.length})})})},t.prototype.delete=function(){var e=this._ctx,n=e.range;return et(e)&&(e.isPrimKey&&!La||n.type===3)?this._write(function(r){var i=e.table.core.schema.primaryKey,o=n;return e.table.core.count({trans:r,query:{index:i,range:o}}).then(function(a){return e.table.core.mutate({trans:r,type:"deleteRange",range:o}).then(function(s){var u=s.failures;s.lastResult,s.results;var l=s.numFailures;if(l)throw new dn("Could not delete some values",Object.keys(u).map(function(f){return u[f]}),a-l);return a-l})})}):this.modify(In)},t}(),In=function(t,e){return e.value=null};function Wa(t){return Nt(Ha.prototype,function(n,r){this.db=t;var i=ro,o=null;if(r)try{i=r()}catch(l){o=l}var a=n._ctx,s=a.table,u=s.hook.reading.fire;this._ctx={table:s,index:a.index,isPrimKey:!a.index||s.schema.primKey.keyPath&&a.index===s.schema.primKey.name,range:i,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:o,or:a.or,valueMapper:u!==Ft?u:null}})}function Va(t,e){return t<e?-1:t===e?0:1}function qa(t,e){return t>e?-1:t===e?0:1}function ue(t,e,n){var r=t instanceof oo?new t.Collection(t):t;return r._ctx.error=n?new n(e):new TypeError(e),r}function tt(t){return new t.Collection(t,function(){return io("")}).limit(0)}function Ya(t){return t==="next"?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()}}function Ga(t){return t==="next"?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()}}function Qa(t,e,n,r,i,o){for(var a=Math.min(t.length,r.length),s=-1,u=0;u<a;++u){var l=e[u];if(l!==r[u])return i(t[u],n[u])<0?t.substr(0,u)+n[u]+n.substr(u+1):i(t[u],r[u])<0?t.substr(0,u)+r[u]+n.substr(u+1):s>=0?t.substr(0,s)+e[s]+n.substr(s+1):null;i(t[u],l)<0&&(s=u)}return a<r.length&&o==="next"?t+n.substr(t.length):a<t.length&&o==="prev"?t.substr(0,n.length):s<0?null:t.substr(0,s)+r[s]+n.substr(s+1)}function qt(t,e,n,r){var i,o,a,s,u,l,f,c=n.length;if(!n.every(function(v){return typeof v=="string"}))return ue(t,to);function p(v){i=Ya(v),o=Ga(v),a=v==="next"?Va:qa;var m=n.map(function(y){return{lower:o(y),upper:i(y)}}).sort(function(y,b){return a(y.lower,b.lower)});s=m.map(function(y){return y.upper}),u=m.map(function(y){return y.lower}),l=v,f=v==="next"?"":r}p("next");var h=new t.Collection(t,function(){return Fe(s[0],u[c-1]+r)});h._ondirectionchange=function(v){p(v)};var d=0;return h._addAlgorithm(function(v,m,y){var b=v.key;if(typeof b!="string")return!1;var k=o(b);if(e(k,u,d))return!0;for(var A=null,_=d;_<c;++_){var g=Qa(b,k,s[_],u[_],a,l);g===null&&A===null?d=_+1:(A===null||a(A,g)>0)&&(A=g)}return m(A!==null?function(){v.continue(A+f)}:y),!1}),h}function Fe(t,e,n,r){return{type:2,lower:t,upper:e,lowerOpen:n,upperOpen:r}}function io(t){return{type:1,lower:t,upper:t}}var oo=function(){function t(){}return Object.defineProperty(t.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),t.prototype.between=function(e,n,r,i){r=r!==!1,i=i===!0;try{return this._cmp(e,n)>0||this._cmp(e,n)===0&&(r||i)&&!(r&&i)?tt(this):new this.Collection(this,function(){return Fe(e,n,!r,!i)})}catch{return ue(this,Ae)}},t.prototype.equals=function(e){return e==null?ue(this,Ae):new this.Collection(this,function(){return io(e)})},t.prototype.above=function(e){return e==null?ue(this,Ae):new this.Collection(this,function(){return Fe(e,void 0,!0)})},t.prototype.aboveOrEqual=function(e){return e==null?ue(this,Ae):new this.Collection(this,function(){return Fe(e,void 0,!1)})},t.prototype.below=function(e){return e==null?ue(this,Ae):new this.Collection(this,function(){return Fe(void 0,e,!1,!0)})},t.prototype.belowOrEqual=function(e){return e==null?ue(this,Ae):new this.Collection(this,function(){return Fe(void 0,e)})},t.prototype.startsWith=function(e){return typeof e!="string"?ue(this,to):this.between(e,e+je,!0,!0)},t.prototype.startsWithIgnoreCase=function(e){return e===""?this.startsWith(e):qt(this,function(n,r){return n.indexOf(r[0])===0},[e],je)},t.prototype.equalsIgnoreCase=function(e){return qt(this,function(n,r){return n===r[0]},[e],"")},t.prototype.anyOfIgnoreCase=function(){var e=xe.apply(nt,arguments);return e.length===0?tt(this):qt(this,function(n,r){return r.indexOf(n)!==-1},e,"")},t.prototype.startsWithAnyOfIgnoreCase=function(){var e=xe.apply(nt,arguments);return e.length===0?tt(this):qt(this,function(n,r){return r.some(function(i){return n.indexOf(i)===0})},e,je)},t.prototype.anyOf=function(){var e=this,n=xe.apply(nt,arguments),r=this._cmp;try{n.sort(r)}catch{return ue(this,Ae)}if(n.length===0)return tt(this);var i=new this.Collection(this,function(){return Fe(n[0],n[n.length-1])});i._ondirectionchange=function(a){r=a==="next"?e._ascending:e._descending,n.sort(r)};var o=0;return i._addAlgorithm(function(a,s,u){for(var l=a.key;r(l,n[o])>0;)if(++o,o===n.length)return s(u),!1;return r(l,n[o])===0?!0:(s(function(){a.continue(n[o])}),!1)}),i},t.prototype.notEqual=function(e){return this.inAnyRange([[tr,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},t.prototype.noneOf=function(){var e=xe.apply(nt,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return ue(this,Ae)}var n=e.reduce(function(r,i){return r?r.concat([[r[r.length-1][1],i]]):[[tr,i]]},null);return n.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})},t.prototype.inAnyRange=function(e,n){var r=this,i=this._cmp,o=this._ascending,a=this._descending,s=this._min,u=this._max;if(e.length===0)return tt(this);if(!e.every(function(_){return _[0]!==void 0&&_[1]!==void 0&&o(_[0],_[1])<=0}))return ue(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",M.InvalidArgument);var l=!n||n.includeLowers!==!1,f=n&&n.includeUppers===!0;function c(_,g){for(var S=0,w=_.length;S<w;++S){var E=_[S];if(i(g[0],E[1])<0&&i(g[1],E[0])>0){E[0]=s(E[0],g[0]),E[1]=u(E[1],g[1]);break}}return S===w&&_.push(g),_}var p=o;function h(_,g){return p(_[0],g[0])}var d;try{d=e.reduce(c,[]),d.sort(h)}catch{return ue(this,Ae)}var v=0,m=f?function(_){return o(_,d[v][1])>0}:function(_){return o(_,d[v][1])>=0},y=l?function(_){return a(_,d[v][0])>0}:function(_){return a(_,d[v][0])>=0};function b(_){return!m(_)&&!y(_)}var k=m,A=new this.Collection(this,function(){return Fe(d[0][0],d[d.length-1][1],!l,!f)});return A._ondirectionchange=function(_){_==="next"?(k=m,p=o):(k=y,p=a),d.sort(h)},A._addAlgorithm(function(_,g,S){for(var w=_.key;k(w);)if(++v,v===d.length)return g(S),!1;return b(w)?!0:(r._cmp(w,d[v][1])===0||r._cmp(w,d[v][0])===0||g(function(){p===o?_.continue(d[v][0]):_.continue(d[v][1])}),!1)}),A},t.prototype.startsWithAnyOf=function(){var e=xe.apply(nt,arguments);return e.every(function(n){return typeof n=="string"})?e.length===0?tt(this):this.inAnyRange(e.map(function(n){return[n,n+je]})):ue(this,"startsWithAnyOf() only works with strings")},t}();function Xa(t){return Nt(oo.prototype,function(n,r,i){this.db=t,this._ctx={table:n,index:r===":id"?null:r,or:i};var o=t._deps.indexedDB;if(!o)throw new M.MissingAPI;this._cmp=this._ascending=o.cmp.bind(o),this._descending=function(a,s){return o.cmp(s,a)},this._max=function(a,s){return o.cmp(a,s)>0?a:s},this._min=function(a,s){return o.cmp(a,s)<0?a:s},this._IDBKeyRange=t._deps.IDBKeyRange})}function be(t){return V(function(e){return Tt(e),t(e.target.error),!1})}function Tt(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}var Dt="storagemutated",Le="x-storagemutated-1",$e=zt(null,Dt),Ja=function(){function t(){}return t.prototype._lock=function(){return vt(!R.global),++this._reculock,this._reculock===1&&!R.global&&(R.lockOwnerFor=this),this},t.prototype._unlock=function(){if(vt(!R.global),--this._reculock===0)for(R.global||(R.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{ft(e[1],e[0])}catch{}}return this},t.prototype._locked=function(){return this._reculock&&R.lockOwnerFor!==this},t.prototype.create=function(e){var n=this;if(!this.mode)return this;var r=this.db.idbdb,i=this.db._state.dbOpenError;if(vt(!this.idbtrans),!e&&!r)switch(i&&i.name){case"DatabaseClosedError":throw new M.DatabaseClosed(i);case"MissingAPIError":throw new M.MissingAPI(i.message,i);default:throw new M.OpenFailed(i)}if(!this.active)throw new M.TransactionInactive;return vt(this._completion._state===null),e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):r.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})),e.onerror=V(function(o){Tt(o),n._reject(e.error)}),e.onabort=V(function(o){Tt(o),n.active&&n._reject(new M.Abort(e.error)),n.active=!1,n.on("abort").fire(o)}),e.oncomplete=V(function(){n.active=!1,n._resolve(),"mutatedParts"in e&&$e.storagemutated.fire(e.mutatedParts)}),this},t.prototype._promise=function(e,n,r){var i=this;if(e==="readwrite"&&this.mode!=="readwrite")return X(new M.ReadOnly("Transaction is readonly"));if(!this.active)return X(new M.TransactionInactive);if(this._locked())return new T(function(a,s){i._blockedFuncs.push([function(){i._promise(e,n,r).then(a,s)},R])});if(r)return ze(function(){var a=new T(function(s,u){i._lock();var l=n(s,u,i);l&&l.then&&l.then(s,u)});return a.finally(function(){return i._unlock()}),a._lib=!0,a});var o=new T(function(a,s){var u=n(a,s,i);u&&u.then&&u.then(a,s)});return o._lib=!0,o},t.prototype._root=function(){return this.parent?this.parent._root():this},t.prototype.waitFor=function(e){var n=this._root(),r=T.resolve(e);if(n._waitingFor)n._waitingFor=n._waitingFor.then(function(){return r});else{n._waitingFor=r,n._waitingQueue=[];var i=n.idbtrans.objectStore(n.storeNames[0]);(function a(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(i.get(-1/0).onsuccess=a)})()}var o=n._waitingFor;return new T(function(a,s){r.then(function(u){return n._waitingQueue.push(V(a.bind(null,u)))},function(u){return n._waitingQueue.push(V(s.bind(null,u)))}).finally(function(){n._waitingFor===o&&(n._waitingFor=null)})})},t.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new M.Abort))},t.prototype.table=function(e){var n=this._memoizedTables||(this._memoizedTables={});if(le(n,e))return n[e];var r=this.schema[e];if(!r)throw new M.NotFound("Table "+e+" not part of transaction");var i=new this.db.Table(e,r,this);return i.core=this.db.core.table(e),n[e]=i,i},t}();function Za(t){return Nt(Ja.prototype,function(n,r,i,o,a){var s=this;this.db=t,this.mode=n,this.storeNames=r,this.schema=i,this.chromeTransactionDurability=o,this.idbtrans=null,this.on=zt(this,"complete","error","abort"),this.parent=a||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new T(function(u,l){s._resolve=u,s._reject=l}),this._completion.then(function(){s.active=!1,s.on.complete.fire()},function(u){var l=s.active;return s.active=!1,s.on.error.fire(u),s.parent?s.parent._reject(u):l&&s.idbtrans&&s.idbtrans.abort(),X(u)})})}function nr(t,e,n,r,i,o,a){return{name:t,keyPath:e,unique:n,multi:r,auto:i,compound:o,src:(n&&!a?"&":"")+(r?"*":"")+(i?"++":"")+ao(e)}}function ao(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function so(t,e,n){return{name:t,primKey:e,indexes:n,mappedClass:null,idxByName:Li(n,function(r){return[r.name,r]})}}function es(t){return t.length===1?t[0]:t}var Ot=function(t){try{return t.only([[]]),Ot=function(){return[[]]},[[]]}catch{return Ot=function(){return je},je}};function rr(t){return t==null?function(){}:typeof t=="string"?ts(t):function(e){return Oe(e,t)}}function ts(t){var e=t.split(".");return e.length===1?function(n){return n[t]}:function(n){return Oe(n,t)}}function Xr(t){return[].slice.call(t)}var ns=0;function wt(t){return t==null?":id":typeof t=="string"?t:"["+t.join("+")+"]"}function rs(t,e,n){function r(c,p){var h=Xr(c.objectStoreNames);return{schema:{name:c.name,tables:h.map(function(d){return p.objectStore(d)}).map(function(d){var v=d.keyPath,m=d.autoIncrement,y=ie(v),b=v==null,k={},A={name:d.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:b,compound:y,keyPath:v,autoIncrement:m,unique:!0,extractKey:rr(v)},indexes:Xr(d.indexNames).map(function(_){return d.index(_)}).map(function(_){var g=_.name,S=_.unique,w=_.multiEntry,E=_.keyPath,x=ie(E),C={name:g,compound:x,keyPath:E,unique:S,multiEntry:w,extractKey:rr(E)};return k[wt(E)]=C,C}),getIndexByKeyPath:function(_){return k[wt(_)]}};return k[":id"]=A.primaryKey,v!=null&&(k[wt(v)]=A.primaryKey),A})},hasGetAll:h.length>0&&"getAll"in p.objectStore(h[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function i(c){if(c.type===3)return null;if(c.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var p=c.lower,h=c.upper,d=c.lowerOpen,v=c.upperOpen,m=p===void 0?h===void 0?null:e.upperBound(h,!!v):h===void 0?e.lowerBound(p,!!d):e.bound(p,h,!!d,!!v);return m}function o(c){var p=c.name;function h(m){var y=m.trans,b=m.type,k=m.keys,A=m.values,_=m.range;return new Promise(function(g,S){g=V(g);var w=y.objectStore(p),E=w.keyPath==null,x=b==="put"||b==="add";if(!x&&b!=="delete"&&b!=="deleteRange")throw new Error("Invalid operation type: "+b);var C=(k||A||{length:1}).length;if(k&&A&&k.length!==A.length)throw new Error("Given keys array must have same length as given values array.");if(C===0)return g({numFailures:0,failures:{},results:[],lastResult:void 0});var L,z=[],j=[],K=0,te=function(_e){++K,Tt(_e)};if(b==="deleteRange"){if(_.type===4)return g({numFailures:K,failures:j,results:[],lastResult:void 0});_.type===3?z.push(L=w.clear()):z.push(L=w.delete(i(_)))}else{var ne=x?E?[A,k]:[A,null]:[k,null],Ke=ne[0],ge=ne[1];if(x)for(var fe=0;fe<C;++fe)z.push(L=ge&&ge[fe]!==void 0?w[b](Ke[fe],ge[fe]):w[b](Ke[fe])),L.onerror=te;else for(var fe=0;fe<C;++fe)z.push(L=w[b](Ke[fe])),L.onerror=te}var Pe=function(_e){var dt=_e.target.result;z.forEach(function(he,$t){return he.error!=null&&(j[$t]=he.error)}),g({numFailures:K,failures:j,results:b==="delete"?k:z.map(function(he){return he.result}),lastResult:dt})};L.onerror=function(_e){te(_e),Pe(_e)},L.onsuccess=Pe})}function d(m){var y=m.trans,b=m.values,k=m.query,A=m.reverse,_=m.unique;return new Promise(function(g,S){g=V(g);var w=k.index,E=k.range,x=y.objectStore(p),C=w.isPrimaryKey?x:x.index(w.name),L=A?_?"prevunique":"prev":_?"nextunique":"next",z=b||!("openKeyCursor"in C)?C.openCursor(i(E),L):C.openKeyCursor(i(E),L);z.onerror=be(S),z.onsuccess=V(function(j){var K=z.result;if(!K){g(null);return}K.___id=++ns,K.done=!1;var te=K.continue.bind(K),ne=K.continuePrimaryKey;ne&&(ne=ne.bind(K));var Ke=K.advance.bind(K),ge=function(){throw new Error("Cursor not started")},fe=function(){throw new Error("Cursor not stopped")};K.trans=y,K.stop=K.continue=K.continuePrimaryKey=K.advance=ge,K.fail=V(S),K.next=function(){var Pe=this,_e=1;return this.start(function(){return _e--?Pe.continue():Pe.stop()}).then(function(){return Pe})},K.start=function(Pe){var _e=new Promise(function(he,$t){he=V(he),z.onerror=be($t),K.fail=$t,K.stop=function(Bo){K.stop=K.continue=K.continuePrimaryKey=K.advance=fe,he(Bo)}}),dt=function(){if(z.result)try{Pe()}catch(he){K.fail(he)}else K.done=!0,K.start=function(){throw new Error("Cursor behind last entry")},K.stop()};return z.onsuccess=V(function(he){z.onsuccess=dt,dt()}),K.continue=te,K.continuePrimaryKey=ne,K.advance=Ke,dt(),_e},g(K)},S)})}function v(m){return function(y){return new Promise(function(b,k){b=V(b);var A=y.trans,_=y.values,g=y.limit,S=y.query,w=g===1/0?void 0:g,E=S.index,x=S.range,C=A.objectStore(p),L=E.isPrimaryKey?C:C.index(E.name),z=i(x);if(g===0)return b({result:[]});if(m){var j=_?L.getAll(z,w):L.getAllKeys(z,w);j.onsuccess=function(Ke){return b({result:Ke.target.result})},j.onerror=be(k)}else{var K=0,te=_||!("openKeyCursor"in L)?L.openCursor(z):L.openKeyCursor(z),ne=[];te.onsuccess=function(Ke){var ge=te.result;if(!ge)return b({result:ne});if(ne.push(_?ge.value:ge.primaryKey),++K===g)return b({result:ne});ge.continue()},te.onerror=be(k)}})}}return{name:p,schema:c,mutate:h,getMany:function(m){var y=m.trans,b=m.keys;return new Promise(function(k,A){k=V(k);for(var _=y.objectStore(p),g=b.length,S=new Array(g),w=0,E=0,x,C=function(K){var te=K.target;(S[te._pos]=te.result)!=null,++E===w&&k(S)},L=be(A),z=0;z<g;++z){var j=b[z];j!=null&&(x=_.get(b[z]),x._pos=z,x.onsuccess=C,x.onerror=L,++w)}w===0&&k(S)})},get:function(m){var y=m.trans,b=m.key;return new Promise(function(k,A){k=V(k);var _=y.objectStore(p),g=_.get(b);g.onsuccess=function(S){return k(S.target.result)},g.onerror=be(A)})},query:v(u),openCursor:d,count:function(m){var y=m.query,b=m.trans,k=y.index,A=y.range;return new Promise(function(_,g){var S=b.objectStore(p),w=k.isPrimaryKey?S:S.index(k.name),E=i(A),x=E?w.count(E):w.count();x.onsuccess=V(function(C){return _(C.target.result)}),x.onerror=be(g)})}}}var a=r(t,n),s=a.schema,u=a.hasGetAll,l=s.tables.map(function(c){return o(c)}),f={};return l.forEach(function(c){return f[c.name]=c}),{stack:"dbcore",transaction:t.transaction.bind(t),table:function(c){var p=f[c];if(!p)throw new Error("Table '"+c+"' not found");return f[c]},MIN_KEY:-1/0,MAX_KEY:Ot(e),schema:s}}function is(t,e){return e.reduce(function(n,r){var i=r.create;return $($({},n),i(n))},t)}function os(t,e,n,r){var i=n.IDBKeyRange;n.indexedDB;var o=is(rs(e,i,r),t.dbcore);return{dbcore:o}}function xr(t,e){var n=t._novip,r=e.db,i=os(n._middlewares,r,n._deps,e);n.core=i.dbcore,n.tables.forEach(function(o){var a=o.name;n.core.schema.tables.some(function(s){return s.name===a})&&(o.core=n.core.table(a),n[a]instanceof n.Table&&(n[a].core=o.core))})}function gn(t,e,n,r){var i=t._novip;n.forEach(function(o){var a=r[o];e.forEach(function(s){var u=yr(s,o);(!u||"value"in u&&u.value===void 0)&&(s===i.Transaction.prototype||s instanceof i.Transaction?Re(s,o,{get:function(){return this.table(o)},set:function(l){Pi(this,o,{value:l,writable:!0,configurable:!0,enumerable:!0})}}):s[o]=new i.Table(o,a))})})}function ir(t,e){var n=t._novip;e.forEach(function(r){for(var i in r)r[i]instanceof n.Table&&delete r[i]})}function as(t,e){return t._cfg.version-e._cfg.version}function ss(t,e,n,r){var i=t._dbSchema,o=t._createTransaction("readwrite",t._storeNames,i);o.create(n),o._completion.catch(r);var a=o._reject.bind(o),s=R.transless||R;ze(function(){R.trans=o,R.transless=s,e===0?(G(i).forEach(function(u){Cr(n,u,i[u].primKey,i[u].indexes)}),xr(t,n),T.follow(function(){return t.on.populate.fire(o)}).catch(a)):us(t,e,o,n).catch(a)})}function us(t,e,n,r){var i=t._novip,o=[],a=i._versions,s=i._dbSchema=Br(i,i.idbdb,r),u=!1,l=a.filter(function(c){return c._cfg.version>=e});l.forEach(function(c){o.push(function(){var p=s,h=c._cfg.dbschema;ar(i,p,r),ar(i,h,r),s=i._dbSchema=h;var d=uo(p,h);d.add.forEach(function(A){Cr(r,A[0],A[1].primKey,A[1].indexes)}),d.change.forEach(function(A){if(A.recreate)throw new M.Upgrade("Not yet support for changing primary key");var _=r.objectStore(A.name);A.add.forEach(function(g){return or(_,g)}),A.change.forEach(function(g){_.deleteIndex(g.name),or(_,g)}),A.del.forEach(function(g){return _.deleteIndex(g)})});var v=c._cfg.contentUpgrade;if(v&&c._cfg.version>e){xr(i,r),n._memoizedTables={},u=!0;var m=zi(h);d.del.forEach(function(A){m[A]=p[A]}),ir(i,[i.Transaction.prototype]),gn(i,[i.Transaction.prototype],G(m),m),n.schema=m;var y=gr(v);y&&ct();var b,k=T.follow(function(){if(b=v(n),b&&y){var A=Ie.bind(null,null);b.then(A,A)}});return b&&typeof b.then=="function"?T.resolve(b):k.then(function(){return b})}}),o.push(function(p){if(!u||!Ma){var h=c._cfg.dbschema;cs(h,p)}ir(i,[i.Transaction.prototype]),gn(i,[i.Transaction.prototype],i._storeNames,i._dbSchema),n.schema=i._dbSchema})});function f(){return o.length?T.resolve(o.shift()(n.idbtrans)).then(f):T.resolve()}return f().then(function(){ls(s,r)})}function uo(t,e){var n={del:[],add:[],change:[]},r;for(r in t)e[r]||n.del.push(r);for(r in e){var i=t[r],o=e[r];if(!i)n.add.push([r,o]);else{var a={name:r,def:o,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(o.primKey.keyPath||"")||i.primKey.auto!==o.primKey.auto&&!An)a.recreate=!0,n.change.push(a);else{var s=i.idxByName,u=o.idxByName,l=void 0;for(l in s)u[l]||a.del.push(l);for(l in u){var f=s[l],c=u[l];f?f.src!==c.src&&a.change.push(c):a.add.push(c)}(a.del.length>0||a.add.length>0||a.change.length>0)&&n.change.push(a)}}}return n}function Cr(t,e,n,r){var i=t.db.createObjectStore(e,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(function(o){return or(i,o)}),i}function ls(t,e){G(t).forEach(function(n){e.db.objectStoreNames.contains(n)||Cr(e,n,t[n].primKey,t[n].indexes)})}function cs(t,e){[].slice.call(e.db.objectStoreNames).forEach(function(n){return t[n]==null&&e.db.deleteObjectStore(n)})}function or(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function Br(t,e,n){var r={},i=kn(e.objectStoreNames,0);return i.forEach(function(o){for(var a=n.objectStore(o),s=a.keyPath,u=nr(ao(s),s||"",!1,!1,!!a.autoIncrement,s&&typeof s!="string",!0),l=[],f=0;f<a.indexNames.length;++f){var c=a.index(a.indexNames[f]);s=c.keyPath;var p=nr(c.name,s,!!c.unique,!!c.multiEntry,!1,s&&typeof s!="string",!1);l.push(p)}r[o]=so(o,u,l)}),r}function fs(t,e,n){var r=t._novip;r.verno=e.version/10;var i=r._dbSchema=Br(r,e,n);r._storeNames=kn(e.objectStoreNames,0),gn(r,[r._allTables],G(i),i)}function ds(t,e){var n=Br(t,t.idbdb,e),r=uo(n,t._dbSchema);return!(r.add.length||r.change.some(function(i){return i.add.length||i.change.length}))}function ar(t,e,n){for(var r=t._novip,i=n.db.objectStoreNames,o=0;o<i.length;++o){var a=i[o],s=n.objectStore(a);r._hasGetAll="getAll"in s;for(var u=0;u<s.indexNames.length;++u){var l=s.indexNames[u],f=s.index(l).keyPath,c=typeof f=="string"?f:"["+kn(f).join("+")+"]";if(e[a]){var p=e[a].idxByName[c];p&&(p.name=l,delete e[a].idxByName[c],e[a].idxByName[l]=p)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&W.WorkerGlobalScope&&W instanceof W.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(r._hasGetAll=!1)}function hs(t){return t.split(",").map(function(e,n){e=e.trim();var r=e.replace(/([&*]|\+\+)/g,""),i=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return nr(r,i||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),ie(i),n===0)})}var ps=function(){function t(){}return t.prototype._parseStoresSpec=function(e,n){G(e).forEach(function(r){if(e[r]!==null){var i=hs(e[r]),o=i.shift();if(o.multi)throw new M.Schema("Primary key cannot be multi-valued");i.forEach(function(a){if(a.auto)throw new M.Schema("Only primary key can be marked as autoIncrement (++)");if(!a.keyPath)throw new M.Schema("Index must have a name and cannot be an empty string")}),n[r]=so(r,o,i)}})},t.prototype.stores=function(e){var n=this.db;this._cfg.storesSource=this._cfg.storesSource?se(this._cfg.storesSource,e):e;var r=n._versions,i={},o={};return r.forEach(function(a){se(i,a._cfg.storesSource),o=a._cfg.dbschema={},a._parseStoresSpec(i,o)}),n._dbSchema=o,ir(n,[n._allTables,n,n.Transaction.prototype]),gn(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],G(o),o),n._storeNames=G(o),this},t.prototype.upgrade=function(e){return this._cfg.contentUpgrade=wr(this._cfg.contentUpgrade||H,e),this},t}();function vs(t){return Nt(ps.prototype,function(n){this.db=t,this._cfg={version:n,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function Tr(t,e){var n=t._dbNamesDB;return n||(n=t._dbNamesDB=new Ir(Sn,{addons:[],indexedDB:t,IDBKeyRange:e}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function Dr(t){return t&&typeof t.databases=="function"}function ms(t){var e=t.indexedDB,n=t.IDBKeyRange;return Dr(e)?Promise.resolve(e.databases()).then(function(r){return r.map(function(i){return i.name}).filter(function(i){return i!==Sn})}):Tr(e,n).toCollection().primaryKeys()}function ys(t,e){var n=t.indexedDB,r=t.IDBKeyRange;!Dr(n)&&e!==Sn&&Tr(n,r).put({name:e}).catch(H)}function gs(t,e){var n=t.indexedDB,r=t.IDBKeyRange;!Dr(n)&&e!==Sn&&Tr(n,r).delete(e).catch(H)}function sr(t){return ze(function(){return R.letThrough=!0,t()})}function _s(){var t=!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent);if(!t||!indexedDB.databases)return Promise.resolve();var e;return new Promise(function(n){var r=function(){return indexedDB.databases().finally(n)};e=setInterval(r,100),r()}).finally(function(){return clearInterval(e)})}function bs(t){var e=t._state,n=t._deps.indexedDB;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(function(){return e.dbOpenError?X(e.dbOpenError):t});Ee&&(e.openCanceller._stackHolder=Ze()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;var r=e.openCanceller;function i(){if(e.openCanceller!==r)throw new M.DatabaseClosed("db.open() was cancelled")}var o=e.dbReadyResolve,a=null,s=!1;return T.race([r,(typeof navigator>"u"?T.resolve():_s()).then(function(){return new T(function(u,l){if(i(),!n)throw new M.MissingAPI;var f=t.name,c=e.autoSchema?n.open(f):n.open(f,Math.round(t.verno*10));if(!c)throw new M.MissingAPI;c.onerror=be(l),c.onblocked=V(t._fireOnBlocked),c.onupgradeneeded=V(function(p){if(a=c.transaction,e.autoSchema&&!t._options.allowEmptyDB){c.onerror=Tt,a.abort(),c.result.close();var h=n.deleteDatabase(f);h.onsuccess=h.onerror=V(function(){l(new M.NoSuchDatabase("Database "+f+" doesnt exist"))})}else{a.onerror=be(l);var d=p.oldVersion>Math.pow(2,62)?0:p.oldVersion;s=d<1,t._novip.idbdb=c.result,ss(t,d/10,a,l)}},l),c.onsuccess=V(function(){a=null;var p=t._novip.idbdb=c.result,h=kn(p.objectStoreNames);if(h.length>0)try{var d=p.transaction(es(h),"readonly");e.autoSchema?fs(t,p,d):(ar(t,t._dbSchema,d),ds(t,d)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),xr(t,d)}catch{}bt.push(t),p.onversionchange=V(function(v){e.vcFired=!0,t.on("versionchange").fire(v)}),p.onclose=V(function(v){t.on("close").fire(v)}),s&&ys(t._deps,f),u()},l)})})]).then(function(){return i(),e.onReadyBeingFired=[],T.resolve(sr(function(){return t.on.ready.fire(t.vip)})).then(function u(){if(e.onReadyBeingFired.length>0){var l=e.onReadyBeingFired.reduce(wr,H);return e.onReadyBeingFired=[],T.resolve(sr(function(){return l(t.vip)})).then(u)}})}).finally(function(){e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(function(){return t}).catch(function(u){e.dbOpenError=u;try{a&&a.abort()}catch{}return r===e.openCanceller&&t._close(),X(u)}).finally(function(){e.openComplete=!0,o()})}function ur(t){var e=function(a){return t.next(a)},n=function(a){return t.throw(a)},r=o(e),i=o(n);function o(a){return function(s){var u=a(s),l=u.value;return u.done?l:!l||typeof l.then!="function"?ie(l)?Promise.all(l).then(r,i):r(l):l.then(r,i)}}return o(e)()}function ws(t,e,n){var r=arguments.length;if(r<2)throw new M.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];n=i.pop();var o=Ni(i);return[t,o,n]}function lo(t,e,n,r,i){return T.resolve().then(function(){var o=R.transless||R,a=t._createTransaction(e,n,t._dbSchema,r),s={trans:a,transless:o};if(r)a.idbtrans=r.idbtrans;else try{a.create(),t._state.PR1398_maxLoop=3}catch(c){return c.name===br.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(function(){return lo(t,e,n,null,i)})):X(c)}var u=gr(i);u&&ct();var l,f=T.follow(function(){if(l=i.call(a,a),l)if(u){var c=Ie.bind(null,null);l.then(c,c)}else typeof l.next=="function"&&typeof l.throw=="function"&&(l=ur(l))},s);return(l&&typeof l.then=="function"?T.resolve(l).then(function(c){return a.active?c:X(new M.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):f.then(function(){return l})).then(function(c){return r&&a._resolve(),a._completion.then(function(){return c})}).catch(function(c){return a._reject(c),X(c)})})}function Yt(t,e,n){for(var r=ie(t)?t.slice():[t],i=0;i<n;++i)r.push(e);return r}function ks(t){return $($({},t),{table:function(e){var n=t.table(e),r=n.schema,i={},o=[];function a(v,m,y){var b=wt(v),k=i[b]=i[b]||[],A=v==null?0:typeof v=="string"?1:v.length,_=m>0,g=$($({},y),{isVirtual:_,keyTail:m,keyLength:A,extractKey:rr(v),unique:!_&&y.unique});if(k.push(g),g.isPrimaryKey||o.push(g),A>1){var S=A===2?v[0]:v.slice(0,A-1);a(S,m+1,y)}return k.sort(function(w,E){return w.keyTail-E.keyTail}),g}var s=a(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[s];for(var u=0,l=r.indexes;u<l.length;u++){var f=l[u];a(f.keyPath,0,f)}function c(v){var m=i[wt(v)];return m&&m[0]}function p(v,m){return{type:v.type===1?2:v.type,lower:Yt(v.lower,v.lowerOpen?t.MAX_KEY:t.MIN_KEY,m),lowerOpen:!0,upper:Yt(v.upper,v.upperOpen?t.MIN_KEY:t.MAX_KEY,m),upperOpen:!0}}function h(v){var m=v.query.index;return m.isVirtual?$($({},v),{query:{index:m,range:p(v.query.range,m.keyTail)}}):v}var d=$($({},n),{schema:$($({},r),{primaryKey:s,indexes:o,getIndexByKeyPath:c}),count:function(v){return n.count(h(v))},query:function(v){return n.query(h(v))},openCursor:function(v){var m=v.query.index,y=m.keyTail,b=m.isVirtual,k=m.keyLength;if(!b)return n.openCursor(v);function A(_){function g(w){w!=null?_.continue(Yt(w,v.reverse?t.MAX_KEY:t.MIN_KEY,y)):v.unique?_.continue(_.key.slice(0,k).concat(v.reverse?t.MIN_KEY:t.MAX_KEY,y)):_.continue()}var S=Object.create(_,{continue:{value:g},continuePrimaryKey:{value:function(w,E){_.continuePrimaryKey(Yt(w,t.MAX_KEY,y),E)}},primaryKey:{get:function(){return _.primaryKey}},key:{get:function(){var w=_.key;return k===1?w[0]:w.slice(0,k)}},value:{get:function(){return _.value}}});return S}return n.openCursor(h(v)).then(function(_){return _&&A(_)})}});return d}})}var Es={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:ks};function Or(t,e,n,r){return n=n||{},r=r||"",G(t).forEach(function(i){if(!le(e,i))n[r+i]=void 0;else{var o=t[i],a=e[i];if(typeof o=="object"&&typeof a=="object"&&o&&a){var s=jn(o),u=jn(a);s!==u?n[r+i]=e[i]:s==="Object"?Or(o,a,n,r+i+"."):o!==a&&(n[r+i]=e[i])}else o!==a&&(n[r+i]=e[i])}}),G(e).forEach(function(i){le(t,i)||(n[r+i]=e[i])}),n}function As(t,e){return e.type==="delete"?e.keys:e.keys||e.values.map(t.extractKey)}var Ss={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(t){return $($({},t),{table:function(e){var n=t.table(e),r=n.schema.primaryKey,i=$($({},n),{mutate:function(o){var a=R.trans,s=a.table(e).hook,u=s.deleting,l=s.creating,f=s.updating;switch(o.type){case"add":if(l.fire===H)break;return a._promise("readwrite",function(){return c(o)},!0);case"put":if(l.fire===H&&f.fire===H)break;return a._promise("readwrite",function(){return c(o)},!0);case"delete":if(u.fire===H)break;return a._promise("readwrite",function(){return c(o)},!0);case"deleteRange":if(u.fire===H)break;return a._promise("readwrite",function(){return p(o)},!0)}return n.mutate(o);function c(d){var v=R.trans,m=d.keys||As(r,d);if(!m)throw new Error("Keys missing");return d=d.type==="add"||d.type==="put"?$($({},d),{keys:m}):$({},d),d.type!=="delete"&&(d.values=$n([],d.values,!0)),d.keys&&(d.keys=$n([],d.keys,!0)),xs(n,d,m).then(function(y){var b=m.map(function(k,A){var _=y[A],g={onerror:null,onsuccess:null};if(d.type==="delete")u.fire.call(g,k,_,v);else if(d.type==="add"||_===void 0){var S=l.fire.call(g,k,d.values[A],v);k==null&&S!=null&&(k=S,d.keys[A]=k,r.outbound||ye(d.values[A],r.keyPath,k))}else{var w=Or(_,d.values[A]),E=f.fire.call(g,w,k,_,v);if(E){var x=d.values[A];Object.keys(E).forEach(function(C){le(x,C)?x[C]=E[C]:ye(x,C,E[C])})}}return g});return n.mutate(d).then(function(k){for(var A=k.failures,_=k.results,g=k.numFailures,S=k.lastResult,w=0;w<m.length;++w){var E=_?_[w]:m[w],x=b[w];E==null?x.onerror&&x.onerror(A[w]):x.onsuccess&&x.onsuccess(d.type==="put"&&y[w]?d.values[w]:E)}return{failures:A,results:_,numFailures:g,lastResult:S}}).catch(function(k){return b.forEach(function(A){return A.onerror&&A.onerror(k)}),Promise.reject(k)})})}function p(d){return h(d.trans,d.range,1e4)}function h(d,v,m){return n.query({trans:d,values:!1,query:{index:r,range:v},limit:m}).then(function(y){var b=y.result;return c({type:"delete",keys:b,trans:d}).then(function(k){return k.numFailures>0?Promise.reject(k.failures[0]):b.length<m?{failures:[],numFailures:0,lastResult:void 0}:h(d,$($({},v),{lower:b[b.length-1],lowerOpen:!0}),m)})})}}});return i}})}};function xs(t,e,n){return e.type==="add"?Promise.resolve([]):t.getMany({trans:e.trans,keys:n,cache:"immutable"})}function co(t,e,n){try{if(!e||e.keys.length<t.length)return null;for(var r=[],i=0,o=0;i<e.keys.length&&o<t.length;++i)ae(e.keys[i],t[o])===0&&(r.push(n?Pt(e.values[i]):e.values[i]),++o);return r.length===t.length?r:null}catch{return null}}var Cs={stack:"dbcore",level:-1,create:function(t){return{table:function(e){var n=t.table(e);return $($({},n),{getMany:function(r){if(!r.cache)return n.getMany(r);var i=co(r.keys,r.trans._cache,r.cache==="clone");return i?T.resolve(i):n.getMany(r).then(function(o){return r.trans._cache={keys:r.keys,values:r.cache==="clone"?Pt(o):o},o})},mutate:function(r){return r.type!=="add"&&(r.trans._cache=null),n.mutate(r)}})}}}},Kn;function Rr(t){return!("from"in t)}var Se=function(t,e){if(this)se(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0});else{var n=new Se;return t&&"d"in t&&se(n,t),n}};at(Se.prototype,(Kn={add:function(t){return _n(this,t),this},addKey:function(t){return Rt(this,t,t),this},addKeys:function(t){var e=this;return t.forEach(function(n){return Rt(e,n,n)}),this}},Kn[Hn]=function(){return lr(this)},Kn));function Rt(t,e,n){var r=ae(e,n);if(!isNaN(r)){if(r>0)throw RangeError();if(Rr(t))return se(t,{from:e,to:n,d:1});var i=t.l,o=t.r;if(ae(n,t.from)<0)return i?Rt(i,e,n):t.l={from:e,to:n,d:1,l:null,r:null},Jr(t);if(ae(e,t.to)>0)return o?Rt(o,e,n):t.r={from:e,to:n,d:1,l:null,r:null},Jr(t);ae(e,t.from)<0&&(t.from=e,t.l=null,t.d=o?o.d+1:1),ae(n,t.to)>0&&(t.to=n,t.r=null,t.d=t.l?t.l.d+1:1);var a=!t.r;i&&!t.l&&_n(t,i),o&&a&&_n(t,o)}}function _n(t,e){function n(r,i){var o=i.from,a=i.to,s=i.l,u=i.r;Rt(r,o,a),s&&n(r,s),u&&n(r,u)}Rr(e)||n(t,e)}function Bs(t,e){var n=lr(e),r=n.next();if(r.done)return!1;for(var i=r.value,o=lr(t),a=o.next(i.from),s=a.value;!r.done&&!a.done;){if(ae(s.from,i.to)<=0&&ae(s.to,i.from)>=0)return!0;ae(i.from,s.from)<0?i=(r=n.next(s.from)).value:s=(a=o.next(i.from)).value}return!1}function lr(t){var e=Rr(t)?null:{s:0,n:t};return{next:function(n){for(var r=arguments.length>0;e;)switch(e.s){case 0:if(e.s=1,r)for(;e.n.l&&ae(n,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!r||ae(n,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function Jr(t){var e,n,r=(((e=t.r)===null||e===void 0?void 0:e.d)||0)-(((n=t.l)===null||n===void 0?void 0:n.d)||0),i=r>1?"r":r<-1?"l":"";if(i){var o=i==="r"?"l":"r",a=$({},t),s=t[i];t.from=s.from,t.to=s.to,t[i]=s[i],a[i]=s[o],t[o]=a,a.d=Zr(a)}t.d=Zr(t)}function Zr(t){var e=t.r,n=t.l;return(e?n?Math.max(e.d,n.d):e.d:n?n.d:0)+1}var Ts={stack:"dbcore",level:0,create:function(t){var e=t.schema.name,n=new Se(t.MIN_KEY,t.MAX_KEY);return $($({},t),{table:function(r){var i=t.table(r),o=i.schema,a=o.primaryKey,s=a.extractKey,u=a.outbound,l=$($({},i),{mutate:function(p){var h=p.trans,d=h.mutatedParts||(h.mutatedParts={}),v=function(S){var w="idb://"+e+"/"+r+"/"+S;return d[w]||(d[w]=new Se)},m=v(""),y=v(":dels"),b=p.type,k=p.type==="deleteRange"?[p.range]:p.type==="delete"?[p.keys]:p.values.length<50?[[],p.values]:[],A=k[0],_=k[1],g=p.trans._cache;return i.mutate(p).then(function(S){if(ie(A)){b!=="delete"&&(A=S.results),m.addKeys(A);var w=co(A,g);!w&&b!=="add"&&y.addKeys(A),(w||_)&&Ds(v,o,w,_)}else if(A){var E={from:A.lower,to:A.upper};y.add(E),m.add(E)}else m.add(n),y.add(n),o.indexes.forEach(function(x){return v(x.name).add(n)});return S})}}),f=function(p){var h,d,v=p.query,m=v.index,y=v.range;return[m,new Se((h=y.lower)!==null&&h!==void 0?h:t.MIN_KEY,(d=y.upper)!==null&&d!==void 0?d:t.MAX_KEY)]},c={get:function(p){return[a,new Se(p.key)]},getMany:function(p){return[a,new Se().addKeys(p.keys)]},count:f,query:f,openCursor:f};return G(c).forEach(function(p){l[p]=function(h){var d=R.subscr;if(d){var v=function(g){var S="idb://"+e+"/"+r+"/"+g;return d[S]||(d[S]=new Se)},m=v(""),y=v(":dels"),b=c[p](h),k=b[0],A=b[1];if(v(k.name||"").add(A),!k.isPrimaryKey)if(p==="count")y.add(n);else{var _=p==="query"&&u&&h.values&&i.query($($({},h),{values:!1}));return i[p].apply(this,arguments).then(function(g){if(p==="query"){if(u&&h.values)return _.then(function(x){var C=x.result;return m.addKeys(C),g});var S=h.values?g.result.map(s):g.result;h.values?m.addKeys(S):y.addKeys(S)}else if(p==="openCursor"){var w=g,E=h.values;return w&&Object.create(w,{key:{get:function(){return y.addKey(w.primaryKey),w.key}},primaryKey:{get:function(){var x=w.primaryKey;return y.addKey(x),x}},value:{get:function(){return E&&m.addKey(w.primaryKey),w.value}}})}return g})}}return i[p].apply(this,arguments)}}),l}})}};function Ds(t,e,n,r){function i(o){var a=t(o.name||"");function s(l){return l!=null?o.extractKey(l):null}var u=function(l){return o.multiEntry&&ie(l)?l.forEach(function(f){return a.addKey(f)}):a.addKey(l)};(n||r).forEach(function(l,f){var c=n&&s(n[f]),p=r&&s(r[f]);ae(c,p)!==0&&(c!=null&&u(c),p!=null&&u(p))})}e.indexes.forEach(i)}var Ir=function(){function t(e,n){var r=this;this._middlewares={},this.verno=0;var i=t.dependencies;this._options=n=$({addons:t.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange},n),this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};var o=n.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var a={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:H,dbReadyPromise:null,cancelOpen:H,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};a.dbReadyPromise=new T(function(s){a.dbReadyResolve=s}),a.openCanceller=new T(function(s,u){a.cancelOpen=u}),this._state=a,this.name=e,this.on=zt(this,"populate","blocked","versionchange","close",{ready:[wr,H]}),this.on.ready.subscribe=Fi(this.on.ready.subscribe,function(s){return function(u,l){t.vip(function(){var f=r._state;if(f.openComplete)f.dbOpenError||T.resolve().then(u),l&&s(u);else if(f.onReadyBeingFired)f.onReadyBeingFired.push(u),l&&s(u);else{s(u);var c=r;l||s(function p(){c.on.ready.unsubscribe(u),c.on.ready.unsubscribe(p)})}})}}),this.Collection=Wa(this),this.Table=Na(this),this.Transaction=Za(this),this.Version=vs(this),this.WhereClause=Xa(this),this.on("versionchange",function(s){s.newVersion>0?console.warn("Another connection wants to upgrade database '"+r.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+r.name+"'. Closing db now to resume the delete request."),r.close()}),this.on("blocked",function(s){!s.newVersion||s.newVersion<s.oldVersion?console.warn("Dexie.delete('"+r.name+"') was blocked"):console.warn("Upgrade '"+r.name+"' blocked by other connection holding version "+s.oldVersion/10)}),this._maxKey=Ot(n.IDBKeyRange),this._createTransaction=function(s,u,l,f){return new r.Transaction(s,u,l,r._options.chromeTransactionDurability,f)},this._fireOnBlocked=function(s){r.on("blocked").fire(s),bt.filter(function(u){return u.name===r.name&&u!==r&&!u._state.vcFired}).map(function(u){return u.on("versionchange").fire(s)})},this.use(Es),this.use(Ss),this.use(Ts),this.use(Cs),this.vip=Object.create(this,{_vip:{value:!0}}),o.forEach(function(s){return s(r)})}return t.prototype.version=function(e){if(isNaN(e)||e<.1)throw new M.Type("Given version is not a positive number");if(e=Math.round(e*10)/10,this.idbdb||this._state.isBeingOpened)throw new M.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var n=this._versions,r=n.filter(function(i){return i._cfg.version===e})[0];return r||(r=new this.Version(e),n.push(r),n.sort(as),r.stores({}),this._state.autoSchema=!1,r)},t.prototype._whenReady=function(e){var n=this;return this.idbdb&&(this._state.openComplete||R.letThrough||this._vip)?e():new T(function(r,i){if(n._state.openComplete)return i(new M.DatabaseClosed(n._state.dbOpenError));if(!n._state.isBeingOpened){if(!n._options.autoOpen){i(new M.DatabaseClosed);return}n.open().catch(H)}n._state.dbReadyPromise.then(r,i)}).then(e)},t.prototype.use=function(e){var n=e.stack,r=e.create,i=e.level,o=e.name;o&&this.unuse({stack:n,name:o});var a=this._middlewares[n]||(this._middlewares[n]=[]);return a.push({stack:n,create:r,level:i==null?10:i,name:o}),a.sort(function(s,u){return s.level-u.level}),this},t.prototype.unuse=function(e){var n=e.stack,r=e.name,i=e.create;return n&&this._middlewares[n]&&(this._middlewares[n]=this._middlewares[n].filter(function(o){return i?o.create!==i:r?o.name!==r:!1})),this},t.prototype.open=function(){return bs(this)},t.prototype._close=function(){var e=this._state,n=bt.indexOf(this);if(n>=0&&bt.splice(n,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}e.dbReadyPromise=new T(function(r){e.dbReadyResolve=r}),e.openCanceller=new T(function(r,i){e.cancelOpen=i})},t.prototype.close=function(){this._close();var e=this._state;this._options.autoOpen=!1,e.dbOpenError=new M.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)},t.prototype.delete=function(){var e=this,n=arguments.length>0,r=this._state;return new T(function(i,o){var a=function(){e.close();var s=e._deps.indexedDB.deleteDatabase(e.name);s.onsuccess=V(function(){gs(e._deps,e.name),i()}),s.onerror=be(o),s.onblocked=e._fireOnBlocked};if(n)throw new M.InvalidArgument("Arguments not allowed in db.delete()");r.isBeingOpened?r.dbReadyPromise.then(a):a()})},t.prototype.backendDB=function(){return this.idbdb},t.prototype.isOpen=function(){return this.idbdb!==null},t.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"},t.prototype.hasFailed=function(){return this._state.dbOpenError!==null},t.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(t.prototype,"tables",{get:function(){var e=this;return G(this._allTables).map(function(n){return e._allTables[n]})},enumerable:!1,configurable:!0}),t.prototype.transaction=function(){var e=ws.apply(this,arguments);return this._transaction.apply(this,e)},t.prototype._transaction=function(e,n,r){var i=this,o=R.trans;(!o||o.db!==this||e.indexOf("!")!==-1)&&(o=null);var a=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");var s,u;try{if(u=n.map(function(f){var c=f instanceof i.Table?f.name:f;if(typeof c!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return c}),e=="r"||e===Tn)s=Tn;else if(e=="rw"||e==Dn)s=Dn;else throw new M.InvalidArgument("Invalid transaction mode: "+e);if(o){if(o.mode===Tn&&s===Dn)if(a)o=null;else throw new M.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");o&&u.forEach(function(f){if(o&&o.storeNames.indexOf(f)===-1)if(a)o=null;else throw new M.SubTransaction("Table "+f+" not included in parent transaction.")}),a&&o&&!o.active&&(o=null)}}catch(f){return o?o._promise(null,function(c,p){p(f)}):X(f)}var l=lo.bind(null,this,s,u,o,r);return o?o._promise(s,l,"lock"):R.trans?ft(R.transless,function(){return i._whenReady(l)}):this._whenReady(l)},t.prototype.table=function(e){if(!le(this._allTables,e))throw new M.InvalidTable("Table "+e+" does not exist");return this._allTables[e]},t}(),Os=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Rs=function(){function t(e){this._subscribe=e}return t.prototype.subscribe=function(e,n,r){return this._subscribe(!e||typeof e=="function"?{next:e,error:n,complete:r}:e)},t.prototype[Os]=function(){return this},t}();function fo(t,e){return G(e).forEach(function(n){var r=t[n]||(t[n]=new Se);_n(r,e[n])}),t}function ho(t){return new Rs(function(e){var n=gr(t);function r(h){n&&ct();var d=function(){return ze(t,{subscr:h,trans:null})},v=R.trans?ft(R.transless,d):d();return n&&v.then(Ie,Ie),v}var i=!1,o={},a={},s={get closed(){return i},unsubscribe:function(){i=!0,$e.storagemutated.unsubscribe(c)}};e.start&&e.start(s);var u=!1,l=!1;function f(){return G(a).some(function(h){return o[h]&&Bs(o[h],a[h])})}var c=function(h){fo(o,h),f()&&p()},p=function(){if(!(u||i)){o={};var h={},d=r(h);l||($e(Dt,c),l=!0),u=!0,Promise.resolve(d).then(function(v){u=!1,!i&&(f()?p():(o={},a=h,e.next&&e.next(v)))},function(v){u=!1,e.error&&e.error(v),s.unsubscribe()})}};return p(),s})}var cr;try{cr={indexedDB:W.indexedDB||W.mozIndexedDB||W.webkitIndexedDB||W.msIndexedDB,IDBKeyRange:W.IDBKeyRange||W.webkitIDBKeyRange}}catch{cr={indexedDB:null,IDBKeyRange:null}}var Ue=Ir;at(Ue,$($({},En),{delete:function(t){var e=new Ue(t,{addons:[]});return e.delete()},exists:function(t){return new Ue(t,{addons:[]}).open().then(function(e){return e.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(t){try{return ms(Ue.dependencies).then(t)}catch{return X(new M.MissingAPI)}},defineClass:function(){function t(e){se(this,e)}return t},ignoreTransaction:function(t){return R.trans?ft(R.transless,t):t()},vip:sr,async:function(t){return function(){try{var e=ur(t.apply(this,arguments));return!e||typeof e.then!="function"?T.resolve(e):e}catch(n){return X(n)}}},spawn:function(t,e,n){try{var r=ur(t.apply(n,e||[]));return!r||typeof r.then!="function"?T.resolve(r):r}catch(i){return X(i)}},currentTransaction:{get:function(){return R.trans||null}},waitFor:function(t,e){var n=T.resolve(typeof t=="function"?Ue.ignoreTransaction(t):t).timeout(e||6e4);return R.trans?R.trans.waitFor(n):n},Promise:T,debug:{get:function(){return Ee},set:function(t){Ui(t,t==="dexie"?function(){return!0}:no)}},derive:ut,extend:se,props:at,override:Fi,Events:zt,on:$e,liveQuery:ho,extendObservabilitySet:fo,getByKeyPath:Oe,setByKeyPath:ye,delByKeyPath:fa,shallowClone:zi,deepClone:Pt,getObjectDiff:Or,cmp:ae,asap:Mi,minKey:tr,addons:[],connections:bt,errnames:br,dependencies:cr,semVer:Vr,version:Vr.split(".").map(function(t){return parseInt(t)}).reduce(function(t,e,n){return t+e/Math.pow(10,n*2)})}));Ue.maxKey=Ot(Ue.dependencies.IDBKeyRange);typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&($e(Dt,function(t){if(!Be){var e;An?(e=document.createEvent("CustomEvent"),e.initCustomEvent(Le,!0,!0,t)):e=new CustomEvent(Le,{detail:t}),Be=!0,dispatchEvent(e),Be=!1}}),addEventListener(Le,function(t){var e=t.detail;Be||bn(e)}));function bn(t){var e=Be;try{Be=!0,$e.storagemutated.fire(t)}finally{Be=e}}var Be=!1;if(typeof BroadcastChannel<"u"){var ei=new BroadcastChannel(Le);$e(Dt,function(t){Be||ei.postMessage(t)}),ei.onmessage=function(t){t.data&&bn(t.data)}}else if(typeof self<"u"&&typeof navigator<"u"){$e(Dt,function(t){try{Be||(typeof localStorage<"u"&&localStorage.setItem(Le,JSON.stringify({trig:Math.random(),changedParts:t})),typeof self.clients=="object"&&$n([],self.clients.matchAll({includeUncontrolled:!0}),!0).forEach(function(e){return e.postMessage({type:Le,changedParts:t})}))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",function(t){if(t.key===Le){var e=JSON.parse(t.newValue);e&&bn(e.changedParts)}});var ti=self.document&&navigator.serviceWorker;ti&&ti.addEventListener("message",Is)}function Is(t){var e=t.data;e&&e.type===Le&&bn(e.changedParts)}T.rejectionMapper=ba;Ui(Ee,no);class Ks extends Ir{constructor(){super("bookDB");Pr(this,"books");this.version(4).stores({books:"++id, meta, contents, toc, files, progress"})}}const we=new Ks,Ps=async t=>{for(let e of await we.books.toArray())if(e.meta.title===t.meta.title)return e.id;try{return await we.books.add(t)}catch(e){console.log(e)}};function po(t){return t.arrayBuffer?t.arrayBuffer():new Promise((e,n)=>{const r=new FileReader;r.addEventListener("loadend",()=>{e(r.result)}),r.addEventListener("error",n),r.readAsArrayBuffer(t)})}async function Fs(t){const e=await po(t);return new Uint8Array(e)}function vo(t){return typeof Blob<"u"&&t instanceof Blob}function It(t){return typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}const Ms=typeof process<"u"&&process.versions&&typeof process.versions.node<"u"&&typeof process.versions.electron>"u";function Ls(t){return t.byteOffset===0&&t.byteLength===t.buffer.byteLength}class ni{constructor(e){this.typedArray=e instanceof ArrayBuffer||It(e)?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}async getLength(){return this.typedArray.byteLength}async read(e,n){return new Uint8Array(this.typedArray.buffer,this.typedArray.byteOffset+e,n)}}class ri{constructor(e){this.blob=e}async getLength(){return this.blob.size}async read(e,n){const r=this.blob.slice(e,e+n),i=await po(r);return new Uint8Array(i)}async sliceAsBlob(e,n,r=""){return this.blob.slice(e,e+n,r)}}function zs(t,e){var n=Uint8Array;if(t[0]==3&&t[1]==0)return e||new n(0);var r=$s,i=mo,o=Ns,a=yo,s=e==null;s&&(e=new n(t.length>>>2<<3));for(var u=0,l=0,f=0,c=0,p=0,h=0,d=0,v=0,m=0,y,b;u==0;){if(u=r(t,m,1),l=r(t,m+1,2),m+=3,l==0){(m&7)!=0&&(m+=8-(m&7));var k=(m>>>3)+4,A=t[k-4]|t[k-3]<<8;s&&(e=Pn(e,v+A)),e.set(new n(t.buffer,t.byteOffset+k,A),v),m=k+A<<3,v+=A;continue}if(s&&(e=Pn(e,v+(1<<17))),l==1&&(y=P.flmap,b=P.fdmap,h=(1<<9)-1,d=(1<<5)-1),l==2){f=i(t,m,5)+257,c=i(t,m+5,5)+1,p=i(t,m+10,4)+4,m+=14;for(var _=0;_<38;_+=2)P.itree[_]=0,P.itree[_+1]=0;for(var g=1,_=0;_<p;_++){var S=i(t,m+_*3,3);P.itree[(P.ordr[_]<<1)+1]=S,S>g&&(g=S)}m+=3*p,kt(P.itree,g),Et(P.itree,g,P.imap),y=P.lmap,b=P.dmap,m=o(P.imap,(1<<g)-1,f+c,t,m,P.ttree);var w=ii(P.ttree,0,f,P.ltree);h=(1<<w)-1;var E=ii(P.ttree,f,c,P.dtree);d=(1<<E)-1,kt(P.ltree,w),Et(P.ltree,w,y),kt(P.dtree,E),Et(P.dtree,E,b)}for(;;){var x=y[a(t,m)&h];m+=x&15;var C=x>>>4;if(C>>>8==0)e[v++]=C;else{if(C==256)break;var L=v+C-254;if(C>264){var z=P.ldef[C-257];L=v+(z>>>3)+i(t,m,z&7),m+=z&7}var j=b[a(t,m)&d];m+=j&15;var K=j>>>4,te=P.ddef[K],ne=(te>>>4)+r(t,m,te&15);for(m+=te&15,s&&(e=Pn(e,v+(1<<17)));v<L;)e[v]=e[v++-ne],e[v]=e[v++-ne],e[v]=e[v++-ne],e[v]=e[v++-ne];v=L}}}return e.length==v?e:e.slice(0,v)}function Pn(t,e){var n=t.length;if(e<=n)return t;var r=new Uint8Array(Math.max(n<<1,e));return r.set(t,0),r}function Ns(t,e,n,r,i,o){for(var a=mo,s=yo,u=0;u<n;){var l=t[s(r,i)&e];i+=l&15;var f=l>>>4;if(f<=15)o[u]=f,u++;else{var c=0,p=0;f==16?(p=3+a(r,i,2),i+=2,c=o[u-1]):f==17?(p=3+a(r,i,3),i+=3):f==18&&(p=11+a(r,i,7),i+=7);for(var h=u+p;u<h;)o[u]=c,u++}}return i}function ii(t,e,n,r){for(var i=0,o=0,a=r.length>>>1;o<n;){var s=t[o+e];r[o<<1]=0,r[(o<<1)+1]=s,s>i&&(i=s),o++}for(;o<a;)r[o<<1]=0,r[(o<<1)+1]=0,o++;return i}function kt(t,e){for(var n=t.length,r,i,o,a,s,u=P.bl_count,a=0;a<=e;a++)u[a]=0;for(a=1;a<n;a+=2)u[t[a]]++;var l=P.next_code;for(r=0,u[0]=0,i=1;i<=e;i++)r=r+u[i-1]<<1,l[i]=r;for(o=0;o<n;o+=2)s=t[o+1],s!=0&&(t[o]=l[s],l[s]++)}function Et(t,e,n){for(var r=t.length,i=P.rev15,o=0;o<r;o+=2)if(t[o+1]!=0)for(var a=o>>1,s=t[o+1],u=a<<4|s,l=e-s,f=t[o]<<l,c=f+(1<<l);f!=c;){var p=i[f]>>>15-e;n[p]=u,f++}}function oi(t,e){for(var n=P.rev15,r=15-e,i=0;i<t.length;i+=2){var o=t[i]<<e-t[i+1];t[i]=n[o]>>>r}}function mo(t,e,n){return(t[e>>>3]|t[(e>>>3)+1]<<8)>>>(e&7)&(1<<n)-1}function $s(t,e,n){return(t[e>>>3]|t[(e>>>3)+1]<<8|t[(e>>>3)+2]<<16)>>>(e&7)&(1<<n)-1}function yo(t,e){return(t[e>>>3]|t[(e>>>3)+1]<<8|t[(e>>>3)+2]<<16)>>>(e&7)}const P=function(){var t=Uint16Array,e=Uint32Array;return{next_code:new t(16),bl_count:new t(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new t(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new e(32),flmap:new t(512),fltree:[],fdmap:new t(32),fdtree:[],lmap:new t(32768),ltree:[],ttree:[],dmap:new t(32768),dtree:[],imap:new t(512),itree:[],rev15:new t(1<<15),lhst:new e(286),dhst:new e(30),ihst:new e(19),lits:new e(15e3),strt:new t(1<<16),prev:new t(1<<15)}}();(function(){for(var t=32768,e=0;e<t;e++){var n=e;n=(n&2863311530)>>>1|(n&1431655765)<<1,n=(n&3435973836)>>>2|(n&858993459)<<2,n=(n&4042322160)>>>4|(n&252645135)<<4,n=(n&4278255360)>>>8|(n&16711935)<<8,P.rev15[e]=(n>>>16|n<<16)>>>17}function r(i,o,a){for(;o--!=0;)i.push(0,a)}for(var e=0;e<32;e++)P.ldef[e]=P.of0[e]<<3|P.exb[e],P.ddef[e]=P.df0[e]<<4|P.dxb[e];r(P.fltree,144,8),r(P.fltree,255-143,9),r(P.fltree,279-255,7),r(P.fltree,287-279,8),kt(P.fltree,9),Et(P.fltree,9,P.flmap),oi(P.fltree,9),r(P.fdtree,32,5),kt(P.fdtree,5),Et(P.fdtree,5,P.fdmap),oi(P.fdtree,5),r(P.itree,19,0),r(P.ltree,286,0),r(P.dtree,30,0),r(P.ttree,320,0)})();const ai={table:function(){for(var t=new Uint32Array(256),e=0;e<256;e++){for(var n=e,r=0;r<8;r++)n&1?n=3988292384^n>>>1:n=n>>>1;t[e]=n}return t}(),update:function(t,e,n,r){for(var i=0;i<r;i++)t=ai.table[(t^e[n+i])&255]^t>>>8;return t},crc:function(t,e,n){return ai.update(4294967295,t,e,n)^4294967295}};function Us(t,e){return zs(t,e)}const si={numWorkers:1,workerURL:"",useWorkers:!1};let js=0;const un=[];function Fn(t){return new Promise((e,n)=>{const r=new Worker(t);r.onmessage=i=>{i.data==="start"?(r.onerror=void 0,r.onmessage=void 0,e(r)):n(new Error(`unexpected message: ${i.data}`))},r.onerror=n})}function Hs(t,e){return t.require(e)}(function(){if(Ms){const{Worker:t}=Hs(Co,"worker_threads");return{async createWorker(e){return new t(e)},addEventListener(e,n){e.on("message",r=>{n({target:e,data:r})})},async terminate(e){await e.terminate()}}}else return{async createWorker(t){try{return await Fn(t)}catch{console.warn("could not load worker:",t)}let e;try{const n=await fetch(t,{mode:"cors"});if(!n.ok)throw new Error(`could not load: ${t}`);e=await n.text(),t=URL.createObjectURL(new Blob([e],{type:"application/javascript"}));const r=await Fn(t);return si.workerURL=t,r}catch{console.warn("could not load worker via fetch:",t)}if(e!==void 0)try{t=`data:application/javascript;base64,${btoa(e)}`;const n=await Fn(t);return si.workerURL=t,n}catch{console.warn("could not load worker via dataURI")}throw console.warn("workers will not be used"),new Error("can not start workers")},addEventListener(t,e){t.addEventListener("message",e)},async terminate(t){t.terminate()}}})();function Ws(t,e,n,r){const i=new Uint8Array(e);Us(t,i),r(n?new Blob([i],{type:n}):i.buffer)}async function Vs(){if(un.length!==0)for(;un.length;){const{src:t,uncompressedSize:e,type:n,resolve:r}=un.shift();let i=t;vo(t)&&(i=await Fs(t)),Ws(i,e,n,r)}}function go(t,e,n){return new Promise((r,i)=>{un.push({src:t,uncompressedSize:e,type:n,resolve:r,reject:i,id:js++}),Vs()})}function qs(t,e){const n=t&31,r=(t>>5&15)-1,i=(t>>9&127)+1980,o=0,a=(e&31)*2,s=e>>5&63,u=e>>11&31;return new Date(i,r,n,u,s,a,o)}class Ys{constructor(e,n){this._reader=e,this._rawEntry=n,this.name=n.name,this.nameBytes=n.nameBytes,this.size=n.uncompressedSize,this.compressedSize=n.compressedSize,this.comment=n.comment,this.commentBytes=n.commentBytes,this.compressionMethod=n.compressionMethod,this.lastModDate=qs(n.lastModFileDate,n.lastModFileTime),this.isDirectory=n.uncompressedSize===0&&n.name.endsWith("/"),this.encrypted=!!(n.generalPurposeBitFlag&1),this.externalFileAttributes=n.externalFileAttributes,this.versionMadeBy=n.versionMadeBy}async blob(e="application/octet-stream"){return await ou(this._reader,this._rawEntry,e)}async arrayBuffer(){return await iu(this._reader,this._rawEntry)}async text(){const e=await this.arrayBuffer();return At(new Uint8Array(e))}async json(){const e=await this.text();return JSON.parse(e)}}const Mn=22,Gs=65535,Qs=101010256,Xs=101075792;async function st(t,e,n){return await t.read(e,n)}async function fr(t,e,n,r){return t.sliceAsBlob?await t.sliceAsBlob(e,n,r):await t.read(e,n)}const Js={unsigned(){return 0}};function Z(t,e){return t[e]+t[e+1]*256}function oe(t,e){return t[e]+t[e+1]*256+t[e+2]*65536+t[e+3]*16777216}function He(t,e){return oe(t,e)+oe(t,e+4)*4294967296}const Zs=new TextDecoder;function At(t,e){return It(t.buffer)&&(t=new Uint8Array(t)),Zs.decode(t)}async function eu(t,e){const n=Math.min(Mn+Gs,e),r=e-n,i=await st(t,r,n);for(let o=n-Mn;o>=0;--o){if(oe(i,o)!==Qs)continue;const a=new Uint8Array(i.buffer,i.byteOffset+o,i.byteLength-o),s=Z(a,4);if(s!==0)throw new Error(`multi-volume zip files are not supported. This is volume: ${s}`);const u=Z(a,10),l=oe(a,12),f=oe(a,16),c=Z(a,20),p=a.length-Mn;if(c!==p)throw new Error(`invalid comment length. expected: ${p}, actual: ${c}`);const h=new Uint8Array(a.buffer,a.byteOffset+22,c),d=At(h);return u===65535||f===4294967295?await nu(t,r+o,d,h):await _o(t,f,l,u,d,h)}throw new Error("could not find end of central directory. maybe not zip file")}const tu=117853008;async function nu(t,e,n,r){const i=e-20,o=await st(t,i,20);if(oe(o,0)!==tu)throw new Error("invalid zip64 end of central directory locator signature");const a=He(o,8),s=await st(t,a,56);if(oe(s,0)!==Xs)throw new Error("invalid zip64 end of central directory record signature");const u=He(s,32),l=He(s,40),f=He(s,48);return _o(t,f,l,u,n,r)}const ru=33639248;async function _o(t,e,n,r,i,o){let a=0;const s=await st(t,e,n),u=[];for(let f=0;f<r;++f){const c=s.subarray(a,a+46),p=oe(c,0);if(p!==ru)throw new Error(`invalid central directory file header signature: 0x${p.toString(16)}`);const h={versionMadeBy:Z(c,4),versionNeededToExtract:Z(c,6),generalPurposeBitFlag:Z(c,8),compressionMethod:Z(c,10),lastModFileTime:Z(c,12),lastModFileDate:Z(c,14),crc32:oe(c,16),compressedSize:oe(c,20),uncompressedSize:oe(c,24),fileNameLength:Z(c,28),extraFieldLength:Z(c,30),fileCommentLength:Z(c,32),internalFileAttributes:Z(c,36),externalFileAttributes:oe(c,38),relativeOffsetOfLocalHeader:oe(c,42)};if(h.generalPurposeBitFlag&64)throw new Error("strong encryption is not supported");a+=46;const d=s.subarray(a,a+h.fileNameLength+h.extraFieldLength+h.fileCommentLength);h.nameBytes=d.slice(0,h.fileNameLength),h.name=At(h.nameBytes);const v=h.fileNameLength+h.extraFieldLength,m=d.slice(h.fileNameLength,v);h.extraFields=[];let y=0;for(;y<m.length-3;){const k=Z(m,y+0),A=Z(m,y+2),_=y+4,g=_+A;if(g>m.length)throw new Error("extra field length exceeds extra field buffer size");h.extraFields.push({id:k,data:m.slice(_,g)}),y=g}if(h.commentBytes=d.slice(v,v+h.fileCommentLength),h.comment=At(h.commentBytes),a+=d.length,h.uncompressedSize===4294967295||h.compressedSize===4294967295||h.relativeOffsetOfLocalHeader===4294967295){const k=h.extraFields.find(g=>g.id===1);if(!k)throw new Error("expected zip64 extended information extra field");const A=k.data;let _=0;if(h.uncompressedSize===4294967295){if(_+8>A.length)throw new Error("zip64 extended information extra field does not include uncompressed size");h.uncompressedSize=He(A,_),_+=8}if(h.compressedSize===4294967295){if(_+8>A.length)throw new Error("zip64 extended information extra field does not include compressed size");h.compressedSize=He(A,_),_+=8}if(h.relativeOffsetOfLocalHeader===4294967295){if(_+8>A.length)throw new Error("zip64 extended information extra field does not include relative header offset");h.relativeOffsetOfLocalHeader=He(A,_),_+=8}}const b=h.extraFields.find(k=>k.id===28789&&k.data.length>=6&&k.data[0]===1&&oe(k.data,1),Js.unsigned(h.nameBytes));if(b&&(h.fileName=At(b.data.slice(5))),h.compressionMethod===0){let k=h.uncompressedSize;if((h.generalPurposeBitFlag&1)!==0&&(k+=12),h.compressedSize!==k)throw new Error(`compressed size mismatch for stored file: ${h.compressedSize} != ${k}`)}u.push(h)}return{zip:{comment:i,commentBytes:o},entries:u.map(f=>new Ys(t,f))}}async function bo(t,e){if(e.generalPurposeBitFlag&1)throw new Error("encrypted entries not supported");const n=await st(t,e.relativeOffsetOfLocalHeader,30),r=await t.getLength(),i=oe(n,0);if(i!==67324752)throw new Error(`invalid local file header signature: 0x${i.toString(16)}`);const o=Z(n,26),a=Z(n,28),s=e.relativeOffsetOfLocalHeader+n.length+o+a;let u;if(e.compressionMethod===0)u=!1;else if(e.compressionMethod===8)u=!0;else throw new Error(`unsupported compression method: ${e.compressionMethod}`);const l=s,f=l+e.compressedSize;if(e.compressedSize!==0&&f>r)throw new Error(`file data overflows file bounds: ${l} +  ${e.compressedSize}  > ${r}`);return{decompress:u,fileDataStart:l}}async function iu(t,e){const{decompress:n,fileDataStart:r}=await bo(t,e);if(!n){const a=await st(t,r,e.compressedSize);return Ls(a)?a.buffer:a.slice().buffer}const i=await fr(t,r,e.compressedSize);return await go(i,e.uncompressedSize)}async function ou(t,e,n){const{decompress:r,fileDataStart:i}=await bo(t,e);if(!r){const s=await fr(t,i,e.compressedSize,n);return vo(s)?s:new Blob([It(s.buffer)?new Uint8Array(s):s],{type:n})}const o=await fr(t,i,e.compressedSize);return await go(o,e.uncompressedSize,n)}async function au(t){let e;if(typeof Blob<"u"&&t instanceof Blob)e=new ri(t);else if(t instanceof ArrayBuffer||t&&t.buffer&&t.buffer instanceof ArrayBuffer)e=new ni(t);else if(It(t)||It(t.buffer))e=new ni(t);else if(typeof t=="string"){const r=await fetch(t);if(!r.ok)throw new Error(`failed http request ${t}, status: ${r.status}: ${r.statusText}`);const i=await r.blob();e=new ri(i)}else if(typeof t.getLength=="function"&&typeof t.read=="function")e=t;else throw new Error("unsupported source type");const n=await e.getLength();if(n>Number.MAX_SAFE_INTEGER)throw new Error(`file too large. size: ${n}. Only file sizes up 4503599627370496 bytes are supported`);return await eu(e,n)}async function su(t){const{zip:e,entries:n}=await au(t);return{zip:e,entries:Object.fromEntries(n.map(r=>[r.name,r]))}}let ln=[],ot=[],dr=[],yt=[],hr=[],wo="",ko,Eo;const wn=new DOMParser,uu=t=>{const e=wn.parseFromString(t,"text/xml"),n=fu(e.querySelector("manifest").children);ko=cu(e.querySelector("metadata")),du(e.querySelector("spine"),n)},lu=async t=>{const{entries:e}=await su(t);let n="";for(const[r,i]of Object.entries(e))switch(r.substring(r.lastIndexOf("."))){case".opf":n=await i.text();break;case".png":case".jpg":case".jpeg":case".gif":{const o=await i.blob();ot.push({name:r,blob:o});break}case".css":{const o=await i.text();yt.push({name:r,css:o});break}case".htm":case".xml":case".html":case".xhtml":{const o=await i.text();dr.push({href:r,html:o});break}case".otf":case".ttf":case".woff":{const o=await i.blob();hr.push({name:r,blob:o});break}case".ncx":{Eo=await i.text();break}}return n},cu=t=>{const e=t.querySelector("title").textContent,n=[];for(let i of t.querySelectorAll("creator"))n.push(i.textContent);let r=ot[0].blob;for(let{name:i,blob:o}of ot)if(i.includes(wo)){r=o;break}else i.includes("cover")&&(r=o);return{title:e,author:n,cover:r}},fu=t=>{const e=[];for(const n of t)n.attributes["media-type"].value==="application/xhtml+xml"?e.push({id:n.attributes.id.value,href:n.attributes.href.value}):n.attributes["media-type"].value.includes("image")&&n.attributes.id.value.includes("cover")&&(wo=n.attributes.href.value);return e},du=(t,e)=>{const n=[];t.querySelectorAll("itemref").forEach(r=>n.push(r.attributes.idref.value)),ln=n.map(r=>e.find(i=>i.id===r))},pr=t=>t.split("\\").pop().split("/").pop(),ui=(t,e)=>{for(const[n,{name:r}]of e.entries())if(r.includes(t))return"ESSENCE-READER-IMAGE-"+n;return""},hu=(t,e)=>{let n=wn.parseFromString(t,"application/xhtml+xml");n.querySelector("parsererror")&&(n=wn.parseFromString(t,"text/html"));for(const i of n.querySelectorAll("[src],[href], image"))switch(i.tagName){case"img":{const o=pr(i.getAttribute("src"));i.setAttribute("src",ui(o,e)),i.style.cssText+="max-height: 100%; max-width: 100%; object-fit: scale-down;";break}case"image":{const o=pr(i.getAttributeNS("http://www.w3.org/1999/xlink","href"));i.setAttributeNS("http://www.w3.org/1999/xlink","href",ui(o,e));break}default:{i.getAttribute("href")!==null&&!i.getAttribute("href").includes("http")?i.removeAttribute("href"):i.getAttribute("src")!==null&&!i.getAttribute("src").includes("http")&&i.removeAttribute("src");break}}return n.body.innerHTML},pu=(t,e)=>{let n=[];return t=t.replace(/@(-moz-|-webkit-|-ms-)*keyframes\s(.*?){([0-9%a-zA-Z,\s.]*{(.*?)})*[\s\n]*}/g,r=>n.push(r)&&"__keyframes__"),t=t.replace(/([^\r\n,{}]+)(,(?=[^}]*{)|\s*{)/g,r=>r.trim()[0]==="@"?r:r.replace(/(\s*)/,"$1"+e+" ")),t.replace(/__keyframes__/g,r=>n.shift())},vu=()=>{const t=[],e=wn.parseFromString(Eo,"application/xml").querySelectorAll("navPoint");for(const n of e){let r=n.querySelector("text").textContent,i=decodeURI(n.querySelector("content").attributes.src.value);const o=n.parentElement.nodeName==="navPoint";t.push({name:r,href:i,isChild:o})}return t},mu=async t=>{ot=[],ln=[],dr=[],hr=[];try{uu(await lu(t))}catch{throw new Error(t.name+" does not appear to be a valid EPUB file")}const e=[],n=[];for(let i=0;i<ln.length;i++)for(const{href:o,html:a}of dr)if(o.includes(ln[i].href)){const s=n.push(hu(a,ot))-1;e.push({href:o,index:s});break}const r=[];for(const{name:i,href:o,isChild:a}of vu())for(const{href:s,index:u}of e)o.includes(pr(s))&&r.push({name:i,index:u,isChild:a});for(let i=0;i<yt.length;i++)yt[i].css=pu(yt[i].css,"#container");return{meta:ko,contents:n,toc:r,files:{images:ot,fonts:hr,styles:yt},progress:0}},yu=(t,e,n)=>t.replace(/url\((?!['"]?(?:data):)['"]?([^'"\)]*)['"]?\)/g,function(i,o){const a=o.split("\\").pop().split("/").pop();let s=[".png",".jpg",".jpeg",".gif"],u=[".otf",".ttf",".woff"],l=[];return s.some(f=>a.endsWith(f))?l=e:u.some(f=>a.endsWith(f))&&(l=n),"url("+gu(a,l)+")"}),gu=(t,e)=>{for(const{name:n,blob:r}of e)if(n.includes(t))return URL.createObjectURL(r);return""},_u=(t,e)=>t.replace(/ESSENCE-READER-IMAGE-(\d*)/g,function(n,r){return URL.createObjectURL(e[r].blob)}),bu=t=>{for(let n=0;n<t.contents.length;n++)t.contents[n]=_u(t.contents[n],t.files.images);let e=t.files.styles;for(let n=0;n<e.length;n++)e[n].css=yu(e[n].css,t.files.images,t.files.fonts);return{meta:t.meta,contents:t.contents,toc:t.toc,files:t.files,progress:t.progress}},wu=t=>({}),li=t=>({}),ku=t=>({}),ci=t=>({}),Eu=t=>({}),fi=t=>({});function Au(t){let e,n,r,i,o,a,s;const u=t[1].leftbar,l=Gt(u,t,t[0],fi),f=t[1].toptext,c=Gt(f,t,t[0],ci),p=t[1].rightbar,h=Gt(p,t,t[0],li);return{c(){e=D("div"),n=D("div"),l&&l.c(),r=N(),i=D("div"),c&&c.c(),o=N(),a=D("div"),h&&h.c(),O(n,"class","buttonbar svelte-5uyilb"),O(n,"id","leftbar"),O(i,"id","toptext"),O(i,"class","svelte-5uyilb"),O(a,"class","buttonbar svelte-5uyilb"),O(a,"id","rightbar"),O(e,"id","topbar"),O(e,"class","svelte-5uyilb")},m(d,v){F(d,e,v),B(e,n),l&&l.m(n,null),B(e,r),B(e,i),c&&c.m(i,null),B(e,o),B(e,a),h&&h.m(a,null),s=!0},p(d,[v]){l&&l.p&&(!s||v&1)&&Xt(l,u,d,d[0],s?Qt(u,d[0],v,Eu):Jt(d[0]),fi),c&&c.p&&(!s||v&1)&&Xt(c,f,d,d[0],s?Qt(f,d[0],v,ku):Jt(d[0]),ci),h&&h.p&&(!s||v&1)&&Xt(h,p,d,d[0],s?Qt(p,d[0],v,wu):Jt(d[0]),li)},i(d){s||(Y(l,d),Y(c,d),Y(h,d),s=!0)},o(d){J(l,d),J(c,d),J(h,d),s=!1},d(d){d&&I(e),l&&l.d(d),c&&c.d(d),h&&h.d(d)}}}function Su(t,e,n){let{$$slots:r={},$$scope:i}=e;return t.$$set=o=>{"$$scope"in o&&n(0,i=o.$$scope)},[i,r]}class Ao extends Je{constructor(e){super(),Xe(this,e,Su,Au,Qe,{})}}function So(t){const e=t-1;return e*e*e+1}function di(t,{delay:e=0,duration:n=400,easing:r=So,x:i=0,y:o=0,opacity:a=0}={}){const s=getComputedStyle(t),u=+s.opacity,l=s.transform==="none"?"":s.transform,f=u*(1-a);return{delay:e,duration:n,easing:r,css:(c,p)=>`
			transform: ${l} translate(${(1-c)*i}px, ${(1-c)*o}px);
			opacity: ${u-f*p}`}}function hi(t){let e,n,r,i,o;const a=t[4].default,s=Gt(a,t,t[3],null);return{c(){e=D("div"),s&&s.c(),O(e,"id","popover"),U(e,"top",t[1]),U(e,"right",t[2]),O(e,"class","svelte-r6pzts")},m(u,l){F(u,e,l),s&&s.m(e,null),r=!0,i||(o=[Fo(Cu.call(null,e)),q(e,"outclick",t[5])],i=!0)},p(u,l){s&&s.p&&(!r||l&8)&&Xt(s,a,u,u[3],r?Qt(a,u[3],l,null):Jt(u[3]),null),(!r||l&2)&&U(e,"top",u[1]),(!r||l&4)&&U(e,"right",u[2])},i(u){r||(Y(s,u),qe(()=>{n||(n=$r(e,di,{x:50,duration:200},!0)),n.run(1)}),r=!0)},o(u){J(s,u),n||(n=$r(e,di,{x:50,duration:200},!1)),n.run(0),r=!1},d(u){u&&I(e),s&&s.d(u),u&&n&&n.end(),i=!1,ce(o)}}}function xu(t){let e,n,r=t[0]&&hi(t);return{c(){r&&r.c(),e=mr()},m(i,o){r&&r.m(i,o),F(i,e,o),n=!0},p(i,[o]){i[0]?r?(r.p(i,o),o&1&&Y(r,1)):(r=hi(i),r.c(),Y(r,1),r.m(e.parentNode,e)):r&&(Ii(),J(r,1,1,()=>{r=null}),Ki())},i(i){n||(Y(r),n=!0)},o(i){J(r),n=!1},d(i){r&&r.d(i),i&&I(e)}}}function Cu(t){const e=n=>{n.target instanceof Element&&!t.contains(n.target)&&n.target.id!=="settingsBtn"&&t.dispatchEvent(new CustomEvent("outclick"))};return document.addEventListener("click",e,!0),{destroy(){document.removeEventListener("click",e,!0)}}}function Bu(t,e,n){let{$$slots:r={},$$scope:i}=e,{visible:o}=e,{top:a}=e,{right:s}=e;const u=()=>n(0,o=!1);return t.$$set=l=>{"visible"in l&&n(0,o=l.visible),"top"in l&&n(1,a=l.top),"right"in l&&n(2,s=l.right),"$$scope"in l&&n(3,i=l.$$scope)},[o,a,s,i,r,u]}class Kr extends Je{constructor(e){super(),Xe(this,e,Bu,xu,Qe,{visible:0,top:1,right:2})}}function Tu(t){let e,n,r,i,o,a,s,u,l;return{c(){e=D("button"),e.textContent="warm",n=N(),r=D("button"),r.textContent="black",i=N(),o=D("button"),o.textContent="dark",a=N(),s=D("button"),s.textContent="light",U(e,"background-color","#f6e4bd"),U(e,"color","#000"),O(e,"class","svelte-k014sn"),U(r,"background-color","#000"),U(r,"color","#e9e9e9"),O(r,"class","svelte-k014sn"),U(o,"background-color","#032038"),U(o,"color","#e9e9e9"),O(o,"class","svelte-k014sn"),U(s,"background-color","#fff"),U(s,"color","#000"),O(s,"class","svelte-k014sn")},m(f,c){F(f,e,c),F(f,n,c),F(f,r,c),F(f,i,c),F(f,o,c),F(f,a,c),F(f,s,c),u||(l=[q(e,"click",t[1]),q(r,"click",t[2]),q(o,"click",t[3]),q(s,"click",t[4])],u=!0)},p:Q,i:Q,o:Q,d(f){f&&I(e),f&&I(n),f&&I(r),f&&I(i),f&&I(o),f&&I(a),f&&I(s),u=!1,ce(l)}}}function Du(t){const e=a=>{document.documentElement.setAttribute("data-theme",a),localStorage.setItem("theme",a)};return[e,()=>e("warm"),()=>e("black"),()=>e("dark"),()=>e("light")]}class xo extends Je{constructor(e){super(),Xe(this,e,Du,Tu,Qe,{})}}function Ou(t){let e,n,r,i,o,a,s,u,l,f,c,p,h,d,v,m,y,b,k,A,_,g,S;return A=new xo({}),{c(){e=D("label"),e.textContent="Font:",n=N(),r=D("br"),i=N(),o=D("select"),a=D("option"),a.textContent="Verdana",s=D("option"),s.textContent="Arial",u=D("option"),u.textContent="Courier New ",l=D("option"),l.textContent="Helvetica",f=D("option"),f.textContent="Times New Roman",c=N(),p=D("br"),h=N(),d=D("label"),d.textContent="Font size:",v=N(),m=D("br"),y=N(),b=D("input"),k=N(),ke(A.$$.fragment),O(e,"for","fontpicker"),U(a,"font-family","'Verdana'"),a.__value="Verdana",a.value=a.__value,U(s,"font-family","'Arial'"),s.__value="Arial",s.value=s.__value,U(u,"font-family","'Courier New '"),u.__value="Courier New ",u.value=u.__value,U(l,"font-family","'Helvetica'"),l.__value="Helvetica",l.value=l.__value,U(f,"font-family","'Times New Roman'"),f.__value="Times New Roman",f.value=f.__value,O(o,"name","fontpicker"),U(o,"width","100%"),t[0].fontFamily===void 0&&qe(()=>t[2].call(o)),O(d,"for","fontsize"),O(b,"name","fontsize"),O(b,"type","range"),O(b,"min","12"),O(b,"max","40")},m(w,E){F(w,e,E),F(w,n,E),F(w,r,E),F(w,i,E),F(w,o,E),B(o,a),B(o,s),B(o,u),B(o,l),B(o,f),Nr(o,t[0].fontFamily),F(w,c,E),F(w,p,E),F(w,h,E),F(w,d,E),F(w,v,E),F(w,m,E),F(w,y,E),F(w,b,E),zr(b,t[0].fontSize),F(w,k,E),ve(A,w,E),_=!0,g||(S=[q(o,"change",t[2]),q(b,"change",t[3]),q(b,"input",t[3])],g=!0)},p(w,E){E&1&&Nr(o,w[0].fontFamily),E&1&&zr(b,w[0].fontSize)},i(w){_||(Y(A.$$.fragment,w),_=!0)},o(w){J(A.$$.fragment,w),_=!1},d(w){w&&I(e),w&&I(n),w&&I(r),w&&I(i),w&&I(o),w&&I(c),w&&I(p),w&&I(h),w&&I(d),w&&I(v),w&&I(m),w&&I(y),w&&I(b),w&&I(k),me(A,w),g=!1,ce(S)}}}function Ru(t){let e,n,r;function i(a){t[4](a)}let o={top:"3.1em",right:"1%",$$slots:{default:[Ou]},$$scope:{ctx:t}};return t[1]!==void 0&&(o.visible=t[1]),e=new Kr({props:o}),pe.push(()=>De(e,"visible",i)),{c(){ke(e.$$.fragment)},m(a,s){ve(e,a,s),r=!0},p(a,[s]){const u={};s&33&&(u.$$scope={dirty:s,ctx:a}),!n&&s&2&&(n=!0,u.visible=a[1],Te(()=>n=!1)),e.$set(u)},i(a){r||(Y(e.$$.fragment,a),r=!0)},o(a){J(e.$$.fragment,a),r=!1},d(a){me(e,a)}}}function Iu(t,e,n){let{settings:r={fontSize:16,fontFamily:"Verdana"}}=e,{settingsVisible:i=!1}=e;function o(){r.fontFamily=Uo(this),n(0,r)}function a(){r.fontSize=No(this.value),n(0,r)}function s(u){i=u,n(1,i)}return t.$$set=u=>{"settings"in u&&n(0,r=u.settings),"settingsVisible"in u&&n(1,i=u.settingsVisible)},[r,i,o,a,s]}class Ku extends Je{constructor(e){super(),Xe(this,e,Iu,Ru,Qe,{settings:0,settingsVisible:1})}}const{document:pi}=na;function vi(t,e,n){const r=t.slice();return r[24]=e[n],r}function Pu(t){let e,n,r;return{c(){e=D("button"),e.textContent="<",O(e,"slot","leftbar"),U(e,"opacity","0.5")},m(i,o){F(i,e,o),n||(r=q(e,"click",t[16]),n=!0)},p:Q,d(i){i&&I(e),n=!1,r()}}}function Fu(t){let e,n,r,i=t[1]!==void 0?t[1].meta.title+" - ":"",o,a,s=(t[1]!==void 0?t[1].meta.author:"")+"",u,l,f,c,p,h=t[1].contents.length-1+"",d,v;return{c(){e=D("div"),n=D("h4"),r=D("b"),o=ee(i),a=N(),u=ee(s),l=N(),f=D("p"),c=ee(t[2]),p=ee("/"),d=ee(h),O(n,"class","svelte-1k3xmmu"),O(f,"id","progress"),O(f,"class","svelte-1k3xmmu"),O(e,"slot","toptext"),O(e,"style",v="transition: opacity 0.3s; "+(t[5]>100?"opacity: 0.5;":""))},m(m,y){F(m,e,y),B(e,n),B(n,r),B(r,o),B(n,a),B(n,u),B(e,l),B(e,f),B(f,c),B(f,p),B(f,d)},p(m,y){y&2&&i!==(i=m[1]!==void 0?m[1].meta.title+" - ":"")&&de(o,i),y&2&&s!==(s=(m[1]!==void 0?m[1].meta.author:"")+"")&&de(u,s),y&4&&de(c,m[2]),y&2&&h!==(h=m[1].contents.length-1+"")&&de(d,h),y&32&&v!==(v="transition: opacity 0.3s; "+(m[5]>100?"opacity: 0.5;":""))&&O(e,"style",v)},d(m){m&&I(e)}}}function Mu(t){let e,n,r,i,o,a,s,u,l,f;return{c(){e=D("div"),n=D("button"),n.textContent="\u2630",r=N(),i=D("button"),i.textContent="\u2699",o=N(),a=D("button"),a.textContent="\xAB",s=N(),u=D("button"),u.textContent="\xBB",O(n,"id","settingsBtn"),O(i,"id","settingsBtn"),O(e,"slot","rightbar"),U(e,"display","inline-block")},m(c,p){F(c,e,p),B(e,n),B(e,r),B(e,i),B(e,o),B(e,a),B(e,s),B(e,u),l||(f=[q(n,"click",t[12]),q(i,"click",t[13]),q(a,"click",t[14]),q(u,"click",t[15])],l=!0)},p:Q,d(c){c&&I(e),l=!1,ce(f)}}}function mi(t){let e,n=(t[24].isChild,""),r,i,o=t[24].name+"",a,s,u,l;function f(){return t[17](t[24])}return{c(){e=D("button"),r=ee(n),i=N(),a=ee(o),O(e,"class","tocButton svelte-1k3xmmu"),O(e,"style",s=(t[2]===t[24].index?"border: 1px solid lightblue; font-weight: bold;":"")+" "+(t[24].isChild?"padding-left: 2em;":""))},m(c,p){F(c,e,p),B(e,r),B(e,i),B(e,a),u||(l=q(e,"click",f),u=!0)},p(c,p){t=c,p&2&&n!==(n=(t[24].isChild,""))&&de(r,n),p&2&&o!==(o=t[24].name+"")&&de(a,o),p&6&&s!==(s=(t[2]===t[24].index?"border: 1px solid lightblue; font-weight: bold;":"")+" "+(t[24].isChild?"padding-left: 2em;":""))&&O(e,"style",s)},d(c){c&&I(e),u=!1,l()}}}function Lu(t){let e,n=t[1].toc,r=[];for(let i=0;i<n.length;i+=1)r[i]=mi(vi(t,n,i));return{c(){for(let i=0;i<r.length;i+=1)r[i].c();e=mr()},m(i,o){for(let a=0;a<r.length;a+=1)r[a].m(i,o);F(i,e,o)},p(i,o){if(o&134){n=i[1].toc;let a;for(a=0;a<n.length;a+=1){const s=vi(i,n,a);r[a]?r[a].p(s,o):(r[a]=mi(s),r[a].c(),r[a].m(e.parentNode,e))}for(;a<r.length;a+=1)r[a].d(1);r.length=n.length}},d(i){zo(r,i),i&&I(e)}}}function zu(t){let e=!1,n=()=>{e=!1},r,i,o,a,s,u,l,f,c,p=t[1].contents[t[2]]+"",h,d,v,m,y,b,k;qe(t[11]),pi.title=i=`
        `+(t[1].meta.title+" - "+t[1].meta.author)+`
    `,a=new Ao({props:{$$slots:{rightbar:[Mu],toptext:[Fu],leftbar:[Pu]},$$scope:{ctx:t}}});function A(E){t[18](E)}let _={top:"3em",right:"1em",$$slots:{default:[Lu]},$$scope:{ctx:t}};t[6]!==void 0&&(_.visible=t[6]),u=new Kr({props:_}),pe.push(()=>De(u,"visible",A));function g(E){t[19](E)}function S(E){t[20](E)}let w={};return t[3]!==void 0&&(w.settingsVisible=t[3]),t[4]!==void 0&&(w.settings=t[4]),d=new Ku({props:w}),pe.push(()=>De(d,"settingsVisible",g)),pe.push(()=>De(d,"settings",S)),{c(){o=N(),ke(a.$$.fragment),s=N(),ke(u.$$.fragment),f=N(),c=D("div"),h=N(),ke(d.$$.fragment),O(c,"id","container"),U(c,"font-size",t[4].fontSize+"px"),U(c,"font-family",t[4].fontFamily),O(c,"class","svelte-1k3xmmu")},m(E,x){F(E,o,x),ve(a,E,x),F(E,s,x),ve(u,E,x),F(E,f,x),F(E,c,x),c.innerHTML=p,F(E,h,x),ve(d,E,x),y=!0,b||(k=[q(window,"keydown",t[9]),q(window,"scroll",()=>{e=!0,clearTimeout(r),r=setTimeout(n,100),t[11]()})],b=!0)},p(E,[x]){x&32&&!e&&(e=!0,clearTimeout(r),scrollTo(window.pageXOffset,E[5]),r=setTimeout(n,100)),(!y||x&2)&&i!==(i=`
        `+(E[1].meta.title+" - "+E[1].meta.author)+`
    `)&&(pi.title=i);const C={};x&134217839&&(C.$$scope={dirty:x,ctx:E}),a.$set(C);const L={};x&134217734&&(L.$$scope={dirty:x,ctx:E}),!l&&x&64&&(l=!0,L.visible=E[6],Te(()=>l=!1)),u.$set(L),(!y||x&6)&&p!==(p=E[1].contents[E[2]]+"")&&(c.innerHTML=p),(!y||x&16)&&U(c,"font-size",E[4].fontSize+"px"),(!y||x&16)&&U(c,"font-family",E[4].fontFamily);const z={};!v&&x&8&&(v=!0,z.settingsVisible=E[3],Te(()=>v=!1)),!m&&x&16&&(m=!0,z.settings=E[4],Te(()=>m=!1)),d.$set(z)},i(E){y||(Y(a.$$.fragment,E),Y(u.$$.fragment,E),Y(d.$$.fragment,E),y=!0)},o(E){J(a.$$.fragment,E),J(u.$$.fragment,E),J(d.$$.fragment,E),y=!1},d(E){E&&I(o),me(a,E),E&&I(s),me(u,E),E&&I(f),E&&I(c),E&&I(h),me(d,E),b=!1,ce(k)}}}function Nu(t,e,n){let{currentBook:r}=e,{reading:i}=e,{currentId:o}=e,a=0,s=!1,u={fontSize:16,fontFamily:"Verdana"},l=0,f=r.meta.title;Qo(()=>{f!==r.meta.title&&(n(2,a=0),f=r.meta.title,c())});const c=()=>{for(const C of document.getElementsByTagName("style"))C.getAttribute("from")==="essence-reader"&&C.remove();r.files.styles.forEach(C=>{const L=document.createElement("style");L.innerText=C.css,L.setAttribute("from","essence-reader"),document.head.appendChild(L)})};Oi(()=>{isNaN(r.progress)||n(2,a=Math.floor(r.progress))});const p=C=>{o!==-1&&we.books.update(o,{progress:C})},h=C=>{0<=C&&C<r.contents.length&&(n(2,a=C),n(5,l=0),p(a))},d=C=>{h(a+C)};c();const v=({key:C})=>{switch(C){case"ArrowLeft":d(-1);break;case"ArrowRight":d(1);break}};let m=!1;function y(){n(5,l=window.pageYOffset)}const b=()=>n(6,m=!m),k=()=>n(3,s=!s),A=()=>d(-1),_=()=>d(1),g=()=>{n(0,i=!1),document.title="Essence Reader",location.hash=""},S=C=>h(C.index);function w(C){m=C,n(6,m)}function E(C){s=C,n(3,s)}function x(C){u=C,n(4,u)}return t.$$set=C=>{"currentBook"in C&&n(1,r=C.currentBook),"reading"in C&&n(0,i=C.reading),"currentId"in C&&n(10,o=C.currentId)},[i,r,a,s,u,l,m,h,d,v,o,y,b,k,A,_,g,S,w,E,x]}class $u extends Je{constructor(e){super(),Xe(this,e,Nu,zu,Qe,{currentBook:1,reading:0,currentId:10})}}function Uu(t,{from:e,to:n},r={}){const i=getComputedStyle(t),o=i.transform==="none"?"":i.transform,[a,s]=i.transformOrigin.split(" ").map(parseFloat),u=e.left+e.width*a/n.width-(n.left+a),l=e.top+e.height*s/n.height-(n.top+s),{delay:f=0,duration:c=h=>Math.sqrt(h)*120,easing:p=So}=r;return{delay:f,duration:Kt(c)?c(Math.sqrt(u*u+l*l)):c,easing:p,css:(h,d)=>{const v=d*u,m=d*l,y=h+d*e.width/n.width,b=h+d*e.height/n.height;return`transform: ${o} translate(${v}px, ${m}px) scale(${y}, ${b});`}}}function yi(t,e,n){const r=t.slice();return r[19]=e[n],r}function ju(t){let e;return{c(){e=D("h3"),e.textContent="Essence Reader",O(e,"slot","toptext"),U(e,"display","inline")},m(n,r){F(n,e,r)},p:Q,d(n){n&&I(e)}}}function Hu(t){let e,n,r;return{c(){e=D("button"),e.textContent="\u2699",O(e,"id","settingsBtn"),O(e,"slot","rightbar")},m(i,o){F(i,e,o),n||(r=q(e,"click",t[12]),n=!0)},p:Q,d(i){i&&I(e),n=!1,r()}}}function Wu(t){let e,n,r,i,o,a,s,u,l,f,c,p,h,d,v,m;return h=new xo({}),{c(){e=D("div"),n=D("label"),r=D("input"),i=ee(`
            Save books
        `),o=D("br"),a=N(),s=D("button"),s.textContent="Remove all",u=N(),l=D("hr"),f=N(),c=D("p"),c.textContent="Select theme",p=N(),ke(h.$$.fragment),O(r,"type","checkbox"),U(n,"user-select","none"),U(c,"display","inline"),U(e,"width","8em")},m(y,b){F(y,e,b),B(e,n),B(n,r),r.checked=t[0],B(n,i),B(e,o),B(e,a),B(e,s),B(e,u),B(e,l),B(e,f),B(e,c),B(e,p),ve(h,e,null),d=!0,v||(m=[q(r,"change",t[13]),q(s,"click",t[10])],v=!0)},p(y,b){b&1&&(r.checked=y[0])},i(y){d||(Y(h.$$.fragment,y),d=!0)},o(y){J(h.$$.fragment,y),d=!1},d(y){y&&I(e),me(h),v=!1,ce(m)}}}function gi(t){let e=[],n=new Map,r,i=t[6];const o=a=>a[19].id;for(let a=0;a<i.length;a+=1){let s=yi(t,i,a),u=o(s);n.set(u,e[a]=_i(u,s))}return{c(){for(let a=0;a<e.length;a+=1)e[a].c();r=mr()},m(a,s){for(let u=0;u<e.length;u+=1)e[u].m(a,s);F(a,r,s)},p(a,s){if(s&578){i=a[6];for(let u=0;u<e.length;u+=1)e[u].r();e=oa(e,s,o,1,a,i,n,r.parentNode,ia,_i,r,yi);for(let u=0;u<e.length;u+=1)e[u].a()}},d(a){for(let s=0;s<e.length;s+=1)e[s].d(a);a&&I(r)}}}function _i(t,e){let n,r,i,o,a,s,u,l,f=e[19].meta.author+"",c,p,h,d=e[19].meta.title+"",v,m,y,b=e[19].progress+"",k,A,_=e[19].contents.length-1+"",g,S,w,E=Q,x,C;function L(...j){return e[15](e[19],...j)}function z(){return e[16](e[19])}return{key:t,first:null,c(){n=D("button"),r=D("button"),r.textContent="\u2715",i=N(),o=D("img"),s=N(),u=D("div"),l=D("h4"),c=ee(f),p=N(),h=D("h3"),v=ee(d),m=N(),y=D("p"),k=ee(b),A=ee(" / "),g=ee(_),S=N(),O(r,"class","deleteBtn svelte-174uz3k"),Mr(o.src,a=e[19].meta.cover!==void 0?URL.createObjectURL(e[19].meta.cover):"")||O(o,"src",a),O(o,"alt","cover"),O(o,"class","svelte-174uz3k"),O(h,"class","svelte-174uz3k"),O(u,"class","bookInfo svelte-174uz3k"),O(n,"class","book svelte-174uz3k"),this.first=n},m(j,K){F(j,n,K),B(n,r),B(n,i),B(n,o),B(n,s),B(n,u),B(u,l),B(l,c),B(u,p),B(u,h),B(h,v),B(u,m),B(u,y),B(y,k),B(y,A),B(y,g),B(n,S),x||(C=[q(r,"click",L),q(n,"click",z)],x=!0)},p(j,K){e=j,K&64&&!Mr(o.src,a=e[19].meta.cover!==void 0?URL.createObjectURL(e[19].meta.cover):"")&&O(o,"src",a),K&64&&f!==(f=e[19].meta.author+"")&&de(c,f),K&64&&d!==(d=e[19].meta.title+"")&&de(v,d),K&64&&b!==(b=e[19].progress+"")&&de(k,b),K&64&&_!==(_=e[19].contents.length-1+"")&&de(g,_)},r(){w=n.getBoundingClientRect()},f(){Yo(n),E()},a(){E(),E=qo(n,w,Uu,{duration:200})},d(j){j&&I(n),x=!1,ce(C)}}}function Vu(t){let e,n,r,i=t[4]?"+":"Drop anywhere or click to select a file",o;return{c(){e=D("h1"),e.textContent="\u{1F4DA}",n=N(),r=D("h2"),o=ee(i),O(e,"class","svelte-174uz3k")},m(a,s){F(a,e,s),F(a,n,s),F(a,r,s),B(r,o)},p(a,s){s&16&&i!==(i=a[4]?"+":"Drop anywhere or click to select a file")&&de(o,i)},d(a){a&&I(e),a&&I(n),a&&I(r)}}}function qu(t){let e,n,r;return{c(){e=D("h1"),e.textContent="\u{1F4DA}",n=N(),r=D("h2"),r.textContent="...",O(e,"class","svelte-174uz3k")},m(i,o){F(i,e,o),F(i,n,o),F(i,r,o)},p:Q,d(i){i&&I(e),i&&I(n),i&&I(r)}}}function bi(t){let e,n,r,i,o=t[3]?"Loading":"Drop anywhere or click to select a file",a;return{c(){e=D("div"),n=D("h4"),n.textContent="Load new book",r=N(),i=D("h3"),a=ee(o),U(i,"color",t[2]?"#87CEFA":""),O(i,"class","svelte-174uz3k"),O(e,"class","bookInfo svelte-174uz3k")},m(s,u){F(s,e,u),B(e,n),B(e,r),B(e,i),B(i,a)},p(s,u){u&8&&o!==(o=s[3]?"Loading":"Drop anywhere or click to select a file")&&de(a,o),u&4&&U(i,"color",s[2]?"#87CEFA":"")},d(s){s&&I(e)}}}function Yu(t){let e,n,r,i,o,a,s,u,l,f,c,p,h,d,v;e=new Ao({props:{$$slots:{rightbar:[Hu],toptext:[ju]},$$scope:{ctx:t}}});function m(S){t[14](S)}let y={top:"3.1em",right:"1%",$$slots:{default:[Wu]},$$scope:{ctx:t}};t[5]!==void 0&&(y.visible=t[5]),r=new Kr({props:y}),pe.push(()=>De(r,"visible",m));let b=t[6]&&gi(t);function k(S,w){return S[3]?qu:Vu}let A=k(t),_=A(t),g=t[4]&&bi(t);return{c(){ke(e.$$.fragment),n=N(),ke(r.$$.fragment),o=N(),a=D("div"),b&&b.c(),s=N(),u=D("button"),l=D("div"),_.c(),c=N(),g&&g.c(),O(l,"id","dropInfo"),O(l,"class",f=Lr(t[3]?"loading":"")+" svelte-174uz3k"),U(l,"max-width",t[4]?"":"100% "),U(l,"background-color",t[2]?" #87CEFA":""),O(u,"class","book svelte-174uz3k"),O(u,"style",p=t[4]?"":"max-width: 50vw"),O(a,"id","parent"),O(a,"class","svelte-174uz3k")},m(S,w){ve(e,S,w),F(S,n,w),ve(r,S,w),F(S,o,w),F(S,a,w),b&&b.m(a,null),B(a,s),B(a,u),B(u,l),_.m(l,null),B(u,c),g&&g.m(u,null),h=!0,d||(v=q(u,"click",t[17]),d=!0)},p(S,[w]){const E={};w&4194336&&(E.$$scope={dirty:w,ctx:S}),e.$set(E);const x={};w&4194305&&(x.$$scope={dirty:w,ctx:S}),!i&&w&32&&(i=!0,x.visible=S[5],Te(()=>i=!1)),r.$set(x),S[6]?b?b.p(S,w):(b=gi(S),b.c(),b.m(a,s)):b&&(b.d(1),b=null),A===(A=k(S))&&_?_.p(S,w):(_.d(1),_=A(S),_&&(_.c(),_.m(l,null))),(!h||w&8&&f!==(f=Lr(S[3]?"loading":"")+" svelte-174uz3k"))&&O(l,"class",f),(!h||w&16)&&U(l,"max-width",S[4]?"":"100% "),(!h||w&4)&&U(l,"background-color",S[2]?" #87CEFA":""),S[4]?g?g.p(S,w):(g=bi(S),g.c(),g.m(u,null)):g&&(g.d(1),g=null),(!h||w&16&&p!==(p=S[4]?"":"max-width: 50vw"))&&O(u,"style",p)},i(S){h||(Y(e.$$.fragment,S),Y(r.$$.fragment,S),h=!0)},o(S){J(e.$$.fragment,S),J(r.$$.fragment,S),h=!1},d(S){me(e,S),S&&I(n),me(r,S),S&&I(o),S&&I(a),b&&b.d(),_.d(),g&&g.d(),d=!1,v()}}}function Gu(t,e,n){let r,{readFiles:i=g=>{}}=e,{openExisting:o=g=>{}}=e,{dragging:a}=e,{saveBooksOn:s}=e,{loading:u}=e,l=ho(()=>we.books.toArray());Po(t,l,g=>n(6,r=g));let f=!1,c=!1;const p=()=>{let g=document.createElement("input");g.type="file",g.onchange=S=>{i(S.target.files[0])},g.click()};async function h(g){await we.books.delete(g)}const d=async()=>{confirm("Are you sure you want to remove all saved books?")&&await we.books.clear()};async function v(){if(s){const g=await we.books.count().catch(()=>n(0,s=!1));n(4,f=g>0)}}v();const m=()=>n(5,c=!c);function y(){s=this.checked,n(0,s)}function b(g){c=g,n(5,c)}const k=(g,S)=>{S.stopPropagation(),h(g.id)},A=g=>o(g.id),_=()=>p();return t.$$set=g=>{"readFiles"in g&&n(11,i=g.readFiles),"openExisting"in g&&n(1,o=g.openExisting),"dragging"in g&&n(2,a=g.dragging),"saveBooksOn"in g&&n(0,s=g.saveBooksOn),"loading"in g&&n(3,u=g.loading)},[s,o,a,u,f,c,r,l,p,h,d,i,m,y,b,k,A,_]}class Qu extends Je{constructor(e){super(),Xe(this,e,Gu,Yu,Qe,{readFiles:11,openExisting:1,dragging:2,saveBooksOn:0,loading:3})}}function Xu(t){let e,n,r,i;function o(u){t[10](u)}function a(u){t[11](u)}let s={readFiles:t[6],openExisting:t[7],dragging:t[3]};return t[0]!==void 0&&(s.saveBooksOn=t[0]),t[4]!==void 0&&(s.loading=t[4]),e=new Qu({props:s}),pe.push(()=>De(e,"saveBooksOn",o)),pe.push(()=>De(e,"loading",a)),{c(){ke(e.$$.fragment)},m(u,l){ve(e,u,l),i=!0},p(u,l){const f={};l&8&&(f.dragging=u[3]),!n&&l&1&&(n=!0,f.saveBooksOn=u[0],Te(()=>n=!1)),!r&&l&16&&(r=!0,f.loading=u[4],Te(()=>r=!1)),e.$set(f)},i(u){i||(Y(e.$$.fragment,u),i=!0)},o(u){J(e.$$.fragment,u),i=!1},d(u){me(e,u)}}}function Ju(t){let e,n,r,i;function o(u){t[8](u)}function a(u){t[9](u)}let s={currentBook:t[1]};return t[2]!==void 0&&(s.reading=t[2]),t[5]!==void 0&&(s.currentId=t[5]),e=new $u({props:s}),pe.push(()=>De(e,"reading",o)),pe.push(()=>De(e,"currentId",a)),{c(){ke(e.$$.fragment)},m(u,l){ve(e,u,l),i=!0},p(u,l){const f={};l&2&&(f.currentBook=u[1]),!n&&l&4&&(n=!0,f.reading=u[2],Te(()=>n=!1)),!r&&l&32&&(r=!0,f.currentId=u[5],Te(()=>r=!1)),e.$set(f)},i(u){i||(Y(e.$$.fragment,u),i=!0)},o(u){J(e.$$.fragment,u),i=!1},d(u){me(e,u)}}}function Zu(t){let e,n,r,i;const o=[Ju,Xu],a=[];function s(u,l){return u[2]?0:1}return n=s(t),r=a[n]=o[n](t),{c(){e=D("main"),r.c()},m(u,l){F(u,e,l),a[n].m(e,null),i=!0},p(u,[l]){let f=n;n=s(u),n===f?a[n].p(u,l):(Ii(),J(a[f],1,1,()=>{a[f]=null}),Ki(),r=a[n],r?r.p(u,l):(r=a[n]=o[n](u),r.c()),Y(r,1),r.m(e,null))},i(u){i||(Y(r),i=!0)},o(u){J(r),i=!1},d(u){u&&I(e),a[n].d()}}}function el(t,e,n){let r,i=!1,o=!1,a=!1;const s=async y=>{try{n(4,a=!0);const b=await mu(y);if(u&&y.size<3e7){const k=await Ps(b);f(b,k)}else f(b)}catch(b){alert(b)}n(4,a=!1)};let u;localStorage.getItem("saveBooksOn")!==null?u=JSON.parse(localStorage.getItem("saveBooksOn")):u=!0;const l=()=>{localStorage.setItem("saveBooksOn",JSON.stringify(u))};window.addEventListener("dragenter",y=>{y.dataTransfer.types.includes("Files")&&n(3,o=!0)}),window.addEventListener("dragleave",y=>{n(3,o=!1),y.preventDefault()});const f=(y,b)=>{n(1,r=bu(y)),n(2,i=!0),location.hash=b?b.toString():"",n(5,p=b||-1)},c=y=>{we.transaction("r",we.books,async()=>{let b=await we.books.get(y);b?f(b,b.id):location.hash=""})};Oi(()=>{location.hash!==""&&c(parseInt(location.hash.substring(1)))}),window.onhashchange=()=>{u&&location.hash===""?(document.title="Essence Reader",n(2,i=!1),history.replaceState(null,""," ")):u&&location.hash!==""&&c(parseInt(location.hash.substring(1)))},window.addEventListener("dragover",y=>y.preventDefault()),window.addEventListener("drop",y=>{y.preventDefault(),n(3,o=!1),s(y.dataTransfer.files[0])});let p=-1;function h(y){i=y,n(2,i)}function d(y){p=y,n(5,p)}function v(y){u=y,n(0,u)}function m(y){a=y,n(4,a)}return t.$$.update=()=>{t.$$.dirty&1&&l()},[u,r,i,o,a,p,s,c,h,d,v,m]}class tl extends Je{constructor(e){super(),Xe(this,e,el,Zu,Qe,{})}}new tl({target:document.getElementById("app")})});export default nl();
