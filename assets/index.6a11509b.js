var xo=Object.defineProperty;var So=(t,e,n)=>e in t?xo(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Ao=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Nr=(t,e,n)=>(So(t,typeof e!="symbol"?e+"":e,n),n);var nl=Ao((il,ko)=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();function G(){}const An=t=>t;function Co(t,e){for(const n in e)t[n]=e[n];return t}function xi(t){return t()}function zr(){return Object.create(null)}function ve(t){t.forEach(xi)}function Ze(t){return typeof t=="function"}function Ue(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let Wt;function $r(t,e){return Wt||(Wt=document.createElement("a")),Wt.href=e,t===Wt.href}function Bo(t){return Object.keys(t).length===0}function To(t,...e){if(t==null)return G;const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function Oo(t,e,n){t.$$.on_destroy.push(To(e,n))}function Jt(t,e,n,r){if(t){const i=Si(t,e,n,r);return t[0](i)}}function Si(t,e,n,r){return t[1]&&r?Co(n.ctx.slice(),t[1](r(e))):n.ctx}function Zt(t,e,n,r){if(t[2]&&r){const i=t[2](r(n));if(e.dirty===void 0)return i;if(typeof i=="object"){const o=[],a=Math.max(e.dirty.length,i.length);for(let s=0;s<a;s+=1)o[s]=e.dirty[s]|i[s];return o}return e.dirty|i}return e.dirty}function en(t,e,n,r,i,o){if(i){const a=Si(e,n,r,o);t.p(a,i)}}function tn(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let r=0;r<n;r++)e[r]=-1;return e}return-1}function Ur(t){return t==null?"":t}function Do(t){return t&&Ze(t.destroy)?t.destroy:G}const Ai=typeof window<"u";let gr=Ai?()=>window.performance.now():()=>Date.now(),_r=Ai?t=>requestAnimationFrame(t):G;const it=new Set;function Ci(t){it.forEach(e=>{e.c(t)||(it.delete(e),e.f())}),it.size!==0&&_r(Ci)}function br(t){let e;return it.size===0&&_r(Ci),{promise:new Promise(n=>{it.add(e={c:t,f:n})}),abort(){it.delete(e)}}}function T(t,e){t.appendChild(e)}function Bi(t){if(!t)return document;const e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function Ro(t){const e=O("style");return Io(Bi(t),e),e.sheet}function Io(t,e){return T(t.head||t,e),e.sheet}function R(t,e,n){t.insertBefore(e,n||null)}function D(t){t.parentNode&&t.parentNode.removeChild(t)}function Ko(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function O(t){return document.createElement(t)}function J(t){return document.createTextNode(t)}function N(){return J(" ")}function wr(){return J("")}function Z(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function K(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Po(t){return t===""?null:+t}function Mo(t){return Array.from(t.childNodes)}function ce(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function jr(t,e){t.value=e==null?"":e}function Y(t,e,n,r){n===null?t.style.removeProperty(e):t.style.setProperty(e,n,r?"important":"")}function Hr(t,e){for(let n=0;n<t.options.length;n+=1){const r=t.options[n];if(r.__value===e){r.selected=!0;return}}t.selectedIndex=-1}function Fo(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}function Lo(t,e,{bubbles:n=!1,cancelable:r=!1}={}){const i=document.createEvent("CustomEvent");return i.initCustomEvent(t,n,r,e),i}const dn=new Map;let hn=0;function No(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}function zo(t,e){const n={stylesheet:Ro(e),rules:{}};return dn.set(t,n),n}function pn(t,e,n,r,i,o,a,s=0){const u=16.666/r;let l=`{
`;for(let m=0;m<=1;m+=u){const w=e+(n-e)*o(m);l+=m*100+`%{${a(w,1-w)}}
`}const c=l+`100% {${a(n,1-n)}}
}`,f=`__svelte_${No(c)}_${s}`,p=Bi(t),{stylesheet:h,rules:v}=dn.get(p)||zo(p,t);v[f]||(v[f]=!0,h.insertRule(`@keyframes ${f} ${c}`,h.cssRules.length));const d=t.style.animation||"";return t.style.animation=`${d?`${d}, `:""}${f} ${r}ms linear ${i}ms 1 both`,hn+=1,f}function vn(t,e){const n=(t.style.animation||"").split(", "),r=n.filter(e?o=>o.indexOf(e)<0:o=>o.indexOf("__svelte")===-1),i=n.length-r.length;i&&(t.style.animation=r.join(", "),hn-=i,hn||$o())}function $o(){_r(()=>{hn||(dn.forEach(t=>{const{ownerNode:e}=t.stylesheet;e&&D(e)}),dn.clear())})}function Uo(t,e,n,r){if(!e)return G;const i=t.getBoundingClientRect();if(e.left===i.left&&e.right===i.right&&e.top===i.top&&e.bottom===i.bottom)return G;const{delay:o=0,duration:a=300,easing:s=An,start:u=gr()+o,end:l=u+a,tick:c=G,css:f}=n(t,{from:e,to:i},r);let p=!0,h=!1,v;function d(){f&&(v=pn(t,0,1,a,o,s,f)),o||(h=!0)}function m(){f&&vn(t,v),p=!1}return br(w=>{if(!h&&w>=u&&(h=!0),h&&w>=l&&(c(1,0),m()),!p)return!1;if(h){const _=w-u,y=0+1*s(_/a);c(y,1-y)}return!0}),d(),c(0,1),m}function jo(t){const e=getComputedStyle(t);if(e.position!=="absolute"&&e.position!=="fixed"){const{width:n,height:r}=e,i=t.getBoundingClientRect();t.style.position="absolute",t.style.width=n,t.style.height=r,Ho(t,i)}}function Ho(t,e){const n=t.getBoundingClientRect();if(e.left!==n.left||e.top!==n.top){const r=getComputedStyle(t),i=r.transform==="none"?"":r.transform;t.style.transform=`${i} translate(${e.left-n.left}px, ${e.top-n.top}px)`}}let St;function yt(t){St=t}function Wo(){if(!St)throw new Error("Function called outside component initialization");return St}function Ti(t){Wo().$$.on_mount.push(t)}const pt=[],Oe=[],nn=[],Hn=[],qo=Promise.resolve();let Wn=!1;function Vo(){Wn||(Wn=!0,qo.then(Oi))}function ue(t){nn.push(t)}function At(t){Hn.push(t)}const In=new Set;let qt=0;function Oi(){const t=St;do{for(;qt<pt.length;){const e=pt[qt];qt++,yt(e),Yo(e.$$)}for(yt(null),pt.length=0,qt=0;Oe.length;)Oe.pop()();for(let e=0;e<nn.length;e+=1){const n=nn[e];In.has(n)||(In.add(n),n())}nn.length=0}while(pt.length);for(;Hn.length;)Hn.pop()();Wn=!1,In.clear(),yt(t)}function Yo(t){if(t.fragment!==null){t.update(),ve(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(ue)}}let ht;function Di(){return ht||(ht=Promise.resolve(),ht.then(()=>{ht=null})),ht}function gt(t,e,n){t.dispatchEvent(Lo(`${e?"intro":"outro"}${n}`))}const rn=new Set;let Ce;function Cn(){Ce={r:0,c:[],p:Ce}}function Bn(){Ce.r||ve(Ce.c),Ce=Ce.p}function U(t,e){t&&t.i&&(rn.delete(t),t.i(e))}function Q(t,e,n,r){if(t&&t.o){if(rn.has(t))return;rn.add(t),Ce.c.push(()=>{rn.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}const Ri={duration:0};function Ct(t,e,n){let r=e(t,n),i=!1,o,a,s=0;function u(){o&&vn(t,o)}function l(){const{delay:f=0,duration:p=300,easing:h=An,tick:v=G,css:d}=r||Ri;d&&(o=pn(t,0,1,p,f,h,d,s++)),v(0,1);const m=gr()+f,w=m+p;a&&a.abort(),i=!0,ue(()=>gt(t,!0,"start")),a=br(_=>{if(i){if(_>=w)return v(1,0),gt(t,!0,"end"),u(),i=!1;if(_>=m){const y=h((_-m)/p);v(y,1-y)}}return i})}let c=!1;return{start(){c||(c=!0,vn(t),Ze(r)?(r=r(),Di().then(l)):l())},invalidate(){c=!1},end(){i&&(u(),i=!1)}}}function mn(t,e,n,r){let i=e(t,n),o=r?0:1,a=null,s=null,u=null;function l(){u&&vn(t,u)}function c(p,h){const v=p.b-o;return h*=Math.abs(v),{a:o,b:p.b,d:v,duration:h,start:p.start,end:p.start+h,group:p.group}}function f(p){const{delay:h=0,duration:v=300,easing:d=An,tick:m=G,css:w}=i||Ri,_={start:gr()+h,b:p};p||(_.group=Ce,Ce.r+=1),a||s?s=_:(w&&(l(),u=pn(t,o,p,v,h,d,w)),p&&m(0,1),a=c(_,v),ue(()=>gt(t,p,"start")),br(y=>{if(s&&y>s.start&&(a=c(s,v),s=null,gt(t,a.b,"start"),w&&(l(),u=pn(t,o,a.b,a.duration,0,d,i.css))),a){if(y>=a.end)m(o=a.b,1-o),gt(t,a.b,"end"),s||(a.b?l():--a.group.r||ve(a.group.c)),a=null;else if(y>=a.start){const b=y-a.start;o=a.a+a.d*d(b/a.duration),m(o,1-o)}}return!!(a||s)}))}return{run(p){Ze(i)?Di().then(()=>{i=i(),f(p)}):f(p)},end(){l(),a=s=null}}}const Go=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Qo(t,e){t.d(1),e.delete(t.key)}function Xo(t,e){t.f(),Qo(t,e)}function Jo(t,e,n,r,i,o,a,s,u,l,c,f){let p=t.length,h=o.length,v=p;const d={};for(;v--;)d[t[v].key]=v;const m=[],w=new Map,_=new Map;for(v=h;v--;){const k=f(i,o,v),S=n(k);let x=a.get(S);x?r&&x.p(k,e):(x=l(S,k),x.c()),w.set(S,m[v]=x),S in d&&_.set(S,Math.abs(v-d[S]))}const y=new Set,b=new Set;function g(k){U(k,1),k.m(s,c),a.set(k.key,k),c=k.first,h--}for(;p&&h;){const k=m[h-1],S=t[p-1],x=k.key,E=S.key;k===S?(c=k.first,p--,h--):w.has(E)?!a.has(x)||y.has(x)?g(k):b.has(E)?p--:_.get(x)>_.get(E)?(b.add(x),g(k)):(y.add(E),p--):(u(S,a),p--)}for(;p--;){const k=t[p];w.has(k.key)||u(k,a)}for(;h;)g(m[h-1]);return m}function Bt(t,e,n){const r=t.$$.props[e];r!==void 0&&(t.$$.bound[r]=n,n(t.$$.ctx[r]))}function ge(t){t&&t.c()}function he(t,e,n,r){const{fragment:i,after_update:o}=t.$$;i&&i.m(e,n),r||ue(()=>{const a=t.$$.on_mount.map(xi).filter(Ze);t.$$.on_destroy?t.$$.on_destroy.push(...a):ve(a),t.$$.on_mount=[]}),o.forEach(ue)}function pe(t,e){const n=t.$$;n.fragment!==null&&(ve(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Zo(t,e){t.$$.dirty[0]===-1&&(pt.push(t),Vo(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function je(t,e,n,r,i,o,a,s=[-1]){const u=St;yt(t);const l=t.$$={fragment:null,ctx:[],props:o,update:G,not_equal:i,bound:zr(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(u?u.$$.context:[])),callbacks:zr(),dirty:s,skip_bound:!1,root:e.target||u.$$.root};a&&a(l.root);let c=!1;if(l.ctx=n?n(t,e.props||{},(f,p,...h)=>{const v=h.length?h[0]:p;return l.ctx&&i(l.ctx[f],l.ctx[f]=v)&&(!l.skip_bound&&l.bound[f]&&l.bound[f](v),c&&Zo(t,f)),p}):[],l.update(),c=!0,ve(l.before_update),l.fragment=r?r(l.ctx):!1,e.target){if(e.hydrate){const f=Mo(e.target);l.fragment&&l.fragment.l(f),f.forEach(D)}else l.fragment&&l.fragment.c();e.intro&&U(t.$$.fragment),he(t,e.target,e.anchor,e.customElement),Oi()}yt(u)}class He{$destroy(){pe(this,1),this.$destroy=G}$on(e,n){if(!Ze(n))return G;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!Bo(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.
Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.
THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var $=function(){return $=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},$.apply(this,arguments)};function qn(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))}var W=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,ee=Object.keys,ie=Array.isArray;typeof Promise<"u"&&!W.Promise&&(W.Promise=Promise);function se(t,e){return typeof e!="object"||ee(e).forEach(function(n){t[n]=e[n]}),t}var Tt=Object.getPrototypeOf,ea={}.hasOwnProperty;function fe(t,e){return ea.call(t,e)}function at(t,e){typeof e=="function"&&(e=e(Tt(t))),(typeof Reflect>"u"?ee:Reflect.ownKeys)(e).forEach(function(n){De(t,n,e[n])})}var Ii=Object.defineProperty;function De(t,e,n,r){Ii(t,e,se(n&&fe(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function ut(t){return{from:function(e){return t.prototype=Object.create(e.prototype),De(t.prototype,"constructor",t),{extend:at.bind(null,t.prototype)}}}}var ta=Object.getOwnPropertyDescriptor;function kr(t,e){var n=ta(t,e),r;return n||(r=Tt(t))&&kr(r,e)}var na=[].slice;function Tn(t,e,n){return na.call(t,e,n)}function Ki(t,e){return e(t)}function vt(t){if(!t)throw new Error("Assertion Failed")}function Pi(t){W.setImmediate?setImmediate(t):setTimeout(t,0)}function Mi(t,e){return t.reduce(function(n,r,i){var o=e(r,i);return o&&(n[o[0]]=o[1]),n},{})}function ra(t,e,n){try{t.apply(null,n)}catch(r){e&&e(r)}}function Te(t,e){if(fe(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var n=[],r=0,i=e.length;r<i;++r){var o=Te(t,e[r]);n.push(o)}return n}var a=e.indexOf(".");if(a!==-1){var s=t[e.substr(0,a)];return s===void 0?void 0:Te(s,e.substr(a+1))}}function ye(t,e,n){if(!(!t||e===void 0)&&!("isFrozen"in Object&&Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){vt(typeof n!="string"&&"length"in n);for(var r=0,i=e.length;r<i;++r)ye(t,e[r],n[r])}else{var o=e.indexOf(".");if(o!==-1){var a=e.substr(0,o),s=e.substr(o+1);if(s==="")n===void 0?ie(t)&&!isNaN(parseInt(a))?t.splice(a,1):delete t[a]:t[a]=n;else{var u=t[a];(!u||!fe(t,a))&&(u=t[a]={}),ye(u,s,n)}}else n===void 0?ie(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=n}}function ia(t,e){typeof e=="string"?ye(t,e,void 0):"length"in e&&[].map.call(e,function(n){ye(t,n,void 0)})}function Fi(t){var e={};for(var n in t)fe(t,n)&&(e[n]=t[n]);return e}var oa=[].concat;function Li(t){return oa.apply([],t)}var Ni="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Li([8,16,32,64].map(function(t){return["Int","Uint","Float"].map(function(e){return e+t+"Array"})}))).filter(function(t){return W[t]}),aa=Ni.map(function(t){return W[t]});Mi(Ni,function(t){return[t,!0]});var Me=null;function Lt(t){Me=typeof WeakMap<"u"&&new WeakMap;var e=Vn(t);return Me=null,e}function Vn(t){if(!t||typeof t!="object")return t;var e=Me&&Me.get(t);if(e)return e;if(ie(t)){e=[],Me&&Me.set(t,e);for(var n=0,r=t.length;n<r;++n)e.push(Vn(t[n]))}else if(aa.indexOf(t.constructor)>=0)e=t;else{var i=Tt(t);e=i===Object.prototype?{}:Object.create(i),Me&&Me.set(t,e);for(var o in t)fe(t,o)&&(e[o]=Vn(t[o]))}return e}var sa={}.toString;function Yn(t){return sa.call(t).slice(8,-1)}var Gn=typeof Symbol<"u"?Symbol.iterator:"@@iterator",ua=typeof Gn=="symbol"?function(t){var e;return t!=null&&(e=t[Gn])&&e.apply(t)}:function(){return null},rt={};function Ae(t){var e,n,r,i;if(arguments.length===1){if(ie(t))return t.slice();if(this===rt&&typeof t=="string")return[t];if(i=ua(t)){for(n=[];r=i.next(),!r.done;)n.push(r.value);return n}if(t==null)return[t];if(e=t.length,typeof e=="number"){for(n=new Array(e);e--;)n[e]=t[e];return n}return[t]}for(e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];return n}var Er=typeof Symbol<"u"?function(t){return t[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Ee=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function zi(t,e){Ee=t,$i=e}var $i=function(){return!0},la=!new Error("").stack;function et(){if(la)try{throw et.arguments,new Error}catch(t){return t}return new Error}function Qn(t,e){var n=t.stack;return n?(e=e||0,n.indexOf(t.name)===0&&(e+=(t.name+t.message).split(`
`).length),n.split(`
`).slice(e).filter($i).map(function(r){return`
`+r}).join("")):""}var ca=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"],Ui=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],xr=ca.concat(Ui),fa={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function lt(t,e){this._e=et(),this.name=t,this.message=e}ut(lt).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Qn(this._e,2))}},toString:function(){return this.name+": "+this.message}});function ji(t,e){return t+". Errors: "+Object.keys(e).map(function(n){return e[n].toString()}).filter(function(n,r,i){return i.indexOf(n)===r}).join(`
`)}function yn(t,e,n,r){this._e=et(),this.failures=e,this.failedKeys=r,this.successCount=n,this.message=ji(t,e)}ut(yn).from(lt);function _t(t,e){this._e=et(),this.name="BulkError",this.failures=Object.keys(e).map(function(n){return e[n]}),this.failuresByPos=e,this.message=ji(t,e)}ut(_t).from(lt);var Sr=xr.reduce(function(t,e){return t[e]=e+"Error",t},{}),da=lt,M=xr.reduce(function(t,e){var n=e+"Error";function r(i,o){this._e=et(),this.name=n,i?typeof i=="string"?(this.message=""+i+(o?`
 `+o:""),this.inner=o||null):typeof i=="object"&&(this.message=i.name+" "+i.message,this.inner=i):(this.message=fa[e]||n,this.inner=null)}return ut(r).from(da),t[e]=r,t},{});M.Syntax=SyntaxError;M.Type=TypeError;M.Range=RangeError;var Wr=Ui.reduce(function(t,e){return t[e+"Error"]=M[e],t},{});function ha(t,e){if(!t||t instanceof lt||t instanceof TypeError||t instanceof SyntaxError||!t.name||!Wr[t.name])return t;var n=new Wr[t.name](e||t.message,t);return"stack"in t&&De(n,"stack",{get:function(){return this.inner.stack}}),n}var On=xr.reduce(function(t,e){return["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=M[e]),t},{});On.ModifyError=yn;On.DexieError=lt;On.BulkError=_t;function j(){}function Nt(t){return t}function pa(t,e){return t==null||t===Nt?e:function(n){return e(t(n))}}function Qe(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function va(t,e){return t===j?e:function(){var n=t.apply(this,arguments);n!==void 0&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?Qe(r,this.onsuccess):r),i&&(this.onerror=this.onerror?Qe(i,this.onerror):i),o!==void 0?o:n}}function ma(t,e){return t===j?e:function(){t.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?Qe(n,this.onsuccess):n),r&&(this.onerror=this.onerror?Qe(r,this.onerror):r)}}function ya(t,e){return t===j?e:function(n){var r=t.apply(this,arguments);se(n,r);var i=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var a=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?Qe(i,this.onsuccess):i),o&&(this.onerror=this.onerror?Qe(o,this.onerror):o),r===void 0?a===void 0?void 0:a:se(r,a)}}function ga(t,e){return t===j?e:function(){return e.apply(this,arguments)===!1?!1:t.apply(this,arguments)}}function Ar(t,e){return t===j?e:function(){var n=t.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,i=arguments.length,o=new Array(i);i--;)o[i]=arguments[i];return n.then(function(){return e.apply(r,o)})}return e.apply(this,arguments)}}var Ot={},_a=100,ba=20,Hi=100,Cr=typeof Promise>"u"?[]:function(){var t=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[t,Tt(t),t];var e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,Tt(e),t]}(),Xn=Cr[0],gn=Cr[1],Jn=Cr[2],Wi=gn&&gn.then,on=Xn&&Xn.constructor,Br=!!Jn,Zn=!1,wa=Jn?function(){Jn.then(Vt)}:W.setImmediate?setImmediate.bind(null,Vt):W.MutationObserver?function(){var t=document.createElement("div");new MutationObserver(function(){Vt(),t=null}).observe(t,{attributes:!0}),t.setAttribute("i","1")}:function(){setTimeout(Vt,0)},Dt=function(t,e){mt.push([t,e]),_n&&(wa(),_n=!1)},er=!0,_n=!0,Ye=[],an=[],tr=null,nr=Nt,ot={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Yr,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(function(t){try{Yr(t[0],t[1])}catch{}})}},I=ot,mt=[],Ge=0,sn=[];function C(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=j,this._lib=!1;var e=this._PSD=I;if(Ee&&(this._stackHolder=et(),this._prev=null,this._numPrev=0),typeof t!="function"){if(t!==Ot)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&ir(this,this._value);return}this._state=null,this._value=null,++e.ref,Vi(this,t)}var rr={get:function(){var t=I,e=bn;function n(r,i){var o=this,a=!t.global&&(t!==I||e!==bn),s=a&&!Re(),u=new C(function(l,c){Tr(o,new qi(kn(r,t,a,s),kn(i,t,a,s),l,c,t))});return Ee&&Qi(u,this),u}return n.prototype=Ot,n},set:function(t){De(this,"then",t&&t.prototype===Ot?rr:{get:function(){return t},set:rr.set})}};at(C.prototype,{then:rr,_then:function(t,e){Tr(this,new qi(null,null,t,e,I))},catch:function(t){if(arguments.length===1)return this.then(null,t);var e=arguments[0],n=arguments[1];return typeof e=="function"?this.then(null,function(r){return r instanceof e?n(r):un(r)}):this.then(null,function(r){return r&&r.name===e?n(r):un(r)})},finally:function(t){return this.then(function(e){return t(),e},function(e){return t(),un(e)})},stack:{get:function(){if(this._stack)return this._stack;try{Zn=!0;var t=Gi(this,[],ba),e=t.join(`
From previous: `);return this._state!==null&&(this._stack=e),e}finally{Zn=!1}}},timeout:function(t,e){var n=this;return t<1/0?new C(function(r,i){var o=setTimeout(function(){return i(new M.Timeout(e))},t);n.then(r,i).finally(clearTimeout.bind(null,o))}):this}});typeof Symbol<"u"&&Symbol.toStringTag&&De(C.prototype,Symbol.toStringTag,"Dexie.Promise");ot.env=Xi();function qi(t,e,n,r,i){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=n,this.reject=r,this.psd=i}at(C,{all:function(){var t=Ae.apply(null,arguments).map(wn);return new C(function(e,n){t.length===0&&e([]);var r=t.length;t.forEach(function(i,o){return C.resolve(i).then(function(a){t[o]=a,--r||e(t)},n)})})},resolve:function(t){if(t instanceof C)return t;if(t&&typeof t.then=="function")return new C(function(n,r){t.then(n,r)});var e=new C(Ot,!0,t);return Qi(e,tr),e},reject:un,race:function(){var t=Ae.apply(null,arguments).map(wn);return new C(function(e,n){t.map(function(r){return C.resolve(r).then(e,n)})})},PSD:{get:function(){return I},set:function(t){return I=t}},totalEchoes:{get:function(){return bn}},newPSD:Ne,usePSD:ft,scheduler:{get:function(){return Dt},set:function(t){Dt=t}},rejectionMapper:{get:function(){return nr},set:function(t){nr=t}},follow:function(t,e){return new C(function(n,r){return Ne(function(i,o){var a=I;a.unhandleds=[],a.onunhandled=o,a.finalize=Qe(function(){var s=this;Ea(function(){s.unhandleds.length===0?i():o(s.unhandleds[0])})},a.finalize),t()},e,n,r)})}});on&&(on.allSettled&&De(C,"allSettled",function(){var t=Ae.apply(null,arguments).map(wn);return new C(function(e){t.length===0&&e([]);var n=t.length,r=new Array(n);t.forEach(function(i,o){return C.resolve(i).then(function(a){return r[o]={status:"fulfilled",value:a}},function(a){return r[o]={status:"rejected",reason:a}}).then(function(){return--n||e(r)})})})}),on.any&&typeof AggregateError<"u"&&De(C,"any",function(){var t=Ae.apply(null,arguments).map(wn);return new C(function(e,n){t.length===0&&n(new AggregateError([]));var r=t.length,i=new Array(r);t.forEach(function(o,a){return C.resolve(o).then(function(s){return e(s)},function(s){i[a]=s,--r||n(new AggregateError(i))})})})}));function Vi(t,e){try{e(function(n){if(t._state===null){if(n===t)throw new TypeError("A promise cannot be resolved with itself.");var r=t._lib&&zt();n&&typeof n.then=="function"?Vi(t,function(i,o){n instanceof C?n._then(i,o):n.then(i,o)}):(t._state=!0,t._value=n,Yi(t)),r&&$t()}},ir.bind(null,t))}catch(n){ir(t,n)}}function ir(t,e){if(an.push(e),t._state===null){var n=t._lib&&zt();e=nr(e),t._state=!1,t._value=e,Ee&&e!==null&&typeof e=="object"&&!e._promise&&ra(function(){var r=kr(e,"stack");e._promise=t,De(e,"stack",{get:function(){return Zn?r&&(r.get?r.get.apply(e):r.value):t.stack}})}),xa(t),Yi(t),n&&$t()}}function Yi(t){var e=t._listeners;t._listeners=[];for(var n=0,r=e.length;n<r;++n)Tr(t,e[n]);var i=t._PSD;--i.ref||i.finalize(),Ge===0&&(++Ge,Dt(function(){--Ge===0&&Or()},[]))}function Tr(t,e){if(t._state===null){t._listeners.push(e);return}var n=t._state?e.onFulfilled:e.onRejected;if(n===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++Ge,Dt(ka,[n,t,e])}function ka(t,e,n){try{tr=e;var r,i=e._value;e._state?r=t(i):(an.length&&(an=[]),r=t(i),an.indexOf(i)===-1&&Sa(e)),n.resolve(r)}catch(o){n.reject(o)}finally{tr=null,--Ge===0&&Or(),--n.psd.ref||n.psd.finalize()}}function Gi(t,e,n){if(e.length===n)return e;var r="";if(t._state===!1){var i=t._value,o,a;i!=null?(o=i.name||"Error",a=i.message||i,r=Qn(i,0)):(o=i,a=""),e.push(o+(a?": "+a:"")+r)}return Ee&&(r=Qn(t._stackHolder,2),r&&e.indexOf(r)===-1&&e.push(r),t._prev&&Gi(t._prev,e,n)),e}function Qi(t,e){var n=e?e._numPrev+1:0;n<_a&&(t._prev=e,t._numPrev=n)}function Vt(){zt()&&$t()}function zt(){var t=er;return er=!1,_n=!1,t}function $t(){var t,e,n;do for(;mt.length>0;)for(t=mt,mt=[],n=t.length,e=0;e<n;++e){var r=t[e];r[0].apply(null,r[1])}while(mt.length>0);er=!0,_n=!0}function Or(){var t=Ye;Ye=[],t.forEach(function(r){r._PSD.onunhandled.call(null,r._value,r)});for(var e=sn.slice(0),n=e.length;n;)e[--n]()}function Ea(t){function e(){t(),sn.splice(sn.indexOf(e),1)}sn.push(e),++Ge,Dt(function(){--Ge===0&&Or()},[])}function xa(t){Ye.some(function(e){return e._value===t._value})||Ye.push(t)}function Sa(t){for(var e=Ye.length;e;)if(Ye[--e]._value===t._value){Ye.splice(e,1);return}}function un(t){return new C(Ot,!1,t)}function V(t,e){var n=I;return function(){var r=zt(),i=I;try{return ze(n,!0),t.apply(this,arguments)}catch(o){e&&e(o)}finally{ze(i,!1),r&&$t()}}}var re={awaits:0,echoes:0,id:0},Aa=0,ln=[],Kn=0,bn=0,Ca=0;function Ne(t,e,n,r){var i=I,o=Object.create(i);o.parent=i,o.ref=0,o.global=!1,o.id=++Ca;var a=ot.env;o.env=Br?{Promise:C,PromiseProp:{value:C,configurable:!0,writable:!0},all:C.all,race:C.race,allSettled:C.allSettled,any:C.any,resolve:C.resolve,reject:C.reject,nthen:qr(a.nthen,o),gthen:qr(a.gthen,o)}:{},e&&se(o,e),++i.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()};var s=ft(o,t,n,r);return o.ref===0&&o.finalize(),s}function ct(){return re.id||(re.id=++Aa),++re.awaits,re.echoes+=Hi,re.id}function Re(){return re.awaits?(--re.awaits===0&&(re.id=0),re.echoes=re.awaits*Hi,!0):!1}(""+Wi).indexOf("[native code]")===-1&&(ct=Re=j);function wn(t){return re.echoes&&t&&t.constructor===on?(ct(),t.then(function(e){return Re(),e},function(e){return Re(),te(e)})):t}function Ba(t){++bn,(!re.echoes||--re.echoes===0)&&(re.echoes=re.id=0),ln.push(I),ze(t,!0)}function Ta(){var t=ln[ln.length-1];ln.pop(),ze(t,!1)}function ze(t,e){var n=I;if((e?re.echoes&&(!Kn++||t!==I):Kn&&(!--Kn||t!==I))&&Ji(e?Ba.bind(null,t):Ta),t!==I&&(I=t,n===ot&&(ot.env=Xi()),Br)){var r=ot.env.Promise,i=t.env;gn.then=i.nthen,r.prototype.then=i.gthen,(n.global||t.global)&&(Object.defineProperty(W,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function Xi(){var t=W.Promise;return Br?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(W,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:gn.then,gthen:t.prototype.then}:{}}function ft(t,e,n,r,i){var o=I;try{return ze(t,!0),e(n,r,i)}finally{ze(o,!1)}}function Ji(t){Wi.call(Xn,t)}function kn(t,e,n,r){return typeof t!="function"?t:function(){var i=I;n&&ct(),ze(e,!0);try{return t.apply(this,arguments)}finally{ze(i,!1),r&&Ji(Re)}}}function qr(t,e){return function(n,r){return t.call(this,kn(n,e),kn(r,e))}}var Vr="unhandledrejection";function Yr(t,e){var n;try{n=e.onuncatched(t)}catch{}if(n!==!1)try{var r,i={promise:e,reason:t};if(W.document&&document.createEvent?(r=document.createEvent("Event"),r.initEvent(Vr,!0,!0),se(r,i)):W.CustomEvent&&(r=new CustomEvent(Vr,{detail:i}),se(r,i)),r&&W.dispatchEvent&&(dispatchEvent(r),!W.PromiseRejectionEvent&&W.onunhandledrejection))try{W.onunhandledrejection(r)}catch{}Ee&&r&&!r.defaultPrevented&&console.warn("Unhandled rejection: "+(t.stack||t))}catch{}}var te=C.reject;function or(t,e,n,r){if(!t.idbdb||!t._state.openComplete&&!I.letThrough&&!t._vip){if(t._state.openComplete)return te(new M.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return te(new M.DatabaseClosed);t.open().catch(j)}return t._state.dbReadyPromise.then(function(){return or(t,e,n,r)})}else{var i=t._createTransaction(e,n,t._dbSchema);try{i.create(),t._state.PR1398_maxLoop=3}catch(o){return o.name===Sr.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(function(){return or(t,e,n,r)})):te(o)}return i._promise(e,function(o,a){return Ne(function(){return I.trans=i,r(o,a,i)})}).then(function(o){return i._completion.then(function(){return o})})}}var Gr="3.2.2",qe=String.fromCharCode(65535),ar=-1/0,xe="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Zi="String expected.",bt=[],Dn=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Oa=Dn,Da=Dn,eo=function(t){return!/(dexie\.js|dexie\.min\.js)/.test(t)},Rn="__dbnames",Pn="readonly",Mn="readwrite";function Xe(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}var to={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Yt(t){return typeof t=="string"&&!/\./.test(t)?function(e){return e[t]===void 0&&t in e&&(e=Lt(e),delete e[t]),e}:function(e){return e}}var Ra=function(){function t(){}return t.prototype._trans=function(e,n,r){var i=this._tx||I.trans,o=this.name;function a(u,l,c){if(!c.schema[o])throw new M.NotFound("Table "+o+" not part of transaction");return n(c.idbtrans,c)}var s=zt();try{return i&&i.db===this.db?i===I.trans?i._promise(e,a,r):Ne(function(){return i._promise(e,a,r)},{trans:i,transless:I.transless||I}):or(this.db,e,[this.name],a)}finally{s&&$t()}},t.prototype.get=function(e,n){var r=this;return e&&e.constructor===Object?this.where(e).first(n):this._trans("readonly",function(i){return r.core.get({trans:i,key:e}).then(function(o){return r.hook.reading.fire(o)})}).then(n)},t.prototype.where=function(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(ie(e))return new this.db.WhereClause(this,"["+e.join("+")+"]");var n=ee(e);if(n.length===1)return this.where(n[0]).equals(e[n[0]]);var r=this.schema.indexes.concat(this.schema.primKey).filter(function(c){return c.compound&&n.every(function(f){return c.keyPath.indexOf(f)>=0})&&c.keyPath.every(function(f){return n.indexOf(f)>=0})})[0];if(r&&this.db._maxKey!==qe)return this.where(r.name).equals(r.keyPath.map(function(c){return e[c]}));!r&&Ee&&console.warn("The query "+JSON.stringify(e)+" on "+this.name+" would benefit of a "+("compound index ["+n.join("+")+"]"));var i=this.schema.idxByName,o=this.db._deps.indexedDB;function a(c,f){try{return o.cmp(c,f)===0}catch{return!1}}var s=n.reduce(function(c,f){var p=c[0],h=c[1],v=i[f],d=e[f];return[p||v,p||!v?Xe(h,v&&v.multi?function(m){var w=Te(m,f);return ie(w)&&w.some(function(_){return a(d,_)})}:function(m){return a(d,Te(m,f))}):h]},[null,null]),u=s[0],l=s[1];return u?this.where(u.name).equals(e[u.keyPath]).filter(l):r?this.filter(l):this.where(n).equals("")},t.prototype.filter=function(e){return this.toCollection().and(e)},t.prototype.count=function(e){return this.toCollection().count(e)},t.prototype.offset=function(e){return this.toCollection().offset(e)},t.prototype.limit=function(e){return this.toCollection().limit(e)},t.prototype.each=function(e){return this.toCollection().each(e)},t.prototype.toArray=function(e){return this.toCollection().toArray(e)},t.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},t.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,ie(e)?"["+e.join("+")+"]":e))},t.prototype.reverse=function(){return this.toCollection().reverse()},t.prototype.mapToClass=function(e){this.schema.mappedClass=e;var n=function(r){if(!r)return r;var i=Object.create(e.prototype);for(var o in r)if(fe(r,o))try{i[o]=r[o]}catch{}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=n,this.hook("reading",n),e},t.prototype.defineClass=function(){function e(n){se(this,n)}return this.mapToClass(e)},t.prototype.add=function(e,n){var r=this,i=this.schema.primKey,o=i.auto,a=i.keyPath,s=e;return a&&o&&(s=Yt(a)(e)),this._trans("readwrite",function(u){return r.core.mutate({trans:u,type:"add",keys:n!=null?[n]:null,values:[s]})}).then(function(u){return u.numFailures?C.reject(u.failures[0]):u.lastResult}).then(function(u){if(a)try{ye(e,a,u)}catch{}return u})},t.prototype.update=function(e,n){if(typeof e=="object"&&!ie(e)){var r=Te(e,this.schema.primKey.keyPath);if(r===void 0)return te(new M.InvalidArgument("Given object does not contain its primary key"));try{typeof n!="function"?ee(n).forEach(function(i){ye(e,i,n[i])}):n(e,{value:e,primKey:r})}catch{}return this.where(":id").equals(r).modify(n)}else return this.where(":id").equals(e).modify(n)},t.prototype.put=function(e,n){var r=this,i=this.schema.primKey,o=i.auto,a=i.keyPath,s=e;return a&&o&&(s=Yt(a)(e)),this._trans("readwrite",function(u){return r.core.mutate({trans:u,type:"put",values:[s],keys:n!=null?[n]:null})}).then(function(u){return u.numFailures?C.reject(u.failures[0]):u.lastResult}).then(function(u){if(a)try{ye(e,a,u)}catch{}return u})},t.prototype.delete=function(e){var n=this;return this._trans("readwrite",function(r){return n.core.mutate({trans:r,type:"delete",keys:[e]})}).then(function(r){return r.numFailures?C.reject(r.failures[0]):void 0})},t.prototype.clear=function(){var e=this;return this._trans("readwrite",function(n){return e.core.mutate({trans:n,type:"deleteRange",range:to})}).then(function(n){return n.numFailures?C.reject(n.failures[0]):void 0})},t.prototype.bulkGet=function(e){var n=this;return this._trans("readonly",function(r){return n.core.getMany({keys:e,trans:r}).then(function(i){return i.map(function(o){return n.hook.reading.fire(o)})})})},t.prototype.bulkAdd=function(e,n,r){var i=this,o=Array.isArray(n)?n:void 0;r=r||(o?void 0:n);var a=r?r.allKeys:void 0;return this._trans("readwrite",function(s){var u=i.schema.primKey,l=u.auto,c=u.keyPath;if(c&&o)throw new M.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(o&&o.length!==e.length)throw new M.InvalidArgument("Arguments objects and keys must have the same length");var f=e.length,p=c&&l?e.map(Yt(c)):e;return i.core.mutate({trans:s,type:"add",keys:o,values:p,wantResults:a}).then(function(h){var v=h.numFailures,d=h.results,m=h.lastResult,w=h.failures,_=a?d:m;if(v===0)return _;throw new _t(i.name+".bulkAdd(): "+v+" of "+f+" operations failed",w)})})},t.prototype.bulkPut=function(e,n,r){var i=this,o=Array.isArray(n)?n:void 0;r=r||(o?void 0:n);var a=r?r.allKeys:void 0;return this._trans("readwrite",function(s){var u=i.schema.primKey,l=u.auto,c=u.keyPath;if(c&&o)throw new M.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(o&&o.length!==e.length)throw new M.InvalidArgument("Arguments objects and keys must have the same length");var f=e.length,p=c&&l?e.map(Yt(c)):e;return i.core.mutate({trans:s,type:"put",keys:o,values:p,wantResults:a}).then(function(h){var v=h.numFailures,d=h.results,m=h.lastResult,w=h.failures,_=a?d:m;if(v===0)return _;throw new _t(i.name+".bulkPut(): "+v+" of "+f+" operations failed",w)})})},t.prototype.bulkDelete=function(e){var n=this,r=e.length;return this._trans("readwrite",function(i){return n.core.mutate({trans:i,type:"delete",keys:e})}).then(function(i){var o=i.numFailures,a=i.lastResult,s=i.failures;if(o===0)return a;throw new _t(n.name+".bulkDelete(): "+o+" of "+r+" operations failed",s)})},t}();function Ut(t){var e={},n=function(s,u){if(u){for(var l=arguments.length,c=new Array(l-1);--l;)c[l-1]=arguments[l];return e[s].subscribe.apply(null,c),t}else if(typeof s=="string")return e[s]};n.addEventType=o;for(var r=1,i=arguments.length;r<i;++r)o(arguments[r]);return n;function o(s,u,l){if(typeof s=="object")return a(s);u||(u=ga),l||(l=j);var c={subscribers:[],fire:l,subscribe:function(f){c.subscribers.indexOf(f)===-1&&(c.subscribers.push(f),c.fire=u(c.fire,f))},unsubscribe:function(f){c.subscribers=c.subscribers.filter(function(p){return p!==f}),c.fire=c.subscribers.reduce(u,l)}};return e[s]=n[s]=c,c}function a(s){ee(s).forEach(function(u){var l=s[u];if(ie(l))o(u,s[u][0],s[u][1]);else if(l==="asap")var c=o(u,Nt,function(){for(var p=arguments.length,h=new Array(p);p--;)h[p]=arguments[p];c.subscribers.forEach(function(v){Pi(function(){v.apply(null,h)})})});else throw new M.InvalidArgument("Invalid event config")})}}function jt(t,e){return ut(e).from({prototype:t}),e}function Ia(t){return jt(Ra.prototype,function(n,r,i){this.db=t,this._tx=i,this.name=n,this.schema=r,this.hook=t._allTables[n]?t._allTables[n].hook:Ut(null,{creating:[va,j],reading:[pa,Nt],updating:[ya,j],deleting:[ma,j]})})}function tt(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function Fn(t,e){t.filter=Xe(t.filter,e)}function Ln(t,e,n){var r=t.replayFilter;t.replayFilter=r?function(){return Xe(r(),e())}:e,t.justLimit=n&&!r}function Ka(t,e){t.isMatch=Xe(t.isMatch,e)}function cn(t,e){if(t.isPrimKey)return e.primaryKey;var n=e.getIndexByKeyPath(t.index);if(!n)throw new M.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return n}function Qr(t,e,n){var r=cn(t,e.schema);return e.openCursor({trans:n,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:r,range:t.range}})}function Gt(t,e,n,r){var i=t.replayFilter?Xe(t.filter,t.replayFilter()):t.filter;if(t.or){var o={},a=function(s,u,l){if(!i||i(u,l,function(p){return u.stop(p)},function(p){return u.fail(p)})){var c=u.primaryKey,f=""+c;f==="[object ArrayBuffer]"&&(f=""+new Uint8Array(c)),fe(o,f)||(o[f]=!0,e(s,u,l))}};return Promise.all([t.or._iterate(a,n),Xr(Qr(t,r,n),t.algorithm,a,!t.keysOnly&&t.valueMapper)])}else return Xr(Qr(t,r,n),Xe(t.algorithm,i),e,!t.keysOnly&&t.valueMapper)}function Xr(t,e,n,r){var i=r?function(a,s,u){return n(r(a),s,u)}:n,o=V(i);return t.then(function(a){if(a)return a.start(function(){var s=function(){return a.continue()};(!e||e(a,function(u){return s=u},function(u){a.stop(u),s=j},function(u){a.fail(u),s=j}))&&o(a.value,a,function(u){return s=u}),s()})})}function ae(t,e){try{var n=Jr(t),r=Jr(e);if(n!==r)return n==="Array"?1:r==="Array"?-1:n==="binary"?1:r==="binary"?-1:n==="string"?1:r==="string"?-1:n==="Date"?1:r!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return Ma(Zr(t),Zr(e));case"Array":return Pa(t,e)}}catch{}return NaN}function Pa(t,e){for(var n=t.length,r=e.length,i=n<r?n:r,o=0;o<i;++o){var a=ae(t[o],e[o]);if(a!==0)return a}return n===r?0:n<r?-1:1}function Ma(t,e){for(var n=t.length,r=e.length,i=n<r?n:r,o=0;o<i;++o)if(t[o]!==e[o])return t[o]<e[o]?-1:1;return n===r?0:n<r?-1:1}function Jr(t){var e=typeof t;if(e!=="object")return e;if(ArrayBuffer.isView(t))return"binary";var n=Yn(t);return n==="ArrayBuffer"?"binary":n}function Zr(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}var Fa=function(){function t(){}return t.prototype._read=function(e,n){var r=this._ctx;return r.error?r.table._trans(null,te.bind(null,r.error)):r.table._trans("readonly",e).then(n)},t.prototype._write=function(e){var n=this._ctx;return n.error?n.table._trans(null,te.bind(null,n.error)):n.table._trans("readwrite",e,"locked")},t.prototype._addAlgorithm=function(e){var n=this._ctx;n.algorithm=Xe(n.algorithm,e)},t.prototype._iterate=function(e,n){return Gt(this._ctx,e,n,this._ctx.table.core)},t.prototype.clone=function(e){var n=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&se(r,e),n._ctx=r,n},t.prototype.raw=function(){return this._ctx.valueMapper=null,this},t.prototype.each=function(e){var n=this._ctx;return this._read(function(r){return Gt(n,e,r,n.table.core)})},t.prototype.count=function(e){var n=this;return this._read(function(r){var i=n._ctx,o=i.table.core;if(tt(i,!0))return o.count({trans:r,query:{index:cn(i,o.schema),range:i.range}}).then(function(s){return Math.min(s,i.limit)});var a=0;return Gt(i,function(){return++a,!1},r,o).then(function(){return a})}).then(e)},t.prototype.sortBy=function(e,n){var r=e.split(".").reverse(),i=r[0],o=r.length-1;function a(l,c){return c?a(l[r[c]],c-1):l[i]}var s=this._ctx.dir==="next"?1:-1;function u(l,c){var f=a(l,o),p=a(c,o);return f<p?-s:f>p?s:0}return this.toArray(function(l){return l.sort(u)}).then(n)},t.prototype.toArray=function(e){var n=this;return this._read(function(r){var i=n._ctx;if(i.dir==="next"&&tt(i,!0)&&i.limit>0){var o=i.valueMapper,a=cn(i,i.table.core.schema);return i.table.core.query({trans:r,limit:i.limit,values:!0,query:{index:a,range:i.range}}).then(function(u){var l=u.result;return o?l.map(o):l})}else{var s=[];return Gt(i,function(u){return s.push(u)},r,i.table.core).then(function(){return s})}},e)},t.prototype.offset=function(e){var n=this._ctx;return e<=0?this:(n.offset+=e,tt(n)?Ln(n,function(){var r=e;return function(i,o){return r===0?!0:r===1?(--r,!1):(o(function(){i.advance(r),r=0}),!1)}}):Ln(n,function(){var r=e;return function(){return--r<0}}),this)},t.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Ln(this._ctx,function(){var n=e;return function(r,i,o){return--n<=0&&i(o),n>=0}},!0),this},t.prototype.until=function(e,n){return Fn(this._ctx,function(r,i,o){return e(r.value)?(i(o),n):!0}),this},t.prototype.first=function(e){return this.limit(1).toArray(function(n){return n[0]}).then(e)},t.prototype.last=function(e){return this.reverse().first(e)},t.prototype.filter=function(e){return Fn(this._ctx,function(n){return e(n.value)}),Ka(this._ctx,e),this},t.prototype.and=function(e){return this.filter(e)},t.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},t.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},t.prototype.desc=function(){return this.reverse()},t.prototype.eachKey=function(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){e(i.key,i)})},t.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},t.prototype.eachPrimaryKey=function(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){e(i.primaryKey,i)})},t.prototype.keys=function(e){var n=this._ctx;n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,o){r.push(o.key)}).then(function(){return r}).then(e)},t.prototype.primaryKeys=function(e){var n=this._ctx;if(n.dir==="next"&&tt(n,!0)&&n.limit>0)return this._read(function(i){var o=cn(n,n.table.core.schema);return n.table.core.query({trans:i,values:!1,limit:n.limit,query:{index:o,range:n.range}})}).then(function(i){var o=i.result;return o}).then(e);n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,o){r.push(o.primaryKey)}).then(function(){return r}).then(e)},t.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},t.prototype.firstKey=function(e){return this.limit(1).keys(function(n){return n[0]}).then(e)},t.prototype.lastKey=function(e){return this.reverse().firstKey(e)},t.prototype.distinct=function(){var e=this._ctx,n=e.index&&e.table.schema.idxByName[e.index];if(!n||!n.multi)return this;var r={};return Fn(this._ctx,function(i){var o=i.primaryKey.toString(),a=fe(r,o);return r[o]=!0,!a}),this},t.prototype.modify=function(e){var n=this,r=this._ctx;return this._write(function(i){var o;if(typeof e=="function")o=e;else{var a=ee(e),s=a.length;o=function(w){for(var _=!1,y=0;y<s;++y){var b=a[y],g=e[b];Te(w,b)!==g&&(ye(w,b,g),_=!0)}return _}}var u=r.table.core,l=u.schema.primaryKey,c=l.outbound,f=l.extractKey,p=n.db._options.modifyChunkSize||200,h=[],v=0,d=[],m=function(w,_){var y=_.failures,b=_.numFailures;v+=w-b;for(var g=0,k=ee(y);g<k.length;g++){var S=k[g];h.push(y[S])}};return n.clone().primaryKeys().then(function(w){var _=function(y){var b=Math.min(p,w.length-y);return u.getMany({trans:i,keys:w.slice(y,y+b),cache:"immutable"}).then(function(g){for(var k=[],S=[],x=c?[]:null,E=[],A=0;A<b;++A){var B=g[A],z={value:Lt(B),primKey:w[y+A]};o.call(z,z.value,z)!==!1&&(z.value==null?E.push(w[y+A]):!c&&ae(f(B),f(z.value))!==0?(E.push(w[y+A]),k.push(z.value)):(S.push(z.value),c&&x.push(w[y+A])))}var L=tt(r)&&r.limit===1/0&&(typeof e!="function"||e===Nn)&&{index:r.index,range:r.range};return Promise.resolve(k.length>0&&u.mutate({trans:i,type:"add",values:k}).then(function(X){for(var F in X.failures)E.splice(parseInt(F),1);m(k.length,X)})).then(function(){return(S.length>0||L&&typeof e=="object")&&u.mutate({trans:i,type:"put",keys:x,values:S,criteria:L,changeSpec:typeof e!="function"&&e}).then(function(X){return m(S.length,X)})}).then(function(){return(E.length>0||L&&e===Nn)&&u.mutate({trans:i,type:"delete",keys:E,criteria:L}).then(function(X){return m(E.length,X)})}).then(function(){return w.length>y+b&&_(y+p)})})};return _(0).then(function(){if(h.length>0)throw new yn("Error modifying one or more objects",h,v,d);return w.length})})})},t.prototype.delete=function(){var e=this._ctx,n=e.range;return tt(e)&&(e.isPrimKey&&!Da||n.type===3)?this._write(function(r){var i=e.table.core.schema.primaryKey,o=n;return e.table.core.count({trans:r,query:{index:i,range:o}}).then(function(a){return e.table.core.mutate({trans:r,type:"deleteRange",range:o}).then(function(s){var u=s.failures;s.lastResult,s.results;var l=s.numFailures;if(l)throw new yn("Could not delete some values",Object.keys(u).map(function(c){return u[c]}),a-l);return a-l})})}):this.modify(Nn)},t}(),Nn=function(t,e){return e.value=null};function La(t){return jt(Fa.prototype,function(n,r){this.db=t;var i=to,o=null;if(r)try{i=r()}catch(l){o=l}var a=n._ctx,s=a.table,u=s.hook.reading.fire;this._ctx={table:s,index:a.index,isPrimKey:!a.index||s.schema.primKey.keyPath&&a.index===s.schema.primKey.name,range:i,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:o,or:a.or,valueMapper:u!==Nt?u:null}})}function Na(t,e){return t<e?-1:t===e?0:1}function za(t,e){return t>e?-1:t===e?0:1}function le(t,e,n){var r=t instanceof ro?new t.Collection(t):t;return r._ctx.error=n?new n(e):new TypeError(e),r}function nt(t){return new t.Collection(t,function(){return no("")}).limit(0)}function $a(t){return t==="next"?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()}}function Ua(t){return t==="next"?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()}}function ja(t,e,n,r,i,o){for(var a=Math.min(t.length,r.length),s=-1,u=0;u<a;++u){var l=e[u];if(l!==r[u])return i(t[u],n[u])<0?t.substr(0,u)+n[u]+n.substr(u+1):i(t[u],r[u])<0?t.substr(0,u)+r[u]+n.substr(u+1):s>=0?t.substr(0,s)+e[s]+n.substr(s+1):null;i(t[u],l)<0&&(s=u)}return a<r.length&&o==="next"?t+n.substr(t.length):a<t.length&&o==="prev"?t.substr(0,n.length):s<0?null:t.substr(0,s)+r[s]+n.substr(s+1)}function Qt(t,e,n,r){var i,o,a,s,u,l,c,f=n.length;if(!n.every(function(d){return typeof d=="string"}))return le(t,Zi);function p(d){i=$a(d),o=Ua(d),a=d==="next"?Na:za;var m=n.map(function(w){return{lower:o(w),upper:i(w)}}).sort(function(w,_){return a(w.lower,_.lower)});s=m.map(function(w){return w.upper}),u=m.map(function(w){return w.lower}),l=d,c=d==="next"?"":r}p("next");var h=new t.Collection(t,function(){return Pe(s[0],u[f-1]+r)});h._ondirectionchange=function(d){p(d)};var v=0;return h._addAlgorithm(function(d,m,w){var _=d.key;if(typeof _!="string")return!1;var y=o(_);if(e(y,u,v))return!0;for(var b=null,g=v;g<f;++g){var k=ja(_,y,s[g],u[g],a,l);k===null&&b===null?v=g+1:(b===null||a(b,k)>0)&&(b=k)}return m(b!==null?function(){d.continue(b+c)}:w),!1}),h}function Pe(t,e,n,r){return{type:2,lower:t,upper:e,lowerOpen:n,upperOpen:r}}function no(t){return{type:1,lower:t,upper:t}}var ro=function(){function t(){}return Object.defineProperty(t.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),t.prototype.between=function(e,n,r,i){r=r!==!1,i=i===!0;try{return this._cmp(e,n)>0||this._cmp(e,n)===0&&(r||i)&&!(r&&i)?nt(this):new this.Collection(this,function(){return Pe(e,n,!r,!i)})}catch{return le(this,xe)}},t.prototype.equals=function(e){return e==null?le(this,xe):new this.Collection(this,function(){return no(e)})},t.prototype.above=function(e){return e==null?le(this,xe):new this.Collection(this,function(){return Pe(e,void 0,!0)})},t.prototype.aboveOrEqual=function(e){return e==null?le(this,xe):new this.Collection(this,function(){return Pe(e,void 0,!1)})},t.prototype.below=function(e){return e==null?le(this,xe):new this.Collection(this,function(){return Pe(void 0,e,!1,!0)})},t.prototype.belowOrEqual=function(e){return e==null?le(this,xe):new this.Collection(this,function(){return Pe(void 0,e)})},t.prototype.startsWith=function(e){return typeof e!="string"?le(this,Zi):this.between(e,e+qe,!0,!0)},t.prototype.startsWithIgnoreCase=function(e){return e===""?this.startsWith(e):Qt(this,function(n,r){return n.indexOf(r[0])===0},[e],qe)},t.prototype.equalsIgnoreCase=function(e){return Qt(this,function(n,r){return n===r[0]},[e],"")},t.prototype.anyOfIgnoreCase=function(){var e=Ae.apply(rt,arguments);return e.length===0?nt(this):Qt(this,function(n,r){return r.indexOf(n)!==-1},e,"")},t.prototype.startsWithAnyOfIgnoreCase=function(){var e=Ae.apply(rt,arguments);return e.length===0?nt(this):Qt(this,function(n,r){return r.some(function(i){return n.indexOf(i)===0})},e,qe)},t.prototype.anyOf=function(){var e=this,n=Ae.apply(rt,arguments),r=this._cmp;try{n.sort(r)}catch{return le(this,xe)}if(n.length===0)return nt(this);var i=new this.Collection(this,function(){return Pe(n[0],n[n.length-1])});i._ondirectionchange=function(a){r=a==="next"?e._ascending:e._descending,n.sort(r)};var o=0;return i._addAlgorithm(function(a,s,u){for(var l=a.key;r(l,n[o])>0;)if(++o,o===n.length)return s(u),!1;return r(l,n[o])===0?!0:(s(function(){a.continue(n[o])}),!1)}),i},t.prototype.notEqual=function(e){return this.inAnyRange([[ar,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},t.prototype.noneOf=function(){var e=Ae.apply(rt,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return le(this,xe)}var n=e.reduce(function(r,i){return r?r.concat([[r[r.length-1][1],i]]):[[ar,i]]},null);return n.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})},t.prototype.inAnyRange=function(e,n){var r=this,i=this._cmp,o=this._ascending,a=this._descending,s=this._min,u=this._max;if(e.length===0)return nt(this);if(!e.every(function(g){return g[0]!==void 0&&g[1]!==void 0&&o(g[0],g[1])<=0}))return le(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",M.InvalidArgument);var l=!n||n.includeLowers!==!1,c=n&&n.includeUppers===!0;function f(g,k){for(var S=0,x=g.length;S<x;++S){var E=g[S];if(i(k[0],E[1])<0&&i(k[1],E[0])>0){E[0]=s(E[0],k[0]),E[1]=u(E[1],k[1]);break}}return S===x&&g.push(k),g}var p=o;function h(g,k){return p(g[0],k[0])}var v;try{v=e.reduce(f,[]),v.sort(h)}catch{return le(this,xe)}var d=0,m=c?function(g){return o(g,v[d][1])>0}:function(g){return o(g,v[d][1])>=0},w=l?function(g){return a(g,v[d][0])>0}:function(g){return a(g,v[d][0])>=0};function _(g){return!m(g)&&!w(g)}var y=m,b=new this.Collection(this,function(){return Pe(v[0][0],v[v.length-1][1],!l,!c)});return b._ondirectionchange=function(g){g==="next"?(y=m,p=o):(y=w,p=a),v.sort(h)},b._addAlgorithm(function(g,k,S){for(var x=g.key;y(x);)if(++d,d===v.length)return k(S),!1;return _(x)?!0:(r._cmp(x,v[d][1])===0||r._cmp(x,v[d][0])===0||k(function(){p===o?g.continue(v[d][0]):g.continue(v[d][1])}),!1)}),b},t.prototype.startsWithAnyOf=function(){var e=Ae.apply(rt,arguments);return e.every(function(n){return typeof n=="string"})?e.length===0?nt(this):this.inAnyRange(e.map(function(n){return[n,n+qe]})):le(this,"startsWithAnyOf() only works with strings")},t}();function Ha(t){return jt(ro.prototype,function(n,r,i){this.db=t,this._ctx={table:n,index:r===":id"?null:r,or:i};var o=t._deps.indexedDB;if(!o)throw new M.MissingAPI;this._cmp=this._ascending=o.cmp.bind(o),this._descending=function(a,s){return o.cmp(s,a)},this._max=function(a,s){return o.cmp(a,s)>0?a:s},this._min=function(a,s){return o.cmp(a,s)<0?a:s},this._IDBKeyRange=t._deps.IDBKeyRange})}function we(t){return V(function(e){return Rt(e),t(e.target.error),!1})}function Rt(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}var It="storagemutated",Fe="x-storagemutated-1",$e=Ut(null,It),Wa=function(){function t(){}return t.prototype._lock=function(){return vt(!I.global),++this._reculock,this._reculock===1&&!I.global&&(I.lockOwnerFor=this),this},t.prototype._unlock=function(){if(vt(!I.global),--this._reculock===0)for(I.global||(I.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{ft(e[1],e[0])}catch{}}return this},t.prototype._locked=function(){return this._reculock&&I.lockOwnerFor!==this},t.prototype.create=function(e){var n=this;if(!this.mode)return this;var r=this.db.idbdb,i=this.db._state.dbOpenError;if(vt(!this.idbtrans),!e&&!r)switch(i&&i.name){case"DatabaseClosedError":throw new M.DatabaseClosed(i);case"MissingAPIError":throw new M.MissingAPI(i.message,i);default:throw new M.OpenFailed(i)}if(!this.active)throw new M.TransactionInactive;return vt(this._completion._state===null),e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):r.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})),e.onerror=V(function(o){Rt(o),n._reject(e.error)}),e.onabort=V(function(o){Rt(o),n.active&&n._reject(new M.Abort(e.error)),n.active=!1,n.on("abort").fire(o)}),e.oncomplete=V(function(){n.active=!1,n._resolve(),"mutatedParts"in e&&$e.storagemutated.fire(e.mutatedParts)}),this},t.prototype._promise=function(e,n,r){var i=this;if(e==="readwrite"&&this.mode!=="readwrite")return te(new M.ReadOnly("Transaction is readonly"));if(!this.active)return te(new M.TransactionInactive);if(this._locked())return new C(function(a,s){i._blockedFuncs.push([function(){i._promise(e,n,r).then(a,s)},I])});if(r)return Ne(function(){var a=new C(function(s,u){i._lock();var l=n(s,u,i);l&&l.then&&l.then(s,u)});return a.finally(function(){return i._unlock()}),a._lib=!0,a});var o=new C(function(a,s){var u=n(a,s,i);u&&u.then&&u.then(a,s)});return o._lib=!0,o},t.prototype._root=function(){return this.parent?this.parent._root():this},t.prototype.waitFor=function(e){var n=this._root(),r=C.resolve(e);if(n._waitingFor)n._waitingFor=n._waitingFor.then(function(){return r});else{n._waitingFor=r,n._waitingQueue=[];var i=n.idbtrans.objectStore(n.storeNames[0]);(function a(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(i.get(-1/0).onsuccess=a)})()}var o=n._waitingFor;return new C(function(a,s){r.then(function(u){return n._waitingQueue.push(V(a.bind(null,u)))},function(u){return n._waitingQueue.push(V(s.bind(null,u)))}).finally(function(){n._waitingFor===o&&(n._waitingFor=null)})})},t.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new M.Abort))},t.prototype.table=function(e){var n=this._memoizedTables||(this._memoizedTables={});if(fe(n,e))return n[e];var r=this.schema[e];if(!r)throw new M.NotFound("Table "+e+" not part of transaction");var i=new this.db.Table(e,r,this);return i.core=this.db.core.table(e),n[e]=i,i},t}();function qa(t){return jt(Wa.prototype,function(n,r,i,o,a){var s=this;this.db=t,this.mode=n,this.storeNames=r,this.schema=i,this.chromeTransactionDurability=o,this.idbtrans=null,this.on=Ut(this,"complete","error","abort"),this.parent=a||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new C(function(u,l){s._resolve=u,s._reject=l}),this._completion.then(function(){s.active=!1,s.on.complete.fire()},function(u){var l=s.active;return s.active=!1,s.on.error.fire(u),s.parent?s.parent._reject(u):l&&s.idbtrans&&s.idbtrans.abort(),te(u)})})}function sr(t,e,n,r,i,o,a){return{name:t,keyPath:e,unique:n,multi:r,auto:i,compound:o,src:(n&&!a?"&":"")+(r?"*":"")+(i?"++":"")+io(e)}}function io(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function oo(t,e,n){return{name:t,primKey:e,indexes:n,mappedClass:null,idxByName:Mi(n,function(r){return[r.name,r]})}}function Va(t){return t.length===1?t[0]:t}var Kt=function(t){try{return t.only([[]]),Kt=function(){return[[]]},[[]]}catch{return Kt=function(){return qe},qe}};function ur(t){return t==null?function(){}:typeof t=="string"?Ya(t):function(e){return Te(e,t)}}function Ya(t){var e=t.split(".");return e.length===1?function(n){return n[t]}:function(n){return Te(n,t)}}function ei(t){return[].slice.call(t)}var Ga=0;function wt(t){return t==null?":id":typeof t=="string"?t:"["+t.join("+")+"]"}function Qa(t,e,n){function r(f,p){var h=ei(f.objectStoreNames);return{schema:{name:f.name,tables:h.map(function(v){return p.objectStore(v)}).map(function(v){var d=v.keyPath,m=v.autoIncrement,w=ie(d),_=d==null,y={},b={name:v.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:_,compound:w,keyPath:d,autoIncrement:m,unique:!0,extractKey:ur(d)},indexes:ei(v.indexNames).map(function(g){return v.index(g)}).map(function(g){var k=g.name,S=g.unique,x=g.multiEntry,E=g.keyPath,A=ie(E),B={name:k,compound:A,keyPath:E,unique:S,multiEntry:x,extractKey:ur(E)};return y[wt(E)]=B,B}),getIndexByKeyPath:function(g){return y[wt(g)]}};return y[":id"]=b.primaryKey,d!=null&&(y[wt(d)]=b.primaryKey),b})},hasGetAll:h.length>0&&"getAll"in p.objectStore(h[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function i(f){if(f.type===3)return null;if(f.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var p=f.lower,h=f.upper,v=f.lowerOpen,d=f.upperOpen,m=p===void 0?h===void 0?null:e.upperBound(h,!!d):h===void 0?e.lowerBound(p,!!v):e.bound(p,h,!!v,!!d);return m}function o(f){var p=f.name;function h(m){var w=m.trans,_=m.type,y=m.keys,b=m.values,g=m.range;return new Promise(function(k,S){k=V(k);var x=w.objectStore(p),E=x.keyPath==null,A=_==="put"||_==="add";if(!A&&_!=="delete"&&_!=="deleteRange")throw new Error("Invalid operation type: "+_);var B=(y||b||{length:1}).length;if(y&&b&&y.length!==b.length)throw new Error("Given keys array must have same length as given values array.");if(B===0)return k({numFailures:0,failures:{},results:[],lastResult:void 0});var z,L=[],X=[],F=0,H=function(be){++F,Rt(be)};if(_==="deleteRange"){if(g.type===4)return k({numFailures:F,failures:X,results:[],lastResult:void 0});g.type===3?L.push(z=x.clear()):L.push(z=x.delete(i(g)))}else{var q=A?E?[b,y]:[b,null]:[y,null],Ie=q[0],_e=q[1];if(A)for(var de=0;de<B;++de)L.push(z=_e&&_e[de]!==void 0?x[_](Ie[de],_e[de]):x[_](Ie[de])),z.onerror=H;else for(var de=0;de<B;++de)L.push(z=x[_](Ie[de])),z.onerror=H}var Ke=function(be){var dt=be.target.result;L.forEach(function(me,Ht){return me.error!=null&&(X[Ht]=me.error)}),k({numFailures:F,failures:X,results:_==="delete"?y:L.map(function(me){return me.result}),lastResult:dt})};z.onerror=function(be){H(be),Ke(be)},z.onsuccess=Ke})}function v(m){var w=m.trans,_=m.values,y=m.query,b=m.reverse,g=m.unique;return new Promise(function(k,S){k=V(k);var x=y.index,E=y.range,A=w.objectStore(p),B=x.isPrimaryKey?A:A.index(x.name),z=b?g?"prevunique":"prev":g?"nextunique":"next",L=_||!("openKeyCursor"in B)?B.openCursor(i(E),z):B.openKeyCursor(i(E),z);L.onerror=we(S),L.onsuccess=V(function(X){var F=L.result;if(!F){k(null);return}F.___id=++Ga,F.done=!1;var H=F.continue.bind(F),q=F.continuePrimaryKey;q&&(q=q.bind(F));var Ie=F.advance.bind(F),_e=function(){throw new Error("Cursor not started")},de=function(){throw new Error("Cursor not stopped")};F.trans=w,F.stop=F.continue=F.continuePrimaryKey=F.advance=_e,F.fail=V(S),F.next=function(){var Ke=this,be=1;return this.start(function(){return be--?Ke.continue():Ke.stop()}).then(function(){return Ke})},F.start=function(Ke){var be=new Promise(function(me,Ht){me=V(me),L.onerror=we(Ht),F.fail=Ht,F.stop=function(Eo){F.stop=F.continue=F.continuePrimaryKey=F.advance=de,me(Eo)}}),dt=function(){if(L.result)try{Ke()}catch(me){F.fail(me)}else F.done=!0,F.start=function(){throw new Error("Cursor behind last entry")},F.stop()};return L.onsuccess=V(function(me){L.onsuccess=dt,dt()}),F.continue=H,F.continuePrimaryKey=q,F.advance=Ie,dt(),be},k(F)},S)})}function d(m){return function(w){return new Promise(function(_,y){_=V(_);var b=w.trans,g=w.values,k=w.limit,S=w.query,x=k===1/0?void 0:k,E=S.index,A=S.range,B=b.objectStore(p),z=E.isPrimaryKey?B:B.index(E.name),L=i(A);if(k===0)return _({result:[]});if(m){var X=g?z.getAll(L,x):z.getAllKeys(L,x);X.onsuccess=function(Ie){return _({result:Ie.target.result})},X.onerror=we(y)}else{var F=0,H=g||!("openKeyCursor"in z)?z.openCursor(L):z.openKeyCursor(L),q=[];H.onsuccess=function(Ie){var _e=H.result;if(!_e)return _({result:q});if(q.push(g?_e.value:_e.primaryKey),++F===k)return _({result:q});_e.continue()},H.onerror=we(y)}})}}return{name:p,schema:f,mutate:h,getMany:function(m){var w=m.trans,_=m.keys;return new Promise(function(y,b){y=V(y);for(var g=w.objectStore(p),k=_.length,S=new Array(k),x=0,E=0,A,B=function(F){var H=F.target;(S[H._pos]=H.result)!=null,++E===x&&y(S)},z=we(b),L=0;L<k;++L){var X=_[L];X!=null&&(A=g.get(_[L]),A._pos=L,A.onsuccess=B,A.onerror=z,++x)}x===0&&y(S)})},get:function(m){var w=m.trans,_=m.key;return new Promise(function(y,b){y=V(y);var g=w.objectStore(p),k=g.get(_);k.onsuccess=function(S){return y(S.target.result)},k.onerror=we(b)})},query:d(u),openCursor:v,count:function(m){var w=m.query,_=m.trans,y=w.index,b=w.range;return new Promise(function(g,k){var S=_.objectStore(p),x=y.isPrimaryKey?S:S.index(y.name),E=i(b),A=E?x.count(E):x.count();A.onsuccess=V(function(B){return g(B.target.result)}),A.onerror=we(k)})}}}var a=r(t,n),s=a.schema,u=a.hasGetAll,l=s.tables.map(function(f){return o(f)}),c={};return l.forEach(function(f){return c[f.name]=f}),{stack:"dbcore",transaction:t.transaction.bind(t),table:function(f){var p=c[f];if(!p)throw new Error("Table '"+f+"' not found");return c[f]},MIN_KEY:-1/0,MAX_KEY:Kt(e),schema:s}}function Xa(t,e){return e.reduce(function(n,r){var i=r.create;return $($({},n),i(n))},t)}function Ja(t,e,n,r){var i=n.IDBKeyRange;n.indexedDB;var o=Xa(Qa(e,i,r),t.dbcore);return{dbcore:o}}function Dr(t,e){var n=t._novip,r=e.db,i=Ja(n._middlewares,r,n._deps,e);n.core=i.dbcore,n.tables.forEach(function(o){var a=o.name;n.core.schema.tables.some(function(s){return s.name===a})&&(o.core=n.core.table(a),n[a]instanceof n.Table&&(n[a].core=o.core))})}function En(t,e,n,r){var i=t._novip;n.forEach(function(o){var a=r[o];e.forEach(function(s){var u=kr(s,o);(!u||"value"in u&&u.value===void 0)&&(s===i.Transaction.prototype||s instanceof i.Transaction?De(s,o,{get:function(){return this.table(o)},set:function(l){Ii(this,o,{value:l,writable:!0,configurable:!0,enumerable:!0})}}):s[o]=new i.Table(o,a))})})}function lr(t,e){var n=t._novip;e.forEach(function(r){for(var i in r)r[i]instanceof n.Table&&delete r[i]})}function Za(t,e){return t._cfg.version-e._cfg.version}function es(t,e,n,r){var i=t._dbSchema,o=t._createTransaction("readwrite",t._storeNames,i);o.create(n),o._completion.catch(r);var a=o._reject.bind(o),s=I.transless||I;Ne(function(){I.trans=o,I.transless=s,e===0?(ee(i).forEach(function(u){Rr(n,u,i[u].primKey,i[u].indexes)}),Dr(t,n),C.follow(function(){return t.on.populate.fire(o)}).catch(a)):ts(t,e,o,n).catch(a)})}function ts(t,e,n,r){var i=t._novip,o=[],a=i._versions,s=i._dbSchema=Ir(i,i.idbdb,r),u=!1,l=a.filter(function(f){return f._cfg.version>=e});l.forEach(function(f){o.push(function(){var p=s,h=f._cfg.dbschema;fr(i,p,r),fr(i,h,r),s=i._dbSchema=h;var v=ao(p,h);v.add.forEach(function(b){Rr(r,b[0],b[1].primKey,b[1].indexes)}),v.change.forEach(function(b){if(b.recreate)throw new M.Upgrade("Not yet support for changing primary key");var g=r.objectStore(b.name);b.add.forEach(function(k){return cr(g,k)}),b.change.forEach(function(k){g.deleteIndex(k.name),cr(g,k)}),b.del.forEach(function(k){return g.deleteIndex(k)})});var d=f._cfg.contentUpgrade;if(d&&f._cfg.version>e){Dr(i,r),n._memoizedTables={},u=!0;var m=Fi(h);v.del.forEach(function(b){m[b]=p[b]}),lr(i,[i.Transaction.prototype]),En(i,[i.Transaction.prototype],ee(m),m),n.schema=m;var w=Er(d);w&&ct();var _,y=C.follow(function(){if(_=d(n),_&&w){var b=Re.bind(null,null);_.then(b,b)}});return _&&typeof _.then=="function"?C.resolve(_):y.then(function(){return _})}}),o.push(function(p){if(!u||!Oa){var h=f._cfg.dbschema;rs(h,p)}lr(i,[i.Transaction.prototype]),En(i,[i.Transaction.prototype],i._storeNames,i._dbSchema),n.schema=i._dbSchema})});function c(){return o.length?C.resolve(o.shift()(n.idbtrans)).then(c):C.resolve()}return c().then(function(){ns(s,r)})}function ao(t,e){var n={del:[],add:[],change:[]},r;for(r in t)e[r]||n.del.push(r);for(r in e){var i=t[r],o=e[r];if(!i)n.add.push([r,o]);else{var a={name:r,def:o,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(o.primKey.keyPath||"")||i.primKey.auto!==o.primKey.auto&&!Dn)a.recreate=!0,n.change.push(a);else{var s=i.idxByName,u=o.idxByName,l=void 0;for(l in s)u[l]||a.del.push(l);for(l in u){var c=s[l],f=u[l];c?c.src!==f.src&&a.change.push(f):a.add.push(f)}(a.del.length>0||a.add.length>0||a.change.length>0)&&n.change.push(a)}}}return n}function Rr(t,e,n,r){var i=t.db.createObjectStore(e,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(function(o){return cr(i,o)}),i}function ns(t,e){ee(t).forEach(function(n){e.db.objectStoreNames.contains(n)||Rr(e,n,t[n].primKey,t[n].indexes)})}function rs(t,e){[].slice.call(e.db.objectStoreNames).forEach(function(n){return t[n]==null&&e.db.deleteObjectStore(n)})}function cr(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function Ir(t,e,n){var r={},i=Tn(e.objectStoreNames,0);return i.forEach(function(o){for(var a=n.objectStore(o),s=a.keyPath,u=sr(io(s),s||"",!1,!1,!!a.autoIncrement,s&&typeof s!="string",!0),l=[],c=0;c<a.indexNames.length;++c){var f=a.index(a.indexNames[c]);s=f.keyPath;var p=sr(f.name,s,!!f.unique,!!f.multiEntry,!1,s&&typeof s!="string",!1);l.push(p)}r[o]=oo(o,u,l)}),r}function is(t,e,n){var r=t._novip;r.verno=e.version/10;var i=r._dbSchema=Ir(r,e,n);r._storeNames=Tn(e.objectStoreNames,0),En(r,[r._allTables],ee(i),i)}function os(t,e){var n=Ir(t,t.idbdb,e),r=ao(n,t._dbSchema);return!(r.add.length||r.change.some(function(i){return i.add.length||i.change.length}))}function fr(t,e,n){for(var r=t._novip,i=n.db.objectStoreNames,o=0;o<i.length;++o){var a=i[o],s=n.objectStore(a);r._hasGetAll="getAll"in s;for(var u=0;u<s.indexNames.length;++u){var l=s.indexNames[u],c=s.index(l).keyPath,f=typeof c=="string"?c:"["+Tn(c).join("+")+"]";if(e[a]){var p=e[a].idxByName[f];p&&(p.name=l,delete e[a].idxByName[f],e[a].idxByName[l]=p)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&W.WorkerGlobalScope&&W instanceof W.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(r._hasGetAll=!1)}function as(t){return t.split(",").map(function(e,n){e=e.trim();var r=e.replace(/([&*]|\+\+)/g,""),i=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return sr(r,i||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),ie(i),n===0)})}var ss=function(){function t(){}return t.prototype._parseStoresSpec=function(e,n){ee(e).forEach(function(r){if(e[r]!==null){var i=as(e[r]),o=i.shift();if(o.multi)throw new M.Schema("Primary key cannot be multi-valued");i.forEach(function(a){if(a.auto)throw new M.Schema("Only primary key can be marked as autoIncrement (++)");if(!a.keyPath)throw new M.Schema("Index must have a name and cannot be an empty string")}),n[r]=oo(r,o,i)}})},t.prototype.stores=function(e){var n=this.db;this._cfg.storesSource=this._cfg.storesSource?se(this._cfg.storesSource,e):e;var r=n._versions,i={},o={};return r.forEach(function(a){se(i,a._cfg.storesSource),o=a._cfg.dbschema={},a._parseStoresSpec(i,o)}),n._dbSchema=o,lr(n,[n._allTables,n,n.Transaction.prototype]),En(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],ee(o),o),n._storeNames=ee(o),this},t.prototype.upgrade=function(e){return this._cfg.contentUpgrade=Ar(this._cfg.contentUpgrade||j,e),this},t}();function us(t){return jt(ss.prototype,function(n){this.db=t,this._cfg={version:n,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function Kr(t,e){var n=t._dbNamesDB;return n||(n=t._dbNamesDB=new Lr(Rn,{addons:[],indexedDB:t,IDBKeyRange:e}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function Pr(t){return t&&typeof t.databases=="function"}function ls(t){var e=t.indexedDB,n=t.IDBKeyRange;return Pr(e)?Promise.resolve(e.databases()).then(function(r){return r.map(function(i){return i.name}).filter(function(i){return i!==Rn})}):Kr(e,n).toCollection().primaryKeys()}function cs(t,e){var n=t.indexedDB,r=t.IDBKeyRange;!Pr(n)&&e!==Rn&&Kr(n,r).put({name:e}).catch(j)}function fs(t,e){var n=t.indexedDB,r=t.IDBKeyRange;!Pr(n)&&e!==Rn&&Kr(n,r).delete(e).catch(j)}function dr(t){return Ne(function(){return I.letThrough=!0,t()})}function ds(){var t=!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent);if(!t||!indexedDB.databases)return Promise.resolve();var e;return new Promise(function(n){var r=function(){return indexedDB.databases().finally(n)};e=setInterval(r,100),r()}).finally(function(){return clearInterval(e)})}function hs(t){var e=t._state,n=t._deps.indexedDB;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(function(){return e.dbOpenError?te(e.dbOpenError):t});Ee&&(e.openCanceller._stackHolder=et()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;var r=e.openCanceller;function i(){if(e.openCanceller!==r)throw new M.DatabaseClosed("db.open() was cancelled")}var o=e.dbReadyResolve,a=null,s=!1;return C.race([r,(typeof navigator>"u"?C.resolve():ds()).then(function(){return new C(function(u,l){if(i(),!n)throw new M.MissingAPI;var c=t.name,f=e.autoSchema?n.open(c):n.open(c,Math.round(t.verno*10));if(!f)throw new M.MissingAPI;f.onerror=we(l),f.onblocked=V(t._fireOnBlocked),f.onupgradeneeded=V(function(p){if(a=f.transaction,e.autoSchema&&!t._options.allowEmptyDB){f.onerror=Rt,a.abort(),f.result.close();var h=n.deleteDatabase(c);h.onsuccess=h.onerror=V(function(){l(new M.NoSuchDatabase("Database "+c+" doesnt exist"))})}else{a.onerror=we(l);var v=p.oldVersion>Math.pow(2,62)?0:p.oldVersion;s=v<1,t._novip.idbdb=f.result,es(t,v/10,a,l)}},l),f.onsuccess=V(function(){a=null;var p=t._novip.idbdb=f.result,h=Tn(p.objectStoreNames);if(h.length>0)try{var v=p.transaction(Va(h),"readonly");e.autoSchema?is(t,p,v):(fr(t,t._dbSchema,v),os(t,v)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),Dr(t,v)}catch{}bt.push(t),p.onversionchange=V(function(d){e.vcFired=!0,t.on("versionchange").fire(d)}),p.onclose=V(function(d){t.on("close").fire(d)}),s&&cs(t._deps,c),u()},l)})})]).then(function(){return i(),e.onReadyBeingFired=[],C.resolve(dr(function(){return t.on.ready.fire(t.vip)})).then(function u(){if(e.onReadyBeingFired.length>0){var l=e.onReadyBeingFired.reduce(Ar,j);return e.onReadyBeingFired=[],C.resolve(dr(function(){return l(t.vip)})).then(u)}})}).finally(function(){e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(function(){return t}).catch(function(u){e.dbOpenError=u;try{a&&a.abort()}catch{}return r===e.openCanceller&&t._close(),te(u)}).finally(function(){e.openComplete=!0,o()})}function hr(t){var e=function(a){return t.next(a)},n=function(a){return t.throw(a)},r=o(e),i=o(n);function o(a){return function(s){var u=a(s),l=u.value;return u.done?l:!l||typeof l.then!="function"?ie(l)?Promise.all(l).then(r,i):r(l):l.then(r,i)}}return o(e)()}function ps(t,e,n){var r=arguments.length;if(r<2)throw new M.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];n=i.pop();var o=Li(i);return[t,o,n]}function so(t,e,n,r,i){return C.resolve().then(function(){var o=I.transless||I,a=t._createTransaction(e,n,t._dbSchema,r),s={trans:a,transless:o};if(r)a.idbtrans=r.idbtrans;else try{a.create(),t._state.PR1398_maxLoop=3}catch(f){return f.name===Sr.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(function(){return so(t,e,n,null,i)})):te(f)}var u=Er(i);u&&ct();var l,c=C.follow(function(){if(l=i.call(a,a),l)if(u){var f=Re.bind(null,null);l.then(f,f)}else typeof l.next=="function"&&typeof l.throw=="function"&&(l=hr(l))},s);return(l&&typeof l.then=="function"?C.resolve(l).then(function(f){return a.active?f:te(new M.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):c.then(function(){return l})).then(function(f){return r&&a._resolve(),a._completion.then(function(){return f})}).catch(function(f){return a._reject(f),te(f)})})}function Xt(t,e,n){for(var r=ie(t)?t.slice():[t],i=0;i<n;++i)r.push(e);return r}function vs(t){return $($({},t),{table:function(e){var n=t.table(e),r=n.schema,i={},o=[];function a(d,m,w){var _=wt(d),y=i[_]=i[_]||[],b=d==null?0:typeof d=="string"?1:d.length,g=m>0,k=$($({},w),{isVirtual:g,keyTail:m,keyLength:b,extractKey:ur(d),unique:!g&&w.unique});if(y.push(k),k.isPrimaryKey||o.push(k),b>1){var S=b===2?d[0]:d.slice(0,b-1);a(S,m+1,w)}return y.sort(function(x,E){return x.keyTail-E.keyTail}),k}var s=a(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[s];for(var u=0,l=r.indexes;u<l.length;u++){var c=l[u];a(c.keyPath,0,c)}function f(d){var m=i[wt(d)];return m&&m[0]}function p(d,m){return{type:d.type===1?2:d.type,lower:Xt(d.lower,d.lowerOpen?t.MAX_KEY:t.MIN_KEY,m),lowerOpen:!0,upper:Xt(d.upper,d.upperOpen?t.MIN_KEY:t.MAX_KEY,m),upperOpen:!0}}function h(d){var m=d.query.index;return m.isVirtual?$($({},d),{query:{index:m,range:p(d.query.range,m.keyTail)}}):d}var v=$($({},n),{schema:$($({},r),{primaryKey:s,indexes:o,getIndexByKeyPath:f}),count:function(d){return n.count(h(d))},query:function(d){return n.query(h(d))},openCursor:function(d){var m=d.query.index,w=m.keyTail,_=m.isVirtual,y=m.keyLength;if(!_)return n.openCursor(d);function b(g){function k(x){x!=null?g.continue(Xt(x,d.reverse?t.MAX_KEY:t.MIN_KEY,w)):d.unique?g.continue(g.key.slice(0,y).concat(d.reverse?t.MIN_KEY:t.MAX_KEY,w)):g.continue()}var S=Object.create(g,{continue:{value:k},continuePrimaryKey:{value:function(x,E){g.continuePrimaryKey(Xt(x,t.MAX_KEY,w),E)}},primaryKey:{get:function(){return g.primaryKey}},key:{get:function(){var x=g.key;return y===1?x[0]:x.slice(0,y)}},value:{get:function(){return g.value}}});return S}return n.openCursor(h(d)).then(function(g){return g&&b(g)})}});return v}})}var ms={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:vs};function Mr(t,e,n,r){return n=n||{},r=r||"",ee(t).forEach(function(i){if(!fe(e,i))n[r+i]=void 0;else{var o=t[i],a=e[i];if(typeof o=="object"&&typeof a=="object"&&o&&a){var s=Yn(o),u=Yn(a);s!==u?n[r+i]=e[i]:s==="Object"?Mr(o,a,n,r+i+"."):o!==a&&(n[r+i]=e[i])}else o!==a&&(n[r+i]=e[i])}}),ee(e).forEach(function(i){fe(t,i)||(n[r+i]=e[i])}),n}function ys(t,e){return e.type==="delete"?e.keys:e.keys||e.values.map(t.extractKey)}var gs={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(t){return $($({},t),{table:function(e){var n=t.table(e),r=n.schema.primaryKey,i=$($({},n),{mutate:function(o){var a=I.trans,s=a.table(e).hook,u=s.deleting,l=s.creating,c=s.updating;switch(o.type){case"add":if(l.fire===j)break;return a._promise("readwrite",function(){return f(o)},!0);case"put":if(l.fire===j&&c.fire===j)break;return a._promise("readwrite",function(){return f(o)},!0);case"delete":if(u.fire===j)break;return a._promise("readwrite",function(){return f(o)},!0);case"deleteRange":if(u.fire===j)break;return a._promise("readwrite",function(){return p(o)},!0)}return n.mutate(o);function f(v){var d=I.trans,m=v.keys||ys(r,v);if(!m)throw new Error("Keys missing");return v=v.type==="add"||v.type==="put"?$($({},v),{keys:m}):$({},v),v.type!=="delete"&&(v.values=qn([],v.values,!0)),v.keys&&(v.keys=qn([],v.keys,!0)),_s(n,v,m).then(function(w){var _=m.map(function(y,b){var g=w[b],k={onerror:null,onsuccess:null};if(v.type==="delete")u.fire.call(k,y,g,d);else if(v.type==="add"||g===void 0){var S=l.fire.call(k,y,v.values[b],d);y==null&&S!=null&&(y=S,v.keys[b]=y,r.outbound||ye(v.values[b],r.keyPath,y))}else{var x=Mr(g,v.values[b]),E=c.fire.call(k,x,y,g,d);if(E){var A=v.values[b];Object.keys(E).forEach(function(B){fe(A,B)?A[B]=E[B]:ye(A,B,E[B])})}}return k});return n.mutate(v).then(function(y){for(var b=y.failures,g=y.results,k=y.numFailures,S=y.lastResult,x=0;x<m.length;++x){var E=g?g[x]:m[x],A=_[x];E==null?A.onerror&&A.onerror(b[x]):A.onsuccess&&A.onsuccess(v.type==="put"&&w[x]?v.values[x]:E)}return{failures:b,results:g,numFailures:k,lastResult:S}}).catch(function(y){return _.forEach(function(b){return b.onerror&&b.onerror(y)}),Promise.reject(y)})})}function p(v){return h(v.trans,v.range,1e4)}function h(v,d,m){return n.query({trans:v,values:!1,query:{index:r,range:d},limit:m}).then(function(w){var _=w.result;return f({type:"delete",keys:_,trans:v}).then(function(y){return y.numFailures>0?Promise.reject(y.failures[0]):_.length<m?{failures:[],numFailures:0,lastResult:void 0}:h(v,$($({},d),{lower:_[_.length-1],lowerOpen:!0}),m)})})}}});return i}})}};function _s(t,e,n){return e.type==="add"?Promise.resolve([]):t.getMany({trans:e.trans,keys:n,cache:"immutable"})}function uo(t,e,n){try{if(!e||e.keys.length<t.length)return null;for(var r=[],i=0,o=0;i<e.keys.length&&o<t.length;++i)ae(e.keys[i],t[o])===0&&(r.push(n?Lt(e.values[i]):e.values[i]),++o);return r.length===t.length?r:null}catch{return null}}var bs={stack:"dbcore",level:-1,create:function(t){return{table:function(e){var n=t.table(e);return $($({},n),{getMany:function(r){if(!r.cache)return n.getMany(r);var i=uo(r.keys,r.trans._cache,r.cache==="clone");return i?C.resolve(i):n.getMany(r).then(function(o){return r.trans._cache={keys:r.keys,values:r.cache==="clone"?Lt(o):o},o})},mutate:function(r){return r.type!=="add"&&(r.trans._cache=null),n.mutate(r)}})}}}},zn;function Fr(t){return!("from"in t)}var Se=function(t,e){if(this)se(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0});else{var n=new Se;return t&&"d"in t&&se(n,t),n}};at(Se.prototype,(zn={add:function(t){return xn(this,t),this},addKey:function(t){return Pt(this,t,t),this},addKeys:function(t){var e=this;return t.forEach(function(n){return Pt(e,n,n)}),this}},zn[Gn]=function(){return pr(this)},zn));function Pt(t,e,n){var r=ae(e,n);if(!isNaN(r)){if(r>0)throw RangeError();if(Fr(t))return se(t,{from:e,to:n,d:1});var i=t.l,o=t.r;if(ae(n,t.from)<0)return i?Pt(i,e,n):t.l={from:e,to:n,d:1,l:null,r:null},ti(t);if(ae(e,t.to)>0)return o?Pt(o,e,n):t.r={from:e,to:n,d:1,l:null,r:null},ti(t);ae(e,t.from)<0&&(t.from=e,t.l=null,t.d=o?o.d+1:1),ae(n,t.to)>0&&(t.to=n,t.r=null,t.d=t.l?t.l.d+1:1);var a=!t.r;i&&!t.l&&xn(t,i),o&&a&&xn(t,o)}}function xn(t,e){function n(r,i){var o=i.from,a=i.to,s=i.l,u=i.r;Pt(r,o,a),s&&n(r,s),u&&n(r,u)}Fr(e)||n(t,e)}function ws(t,e){var n=pr(e),r=n.next();if(r.done)return!1;for(var i=r.value,o=pr(t),a=o.next(i.from),s=a.value;!r.done&&!a.done;){if(ae(s.from,i.to)<=0&&ae(s.to,i.from)>=0)return!0;ae(i.from,s.from)<0?i=(r=n.next(s.from)).value:s=(a=o.next(i.from)).value}return!1}function pr(t){var e=Fr(t)?null:{s:0,n:t};return{next:function(n){for(var r=arguments.length>0;e;)switch(e.s){case 0:if(e.s=1,r)for(;e.n.l&&ae(n,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!r||ae(n,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function ti(t){var e,n,r=(((e=t.r)===null||e===void 0?void 0:e.d)||0)-(((n=t.l)===null||n===void 0?void 0:n.d)||0),i=r>1?"r":r<-1?"l":"";if(i){var o=i==="r"?"l":"r",a=$({},t),s=t[i];t.from=s.from,t.to=s.to,t[i]=s[i],a[i]=s[o],t[o]=a,a.d=ni(a)}t.d=ni(t)}function ni(t){var e=t.r,n=t.l;return(e?n?Math.max(e.d,n.d):e.d:n?n.d:0)+1}var ks={stack:"dbcore",level:0,create:function(t){var e=t.schema.name,n=new Se(t.MIN_KEY,t.MAX_KEY);return $($({},t),{table:function(r){var i=t.table(r),o=i.schema,a=o.primaryKey,s=a.extractKey,u=a.outbound,l=$($({},i),{mutate:function(p){var h=p.trans,v=h.mutatedParts||(h.mutatedParts={}),d=function(S){var x="idb://"+e+"/"+r+"/"+S;return v[x]||(v[x]=new Se)},m=d(""),w=d(":dels"),_=p.type,y=p.type==="deleteRange"?[p.range]:p.type==="delete"?[p.keys]:p.values.length<50?[[],p.values]:[],b=y[0],g=y[1],k=p.trans._cache;return i.mutate(p).then(function(S){if(ie(b)){_!=="delete"&&(b=S.results),m.addKeys(b);var x=uo(b,k);!x&&_!=="add"&&w.addKeys(b),(x||g)&&Es(d,o,x,g)}else if(b){var E={from:b.lower,to:b.upper};w.add(E),m.add(E)}else m.add(n),w.add(n),o.indexes.forEach(function(A){return d(A.name).add(n)});return S})}}),c=function(p){var h,v,d=p.query,m=d.index,w=d.range;return[m,new Se((h=w.lower)!==null&&h!==void 0?h:t.MIN_KEY,(v=w.upper)!==null&&v!==void 0?v:t.MAX_KEY)]},f={get:function(p){return[a,new Se(p.key)]},getMany:function(p){return[a,new Se().addKeys(p.keys)]},count:c,query:c,openCursor:c};return ee(f).forEach(function(p){l[p]=function(h){var v=I.subscr;if(v){var d=function(k){var S="idb://"+e+"/"+r+"/"+k;return v[S]||(v[S]=new Se)},m=d(""),w=d(":dels"),_=f[p](h),y=_[0],b=_[1];if(d(y.name||"").add(b),!y.isPrimaryKey)if(p==="count")w.add(n);else{var g=p==="query"&&u&&h.values&&i.query($($({},h),{values:!1}));return i[p].apply(this,arguments).then(function(k){if(p==="query"){if(u&&h.values)return g.then(function(A){var B=A.result;return m.addKeys(B),k});var S=h.values?k.result.map(s):k.result;h.values?m.addKeys(S):w.addKeys(S)}else if(p==="openCursor"){var x=k,E=h.values;return x&&Object.create(x,{key:{get:function(){return w.addKey(x.primaryKey),x.key}},primaryKey:{get:function(){var A=x.primaryKey;return w.addKey(A),A}},value:{get:function(){return E&&m.addKey(x.primaryKey),x.value}}})}return k})}}return i[p].apply(this,arguments)}}),l}})}};function Es(t,e,n,r){function i(o){var a=t(o.name||"");function s(l){return l!=null?o.extractKey(l):null}var u=function(l){return o.multiEntry&&ie(l)?l.forEach(function(c){return a.addKey(c)}):a.addKey(l)};(n||r).forEach(function(l,c){var f=n&&s(n[c]),p=r&&s(r[c]);ae(f,p)!==0&&(f!=null&&u(f),p!=null&&u(p))})}e.indexes.forEach(i)}var Lr=function(){function t(e,n){var r=this;this._middlewares={},this.verno=0;var i=t.dependencies;this._options=n=$({addons:t.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange},n),this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};var o=n.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var a={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:j,dbReadyPromise:null,cancelOpen:j,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};a.dbReadyPromise=new C(function(s){a.dbReadyResolve=s}),a.openCanceller=new C(function(s,u){a.cancelOpen=u}),this._state=a,this.name=e,this.on=Ut(this,"populate","blocked","versionchange","close",{ready:[Ar,j]}),this.on.ready.subscribe=Ki(this.on.ready.subscribe,function(s){return function(u,l){t.vip(function(){var c=r._state;if(c.openComplete)c.dbOpenError||C.resolve().then(u),l&&s(u);else if(c.onReadyBeingFired)c.onReadyBeingFired.push(u),l&&s(u);else{s(u);var f=r;l||s(function p(){f.on.ready.unsubscribe(u),f.on.ready.unsubscribe(p)})}})}}),this.Collection=La(this),this.Table=Ia(this),this.Transaction=qa(this),this.Version=us(this),this.WhereClause=Ha(this),this.on("versionchange",function(s){s.newVersion>0?console.warn("Another connection wants to upgrade database '"+r.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+r.name+"'. Closing db now to resume the delete request."),r.close()}),this.on("blocked",function(s){!s.newVersion||s.newVersion<s.oldVersion?console.warn("Dexie.delete('"+r.name+"') was blocked"):console.warn("Upgrade '"+r.name+"' blocked by other connection holding version "+s.oldVersion/10)}),this._maxKey=Kt(n.IDBKeyRange),this._createTransaction=function(s,u,l,c){return new r.Transaction(s,u,l,r._options.chromeTransactionDurability,c)},this._fireOnBlocked=function(s){r.on("blocked").fire(s),bt.filter(function(u){return u.name===r.name&&u!==r&&!u._state.vcFired}).map(function(u){return u.on("versionchange").fire(s)})},this.use(ms),this.use(gs),this.use(ks),this.use(bs),this.vip=Object.create(this,{_vip:{value:!0}}),o.forEach(function(s){return s(r)})}return t.prototype.version=function(e){if(isNaN(e)||e<.1)throw new M.Type("Given version is not a positive number");if(e=Math.round(e*10)/10,this.idbdb||this._state.isBeingOpened)throw new M.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var n=this._versions,r=n.filter(function(i){return i._cfg.version===e})[0];return r||(r=new this.Version(e),n.push(r),n.sort(Za),r.stores({}),this._state.autoSchema=!1,r)},t.prototype._whenReady=function(e){var n=this;return this.idbdb&&(this._state.openComplete||I.letThrough||this._vip)?e():new C(function(r,i){if(n._state.openComplete)return i(new M.DatabaseClosed(n._state.dbOpenError));if(!n._state.isBeingOpened){if(!n._options.autoOpen){i(new M.DatabaseClosed);return}n.open().catch(j)}n._state.dbReadyPromise.then(r,i)}).then(e)},t.prototype.use=function(e){var n=e.stack,r=e.create,i=e.level,o=e.name;o&&this.unuse({stack:n,name:o});var a=this._middlewares[n]||(this._middlewares[n]=[]);return a.push({stack:n,create:r,level:i==null?10:i,name:o}),a.sort(function(s,u){return s.level-u.level}),this},t.prototype.unuse=function(e){var n=e.stack,r=e.name,i=e.create;return n&&this._middlewares[n]&&(this._middlewares[n]=this._middlewares[n].filter(function(o){return i?o.create!==i:r?o.name!==r:!1})),this},t.prototype.open=function(){return hs(this)},t.prototype._close=function(){var e=this._state,n=bt.indexOf(this);if(n>=0&&bt.splice(n,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}e.dbReadyPromise=new C(function(r){e.dbReadyResolve=r}),e.openCanceller=new C(function(r,i){e.cancelOpen=i})},t.prototype.close=function(){this._close();var e=this._state;this._options.autoOpen=!1,e.dbOpenError=new M.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)},t.prototype.delete=function(){var e=this,n=arguments.length>0,r=this._state;return new C(function(i,o){var a=function(){e.close();var s=e._deps.indexedDB.deleteDatabase(e.name);s.onsuccess=V(function(){fs(e._deps,e.name),i()}),s.onerror=we(o),s.onblocked=e._fireOnBlocked};if(n)throw new M.InvalidArgument("Arguments not allowed in db.delete()");r.isBeingOpened?r.dbReadyPromise.then(a):a()})},t.prototype.backendDB=function(){return this.idbdb},t.prototype.isOpen=function(){return this.idbdb!==null},t.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"},t.prototype.hasFailed=function(){return this._state.dbOpenError!==null},t.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(t.prototype,"tables",{get:function(){var e=this;return ee(this._allTables).map(function(n){return e._allTables[n]})},enumerable:!1,configurable:!0}),t.prototype.transaction=function(){var e=ps.apply(this,arguments);return this._transaction.apply(this,e)},t.prototype._transaction=function(e,n,r){var i=this,o=I.trans;(!o||o.db!==this||e.indexOf("!")!==-1)&&(o=null);var a=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");var s,u;try{if(u=n.map(function(c){var f=c instanceof i.Table?c.name:c;if(typeof f!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return f}),e=="r"||e===Pn)s=Pn;else if(e=="rw"||e==Mn)s=Mn;else throw new M.InvalidArgument("Invalid transaction mode: "+e);if(o){if(o.mode===Pn&&s===Mn)if(a)o=null;else throw new M.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");o&&u.forEach(function(c){if(o&&o.storeNames.indexOf(c)===-1)if(a)o=null;else throw new M.SubTransaction("Table "+c+" not included in parent transaction.")}),a&&o&&!o.active&&(o=null)}}catch(c){return o?o._promise(null,function(f,p){p(c)}):te(c)}var l=so.bind(null,this,s,u,o,r);return o?o._promise(s,l,"lock"):I.trans?ft(I.transless,function(){return i._whenReady(l)}):this._whenReady(l)},t.prototype.table=function(e){if(!fe(this._allTables,e))throw new M.InvalidTable("Table "+e+" does not exist");return this._allTables[e]},t}(),xs=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Ss=function(){function t(e){this._subscribe=e}return t.prototype.subscribe=function(e,n,r){return this._subscribe(!e||typeof e=="function"?{next:e,error:n,complete:r}:e)},t.prototype[xs]=function(){return this},t}();function lo(t,e){return ee(e).forEach(function(n){var r=t[n]||(t[n]=new Se);xn(r,e[n])}),t}function co(t){return new Ss(function(e){var n=Er(t);function r(h){n&&ct();var v=function(){return Ne(t,{subscr:h,trans:null})},d=I.trans?ft(I.transless,v):v();return n&&d.then(Re,Re),d}var i=!1,o={},a={},s={get closed(){return i},unsubscribe:function(){i=!0,$e.storagemutated.unsubscribe(f)}};e.start&&e.start(s);var u=!1,l=!1;function c(){return ee(a).some(function(h){return o[h]&&ws(o[h],a[h])})}var f=function(h){lo(o,h),c()&&p()},p=function(){if(!(u||i)){o={};var h={},v=r(h);l||($e(It,f),l=!0),u=!0,Promise.resolve(v).then(function(d){u=!1,!i&&(c()?p():(o={},a=h,e.next&&e.next(d)))},function(d){u=!1,e.error&&e.error(d),s.unsubscribe()})}};return p(),s})}var vr;try{vr={indexedDB:W.indexedDB||W.mozIndexedDB||W.webkitIndexedDB||W.msIndexedDB,IDBKeyRange:W.IDBKeyRange||W.webkitIDBKeyRange}}catch{vr={indexedDB:null,IDBKeyRange:null}}var We=Lr;at(We,$($({},On),{delete:function(t){var e=new We(t,{addons:[]});return e.delete()},exists:function(t){return new We(t,{addons:[]}).open().then(function(e){return e.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(t){try{return ls(We.dependencies).then(t)}catch{return te(new M.MissingAPI)}},defineClass:function(){function t(e){se(this,e)}return t},ignoreTransaction:function(t){return I.trans?ft(I.transless,t):t()},vip:dr,async:function(t){return function(){try{var e=hr(t.apply(this,arguments));return!e||typeof e.then!="function"?C.resolve(e):e}catch(n){return te(n)}}},spawn:function(t,e,n){try{var r=hr(t.apply(n,e||[]));return!r||typeof r.then!="function"?C.resolve(r):r}catch(i){return te(i)}},currentTransaction:{get:function(){return I.trans||null}},waitFor:function(t,e){var n=C.resolve(typeof t=="function"?We.ignoreTransaction(t):t).timeout(e||6e4);return I.trans?I.trans.waitFor(n):n},Promise:C,debug:{get:function(){return Ee},set:function(t){zi(t,t==="dexie"?function(){return!0}:eo)}},derive:ut,extend:se,props:at,override:Ki,Events:Ut,on:$e,liveQuery:co,extendObservabilitySet:lo,getByKeyPath:Te,setByKeyPath:ye,delByKeyPath:ia,shallowClone:Fi,deepClone:Lt,getObjectDiff:Mr,cmp:ae,asap:Pi,minKey:ar,addons:[],connections:bt,errnames:Sr,dependencies:vr,semVer:Gr,version:Gr.split(".").map(function(t){return parseInt(t)}).reduce(function(t,e,n){return t+e/Math.pow(10,n*2)})}));We.maxKey=Kt(We.dependencies.IDBKeyRange);typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&($e(It,function(t){if(!Be){var e;Dn?(e=document.createEvent("CustomEvent"),e.initCustomEvent(Fe,!0,!0,t)):e=new CustomEvent(Fe,{detail:t}),Be=!0,dispatchEvent(e),Be=!1}}),addEventListener(Fe,function(t){var e=t.detail;Be||Sn(e)}));function Sn(t){var e=Be;try{Be=!0,$e.storagemutated.fire(t)}finally{Be=e}}var Be=!1;if(typeof BroadcastChannel<"u"){var ri=new BroadcastChannel(Fe);$e(It,function(t){Be||ri.postMessage(t)}),ri.onmessage=function(t){t.data&&Sn(t.data)}}else if(typeof self<"u"&&typeof navigator<"u"){$e(It,function(t){try{Be||(typeof localStorage<"u"&&localStorage.setItem(Fe,JSON.stringify({trig:Math.random(),changedParts:t})),typeof self.clients=="object"&&qn([],self.clients.matchAll({includeUncontrolled:!0}),!0).forEach(function(e){return e.postMessage({type:Fe,changedParts:t})}))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",function(t){if(t.key===Fe){var e=JSON.parse(t.newValue);e&&Sn(e.changedParts)}});var ii=self.document&&navigator.serviceWorker;ii&&ii.addEventListener("message",As)}function As(t){var e=t.data;e&&e.type===Fe&&Sn(e.changedParts)}C.rejectionMapper=ha;zi(Ee,eo);class Cs extends Lr{constructor(){super("bookDB");Nr(this,"books");this.version(5).stores({books:"++id, meta, contents, spine, toc, files, progress"})}}const ke=new Cs,Bs=async t=>{for(let e of await ke.books.toArray())if(e.meta.title===t.meta.title)return e.id;try{return await ke.books.add(t)}catch(e){console.log(e)}};function fo(t){return t.arrayBuffer?t.arrayBuffer():new Promise((e,n)=>{const r=new FileReader;r.addEventListener("loadend",()=>{e(r.result)}),r.addEventListener("error",n),r.readAsArrayBuffer(t)})}async function Ts(t){const e=await fo(t);return new Uint8Array(e)}function ho(t){return typeof Blob<"u"&&t instanceof Blob}function Mt(t){return typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}const Os=typeof process<"u"&&process.versions&&typeof process.versions.node<"u"&&typeof process.versions.electron>"u";function Ds(t){return t.byteOffset===0&&t.byteLength===t.buffer.byteLength}class oi{constructor(e){this.typedArray=e instanceof ArrayBuffer||Mt(e)?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}async getLength(){return this.typedArray.byteLength}async read(e,n){return new Uint8Array(this.typedArray.buffer,this.typedArray.byteOffset+e,n)}}class ai{constructor(e){this.blob=e}async getLength(){return this.blob.size}async read(e,n){const r=this.blob.slice(e,e+n),i=await fo(r);return new Uint8Array(i)}async sliceAsBlob(e,n,r=""){return this.blob.slice(e,e+n,r)}}function Rs(t,e){var n=Uint8Array;if(t[0]==3&&t[1]==0)return e||new n(0);var r=Ks,i=po,o=Is,a=vo,s=e==null;s&&(e=new n(t.length>>>2<<3));for(var u=0,l=0,c=0,f=0,p=0,h=0,v=0,d=0,m=0,w,_;u==0;){if(u=r(t,m,1),l=r(t,m+1,2),m+=3,l==0){(m&7)!=0&&(m+=8-(m&7));var y=(m>>>3)+4,b=t[y-4]|t[y-3]<<8;s&&(e=$n(e,d+b)),e.set(new n(t.buffer,t.byteOffset+y,b),d),m=y+b<<3,d+=b;continue}if(s&&(e=$n(e,d+(1<<17))),l==1&&(w=P.flmap,_=P.fdmap,h=(1<<9)-1,v=(1<<5)-1),l==2){c=i(t,m,5)+257,f=i(t,m+5,5)+1,p=i(t,m+10,4)+4,m+=14;for(var g=0;g<38;g+=2)P.itree[g]=0,P.itree[g+1]=0;for(var k=1,g=0;g<p;g++){var S=i(t,m+g*3,3);P.itree[(P.ordr[g]<<1)+1]=S,S>k&&(k=S)}m+=3*p,kt(P.itree,k),Et(P.itree,k,P.imap),w=P.lmap,_=P.dmap,m=o(P.imap,(1<<k)-1,c+f,t,m,P.ttree);var x=si(P.ttree,0,c,P.ltree);h=(1<<x)-1;var E=si(P.ttree,c,f,P.dtree);v=(1<<E)-1,kt(P.ltree,x),Et(P.ltree,x,w),kt(P.dtree,E),Et(P.dtree,E,_)}for(;;){var A=w[a(t,m)&h];m+=A&15;var B=A>>>4;if(B>>>8==0)e[d++]=B;else{if(B==256)break;var z=d+B-254;if(B>264){var L=P.ldef[B-257];z=d+(L>>>3)+i(t,m,L&7),m+=L&7}var X=_[a(t,m)&v];m+=X&15;var F=X>>>4,H=P.ddef[F],q=(H>>>4)+r(t,m,H&15);for(m+=H&15,s&&(e=$n(e,d+(1<<17)));d<z;)e[d]=e[d++-q],e[d]=e[d++-q],e[d]=e[d++-q],e[d]=e[d++-q];d=z}}}return e.length==d?e:e.slice(0,d)}function $n(t,e){var n=t.length;if(e<=n)return t;var r=new Uint8Array(Math.max(n<<1,e));return r.set(t,0),r}function Is(t,e,n,r,i,o){for(var a=po,s=vo,u=0;u<n;){var l=t[s(r,i)&e];i+=l&15;var c=l>>>4;if(c<=15)o[u]=c,u++;else{var f=0,p=0;c==16?(p=3+a(r,i,2),i+=2,f=o[u-1]):c==17?(p=3+a(r,i,3),i+=3):c==18&&(p=11+a(r,i,7),i+=7);for(var h=u+p;u<h;)o[u]=f,u++}}return i}function si(t,e,n,r){for(var i=0,o=0,a=r.length>>>1;o<n;){var s=t[o+e];r[o<<1]=0,r[(o<<1)+1]=s,s>i&&(i=s),o++}for(;o<a;)r[o<<1]=0,r[(o<<1)+1]=0,o++;return i}function kt(t,e){for(var n=t.length,r,i,o,a,s,u=P.bl_count,a=0;a<=e;a++)u[a]=0;for(a=1;a<n;a+=2)u[t[a]]++;var l=P.next_code;for(r=0,u[0]=0,i=1;i<=e;i++)r=r+u[i-1]<<1,l[i]=r;for(o=0;o<n;o+=2)s=t[o+1],s!=0&&(t[o]=l[s],l[s]++)}function Et(t,e,n){for(var r=t.length,i=P.rev15,o=0;o<r;o+=2)if(t[o+1]!=0)for(var a=o>>1,s=t[o+1],u=a<<4|s,l=e-s,c=t[o]<<l,f=c+(1<<l);c!=f;){var p=i[c]>>>15-e;n[p]=u,c++}}function ui(t,e){for(var n=P.rev15,r=15-e,i=0;i<t.length;i+=2){var o=t[i]<<e-t[i+1];t[i]=n[o]>>>r}}function po(t,e,n){return(t[e>>>3]|t[(e>>>3)+1]<<8)>>>(e&7)&(1<<n)-1}function Ks(t,e,n){return(t[e>>>3]|t[(e>>>3)+1]<<8|t[(e>>>3)+2]<<16)>>>(e&7)&(1<<n)-1}function vo(t,e){return(t[e>>>3]|t[(e>>>3)+1]<<8|t[(e>>>3)+2]<<16)>>>(e&7)}const P=function(){var t=Uint16Array,e=Uint32Array;return{next_code:new t(16),bl_count:new t(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new t(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new e(32),flmap:new t(512),fltree:[],fdmap:new t(32),fdtree:[],lmap:new t(32768),ltree:[],ttree:[],dmap:new t(32768),dtree:[],imap:new t(512),itree:[],rev15:new t(1<<15),lhst:new e(286),dhst:new e(30),ihst:new e(19),lits:new e(15e3),strt:new t(1<<16),prev:new t(1<<15)}}();(function(){for(var t=32768,e=0;e<t;e++){var n=e;n=(n&2863311530)>>>1|(n&1431655765)<<1,n=(n&3435973836)>>>2|(n&858993459)<<2,n=(n&4042322160)>>>4|(n&252645135)<<4,n=(n&4278255360)>>>8|(n&16711935)<<8,P.rev15[e]=(n>>>16|n<<16)>>>17}function r(i,o,a){for(;o--!=0;)i.push(0,a)}for(var e=0;e<32;e++)P.ldef[e]=P.of0[e]<<3|P.exb[e],P.ddef[e]=P.df0[e]<<4|P.dxb[e];r(P.fltree,144,8),r(P.fltree,255-143,9),r(P.fltree,279-255,7),r(P.fltree,287-279,8),kt(P.fltree,9),Et(P.fltree,9,P.flmap),ui(P.fltree,9),r(P.fdtree,32,5),kt(P.fdtree,5),Et(P.fdtree,5,P.fdmap),ui(P.fdtree,5),r(P.itree,19,0),r(P.ltree,286,0),r(P.dtree,30,0),r(P.ttree,320,0)})();const li={table:function(){for(var t=new Uint32Array(256),e=0;e<256;e++){for(var n=e,r=0;r<8;r++)n&1?n=3988292384^n>>>1:n=n>>>1;t[e]=n}return t}(),update:function(t,e,n,r){for(var i=0;i<r;i++)t=li.table[(t^e[n+i])&255]^t>>>8;return t},crc:function(t,e,n){return li.update(4294967295,t,e,n)^4294967295}};function Ps(t,e){return Rs(t,e)}const ci={numWorkers:1,workerURL:"",useWorkers:!1};let Ms=0;const fn=[];function Un(t){return new Promise((e,n)=>{const r=new Worker(t);r.onmessage=i=>{i.data==="start"?(r.onerror=void 0,r.onmessage=void 0,e(r)):n(new Error(`unexpected message: ${i.data}`))},r.onerror=n})}function Fs(t,e){return t.require(e)}(function(){if(Os){const{Worker:t}=Fs(ko,"worker_threads");return{async createWorker(e){return new t(e)},addEventListener(e,n){e.on("message",r=>{n({target:e,data:r})})},async terminate(e){await e.terminate()}}}else return{async createWorker(t){try{return await Un(t)}catch{console.warn("could not load worker:",t)}let e;try{const n=await fetch(t,{mode:"cors"});if(!n.ok)throw new Error(`could not load: ${t}`);e=await n.text(),t=URL.createObjectURL(new Blob([e],{type:"application/javascript"}));const r=await Un(t);return ci.workerURL=t,r}catch{console.warn("could not load worker via fetch:",t)}if(e!==void 0)try{t=`data:application/javascript;base64,${btoa(e)}`;const n=await Un(t);return ci.workerURL=t,n}catch{console.warn("could not load worker via dataURI")}throw console.warn("workers will not be used"),new Error("can not start workers")},addEventListener(t,e){t.addEventListener("message",e)},async terminate(t){t.terminate()}}})();function Ls(t,e,n,r){const i=new Uint8Array(e);Ps(t,i),r(n?new Blob([i],{type:n}):i.buffer)}async function Ns(){if(fn.length!==0)for(;fn.length;){const{src:t,uncompressedSize:e,type:n,resolve:r}=fn.shift();let i=t;ho(t)&&(i=await Ts(t)),Ls(i,e,n,r)}}function mo(t,e,n){return new Promise((r,i)=>{fn.push({src:t,uncompressedSize:e,type:n,resolve:r,reject:i,id:Ms++}),Ns()})}function zs(t,e){const n=t&31,r=(t>>5&15)-1,i=(t>>9&127)+1980,o=0,a=(e&31)*2,s=e>>5&63,u=e>>11&31;return new Date(i,r,n,u,s,a,o)}class $s{constructor(e,n){this._reader=e,this._rawEntry=n,this.name=n.name,this.nameBytes=n.nameBytes,this.size=n.uncompressedSize,this.compressedSize=n.compressedSize,this.comment=n.comment,this.commentBytes=n.commentBytes,this.compressionMethod=n.compressionMethod,this.lastModDate=zs(n.lastModFileDate,n.lastModFileTime),this.isDirectory=n.uncompressedSize===0&&n.name.endsWith("/"),this.encrypted=!!(n.generalPurposeBitFlag&1),this.externalFileAttributes=n.externalFileAttributes,this.versionMadeBy=n.versionMadeBy}async blob(e="application/octet-stream"){return await Js(this._reader,this._rawEntry,e)}async arrayBuffer(){return await Xs(this._reader,this._rawEntry)}async text(){const e=await this.arrayBuffer();return xt(new Uint8Array(e))}async json(){const e=await this.text();return JSON.parse(e)}}const jn=22,Us=65535,js=101010256,Hs=101075792;async function st(t,e,n){return await t.read(e,n)}async function mr(t,e,n,r){return t.sliceAsBlob?await t.sliceAsBlob(e,n,r):await t.read(e,n)}const Ws={unsigned(){return 0}};function ne(t,e){return t[e]+t[e+1]*256}function oe(t,e){return t[e]+t[e+1]*256+t[e+2]*65536+t[e+3]*16777216}function Ve(t,e){return oe(t,e)+oe(t,e+4)*4294967296}const qs=new TextDecoder;function xt(t,e){return Mt(t.buffer)&&(t=new Uint8Array(t)),qs.decode(t)}async function Vs(t,e){const n=Math.min(jn+Us,e),r=e-n,i=await st(t,r,n);for(let o=n-jn;o>=0;--o){if(oe(i,o)!==js)continue;const a=new Uint8Array(i.buffer,i.byteOffset+o,i.byteLength-o),s=ne(a,4);if(s!==0)throw new Error(`multi-volume zip files are not supported. This is volume: ${s}`);const u=ne(a,10),l=oe(a,12),c=oe(a,16),f=ne(a,20),p=a.length-jn;if(f!==p)throw new Error(`invalid comment length. expected: ${p}, actual: ${f}`);const h=new Uint8Array(a.buffer,a.byteOffset+22,f),v=xt(h);return u===65535||c===4294967295?await Gs(t,r+o,v,h):await yo(t,c,l,u,v,h)}throw new Error("could not find end of central directory. maybe not zip file")}const Ys=117853008;async function Gs(t,e,n,r){const i=e-20,o=await st(t,i,20);if(oe(o,0)!==Ys)throw new Error("invalid zip64 end of central directory locator signature");const a=Ve(o,8),s=await st(t,a,56);if(oe(s,0)!==Hs)throw new Error("invalid zip64 end of central directory record signature");const u=Ve(s,32),l=Ve(s,40),c=Ve(s,48);return yo(t,c,l,u,n,r)}const Qs=33639248;async function yo(t,e,n,r,i,o){let a=0;const s=await st(t,e,n),u=[];for(let c=0;c<r;++c){const f=s.subarray(a,a+46),p=oe(f,0);if(p!==Qs)throw new Error(`invalid central directory file header signature: 0x${p.toString(16)}`);const h={versionMadeBy:ne(f,4),versionNeededToExtract:ne(f,6),generalPurposeBitFlag:ne(f,8),compressionMethod:ne(f,10),lastModFileTime:ne(f,12),lastModFileDate:ne(f,14),crc32:oe(f,16),compressedSize:oe(f,20),uncompressedSize:oe(f,24),fileNameLength:ne(f,28),extraFieldLength:ne(f,30),fileCommentLength:ne(f,32),internalFileAttributes:ne(f,36),externalFileAttributes:oe(f,38),relativeOffsetOfLocalHeader:oe(f,42)};if(h.generalPurposeBitFlag&64)throw new Error("strong encryption is not supported");a+=46;const v=s.subarray(a,a+h.fileNameLength+h.extraFieldLength+h.fileCommentLength);h.nameBytes=v.slice(0,h.fileNameLength),h.name=xt(h.nameBytes);const d=h.fileNameLength+h.extraFieldLength,m=v.slice(h.fileNameLength,d);h.extraFields=[];let w=0;for(;w<m.length-3;){const y=ne(m,w+0),b=ne(m,w+2),g=w+4,k=g+b;if(k>m.length)throw new Error("extra field length exceeds extra field buffer size");h.extraFields.push({id:y,data:m.slice(g,k)}),w=k}if(h.commentBytes=v.slice(d,d+h.fileCommentLength),h.comment=xt(h.commentBytes),a+=v.length,h.uncompressedSize===4294967295||h.compressedSize===4294967295||h.relativeOffsetOfLocalHeader===4294967295){const y=h.extraFields.find(k=>k.id===1);if(!y)throw new Error("expected zip64 extended information extra field");const b=y.data;let g=0;if(h.uncompressedSize===4294967295){if(g+8>b.length)throw new Error("zip64 extended information extra field does not include uncompressed size");h.uncompressedSize=Ve(b,g),g+=8}if(h.compressedSize===4294967295){if(g+8>b.length)throw new Error("zip64 extended information extra field does not include compressed size");h.compressedSize=Ve(b,g),g+=8}if(h.relativeOffsetOfLocalHeader===4294967295){if(g+8>b.length)throw new Error("zip64 extended information extra field does not include relative header offset");h.relativeOffsetOfLocalHeader=Ve(b,g),g+=8}}const _=h.extraFields.find(y=>y.id===28789&&y.data.length>=6&&y.data[0]===1&&oe(y.data,1),Ws.unsigned(h.nameBytes));if(_&&(h.fileName=xt(_.data.slice(5))),h.compressionMethod===0){let y=h.uncompressedSize;if((h.generalPurposeBitFlag&1)!==0&&(y+=12),h.compressedSize!==y)throw new Error(`compressed size mismatch for stored file: ${h.compressedSize} != ${y}`)}u.push(h)}return{zip:{comment:i,commentBytes:o},entries:u.map(c=>new $s(t,c))}}async function go(t,e){if(e.generalPurposeBitFlag&1)throw new Error("encrypted entries not supported");const n=await st(t,e.relativeOffsetOfLocalHeader,30),r=await t.getLength(),i=oe(n,0);if(i!==67324752)throw new Error(`invalid local file header signature: 0x${i.toString(16)}`);const o=ne(n,26),a=ne(n,28),s=e.relativeOffsetOfLocalHeader+n.length+o+a;let u;if(e.compressionMethod===0)u=!1;else if(e.compressionMethod===8)u=!0;else throw new Error(`unsupported compression method: ${e.compressionMethod}`);const l=s,c=l+e.compressedSize;if(e.compressedSize!==0&&c>r)throw new Error(`file data overflows file bounds: ${l} +  ${e.compressedSize}  > ${r}`);return{decompress:u,fileDataStart:l}}async function Xs(t,e){const{decompress:n,fileDataStart:r}=await go(t,e);if(!n){const a=await st(t,r,e.compressedSize);return Ds(a)?a.buffer:a.slice().buffer}const i=await mr(t,r,e.compressedSize);return await mo(i,e.uncompressedSize)}async function Js(t,e,n){const{decompress:r,fileDataStart:i}=await go(t,e);if(!r){const s=await mr(t,i,e.compressedSize,n);return ho(s)?s:new Blob([Mt(s.buffer)?new Uint8Array(s):s],{type:n})}const o=await mr(t,i,e.compressedSize);return await mo(o,e.uncompressedSize,n)}async function Zs(t){let e;if(typeof Blob<"u"&&t instanceof Blob)e=new ai(t);else if(t instanceof ArrayBuffer||t&&t.buffer&&t.buffer instanceof ArrayBuffer)e=new oi(t);else if(Mt(t)||Mt(t.buffer))e=new oi(t);else if(typeof t=="string"){const r=await fetch(t);if(!r.ok)throw new Error(`failed http request ${t}, status: ${r.status}: ${r.statusText}`);const i=await r.blob();e=new ai(i)}else if(typeof t.getLength=="function"&&typeof t.read=="function")e=t;else throw new Error("unsupported source type");const n=await e.getLength();if(n>Number.MAX_SAFE_INTEGER)throw new Error(`file too large. size: ${n}. Only file sizes up 4503599627370496 bytes are supported`);return await Vs(e,n)}async function eu(t){const{zip:e,entries:n}=await Zs(t);return{zip:e,entries:Object.fromEntries(n.map(r=>[r.name,r]))}}const Ft=new DOMParser,tu=(t,e)=>{const n=Ft.parseFromString(t,"text/xml"),{title:r,author:i,coverId:o}=ru(n.querySelector("metadata")),a=iu(n.querySelector("manifest")),s=ou(n.querySelector("spine"),a),u=a.has(o)?e.get(a.get(o)):void 0;return{meta:{title:r,author:i,cover:u},spine:s}},nu=async t=>{const{entries:e}=await eu(t),n=new Map,r=new Map,i=new Map,o=new Map;let a="",s="";for(const[u,l]of Object.entries(e))switch(u.substring(u.lastIndexOf("."))){case".opf":s=await l.text();break;case".png":case".jpg":case".jpeg":case".gif":{const c=await l.blob();n.set(Le(u),c);break}case".css":{const c=await l.text();i.set(u,uu(c,"#container"));break}case".htm":case".xml":case".html":case".xhtml":{const c=await l.text();r.set(Le(u),c);break}case".otf":case".ttf":case".woff":{const c=await l.blob();o.set(Le(u),c);break}case".ncx":{a=await l.text();break}}return{images:n,htmls:r,styles:i,fonts:o,tocNcx:a,opf:s}},ru=t=>{var i;const e=t.querySelector("title").textContent,n=Array.from(t.querySelectorAll("creator")).map(o=>o.textContent),r=(i=t.querySelector("[name='cover']"))==null?void 0:i.attributes.content.value;return{title:e,author:n,coverId:r}},iu=t=>{const e=new Map;for(const n of t.children)e.set(n.attributes.id.value,Le(n.attributes.href.value));return e},ou=(t,e)=>Array.from(t.children).map(n=>e.get(n.attributes.idref.value)),Le=t=>decodeURI(t.split("\\").pop().split("/").pop()),au=(t,e)=>{const n=Ft.parseFromString(t,"application/xhtml+xml").querySelector("img");if(n&&n.hasAttribute("src"))return e.get(Le(n.getAttribute("src")))},su=t=>{let e=Ft.parseFromString(t,"application/xhtml+xml");e.querySelector("parsererror")&&(e=Ft.parseFromString(t,"text/html"));for(const r of e.querySelectorAll("[src],[href], image"))switch(r.tagName){case"img":{const i=Le(r.getAttribute("src"));r.setAttribute("src","ESSENCE-READER-IMAGE-"+i),r.style.cssText+="max-height: 100%; max-width: 100%; object-fit: scale-down;";break}case"image":{const i=Le(r.getAttributeNS("http://www.w3.org/1999/xlink","href"));r.setAttributeNS("http://www.w3.org/1999/xlink","href","ESSENCE-READER-IMAGE-"+i);break}default:{r.getAttribute("src")!==null&&!r.getAttribute("src").includes("http")&&r.removeAttribute("src");break}}return e.body.innerHTML},uu=(t,e)=>{let n=[];return t=t.replace(/@(-moz-|-webkit-|-ms-)*keyframes\s(.*?){([0-9%a-zA-Z,\s.]*{(.*?)})*[\s\n]*}/g,r=>n.push(r)&&"__keyframes__"),t=t.replace(/([^\r\n,{}]+)(,(?=[^}]*{)|\s*{)/g,r=>r.trim()[0]==="@"?r:r.replace(/(\s*)/,"$1"+e+" ")),t.replace(/__keyframes__/g,r=>n.shift())},lu=(t,e)=>{const n=[],r=Ft.parseFromString(t,"application/xml").querySelectorAll("navPoint");for(const i of r){const o=i.querySelector("text").textContent;let a=Le(i.querySelector("content").attributes.src.value);a.includes("#")&&(a=a.substring(0,a.indexOf("#")));const s=e.get(a).index,u=i.parentElement.nodeName==="navPoint";n.push({name:o,index:s,isChild:u})}return n},cu=async t=>{try{const{images:e,htmls:n,styles:r,fonts:i,tocNcx:o,opf:a}=await nu(t),{meta:s,spine:u}=tu(a,e);s.cover===void 0&&(s.cover=au(n.get(u[0]),e));const l=new Map;u.forEach((f,p)=>{l.set(f,{index:p,html:n.has(f)?su(n.get(f)):null})});const c=lu(o,l);return{meta:s,contents:l,spine:u,toc:c,files:{images:e,fonts:i,styles:r},progress:0}}catch{throw new Error(t.name+" does not appear to be a valid EPUB file")}},fu=(t,e,n)=>t.replace(/url\((?!['"]?(?:data):)['"]?([^'"\)]*)['"]?\)/g,function(i,o){const a=o.split("\\").pop().split("/").pop(),s=[".png",".jpg",".jpeg",".gif"],u=[".otf",".ttf",".woff"];return s.some(l=>a.endsWith(l))&&e.has(a)?"url("+URL.createObjectURL(e.get(a))+")":u.some(l=>a.endsWith(l))&&n.has(a)?"url("+URL.createObjectURL(n.get(a))+")":""}),du=(t,e)=>t.replace(/ESSENCE-READER-IMAGE-([^?#"']*)/g,function(n,r){return e.has(r)?URL.createObjectURL(e.get(r)):""}),hu=t=>{try{return t.contents.forEach((e,n,r)=>r.set(n,{index:e.index,html:du(e.html,t.files.images)})),t.files.styles.forEach((e,n,r)=>r.set(n,fu(e,t.files.images,t.files.fonts))),t}catch{alert("An error occured when opening book, please try removing it and adding it again")}};function _o(t){const e=t-1;return e*e*e+1}function Je(t,{delay:e=0,duration:n=400,easing:r=An}={}){const i=+getComputedStyle(t).opacity;return{delay:e,duration:n,easing:r,css:o=>`opacity: ${o*i}`}}function fi(t,{delay:e=0,duration:n=400,easing:r=_o,x:i=0,y:o=0,opacity:a=0}={}){const s=getComputedStyle(t),u=+s.opacity,l=s.transform==="none"?"":s.transform,c=u*(1-a);return{delay:e,duration:n,easing:r,css:(f,p)=>`
			transform: ${l} translate(${(1-f)*i}px, ${(1-f)*o}px);
			opacity: ${u-c*p}`}}const pu=t=>({}),di=t=>({}),vu=t=>({}),hi=t=>({}),mu=t=>({}),pi=t=>({});function yu(t){let e,n,r,i,o,a,s,u;const l=t[2].leftbar,c=Jt(l,t,t[1],pi),f=t[2].toptext,p=Jt(f,t,t[1],hi),h=t[2].rightbar,v=Jt(h,t,t[1],di);return{c(){e=O("div"),n=O("div"),c&&c.c(),r=N(),i=O("div"),p&&p.c(),o=N(),a=O("div"),v&&v.c(),K(n,"class","buttonbar svelte-tsn8nz"),K(n,"id","leftbar"),K(i,"id","toptext"),K(i,"class","svelte-tsn8nz"),K(a,"class","buttonbar svelte-tsn8nz"),K(a,"id","rightbar"),K(e,"id","topbar"),K(e,"style",s=t[0]?"color: rgba(0, 0, 0, 0.5);":" "),K(e,"class","svelte-tsn8nz")},m(d,m){R(d,e,m),T(e,n),c&&c.m(n,null),T(e,r),T(e,i),p&&p.m(i,null),T(e,o),T(e,a),v&&v.m(a,null),u=!0},p(d,[m]){c&&c.p&&(!u||m&2)&&en(c,l,d,d[1],u?Zt(l,d[1],m,mu):tn(d[1]),pi),p&&p.p&&(!u||m&2)&&en(p,f,d,d[1],u?Zt(f,d[1],m,vu):tn(d[1]),hi),v&&v.p&&(!u||m&2)&&en(v,h,d,d[1],u?Zt(h,d[1],m,pu):tn(d[1]),di),(!u||m&1&&s!==(s=d[0]?"color: rgba(0, 0, 0, 0.5);":" "))&&K(e,"style",s)},i(d){u||(U(c,d),U(p,d),U(v,d),u=!0)},o(d){Q(c,d),Q(p,d),Q(v,d),u=!1},d(d){d&&D(e),c&&c.d(d),p&&p.d(d),v&&v.d(d)}}}function gu(t,e,n){let{$$slots:r={},$$scope:i}=e,{toned:o=!1}=e;return t.$$set=a=>{"toned"in a&&n(0,o=a.toned),"$$scope"in a&&n(1,i=a.$$scope)},[o,i,r]}class bo extends He{constructor(e){super(),je(this,e,gu,yu,Ue,{toned:0})}}function _u(t){let e,n,r,i,o,a,s,u,l;return{c(){e=O("button"),e.textContent="warm",n=N(),r=O("button"),r.textContent="black",i=N(),o=O("button"),o.textContent="dark",a=N(),s=O("button"),s.textContent="light",Y(e,"background-color","#f6e4bd"),Y(e,"color","#000"),K(e,"class","svelte-k014sn"),Y(r,"background-color","#000"),Y(r,"color","#e9e9e9"),K(r,"class","svelte-k014sn"),Y(o,"background-color","#032038"),Y(o,"color","#e9e9e9"),K(o,"class","svelte-k014sn"),Y(s,"background-color","#fff"),Y(s,"color","#000"),K(s,"class","svelte-k014sn")},m(c,f){R(c,e,f),R(c,n,f),R(c,r,f),R(c,i,f),R(c,o,f),R(c,a,f),R(c,s,f),u||(l=[Z(e,"click",t[1]),Z(r,"click",t[2]),Z(o,"click",t[3]),Z(s,"click",t[4])],u=!0)},p:G,i:G,o:G,d(c){c&&D(e),c&&D(n),c&&D(r),c&&D(i),c&&D(o),c&&D(a),c&&D(s),u=!1,ve(l)}}}function bu(t){const e=a=>{document.documentElement.setAttribute("data-theme",a),localStorage.setItem("theme",a)};return[e,()=>e("warm"),()=>e("black"),()=>e("dark"),()=>e("light")]}class wo extends He{constructor(e){super(),je(this,e,bu,_u,Ue,{})}}function wu(t){let e,n,r,i,o,a,s,u,l,c,f,p,h,v,d,m,w,_,y,b,g,k,S,x;return g=new wo({}),{c(){e=O("label"),e.textContent="Font:",n=N(),r=O("br"),i=N(),o=O("select"),a=O("option"),a.textContent="Default",s=O("option"),s.textContent="Verdana",u=O("option"),u.textContent="Arial",l=O("option"),l.textContent="Courier New ",c=O("option"),c.textContent="Helvetica",f=O("option"),f.textContent="Times New Roman",p=N(),h=O("br"),v=N(),d=O("label"),d.textContent="Scale:",m=N(),w=O("br"),_=N(),y=O("input"),b=N(),ge(g.$$.fragment),K(e,"for","fontpicker"),a.__value="Default",a.value=a.__value,Y(s,"font-family","'Verdana'"),s.__value="Verdana",s.value=s.__value,Y(u,"font-family","'Arial'"),u.__value="Arial",u.value=u.__value,Y(l,"font-family","'Courier New '"),l.__value="Courier New ",l.value=l.__value,Y(c,"font-family","'Helvetica'"),c.__value="Helvetica",c.value=c.__value,Y(f,"font-family","'Times New Roman'"),f.__value="Times New Roman",f.value=f.__value,K(o,"name","fontpicker"),Y(o,"width","100%"),t[0].fontFamily===void 0&&ue(()=>t[1].call(o)),K(d,"for","scale"),K(y,"name","scale"),K(y,"type","range"),K(y,"min","5"),K(y,"max","30")},m(E,A){R(E,e,A),R(E,n,A),R(E,r,A),R(E,i,A),R(E,o,A),T(o,a),T(o,s),T(o,u),T(o,l),T(o,c),T(o,f),Hr(o,t[0].fontFamily),R(E,p,A),R(E,h,A),R(E,v,A),R(E,d,A),R(E,m,A),R(E,w,A),R(E,_,A),R(E,y,A),jr(y,t[0].scale),R(E,b,A),he(g,E,A),k=!0,S||(x=[Z(o,"change",t[1]),Z(y,"change",t[2]),Z(y,"input",t[2])],S=!0)},p(E,[A]){A&1&&Hr(o,E[0].fontFamily),A&1&&jr(y,E[0].scale)},i(E){k||(U(g.$$.fragment,E),k=!0)},o(E){Q(g.$$.fragment,E),k=!1},d(E){E&&D(e),E&&D(n),E&&D(r),E&&D(i),E&&D(o),E&&D(p),E&&D(h),E&&D(v),E&&D(d),E&&D(m),E&&D(w),E&&D(_),E&&D(y),E&&D(b),pe(g,E),S=!1,ve(x)}}}function ku(t,e,n){let{settings:r}=e;function i(){r.fontFamily=Fo(this),n(0,r)}function o(){r.scale=Po(this.value),n(0,r)}return t.$$set=a=>{"settings"in a&&n(0,r=a.settings)},[r,i,o]}class Eu extends He{constructor(e){super(),je(this,e,ku,wu,Ue,{settings:0})}}function vi(t){let e,n,r,i,o;const a=t[5].default,s=Jt(a,t,t[4],null);return{c(){e=O("div"),s&&s.c(),K(e,"class","popover svelte-1fppysh")},m(u,l){R(u,e,l),s&&s.m(e,null),r=!0,i||(o=Do(t[3].call(null,e)),i=!0)},p(u,l){s&&s.p&&(!r||l&16)&&en(s,a,u,u[4],r?Zt(a,u[4],l,null):tn(u[4]),null)},i(u){r||(U(s,u),ue(()=>{n||(n=mn(e,fi,{x:50,duration:200},!0)),n.run(1)}),r=!0)},o(u){Q(s,u),n||(n=mn(e,fi,{x:50,duration:200},!1)),n.run(0),r=!1},d(u){u&&D(e),s&&s.d(u),u&&n&&n.end(),i=!1,o()}}}function xu(t){let e,n,r,i,o,a,s,u=t[1]&&vi(t);return{c(){e=O("button"),n=J(t[0]),r=N(),u&&u.c(),i=wr()},m(l,c){R(l,e,c),T(e,n),t[6](e),R(l,r,c),u&&u.m(l,c),R(l,i,c),o=!0,a||(s=Z(e,"click",t[7]),a=!0)},p(l,[c]){(!o||c&1)&&ce(n,l[0]),l[1]?u?(u.p(l,c),c&2&&U(u,1)):(u=vi(l),u.c(),U(u,1),u.m(i.parentNode,i)):u&&(Cn(),Q(u,1,1,()=>{u=null}),Bn())},i(l){o||(U(u),o=!0)},o(l){Q(u),o=!1},d(l){l&&D(e),t[6](null),l&&D(r),u&&u.d(l),l&&D(i),a=!1,s()}}}function Su(t,e,n){let{$$slots:r={},$$scope:i}=e,o,{text:a}=e,s;function u(f){const p=h=>{h.target instanceof Element&&!f.contains(h.target)&&h.target!==s&&n(1,o=!1)};return document.addEventListener("click",p,!0),{destroy(){document.removeEventListener("click",p,!0)}}}function l(f){Oe[f?"unshift":"push"](()=>{s=f,n(2,s)})}const c=()=>n(1,o=!o);return t.$$set=f=>{"text"in f&&n(0,a=f.text),"$$scope"in f&&n(4,i=f.$$scope)},[a,o,s,u,i,r,l,c]}class yr extends He{constructor(e){super(),je(this,e,Su,xu,Ue,{text:0})}}function Au(t){let e,n=t[0].name+"",r,i,o,a;return{c(){e=O("button"),r=J(n),K(e,"class","tocButton svelte-16nkk4l"),K(e,"style",i=(t[2]?"border: 1px solid lightblue; font-weight: bold;":"")+" "+(t[0].isChild?"padding-left: 2em;":""))},m(s,u){R(s,e,u),T(e,r),o||(a=Z(e,"click",function(){Ze(t[1])&&t[1].apply(this,arguments)}),o=!0)},p(s,[u]){t=s,u&1&&n!==(n=t[0].name+"")&&ce(r,n),u&5&&i!==(i=(t[2]?"border: 1px solid lightblue; font-weight: bold;":"")+" "+(t[0].isChild?"padding-left: 2em;":""))&&K(e,"style",i)},i:G,o:G,d(s){s&&D(e),o=!1,a()}}}function Cu(t,e,n){let{tocitem:r}=e,{onclick:i}=e,{selected:o}=e;return t.$$set=a=>{"tocitem"in a&&n(0,r=a.tocitem),"onclick"in a&&n(1,i=a.onclick),"selected"in a&&n(2,o=a.selected)},[r,i,o]}class Bu extends He{constructor(e){super(),je(this,e,Cu,Au,Ue,{tocitem:0,onclick:1,selected:2})}}const Tu=t=>{let e=document.getElementById("user-settings");e||(e=document.createElement("style"),e.id="user-settings",document.head.appendChild(e)),e.innerText="#container { transform: scale("+t.scale/10+"); width: "+50/(t.scale/10)+"%; } @media (max-width: 1500px) {#container { width: "+90/(t.scale/10)+"%}}"+(t.fontFamily!=="Default"?" #container p, #container a, #container span { font-family: "+t.fontFamily+" !important;}":""),localStorage.setItem("settings",JSON.stringify(t))},Ou=t=>{for(const e of document.getElementsByClassName("essence-reader"))e.remove();t.forEach(e=>{const n=document.createElement("style");n.innerText=e,n.className="essence-reader",document.head.appendChild(n)})},Du=(t,e)=>{t!==-1&&ke.books.update(t,{progress:e})},Ru=(t,e)=>{for(const n of t)if(n.getAttribute("href").includes("http"))n.setAttribute("target","_blank");else{let r=n.getAttribute("href").split("\\").pop().split("/").pop();n.addEventListener("click",i=>{i.preventDefault(),r.includes("#")&&(r=r.substring(0,r.indexOf("#"))),e(r)})}},{document:mi}=Go;function yi(t,e,n){const r=t.slice();return r[24]=e[n],r}function Iu(t){let e,n,r;return{c(){e=O("button"),e.textContent="<",K(e,"slot","leftbar")},m(i,o){R(i,e,o),n||(r=Z(e,"click",t[18]),n=!0)},p:G,d(i){i&&D(e),n=!1,r()}}}function Ku(t){let e,n,r=t[1].meta.title+"",i,o,a,s=t[1].meta.author+"",u,l,c,f,p,h=t[1].spine.length-1+"",v;return{c(){e=O("h4"),n=O("b"),i=J(r),o=J(" -"),a=N(),u=J(s),l=N(),c=O("p"),f=J(t[4]),p=J("/"),v=J(h)},m(d,m){R(d,e,m),T(e,n),T(n,i),T(n,o),T(e,a),T(e,u),R(d,l,m),R(d,c,m),T(c,f),T(c,p),T(c,v)},p(d,m){m&2&&r!==(r=d[1].meta.title+"")&&ce(i,r),m&2&&s!==(s=d[1].meta.author+"")&&ce(u,s),m&16&&ce(f,d[4]),m&2&&h!==(h=d[1].spine.length-1+"")&&ce(v,h)},d(d){d&&D(e),d&&D(l),d&&D(c)}}}function gi(t){let e,n,r=t[6][t[6].length-1]+"",i,o,a,s,u;return{c(){e=O("button"),n=J("\u21AB "),i=J(r),K(e,"id","jumpbtn"),K(e,"class","svelte-1si9v5y")},m(l,c){R(l,e,c),T(e,n),T(e,i),a=!0,s||(u=Z(e,"click",t[13]),s=!0)},p(l,c){(!a||c&64)&&r!==(r=l[6][l[6].length-1]+"")&&ce(i,r)},i(l){a||(ue(()=>{o||(o=mn(e,Je,{duration:200},!0)),o.run(1)}),a=!0)},o(l){o||(o=mn(e,Je,{duration:200},!1)),o.run(0),a=!1},d(l){l&&D(e),l&&o&&o.end(),s=!1,u()}}}function _i(t){let e,n;function r(){return t[14](t[24])}return e=new Bu({props:{tocitem:t[24],selected:t[4]===t[24].index,onclick:r}}),{c(){ge(e.$$.fragment)},m(i,o){he(e,i,o),n=!0},p(i,o){t=i;const a={};o&2&&(a.tocitem=t[24]),o&18&&(a.selected=t[4]===t[24].index),o&2&&(a.onclick=r),e.$set(a)},i(i){n||(U(e.$$.fragment,i),n=!0)},o(i){Q(e.$$.fragment,i),n=!1},d(i){pe(e,i)}}}function Pu(t){let e,n,r=t[1].toc,i=[];for(let a=0;a<r.length;a+=1)i[a]=_i(yi(t,r,a));const o=a=>Q(i[a],1,1,()=>{i[a]=null});return{c(){for(let a=0;a<i.length;a+=1)i[a].c();e=wr()},m(a,s){for(let u=0;u<i.length;u+=1)i[u].m(a,s);R(a,e,s),n=!0},p(a,s){if(s&530){r=a[1].toc;let u;for(u=0;u<r.length;u+=1){const l=yi(a,r,u);i[u]?(i[u].p(l,s),U(i[u],1)):(i[u]=_i(l),i[u].c(),U(i[u],1),i[u].m(e.parentNode,e))}for(Cn(),u=r.length;u<i.length;u+=1)o(u);Bn()}},i(a){if(!n){for(let s=0;s<r.length;s+=1)U(i[s]);n=!0}},o(a){i=i.filter(Boolean);for(let s=0;s<i.length;s+=1)Q(i[s]);n=!1},d(a){Ko(i,a),a&&D(e)}}}function Mu(t){let e,n,r;function i(a){t[15](a)}let o={};return t[2]!==void 0&&(o.settings=t[2]),e=new Eu({props:o}),Oe.push(()=>Bt(e,"settings",i)),{c(){ge(e.$$.fragment)},m(a,s){he(e,a,s),r=!0},p(a,s){const u={};!n&&s&4&&(n=!0,u.settings=a[2],At(()=>n=!1)),e.$set(u)},i(a){r||(U(e.$$.fragment,a),r=!0)},o(a){Q(e.$$.fragment,a),r=!1},d(a){pe(e,a)}}}function Fu(t){let e,n,r,i,o,a,s,u,l,c,f,p=t[6].length!==0&&gi(t);return n=new yr({props:{text:"\u2630",$$slots:{default:[Pu]},$$scope:{ctx:t}}}),i=new yr({props:{text:"\u2699",$$slots:{default:[Mu]},$$scope:{ctx:t}}}),{c(){p&&p.c(),e=N(),ge(n.$$.fragment),r=N(),ge(i.$$.fragment),o=N(),a=O("button"),a.textContent="\xAB",s=N(),u=O("button"),u.textContent="\xBB"},m(h,v){p&&p.m(h,v),R(h,e,v),he(n,h,v),R(h,r,v),he(i,h,v),R(h,o,v),R(h,a,v),R(h,s,v),R(h,u,v),l=!0,c||(f=[Z(a,"click",t[16]),Z(u,"click",t[17])],c=!0)},p(h,v){h[6].length!==0?p?(p.p(h,v),v&64&&U(p,1)):(p=gi(h),p.c(),U(p,1),p.m(e.parentNode,e)):p&&(Cn(),Q(p,1,1,()=>{p=null}),Bn());const d={};v&134217746&&(d.$$scope={dirty:v,ctx:h}),n.$set(d);const m={};v&134217732&&(m.$$scope={dirty:v,ctx:h}),i.$set(m)},i(h){l||(U(p),U(n.$$.fragment,h),U(i.$$.fragment,h),l=!0)},o(h){Q(p),Q(n.$$.fragment,h),Q(i.$$.fragment,h),l=!1},d(h){p&&p.d(h),h&&D(e),pe(n,h),h&&D(r),pe(i,h),h&&D(o),h&&D(a),h&&D(s),h&&D(u),c=!1,ve(f)}}}function Lu(t){let e=!1,n=()=>{e=!1},r,i,o,a,s,u,l,c,f,p,h;return ue(t[12]),mi.title=i=`
        `+(t[1].meta.title+" - "+t[1].meta.author)+`
    `,s=new bo({props:{toned:t[5]>100,$$slots:{rightbar:[Fu],toptext:[Ku],leftbar:[Iu]},$$scope:{ctx:t}}}),{c(){o=N(),a=O("div"),ge(s.$$.fragment),u=N(),l=O("div"),K(l,"id","container"),K(l,"class","svelte-1si9v5y")},m(v,d){R(v,o,d),R(v,a,d),he(s,a,null),T(a,u),T(a,l),t[19](l),f=!0,p||(h=[Z(window,"keydown",t[10]),Z(window,"scroll",()=>{e=!0,clearTimeout(r),r=setTimeout(n,100),t[12]()})],p=!0)},p(v,[d]){d&32&&!e&&(e=!0,clearTimeout(r),scrollTo(window.pageXOffset,v[5]),r=setTimeout(n,100)),(!f||d&2)&&i!==(i=`
        `+(v[1].meta.title+" - "+v[1].meta.author)+`
    `)&&(mi.title=i);const m={};d&32&&(m.toned=v[5]>100),d&134217815&&(m.$$scope={dirty:d,ctx:v}),s.$set(m)},i(v){f||(U(s.$$.fragment,v),c||ue(()=>{c=Ct(a,Je,{duration:200}),c.start()}),f=!0)},o(v){Q(s.$$.fragment,v),f=!1},d(v){v&&D(o),v&&D(a),pe(s),t[19](null),p=!1,ve(h)}}}function Nu(t,e,n){let{currentBook:r}=e,{reading:i}=e,{currentId:o}=e,a,s=0,u=0,l=r.meta.title,c=JSON.parse(localStorage.getItem("settings"))||{scale:10,fontFamily:"Default"};const f=()=>{isNaN(r.progress)?h(0):h(Math.floor(r.progress)),Ou(r.files.styles)},p=()=>{l!==r.meta.title&&(l=r.meta.title,f())};Ti(f);const h=B=>{0<=B&&B<r.spine.length&&(n(4,s=B),n(5,u=0),Du(o,s),v())},v=()=>{n(3,a.innerHTML=r.contents.get(r.spine[s]).html,a),Ru(a.querySelectorAll("[href]"),B=>w(r.contents.get(B).index))};let d=[];const m=B=>{h(s+B),d.length!==0&&n(6,d=[])},w=B=>{n(6,d=[...d,s]),h(B)},_=({key:B})=>{switch(B){case"ArrowLeft":m(-1);break;case"ArrowRight":m(1);break}};function y(){n(5,u=window.pageYOffset)}const b=()=>{h(d.pop()),n(6,d)},g=B=>w(B.index);function k(B){c=B,n(2,c)}const S=()=>m(-1),x=()=>m(1),E=()=>{n(0,i=!1),document.title="Essence Reader",location.hash=""};function A(B){Oe[B?"unshift":"push"](()=>{a=B,n(3,a)})}return t.$$set=B=>{"currentBook"in B&&n(1,r=B.currentBook),"reading"in B&&n(0,i=B.reading),"currentId"in B&&n(11,o=B.currentId)},t.$$.update=()=>{t.$$.dirty&4&&Tu(c),t.$$.dirty&2&&p()},[i,r,c,a,s,u,d,h,m,w,_,o,y,b,g,k,S,x,E,A]}class zu extends He{constructor(e){super(),je(this,e,Nu,Lu,Ue,{currentBook:1,reading:0,currentId:11})}}function $u(t,{from:e,to:n},r={}){const i=getComputedStyle(t),o=i.transform==="none"?"":i.transform,[a,s]=i.transformOrigin.split(" ").map(parseFloat),u=e.left+e.width*a/n.width-(n.left+a),l=e.top+e.height*s/n.height-(n.top+s),{delay:c=0,duration:f=h=>Math.sqrt(h)*120,easing:p=_o}=r;return{delay:c,duration:Ze(f)?f(Math.sqrt(u*u+l*l)):f,easing:p,css:(h,v)=>{const d=v*u,m=v*l,w=h+v*e.width/n.width,_=h+v*e.height/n.height;return`transform: ${o} translate(${d}px, ${m}px) scale(${w}, ${_});`}}}function bi(t,e,n){const r=t.slice();return r[16]=e[n],r}function Uu(t){let e;return{c(){e=O("h3"),e.textContent="Essence Reader",K(e,"slot","toptext")},m(n,r){R(n,e,r)},p:G,d(n){n&&D(e)}}}function ju(t){let e,n,r,i,o,a,s,u,l,c,f,p,h,v,d,m;return h=new wo({}),{c(){e=O("div"),n=O("label"),r=O("input"),i=J(`
                    Save books
                `),o=O("br"),a=N(),s=O("button"),s.textContent="Remove all",u=N(),l=O("hr"),c=N(),f=O("p"),f.textContent="Select theme",p=N(),ge(h.$$.fragment),K(r,"type","checkbox"),Y(n,"user-select","none"),Y(f,"display","inline"),Y(e,"width","8em")},m(w,_){R(w,e,_),T(e,n),T(n,r),r.checked=t[0],T(n,i),T(e,o),T(e,a),T(e,s),T(e,u),T(e,l),T(e,c),T(e,f),T(e,p),he(h,e,null),v=!0,d||(m=[Z(r,"change",t[11]),Z(s,"click",t[9])],d=!0)},p(w,_){_&1&&(r.checked=w[0])},i(w){v||(U(h.$$.fragment,w),v=!0)},o(w){Q(h.$$.fragment,w),v=!1},d(w){w&&D(e),pe(h),d=!1,ve(m)}}}function Hu(t){let e,n;return e=new yr({props:{slot:"rightbar",text:"\u2699",$$slots:{default:[ju]},$$scope:{ctx:t}}}),{c(){ge(e.$$.fragment)},m(r,i){he(e,r,i),n=!0},p(r,i){const o={};i&524289&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){n||(U(e.$$.fragment,r),n=!0)},o(r){Q(e.$$.fragment,r),n=!1},d(r){pe(e,r)}}}function wi(t){let e=[],n=new Map,r,i=t[5];const o=a=>a[16].id;for(let a=0;a<i.length;a+=1){let s=bi(t,i,a),u=o(s);n.set(u,e[a]=ki(u,s))}return{c(){for(let a=0;a<e.length;a+=1)e[a].c();r=wr()},m(a,s){for(let u=0;u<e.length;u+=1)e[u].m(a,s);R(a,r,s)},p(a,s){if(s&290){i=a[5];for(let u=0;u<e.length;u+=1)e[u].r();e=Jo(e,s,o,1,a,i,n,r.parentNode,Xo,ki,r,bi);for(let u=0;u<e.length;u+=1)e[u].a()}},i(a){for(let s=0;s<i.length;s+=1)U(e[s])},o:G,d(a){for(let s=0;s<e.length;s+=1)e[s].d(a);a&&D(r)}}}function ki(t,e){let n,r,i,o,a,s,u,l,c,f=e[16].meta.author+"",p,h,v,d=e[16].meta.title+"",m,w,_,y=e[16].progress+"",b,g,k=e[16].spine.length-1+"",S,x,E,A,B=G,z,L;function X(...H){return e[12](e[16],...H)}function F(){return e[13](e[16])}return{key:t,first:null,c(){n=O("button"),r=O("button"),r.textContent="\u2715",i=N(),o=O("img"),u=N(),l=O("div"),c=O("h4"),p=J(f),h=N(),v=O("h3"),m=J(d),w=N(),_=O("p"),b=J(y),g=J(" / "),S=J(k),E=N(),K(r,"class","deleteBtn svelte-is49rk"),$r(o.src,a=e[16].meta.cover!==void 0?URL.createObjectURL(e[16].meta.cover):"")||K(o,"src",a),K(o,"alt","cover"),K(o,"class","svelte-is49rk"),K(v,"class","svelte-is49rk"),K(l,"class","bookInfo svelte-is49rk"),K(n,"class","book svelte-is49rk"),this.first=n},m(H,q){R(H,n,q),T(n,r),T(n,i),T(n,o),T(n,u),T(n,l),T(l,c),T(c,p),T(l,h),T(l,v),T(v,m),T(l,w),T(l,_),T(_,b),T(_,g),T(_,S),T(n,E),z||(L=[Z(r,"click",X),Z(n,"click",F)],z=!0)},p(H,q){e=H,q&32&&!$r(o.src,a=e[16].meta.cover!==void 0?URL.createObjectURL(e[16].meta.cover):"")&&K(o,"src",a),q&32&&f!==(f=e[16].meta.author+"")&&ce(p,f),q&32&&d!==(d=e[16].meta.title+"")&&ce(m,d),q&32&&y!==(y=e[16].progress+"")&&ce(b,y),q&32&&k!==(k=e[16].spine.length-1+"")&&ce(S,k)},r(){A=n.getBoundingClientRect()},f(){jo(n),B()},a(){B(),B=Uo(n,A,$u,{duration:200})},i(H){s||ue(()=>{s=Ct(o,Je,{duration:200}),s.start()}),x||ue(()=>{x=Ct(l,Je,{duration:200}),x.start()})},o:G,d(H){H&&D(n),z=!1,ve(L)}}}function Wu(t){let e,n,r,i=t[4]?"+":"Drop anywhere or click to select a file",o;return{c(){e=O("h1"),e.textContent="\u{1F4DA}",n=N(),r=O("h2"),o=J(i),K(e,"class","svelte-is49rk")},m(a,s){R(a,e,s),R(a,n,s),R(a,r,s),T(r,o)},p(a,s){s&16&&i!==(i=a[4]?"+":"Drop anywhere or click to select a file")&&ce(o,i)},d(a){a&&D(e),a&&D(n),a&&D(r)}}}function qu(t){let e,n,r;return{c(){e=O("h1"),e.textContent="\u{1F4DA}",n=N(),r=O("h2"),r.textContent="...",K(e,"class","svelte-is49rk")},m(i,o){R(i,e,o),R(i,n,o),R(i,r,o)},p:G,d(i){i&&D(e),i&&D(n),i&&D(r)}}}function Ei(t){let e,n,r,i,o=t[3]?"Loading":"Drop anywhere or click to select a file",a;return{c(){e=O("div"),n=O("h4"),n.textContent="Load new book",r=N(),i=O("h3"),a=J(o),Y(i,"color",t[2]?"#87CEFA":""),K(i,"class","svelte-is49rk"),K(e,"class","bookInfo svelte-is49rk")},m(s,u){R(s,e,u),T(e,n),T(e,r),T(e,i),T(i,a)},p(s,u){u&8&&o!==(o=s[3]?"Loading":"Drop anywhere or click to select a file")&&ce(a,o),u&4&&Y(i,"color",s[2]?"#87CEFA":"")},d(s){s&&D(e)}}}function Vu(t){let e,n,r,i,o,a,s,u,l,c,f,p,h,v;n=new bo({props:{$$slots:{rightbar:[Hu],toptext:[Uu]},$$scope:{ctx:t}}});let d=t[5]&&wi(t);function m(b,g){return b[3]?qu:Wu}let w=m(t),_=w(t),y=t[4]&&Ei(t);return{c(){e=O("div"),ge(n.$$.fragment),r=N(),i=O("div"),d&&d.c(),o=N(),a=O("button"),s=O("div"),_.c(),l=N(),y&&y.c(),K(s,"id","dropInfo"),K(s,"class",u=Ur(t[3]?"loading":"")+" svelte-is49rk"),Y(s,"max-width",t[4]?"":"100% "),Y(s,"background-color",t[2]?" #87CEFA":""),K(a,"class","book svelte-is49rk"),K(a,"style",c=t[4]?"":"max-width: 50vw"),K(i,"id","parent"),K(i,"class","svelte-is49rk")},m(b,g){R(b,e,g),he(n,e,null),T(e,r),T(e,i),d&&d.m(i,null),T(i,o),T(i,a),T(a,s),_.m(s,null),T(a,l),y&&y.m(a,null),p=!0,h||(v=Z(a,"click",t[14]),h=!0)},p(b,[g]){const k={};g&524289&&(k.$$scope={dirty:g,ctx:b}),n.$set(k),b[5]?d?(d.p(b,g),g&32&&U(d,1)):(d=wi(b),d.c(),U(d,1),d.m(i,o)):d&&(d.d(1),d=null),w===(w=m(b))&&_?_.p(b,g):(_.d(1),_=w(b),_&&(_.c(),_.m(s,null))),(!p||g&8&&u!==(u=Ur(b[3]?"loading":"")+" svelte-is49rk"))&&K(s,"class",u),(!p||g&16)&&Y(s,"max-width",b[4]?"":"100% "),(!p||g&4)&&Y(s,"background-color",b[2]?" #87CEFA":""),b[4]?y?y.p(b,g):(y=Ei(b),y.c(),y.m(a,null)):y&&(y.d(1),y=null),(!p||g&16&&c!==(c=b[4]?"":"max-width: 50vw"))&&K(a,"style",c)},i(b){p||(U(n.$$.fragment,b),U(d),f||ue(()=>{f=Ct(e,Je,{duration:200}),f.start()}),p=!0)},o(b){Q(n.$$.fragment,b),p=!1},d(b){b&&D(e),pe(n),d&&d.d(),_.d(),y&&y.d(),h=!1,v()}}}function Yu(t,e,n){let r,{readFiles:i=y=>{}}=e,{openExisting:o=y=>{}}=e,{dragging:a}=e,{saveBooksOn:s}=e,{loading:u}=e,l=co(()=>ke.books.toArray());Oo(t,l,y=>n(5,r=y));let c=!1;const f=()=>{let y=document.createElement("input");y.type="file",y.onchange=b=>{i(b.target.files[0])},y.click()};async function p(y){await ke.books.delete(y)}const h=async()=>{confirm("Are you sure you want to remove all saved books?")&&await ke.books.clear()};async function v(){if(s){const y=await ke.books.count().catch(()=>n(0,s=!1));n(4,c=y>0)}}v();function d(){s=this.checked,n(0,s)}const m=(y,b)=>{b.stopPropagation(),p(y.id)},w=y=>o(y.id),_=()=>f();return t.$$set=y=>{"readFiles"in y&&n(10,i=y.readFiles),"openExisting"in y&&n(1,o=y.openExisting),"dragging"in y&&n(2,a=y.dragging),"saveBooksOn"in y&&n(0,s=y.saveBooksOn),"loading"in y&&n(3,u=y.loading)},[s,o,a,u,c,r,l,f,p,h,i,d,m,w,_]}class Gu extends He{constructor(e){super(),je(this,e,Yu,Vu,Ue,{readFiles:10,openExisting:1,dragging:2,saveBooksOn:0,loading:3})}}function Qu(t){let e,n,r,i;function o(u){t[11](u)}function a(u){t[12](u)}let s={readFiles:t[7],openExisting:t[8],dragging:t[3]};return t[0]!==void 0&&(s.saveBooksOn=t[0]),t[4]!==void 0&&(s.loading=t[4]),e=new Gu({props:s}),Oe.push(()=>Bt(e,"saveBooksOn",o)),Oe.push(()=>Bt(e,"loading",a)),{c(){ge(e.$$.fragment)},m(u,l){he(e,u,l),i=!0},p(u,l){const c={};l&8&&(c.dragging=u[3]),!n&&l&1&&(n=!0,c.saveBooksOn=u[0],At(()=>n=!1)),!r&&l&16&&(r=!0,c.loading=u[4],At(()=>r=!1)),e.$set(c)},i(u){i||(U(e.$$.fragment,u),i=!0)},o(u){Q(e.$$.fragment,u),i=!1},d(u){pe(e,u)}}}function Xu(t){let e,n;return{c(){e=O("p"),e.textContent="Loading",Y(e,"text-align","center")},m(r,i){R(r,e,i)},p:G,i(r){n||ue(()=>{n=Ct(e,Je,{}),n.start()})},o:G,d(r){r&&D(e)}}}function Ju(t){let e,n,r,i;function o(u){t[9](u)}function a(u){t[10](u)}let s={currentBook:t[1]};return t[2]!==void 0&&(s.reading=t[2]),t[5]!==void 0&&(s.currentId=t[5]),e=new zu({props:s}),Oe.push(()=>Bt(e,"reading",o)),Oe.push(()=>Bt(e,"currentId",a)),{c(){ge(e.$$.fragment)},m(u,l){he(e,u,l),i=!0},p(u,l){const c={};l&2&&(c.currentBook=u[1]),!n&&l&4&&(n=!0,c.reading=u[2],At(()=>n=!1)),!r&&l&32&&(r=!0,c.currentId=u[5],At(()=>r=!1)),e.$set(c)},i(u){i||(U(e.$$.fragment,u),i=!0)},o(u){Q(e.$$.fragment,u),i=!1},d(u){pe(e,u)}}}function Zu(t){let e,n,r,i;const o=[Ju,Xu,Qu],a=[];function s(u,l){return u[2]?0:u[6]?1:2}return n=s(t),r=a[n]=o[n](t),{c(){e=O("main"),r.c()},m(u,l){R(u,e,l),a[n].m(e,null),i=!0},p(u,[l]){let c=n;n=s(u),n===c?a[n].p(u,l):(Cn(),Q(a[c],1,1,()=>{a[c]=null}),Bn(),r=a[n],r?r.p(u,l):(r=a[n]=o[n](u),r.c()),U(r,1),r.m(e,null))},i(u){i||(U(r),i=!0)},o(u){Q(r),i=!1},d(u){u&&D(e),a[n].d()}}}function el(t,e,n){let r,i=!1,o=!1,a=!1;const s=async _=>{try{n(4,a=!0);const y=await cu(_);if(u&&_.size<3e7){const b=await Bs(y);c(y,b)}else c(y)}catch(y){alert(y)}n(4,a=!1)};let u;localStorage.getItem("saveBooksOn")!==null?u=JSON.parse(localStorage.getItem("saveBooksOn")):u=!0;const l=()=>{localStorage.setItem("saveBooksOn",JSON.stringify(u))};window.addEventListener("dragenter",_=>{_.dataTransfer.types.includes("Files")&&n(3,o=!0)}),window.addEventListener("dragleave",_=>{n(3,o=!1),_.preventDefault()});const c=(_,y)=>{n(1,r=hu(_)),n(2,i=!0),location.hash=y?y.toString():"",n(5,p=y||-1)},f=_=>{n(6,h=!0),ke.transaction("r",ke.books,async()=>{let y=await ke.books.get(_);y?c(y,y.id):(location.hash="",n(6,h=!1))})};Ti(()=>{location.hash!==""&&(n(6,h=!0),f(parseInt(location.hash.substring(1))))}),window.onhashchange=()=>{u&&location.hash===""?(document.title="Essence Reader",n(2,i=!1),history.replaceState(null,""," "),n(6,h=!1)):u&&location.hash!==""&&f(parseInt(location.hash.substring(1)))},window.addEventListener("dragover",_=>_.preventDefault()),window.addEventListener("drop",_=>{_.preventDefault(),n(3,o=!1),s(_.dataTransfer.files[0])});let p=-1,h=!1;function v(_){i=_,n(2,i)}function d(_){p=_,n(5,p)}function m(_){u=_,n(0,u)}function w(_){a=_,n(4,a)}return t.$$.update=()=>{t.$$.dirty&1&&l()},[u,r,i,o,a,p,h,s,f,v,d,m,w]}class tl extends He{constructor(e){super(),je(this,e,el,Zu,Ue,{})}}new tl({target:document.getElementById("app")})});export default nl();
