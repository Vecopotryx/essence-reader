var app=function(){"use strict";function e(){}const t=e=>e;function n(e){return e()}function r(){return Object.create(null)}function i(e){e.forEach(n)}function s(e){return"function"==typeof e}function o(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}let a;function l(e,t){return a||(a=document.createElement("a")),a.href=t,e===a.href}function c(t,n,r){t.$$.on_destroy.push(function(t,...n){if(null==t)return e;const r=t.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}(n,r))}function u(e,t,n,r){if(e){const i=h(e,t,n,r);return e[0](i)}}function h(e,t,n,r){return e[1]&&r?function(e,t){for(const n in t)e[n]=t[n];return e}(n.ctx.slice(),e[1](r(t))):n.ctx}function f(e,t,n,r){if(e[2]&&r){const i=e[2](r(n));if(void 0===t.dirty)return i;if("object"==typeof i){const e=[],n=Math.max(t.dirty.length,i.length);for(let r=0;r<n;r+=1)e[r]=t.dirty[r]|i[r];return e}return t.dirty|i}return t.dirty}function d(e,t,n,r,i,s){if(i){const o=h(t,n,r,s);e.p(o,i)}}function p(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let e=0;e<n;e++)t[e]=-1;return t}return-1}function m(e){return null==e?"":e}const g="undefined"!=typeof window;let y=g?()=>window.performance.now():()=>Date.now(),b=g?e=>requestAnimationFrame(e):e;const v=new Set;function w(e){v.forEach((t=>{t.c(e)||(v.delete(t),t.f())})),0!==v.size&&b(w)}function x(e,t){e.appendChild(t)}function _(e){if(!e)return document;const t=e.getRootNode?e.getRootNode():e.ownerDocument;return t&&t.host?t:e.ownerDocument}function k(e){const t=A("style");return function(e,t){x(e.head||e,t)}(_(e),t),t.sheet}function E(e,t,n){e.insertBefore(t,n||null)}function $(e){e.parentNode.removeChild(e)}function A(e){return document.createElement(e)}function N(e){return document.createTextNode(e)}function O(){return N(" ")}function P(){return N("")}function S(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function C(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function T(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function B(e,t){e.value=null==t?"":t}function F(e,t,n,r){null===n?e.style.removeProperty(t):e.style.setProperty(t,n,r?"important":"")}function j(e,t){for(let n=0;n<e.options.length;n+=1){const r=e.options[n];if(r.__value===t)return void(r.selected=!0)}e.selectedIndex=-1}class D{constructor(e=!1){this.is_svg=!1,this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,t,n=null){var r;this.e||(this.is_svg?this.e=(r=t.nodeName,document.createElementNS("http://www.w3.org/2000/svg",r)):this.e=A(t.nodeName),this.t=t,this.c(e)),this.i(n)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)E(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach($)}}const I=new Map;let K,R=0;function M(e,t,n,r,i,s,o,a=0){const l=16.666/r;let c="{\n";for(let e=0;e<=1;e+=l){const r=t+(n-t)*s(e);c+=100*e+`%{${o(r,1-r)}}\n`}const u=c+`100% {${o(n,1-n)}}\n}`,h=`__svelte_${function(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}(u)}_${a}`,f=_(e),{stylesheet:d,rules:p}=I.get(f)||function(e,t){const n={stylesheet:k(t),rules:{}};return I.set(e,n),n}(f,e);p[h]||(p[h]=!0,d.insertRule(`@keyframes ${h} ${u}`,d.cssRules.length));const m=e.style.animation||"";return e.style.animation=`${m?`${m}, `:""}${h} ${r}ms linear ${i}ms 1 both`,R+=1,h}function L(e,t){const n=(e.style.animation||"").split(", "),r=n.filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")),i=n.length-r.length;i&&(e.style.animation=r.join(", "),R-=i,R||b((()=>{R||(I.forEach((e=>{const{stylesheet:t}=e;let n=t.cssRules.length;for(;n--;)t.deleteRule(n);e.rules={}})),I.clear())})))}function z(n,r,i,s){if(!r)return e;const o=n.getBoundingClientRect();if(r.left===o.left&&r.right===o.right&&r.top===o.top&&r.bottom===o.bottom)return e;const{delay:a=0,duration:l=300,easing:c=t,start:u=y()+a,end:h=u+l,tick:f=e,css:d}=i(n,{from:r,to:o},s);let p,m=!0,g=!1;function x(){d&&L(n,p),m=!1}return function(e){let t;0===v.size&&b(w),new Promise((n=>{v.add(t={c:e,f:n})}))}((e=>{if(!g&&e>=u&&(g=!0),g&&e>=h&&(f(1,0),x()),!m)return!1;if(g){const t=0+1*c((e-u)/l);f(t,1-t)}return!0})),d&&(p=M(n,0,1,l,a,c,d)),a||(g=!0),f(0,1),x}function q(e){const t=getComputedStyle(e);if("absolute"!==t.position&&"fixed"!==t.position){const{width:n,height:r}=t,i=e.getBoundingClientRect();e.style.position="absolute",e.style.width=n,e.style.height=r,function(e,t){const n=e.getBoundingClientRect();if(t.left!==n.left||t.top!==n.top){const r=getComputedStyle(e),i="none"===r.transform?"":r.transform;e.style.transform=`${i} translate(${t.left-n.left}px, ${t.top-n.top}px)`}}(e,i)}}function V(e){K=e}function U(){if(!K)throw new Error("Function called outside component initialization");return K}const W=[],X=[],Y=[],H=[],G=Promise.resolve();let Q=!1;function J(e){Y.push(e)}function Z(e){H.push(e)}const ee=new Set;let te=0;function ne(){const e=K;do{for(;te<W.length;){const e=W[te];te++,V(e),re(e.$$)}for(V(null),W.length=0,te=0;X.length;)X.pop()();for(let e=0;e<Y.length;e+=1){const t=Y[e];ee.has(t)||(ee.add(t),t())}Y.length=0}while(W.length);for(;H.length;)H.pop()();Q=!1,ee.clear(),V(e)}function re(e){if(null!==e.fragment){e.update(),i(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(J)}}const ie=new Set;let se;function oe(){se={r:0,c:[],p:se}}function ae(){se.r||i(se.c),se=se.p}function le(e,t){e&&e.i&&(ie.delete(e),e.i(t))}function ce(e,t,n,r){if(e&&e.o){if(ie.has(e))return;ie.add(e),se.c.push((()=>{ie.delete(e),r&&(n&&e.d(1),r())})),e.o(t)}else r&&r()}const ue="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function he(e,t){e.f(),function(e,t){e.d(1),t.delete(e.key)}(e,t)}function fe(e,t,n){const r=e.$$.props[t];void 0!==r&&(e.$$.bound[r]=n,n(e.$$.ctx[r]))}function de(e){e&&e.c()}function pe(e,t,r,o){const{fragment:a,on_mount:l,on_destroy:c,after_update:u}=e.$$;a&&a.m(t,r),o||J((()=>{const t=l.map(n).filter(s);c?c.push(...t):i(t),e.$$.on_mount=[]})),u.forEach(J)}function me(e,t){const n=e.$$;null!==n.fragment&&(i(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function ge(e,t){-1===e.$$.dirty[0]&&(W.push(e),Q||(Q=!0,G.then(ne)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function ye(t,n,s,o,a,l,c,u=[-1]){const h=K;V(t);const f=t.$$={fragment:null,ctx:null,props:l,update:e,not_equal:a,bound:r(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(h?h.$$.context:[])),callbacks:r(),dirty:u,skip_bound:!1,root:n.target||h.$$.root};c&&c(f.root);let d=!1;if(f.ctx=s?s(t,n.props||{},((e,n,...r)=>{const i=r.length?r[0]:n;return f.ctx&&a(f.ctx[e],f.ctx[e]=i)&&(!f.skip_bound&&f.bound[e]&&f.bound[e](i),d&&ge(t,e)),n})):[],f.update(),d=!0,i(f.before_update),f.fragment=!!o&&o(f.ctx),n.target){if(n.hydrate){const e=function(e){return Array.from(e.childNodes)}(n.target);f.fragment&&f.fragment.l(e),e.forEach($)}else f.fragment&&f.fragment.c();n.intro&&le(t.$$.fragment),pe(t,n.target,n.anchor,n.customElement),ne()}V(h)}class be{$destroy(){me(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const ve="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,we=Object.keys,xe=Array.isArray;function _e(e,t){return"object"!=typeof t||we(t).forEach((function(n){e[n]=t[n]})),e}"undefined"==typeof Promise||ve.Promise||(ve.Promise=Promise);const ke=Object.getPrototypeOf,Ee={}.hasOwnProperty;function $e(e,t){return Ee.call(e,t)}function Ae(e,t){"function"==typeof t&&(t=t(ke(e))),("undefined"==typeof Reflect?we:Reflect.ownKeys)(t).forEach((n=>{Oe(e,n,t[n])}))}const Ne=Object.defineProperty;function Oe(e,t,n,r){Ne(e,t,_e(n&&$e(n,"get")&&"function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function Pe(e){return{from:function(t){return e.prototype=Object.create(t.prototype),Oe(e.prototype,"constructor",e),{extend:Ae.bind(null,e.prototype)}}}}const Se=Object.getOwnPropertyDescriptor;function Ce(e,t){let n;return Se(e,t)||(n=ke(e))&&Ce(n,t)}const Te=[].slice;function Be(e,t,n){return Te.call(e,t,n)}function Fe(e,t){return t(e)}function je(e){if(!e)throw new Error("Assertion Failed")}function De(e){ve.setImmediate?setImmediate(e):setTimeout(e,0)}function Ie(e,t){return e.reduce(((e,n,r)=>{var i=t(n,r);return i&&(e[i[0]]=i[1]),e}),{})}function Ke(e,t){if($e(e,t))return e[t];if(!t)return e;if("string"!=typeof t){for(var n=[],r=0,i=t.length;r<i;++r){var s=Ke(e,t[r]);n.push(s)}return n}var o=t.indexOf(".");if(-1!==o){var a=e[t.substr(0,o)];return void 0===a?void 0:Ke(a,t.substr(o+1))}}function Re(e,t,n){if(e&&void 0!==t&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){je("string"!=typeof n&&"length"in n);for(var r=0,i=t.length;r<i;++r)Re(e,t[r],n[r])}else{var s=t.indexOf(".");if(-1!==s){var o=t.substr(0,s),a=t.substr(s+1);if(""===a)void 0===n?xe(e)&&!isNaN(parseInt(o))?e.splice(o,1):delete e[o]:e[o]=n;else{var l=e[o];l&&$e(e,o)||(l=e[o]={}),Re(l,a,n)}}else void 0===n?xe(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function Me(e){var t={};for(var n in e)$e(e,n)&&(t[n]=e[n]);return t}const Le=[].concat;function ze(e){return Le.apply([],e)}const qe="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(ze([8,16,32,64].map((e=>["Int","Uint","Float"].map((t=>t+e+"Array")))))).filter((e=>ve[e])),Ve=qe.map((e=>ve[e]));Ie(qe,(e=>[e,!0]));let Ue=null;function We(e){Ue="undefined"!=typeof WeakMap&&new WeakMap;const t=Xe(e);return Ue=null,t}function Xe(e){if(!e||"object"!=typeof e)return e;let t=Ue&&Ue.get(e);if(t)return t;if(xe(e)){t=[],Ue&&Ue.set(e,t);for(var n=0,r=e.length;n<r;++n)t.push(Xe(e[n]))}else if(Ve.indexOf(e.constructor)>=0)t=e;else{const n=ke(e);for(var i in t=n===Object.prototype?{}:Object.create(n),Ue&&Ue.set(e,t),e)$e(e,i)&&(t[i]=Xe(e[i]))}return t}const{toString:Ye}={};function He(e){return Ye.call(e).slice(8,-1)}const Ge="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",Qe="symbol"==typeof Ge?function(e){var t;return null!=e&&(t=e[Ge])&&t.apply(e)}:function(){return null},Je={};function Ze(e){var t,n,r,i;if(1===arguments.length){if(xe(e))return e.slice();if(this===Je&&"string"==typeof e)return[e];if(i=Qe(e)){for(n=[];!(r=i.next()).done;)n.push(r.value);return n}if(null==e)return[e];if("number"==typeof(t=e.length)){for(n=new Array(t);t--;)n[t]=e[t];return n}return[e]}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}const et="undefined"!=typeof Symbol?e=>"AsyncFunction"===e[Symbol.toStringTag]:()=>!1;var tt="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function nt(e,t){tt=e,rt=t}var rt=()=>!0;const it=!new Error("").stack;function st(){if(it)try{throw st.arguments,new Error}catch(e){return e}return new Error}function ot(e,t){var n=e.stack;return n?(t=t||0,0===n.indexOf(e.name)&&(t+=(e.name+e.message).split("\n").length),n.split("\n").slice(t).filter(rt).map((e=>"\n"+e)).join("")):""}var at=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],lt=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(at),ct={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function ut(e,t){this._e=st(),this.name=e,this.message=t}function ht(e,t){return e+". Errors: "+Object.keys(t).map((e=>t[e].toString())).filter(((e,t,n)=>n.indexOf(e)===t)).join("\n")}function ft(e,t,n,r){this._e=st(),this.failures=t,this.failedKeys=r,this.successCount=n,this.message=ht(e,t)}function dt(e,t){this._e=st(),this.name="BulkError",this.failures=Object.keys(t).map((e=>t[e])),this.failuresByPos=t,this.message=ht(e,t)}Pe(ut).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+ot(this._e,2))}},toString:function(){return this.name+": "+this.message}}),Pe(ft).from(ut),Pe(dt).from(ut);var pt=lt.reduce(((e,t)=>(e[t]=t+"Error",e)),{});const mt=ut;var gt=lt.reduce(((e,t)=>{var n=t+"Error";function r(e,r){this._e=st(),this.name=n,e?"string"==typeof e?(this.message=`${e}${r?"\n "+r:""}`,this.inner=r||null):"object"==typeof e&&(this.message=`${e.name} ${e.message}`,this.inner=e):(this.message=ct[t]||n,this.inner=null)}return Pe(r).from(mt),e[t]=r,e}),{});gt.Syntax=SyntaxError,gt.Type=TypeError,gt.Range=RangeError;var yt=at.reduce(((e,t)=>(e[t+"Error"]=gt[t],e)),{});var bt=lt.reduce(((e,t)=>(-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=gt[t]),e)),{});function vt(){}function wt(e){return e}function xt(e,t){return null==e||e===wt?t:function(n){return t(e(n))}}function _t(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function kt(e,t){return e===vt?t:function(){var n=e.apply(this,arguments);void 0!==n&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var s=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?_t(r,this.onsuccess):r),i&&(this.onerror=this.onerror?_t(i,this.onerror):i),void 0!==s?s:n}}function Et(e,t){return e===vt?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?_t(n,this.onsuccess):n),r&&(this.onerror=this.onerror?_t(r,this.onerror):r)}}function $t(e,t){return e===vt?t:function(n){var r=e.apply(this,arguments);_e(n,r);var i=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?_t(i,this.onsuccess):i),s&&(this.onerror=this.onerror?_t(s,this.onerror):s),void 0===r?void 0===o?void 0:o:_e(r,o)}}function At(e,t){return e===vt?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function Nt(e,t){return e===vt?t:function(){var n=e.apply(this,arguments);if(n&&"function"==typeof n.then){for(var r=this,i=arguments.length,s=new Array(i);i--;)s[i]=arguments[i];return n.then((function(){return t.apply(r,s)}))}return t.apply(this,arguments)}}bt.ModifyError=ft,bt.DexieError=ut,bt.BulkError=dt;var Ot={};const[Pt,St,Ct]="undefined"==typeof Promise?[]:(()=>{let e=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[e,ke(e),e];const t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,ke(t),e]})(),Tt=St&&St.then,Bt=Pt&&Pt.constructor,Ft=!!Ct;var jt=!1,Dt=Ct?()=>{Ct.then(on)}:ve.setImmediate?setImmediate.bind(null,on):ve.MutationObserver?()=>{var e=document.createElement("div");new MutationObserver((()=>{on(),e=null})).observe(e,{attributes:!0}),e.setAttribute("i","1")}:()=>{setTimeout(on,0)},It=function(e,t){Wt.push([e,t]),Rt&&(Dt(),Rt=!1)},Kt=!0,Rt=!0,Mt=[],Lt=[],zt=null,qt=wt,Vt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Cn,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach((e=>{try{Cn(e[0],e[1])}catch(e){}}))}},Ut=Vt,Wt=[],Xt=0,Yt=[];function Ht(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=vt,this._lib=!1;var t=this._PSD=Ut;if(tt&&(this._stackHolder=st(),this._prev=null,this._numPrev=0),"function"!=typeof e){if(e!==Ot)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&Zt(this,this._value))}this._state=null,this._value=null,++t.ref,Jt(this,e)}const Gt={get:function(){var e=Ut,t=gn;function n(n,r){var i=!e.global&&(e!==Ut||t!==gn);const s=i&&!wn();var o=new Ht(((t,o)=>{tn(this,new Qt(On(n,e,i,s),On(r,e,i,s),t,o,e))}));return tt&&sn(o,this),o}return n.prototype=Ot,n},set:function(e){Oe(this,"then",e&&e.prototype===Ot?Gt:{get:function(){return e},set:Gt.set})}};function Qt(e,t,n,r,i){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r,this.psd=i}function Jt(e,t){try{t((t=>{if(null===e._state){if(t===e)throw new TypeError("A promise cannot be resolved with itself.");var n=e._lib&&an();t&&"function"==typeof t.then?Jt(e,((e,n)=>{t instanceof Ht?t._then(e,n):t.then(e,n)})):(e._state=!0,e._value=t,en(e)),n&&ln()}}),Zt.bind(null,e))}catch(t){Zt(e,t)}}function Zt(e,t){if(Lt.push(t),null===e._state){var n=e._lib&&an();t=qt(t),e._state=!1,e._value=t,tt&&null!==t&&"object"==typeof t&&!t._promise&&function(e,t,n){try{e.apply(null,n)}catch(e){t&&t(e)}}((()=>{var n=Ce(t,"stack");t._promise=e,Oe(t,"stack",{get:()=>jt?n&&(n.get?n.get.apply(t):n.value):e.stack})})),function(e){Mt.some((t=>t._value===e._value))||Mt.push(e)}(e),en(e),n&&ln()}}function en(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)tn(e,t[n]);var i=e._PSD;--i.ref||i.finalize(),0===Xt&&(++Xt,It((()=>{0==--Xt&&cn()}),[]))}function tn(e,t){if(null!==e._state){var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Xt,It(nn,[n,e,t])}else e._listeners.push(t)}function nn(e,t,n){try{zt=t;var r,i=t._value;t._state?r=e(i):(Lt.length&&(Lt=[]),r=e(i),-1===Lt.indexOf(i)&&function(e){var t=Mt.length;for(;t;)if(Mt[--t]._value===e._value)return void Mt.splice(t,1)}(t)),n.resolve(r)}catch(e){n.reject(e)}finally{zt=null,0==--Xt&&cn(),--n.psd.ref||n.psd.finalize()}}function rn(e,t,n){if(t.length===n)return t;var r="";if(!1===e._state){var i,s,o=e._value;null!=o?(i=o.name||"Error",s=o.message||o,r=ot(o,0)):(i=o,s=""),t.push(i+(s?": "+s:"")+r)}return tt&&((r=ot(e._stackHolder,2))&&-1===t.indexOf(r)&&t.push(r),e._prev&&rn(e._prev,t,n)),t}function sn(e,t){var n=t?t._numPrev+1:0;n<100&&(e._prev=t,e._numPrev=n)}function on(){an()&&ln()}function an(){var e=Kt;return Kt=!1,Rt=!1,e}function ln(){var e,t,n;do{for(;Wt.length>0;)for(e=Wt,Wt=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}}while(Wt.length>0);Kt=!0,Rt=!0}function cn(){var e=Mt;Mt=[],e.forEach((e=>{e._PSD.onunhandled.call(null,e._value,e)}));for(var t=Yt.slice(0),n=t.length;n;)t[--n]()}function un(e){return new Ht(Ot,!1,e)}function hn(e,t){var n=Ut;return function(){var r=an(),i=Ut;try{return En(n,!0),e.apply(this,arguments)}catch(e){t&&t(e)}finally{En(i,!1),r&&ln()}}}Ae(Ht.prototype,{then:Gt,_then:function(e,t){tn(this,new Qt(null,null,e,t,Ut))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=arguments[0],n=arguments[1];return"function"==typeof t?this.then(null,(e=>e instanceof t?n(e):un(e))):this.then(null,(e=>e&&e.name===t?n(e):un(e)))},finally:function(e){return this.then((t=>(e(),t)),(t=>(e(),un(t))))},stack:{get:function(){if(this._stack)return this._stack;try{jt=!0;var e=rn(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=e),e}finally{jt=!1}}},timeout:function(e,t){return e<1/0?new Ht(((n,r)=>{var i=setTimeout((()=>r(new gt.Timeout(t))),e);this.then(n,r).finally(clearTimeout.bind(null,i))})):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&Oe(Ht.prototype,Symbol.toStringTag,"Dexie.Promise"),Vt.env=$n(),Ae(Ht,{all:function(){var e=Ze.apply(null,arguments).map(xn);return new Ht((function(t,n){0===e.length&&t([]);var r=e.length;e.forEach(((i,s)=>Ht.resolve(i).then((n=>{e[s]=n,--r||t(e)}),n)))}))},resolve:e=>{if(e instanceof Ht)return e;if(e&&"function"==typeof e.then)return new Ht(((t,n)=>{e.then(t,n)}));var t=new Ht(Ot,!0,e);return sn(t,zt),t},reject:un,race:function(){var e=Ze.apply(null,arguments).map(xn);return new Ht(((t,n)=>{e.map((e=>Ht.resolve(e).then(t,n)))}))},PSD:{get:()=>Ut,set:e=>Ut=e},totalEchoes:{get:()=>gn},newPSD:bn,usePSD:An,scheduler:{get:()=>It,set:e=>{It=e}},rejectionMapper:{get:()=>qt,set:e=>{qt=e}},follow:(e,t)=>new Ht(((n,r)=>bn(((t,n)=>{var r=Ut;r.unhandleds=[],r.onunhandled=n,r.finalize=_t((function(){!function(e){function t(){e(),Yt.splice(Yt.indexOf(t),1)}Yt.push(t),++Xt,It((()=>{0==--Xt&&cn()}),[])}((()=>{0===this.unhandleds.length?t():n(this.unhandleds[0])}))}),r.finalize),e()}),t,n,r)))}),Bt&&(Bt.allSettled&&Oe(Ht,"allSettled",(function(){const e=Ze.apply(null,arguments).map(xn);return new Ht((t=>{0===e.length&&t([]);let n=e.length;const r=new Array(n);e.forEach(((e,i)=>Ht.resolve(e).then((e=>r[i]={status:"fulfilled",value:e}),(e=>r[i]={status:"rejected",reason:e})).then((()=>--n||t(r)))))}))})),Bt.any&&"undefined"!=typeof AggregateError&&Oe(Ht,"any",(function(){const e=Ze.apply(null,arguments).map(xn);return new Ht(((t,n)=>{0===e.length&&n(new AggregateError([]));let r=e.length;const i=new Array(r);e.forEach(((e,s)=>Ht.resolve(e).then((e=>t(e)),(e=>{i[s]=e,--r||n(new AggregateError(i))}))))}))})));const fn={awaits:0,echoes:0,id:0};var dn=0,pn=[],mn=0,gn=0,yn=0;function bn(e,t,n,r){var i=Ut,s=Object.create(i);s.parent=i,s.ref=0,s.global=!1,s.id=++yn;var o=Vt.env;s.env=Ft?{Promise:Ht,PromiseProp:{value:Ht,configurable:!0,writable:!0},all:Ht.all,race:Ht.race,allSettled:Ht.allSettled,any:Ht.any,resolve:Ht.resolve,reject:Ht.reject,nthen:Pn(o.nthen,s),gthen:Pn(o.gthen,s)}:{},t&&_e(s,t),++i.ref,s.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=An(s,e,n,r);return 0===s.ref&&s.finalize(),a}function vn(){return fn.id||(fn.id=++dn),++fn.awaits,fn.echoes+=100,fn.id}function wn(){return!!fn.awaits&&(0==--fn.awaits&&(fn.id=0),fn.echoes=100*fn.awaits,!0)}function xn(e){return fn.echoes&&e&&e.constructor===Bt?(vn(),e.then((e=>(wn(),e)),(e=>(wn(),Tn(e))))):e}function _n(e){++gn,fn.echoes&&0!=--fn.echoes||(fn.echoes=fn.id=0),pn.push(Ut),En(e,!0)}function kn(){var e=pn[pn.length-1];pn.pop(),En(e,!1)}function En(e,t){var n=Ut;if((t?!fn.echoes||mn++&&e===Ut:!mn||--mn&&e===Ut)||Nn(t?_n.bind(null,e):kn),e!==Ut&&(Ut=e,n===Vt&&(Vt.env=$n()),Ft)){var r=Vt.env.Promise,i=e.env;St.then=i.nthen,r.prototype.then=i.gthen,(n.global||e.global)&&(Object.defineProperty(ve,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function $n(){var e=ve.Promise;return Ft?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(ve,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject,nthen:St.then,gthen:e.prototype.then}:{}}function An(e,t,n,r,i){var s=Ut;try{return En(e,!0),t(n,r,i)}finally{En(s,!1)}}function Nn(e){Tt.call(Pt,e)}function On(e,t,n,r){return"function"!=typeof e?e:function(){var i=Ut;n&&vn(),En(t,!0);try{return e.apply(this,arguments)}finally{En(i,!1),r&&Nn(wn)}}}function Pn(e,t){return function(n,r){return e.call(this,On(n,t),On(r,t))}}-1===(""+Tt).indexOf("[native code]")&&(vn=wn=vt);const Sn="unhandledrejection";function Cn(e,t){var n;try{n=t.onuncatched(e)}catch(e){}if(!1!==n)try{var r,i={promise:t,reason:e};if(ve.document&&document.createEvent?((r=document.createEvent("Event")).initEvent(Sn,!0,!0),_e(r,i)):ve.CustomEvent&&_e(r=new CustomEvent(Sn,{detail:i}),i),r&&ve.dispatchEvent&&(dispatchEvent(r),!ve.PromiseRejectionEvent&&ve.onunhandledrejection))try{ve.onunhandledrejection(r)}catch(e){}tt&&r&&!r.defaultPrevented&&console.warn(`Unhandled rejection: ${e.stack||e}`)}catch(e){}}var Tn=Ht.reject;function Bn(e,t,n,r){if(e.idbdb&&(e._state.openComplete||Ut.letThrough||e._vip)){var i=e._createTransaction(t,n,e._dbSchema);try{i.create(),e._state.PR1398_maxLoop=3}catch(i){return i.name===pt.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then((()=>Bn(e,t,n,r)))):Tn(i)}return i._promise(t,((e,t)=>bn((()=>(Ut.trans=i,r(e,t,i)))))).then((e=>i._completion.then((()=>e))))}if(e._state.openComplete)return Tn(new gt.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._options.autoOpen)return Tn(new gt.DatabaseClosed);e.open().catch(vt)}return e._state.dbReadyPromise.then((()=>Bn(e,t,n,r)))}const Fn="3.2.2",jn=String.fromCharCode(65535),Dn=-1/0,In="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Kn="String expected.",Rn=[],Mn="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Ln=Mn,zn=Mn,qn=e=>!/(dexie\.js|dexie\.min\.js)/.test(e),Vn="__dbnames",Un="readonly",Wn="readwrite";function Xn(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}const Yn={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Hn(e){return"string"!=typeof e||/\./.test(e)?e=>e:t=>(void 0===t[e]&&e in t&&delete(t=We(t))[e],t)}class Gn{_trans(e,t,n){const r=this._tx||Ut.trans,i=this.name;function s(e,n,r){if(!r.schema[i])throw new gt.NotFound("Table "+i+" not part of transaction");return t(r.idbtrans,r)}const o=an();try{return r&&r.db===this.db?r===Ut.trans?r._promise(e,s,n):bn((()=>r._promise(e,s,n)),{trans:r,transless:Ut.transless||Ut}):Bn(this.db,e,[this.name],s)}finally{o&&ln()}}get(e,t){return e&&e.constructor===Object?this.where(e).first(t):this._trans("readonly",(t=>this.core.get({trans:t,key:e}).then((e=>this.hook.reading.fire(e))))).then(t)}where(e){if("string"==typeof e)return new this.db.WhereClause(this,e);if(xe(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);const t=we(e);if(1===t.length)return this.where(t[0]).equals(e[t[0]]);const n=this.schema.indexes.concat(this.schema.primKey).filter((e=>e.compound&&t.every((t=>e.keyPath.indexOf(t)>=0))&&e.keyPath.every((e=>t.indexOf(e)>=0))))[0];if(n&&this.db._maxKey!==jn)return this.where(n.name).equals(n.keyPath.map((t=>e[t])));!n&&tt&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${t.join("+")}]`);const{idxByName:r}=this.schema,i=this.db._deps.indexedDB;function s(e,t){try{return 0===i.cmp(e,t)}catch(e){return!1}}const[o,a]=t.reduce((([t,n],i)=>{const o=r[i],a=e[i];return[t||o,t||!o?Xn(n,o&&o.multi?e=>{const t=Ke(e,i);return xe(t)&&t.some((e=>s(a,e)))}:e=>s(a,Ke(e,i))):n]}),[null,null]);return o?this.where(o.name).equals(e[o.keyPath]).filter(a):n?this.filter(a):this.where(t).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,xe(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;const t=t=>{if(!t)return t;const n=Object.create(e.prototype);for(var r in t)if($e(t,r))try{n[r]=t[r]}catch(e){}return n};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=t,this.hook("reading",t),e}defineClass(){return this.mapToClass((function(e){_e(this,e)}))}add(e,t){const{auto:n,keyPath:r}=this.schema.primKey;let i=e;return r&&n&&(i=Hn(r)(e)),this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"add",keys:null!=t?[t]:null,values:[i]}))).then((e=>e.numFailures?Ht.reject(e.failures[0]):e.lastResult)).then((t=>{if(r)try{Re(e,r,t)}catch(e){}return t}))}update(e,t){if("object"!=typeof e||xe(e))return this.where(":id").equals(e).modify(t);{const n=Ke(e,this.schema.primKey.keyPath);if(void 0===n)return Tn(new gt.InvalidArgument("Given object does not contain its primary key"));try{"function"!=typeof t?we(t).forEach((n=>{Re(e,n,t[n])})):t(e,{value:e,primKey:n})}catch(e){}return this.where(":id").equals(n).modify(t)}}put(e,t){const{auto:n,keyPath:r}=this.schema.primKey;let i=e;return r&&n&&(i=Hn(r)(e)),this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"put",values:[i],keys:null!=t?[t]:null}))).then((e=>e.numFailures?Ht.reject(e.failures[0]):e.lastResult)).then((t=>{if(r)try{Re(e,r,t)}catch(e){}return t}))}delete(e){return this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"delete",keys:[e]}))).then((e=>e.numFailures?Ht.reject(e.failures[0]):void 0))}clear(){return this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"deleteRange",range:Yn}))).then((e=>e.numFailures?Ht.reject(e.failures[0]):void 0))}bulkGet(e){return this._trans("readonly",(t=>this.core.getMany({keys:e,trans:t}).then((e=>e.map((e=>this.hook.reading.fire(e)))))))}bulkAdd(e,t,n){const r=Array.isArray(t)?t:void 0,i=(n=n||(r?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",(t=>{const{auto:n,keyPath:s}=this.schema.primKey;if(s&&r)throw new gt.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(r&&r.length!==e.length)throw new gt.InvalidArgument("Arguments objects and keys must have the same length");const o=e.length;let a=s&&n?e.map(Hn(s)):e;return this.core.mutate({trans:t,type:"add",keys:r,values:a,wantResults:i}).then((({numFailures:e,results:t,lastResult:n,failures:r})=>{if(0===e)return i?t:n;throw new dt(`${this.name}.bulkAdd(): ${e} of ${o} operations failed`,r)}))}))}bulkPut(e,t,n){const r=Array.isArray(t)?t:void 0,i=(n=n||(r?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",(t=>{const{auto:n,keyPath:s}=this.schema.primKey;if(s&&r)throw new gt.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(r&&r.length!==e.length)throw new gt.InvalidArgument("Arguments objects and keys must have the same length");const o=e.length;let a=s&&n?e.map(Hn(s)):e;return this.core.mutate({trans:t,type:"put",keys:r,values:a,wantResults:i}).then((({numFailures:e,results:t,lastResult:n,failures:r})=>{if(0===e)return i?t:n;throw new dt(`${this.name}.bulkPut(): ${e} of ${o} operations failed`,r)}))}))}bulkDelete(e){const t=e.length;return this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"delete",keys:e}))).then((({numFailures:e,lastResult:n,failures:r})=>{if(0===e)return n;throw new dt(`${this.name}.bulkDelete(): ${e} of ${t} operations failed`,r)}))}}function Qn(e){var t={},n=function(n,r){if(r){for(var i=arguments.length,s=new Array(i-1);--i;)s[i-1]=arguments[i];return t[n].subscribe.apply(null,s),e}if("string"==typeof n)return t[n]};n.addEventType=s;for(var r=1,i=arguments.length;r<i;++r)s(arguments[r]);return n;function s(e,r,i){if("object"==typeof e)return o(e);r||(r=At),i||(i=vt);var s={subscribers:[],fire:i,subscribe:function(e){-1===s.subscribers.indexOf(e)&&(s.subscribers.push(e),s.fire=r(s.fire,e))},unsubscribe:function(e){s.subscribers=s.subscribers.filter((function(t){return t!==e})),s.fire=s.subscribers.reduce(r,i)}};return t[e]=n[e]=s,s}function o(e){we(e).forEach((function(t){var n=e[t];if(xe(n))s(t,e[t][0],e[t][1]);else{if("asap"!==n)throw new gt.InvalidArgument("Invalid event config");var r=s(t,wt,(function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];r.subscribers.forEach((function(e){De((function(){e.apply(null,t)}))}))}))}}))}}function Jn(e,t){return Pe(t).from({prototype:e}),t}function Zn(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function er(e,t){e.filter=Xn(e.filter,t)}function tr(e,t,n){var r=e.replayFilter;e.replayFilter=r?()=>Xn(r(),t()):t,e.justLimit=n&&!r}function nr(e,t){if(e.isPrimKey)return t.primaryKey;const n=t.getIndexByKeyPath(e.index);if(!n)throw new gt.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function rr(e,t,n){const r=nr(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:"prev"===e.dir,unique:!!e.unique,query:{index:r,range:e.range}})}function ir(e,t,n,r){const i=e.replayFilter?Xn(e.filter,e.replayFilter()):e.filter;if(e.or){const s={},o=(e,n,r)=>{if(!i||i(n,r,(e=>n.stop(e)),(e=>n.fail(e)))){var o=n.primaryKey,a=""+o;"[object ArrayBuffer]"===a&&(a=""+new Uint8Array(o)),$e(s,a)||(s[a]=!0,t(e,n,r))}};return Promise.all([e.or._iterate(o,n),sr(rr(e,r,n),e.algorithm,o,!e.keysOnly&&e.valueMapper)])}return sr(rr(e,r,n),Xn(e.algorithm,i),t,!e.keysOnly&&e.valueMapper)}function sr(e,t,n,r){var i=hn(r?(e,t,i)=>n(r(e),t,i):n);return e.then((e=>{if(e)return e.start((()=>{var n=()=>e.continue();t&&!t(e,(e=>n=e),(t=>{e.stop(t),n=vt}),(t=>{e.fail(t),n=vt}))||i(e.value,e,(e=>n=e)),n()}))}))}function or(e,t){try{const n=ar(e),r=ar(t);if(n!==r)return"Array"===n?1:"Array"===r?-1:"binary"===n?1:"binary"===r?-1:"string"===n?1:"string"===r?-1:"Date"===n?1:"Date"!==r?NaN:-1;switch(n){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return function(e,t){const n=e.length,r=t.length,i=n<r?n:r;for(let n=0;n<i;++n)if(e[n]!==t[n])return e[n]<t[n]?-1:1;return n===r?0:n<r?-1:1}(lr(e),lr(t));case"Array":return function(e,t){const n=e.length,r=t.length,i=n<r?n:r;for(let n=0;n<i;++n){const r=or(e[n],t[n]);if(0!==r)return r}return n===r?0:n<r?-1:1}(e,t)}}catch(e){}return NaN}function ar(e){const t=typeof e;if("object"!==t)return t;if(ArrayBuffer.isView(e))return"binary";const n=He(e);return"ArrayBuffer"===n?"binary":n}function lr(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}class cr{_read(e,t){var n=this._ctx;return n.error?n.table._trans(null,Tn.bind(null,n.error)):n.table._trans("readonly",e).then(t)}_write(e){var t=this._ctx;return t.error?t.table._trans(null,Tn.bind(null,t.error)):t.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var t=this._ctx;t.algorithm=Xn(t.algorithm,e)}_iterate(e,t){return ir(this._ctx,e,t,this._ctx.table.core)}clone(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&_e(n,e),t._ctx=n,t}raw(){return this._ctx.valueMapper=null,this}each(e){var t=this._ctx;return this._read((n=>ir(t,e,n,t.table.core)))}count(e){return this._read((e=>{const t=this._ctx,n=t.table.core;if(Zn(t,!0))return n.count({trans:e,query:{index:nr(t,n.schema),range:t.range}}).then((e=>Math.min(e,t.limit)));var r=0;return ir(t,(()=>(++r,!1)),e,n).then((()=>r))})).then(e)}sortBy(e,t){const n=e.split(".").reverse(),r=n[0],i=n.length-1;function s(e,t){return t?s(e[n[t]],t-1):e[r]}var o="next"===this._ctx.dir?1:-1;function a(e,t){var n=s(e,i),r=s(t,i);return n<r?-o:n>r?o:0}return this.toArray((function(e){return e.sort(a)})).then(t)}toArray(e){return this._read((e=>{var t=this._ctx;if("next"===t.dir&&Zn(t,!0)&&t.limit>0){const{valueMapper:n}=t,r=nr(t,t.table.core.schema);return t.table.core.query({trans:e,limit:t.limit,values:!0,query:{index:r,range:t.range}}).then((({result:e})=>n?e.map(n):e))}{const n=[];return ir(t,(e=>n.push(e)),e,t.table.core).then((()=>n))}}),e)}offset(e){var t=this._ctx;return e<=0||(t.offset+=e,Zn(t)?tr(t,(()=>{var t=e;return(e,n)=>0===t||(1===t?(--t,!1):(n((()=>{e.advance(t),t=0})),!1))})):tr(t,(()=>{var t=e;return()=>--t<0}))),this}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),tr(this._ctx,(()=>{var t=e;return function(e,n,r){return--t<=0&&n(r),t>=0}}),!0),this}until(e,t){return er(this._ctx,(function(n,r,i){return!e(n.value)||(r(i),t)})),this}first(e){return this.limit(1).toArray((function(e){return e[0]})).then(e)}last(e){return this.reverse().first(e)}filter(e){var t,n;return er(this._ctx,(function(t){return e(t.value)})),t=this._ctx,n=e,t.isMatch=Xn(t.isMatch,n),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,n){e(n.key,n)}))}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,n){e(n.primaryKey,n)}))}keys(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each((function(e,t){n.push(t.key)})).then((function(){return n})).then(e)}primaryKeys(e){var t=this._ctx;if("next"===t.dir&&Zn(t,!0)&&t.limit>0)return this._read((e=>{var n=nr(t,t.table.core.schema);return t.table.core.query({trans:e,values:!1,limit:t.limit,query:{index:n,range:t.range}})})).then((({result:e})=>e)).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each((function(e,t){n.push(t.primaryKey)})).then((function(){return n})).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys((function(e){return e[0]})).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var n={};return er(this._ctx,(function(e){var t=e.primaryKey.toString(),r=$e(n,t);return n[t]=!0,!r})),this}modify(e){var t=this._ctx;return this._write((n=>{var r;if("function"==typeof e)r=e;else{var i=we(e),s=i.length;r=function(t){for(var n=!1,r=0;r<s;++r){var o=i[r],a=e[o];Ke(t,o)!==a&&(Re(t,o,a),n=!0)}return n}}const o=t.table.core,{outbound:a,extractKey:l}=o.schema.primaryKey,c=this.db._options.modifyChunkSize||200,u=[];let h=0;const f=[],d=(e,t)=>{const{failures:n,numFailures:r}=t;h+=e-r;for(let e of we(n))u.push(n[e])};return this.clone().primaryKeys().then((i=>{const s=u=>{const h=Math.min(c,i.length-u);return o.getMany({trans:n,keys:i.slice(u,u+h),cache:"immutable"}).then((f=>{const p=[],m=[],g=a?[]:null,y=[];for(let e=0;e<h;++e){const t=f[e],n={value:We(t),primKey:i[u+e]};!1!==r.call(n,n.value,n)&&(null==n.value?y.push(i[u+e]):a||0===or(l(t),l(n.value))?(m.push(n.value),a&&g.push(i[u+e])):(y.push(i[u+e]),p.push(n.value)))}const b=Zn(t)&&t.limit===1/0&&("function"!=typeof e||e===ur)&&{index:t.index,range:t.range};return Promise.resolve(p.length>0&&o.mutate({trans:n,type:"add",values:p}).then((e=>{for(let t in e.failures)y.splice(parseInt(t),1);d(p.length,e)}))).then((()=>(m.length>0||b&&"object"==typeof e)&&o.mutate({trans:n,type:"put",keys:g,values:m,criteria:b,changeSpec:"function"!=typeof e&&e}).then((e=>d(m.length,e))))).then((()=>(y.length>0||b&&e===ur)&&o.mutate({trans:n,type:"delete",keys:y,criteria:b}).then((e=>d(y.length,e))))).then((()=>i.length>u+h&&s(u+c)))}))};return s(0).then((()=>{if(u.length>0)throw new ft("Error modifying one or more objects",u,h,f);return i.length}))}))}))}delete(){var e=this._ctx,t=e.range;return Zn(e)&&(e.isPrimKey&&!zn||3===t.type)?this._write((n=>{const{primaryKey:r}=e.table.core.schema,i=t;return e.table.core.count({trans:n,query:{index:r,range:i}}).then((t=>e.table.core.mutate({trans:n,type:"deleteRange",range:i}).then((({failures:e,lastResult:n,results:r,numFailures:i})=>{if(i)throw new ft("Could not delete some values",Object.keys(e).map((t=>e[t])),t-i);return t-i}))))})):this.modify(ur)}}const ur=(e,t)=>t.value=null;function hr(e,t){return e<t?-1:e===t?0:1}function fr(e,t){return e>t?-1:e===t?0:1}function dr(e,t,n){var r=e instanceof vr?new e.Collection(e):e;return r._ctx.error=n?new n(t):new TypeError(t),r}function pr(e){return new e.Collection(e,(()=>br(""))).limit(0)}function mr(e,t,n,r,i,s){for(var o=Math.min(e.length,r.length),a=-1,l=0;l<o;++l){var c=t[l];if(c!==r[l])return i(e[l],n[l])<0?e.substr(0,l)+n[l]+n.substr(l+1):i(e[l],r[l])<0?e.substr(0,l)+r[l]+n.substr(l+1):a>=0?e.substr(0,a)+t[a]+n.substr(a+1):null;i(e[l],c)<0&&(a=l)}return o<r.length&&"next"===s?e+n.substr(e.length):o<e.length&&"prev"===s?e.substr(0,n.length):a<0?null:e.substr(0,a)+r[a]+n.substr(a+1)}function gr(e,t,n,r){var i,s,o,a,l,c,u,h=n.length;if(!n.every((e=>"string"==typeof e)))return dr(e,Kn);function f(e){i=function(e){return"next"===e?e=>e.toUpperCase():e=>e.toLowerCase()}(e),s=function(e){return"next"===e?e=>e.toLowerCase():e=>e.toUpperCase()}(e),o="next"===e?hr:fr;var t=n.map((function(e){return{lower:s(e),upper:i(e)}})).sort((function(e,t){return o(e.lower,t.lower)}));a=t.map((function(e){return e.upper})),l=t.map((function(e){return e.lower})),c=e,u="next"===e?"":r}f("next");var d=new e.Collection(e,(()=>yr(a[0],l[h-1]+r)));d._ondirectionchange=function(e){f(e)};var p=0;return d._addAlgorithm((function(e,n,r){var i=e.key;if("string"!=typeof i)return!1;var f=s(i);if(t(f,l,p))return!0;for(var d=null,m=p;m<h;++m){var g=mr(i,f,a[m],l[m],o,c);null===g&&null===d?p=m+1:(null===d||o(d,g)>0)&&(d=g)}return n(null!==d?function(){e.continue(d+u)}:r),!1})),d}function yr(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function br(e){return{type:1,lower:e,upper:e}}class vr{get Collection(){return this._ctx.table.db.Collection}between(e,t,n,r){n=!1!==n,r=!0===r;try{return this._cmp(e,t)>0||0===this._cmp(e,t)&&(n||r)&&(!n||!r)?pr(this):new this.Collection(this,(()=>yr(e,t,!n,!r)))}catch(e){return dr(this,In)}}equals(e){return null==e?dr(this,In):new this.Collection(this,(()=>br(e)))}above(e){return null==e?dr(this,In):new this.Collection(this,(()=>yr(e,void 0,!0)))}aboveOrEqual(e){return null==e?dr(this,In):new this.Collection(this,(()=>yr(e,void 0,!1)))}below(e){return null==e?dr(this,In):new this.Collection(this,(()=>yr(void 0,e,!1,!0)))}belowOrEqual(e){return null==e?dr(this,In):new this.Collection(this,(()=>yr(void 0,e)))}startsWith(e){return"string"!=typeof e?dr(this,Kn):this.between(e,e+jn,!0,!0)}startsWithIgnoreCase(e){return""===e?this.startsWith(e):gr(this,((e,t)=>0===e.indexOf(t[0])),[e],jn)}equalsIgnoreCase(e){return gr(this,((e,t)=>e===t[0]),[e],"")}anyOfIgnoreCase(){var e=Ze.apply(Je,arguments);return 0===e.length?pr(this):gr(this,((e,t)=>-1!==t.indexOf(e)),e,"")}startsWithAnyOfIgnoreCase(){var e=Ze.apply(Je,arguments);return 0===e.length?pr(this):gr(this,((e,t)=>t.some((t=>0===e.indexOf(t)))),e,jn)}anyOf(){const e=Ze.apply(Je,arguments);let t=this._cmp;try{e.sort(t)}catch(e){return dr(this,In)}if(0===e.length)return pr(this);const n=new this.Collection(this,(()=>yr(e[0],e[e.length-1])));n._ondirectionchange=n=>{t="next"===n?this._ascending:this._descending,e.sort(t)};let r=0;return n._addAlgorithm(((n,i,s)=>{const o=n.key;for(;t(o,e[r])>0;)if(++r,r===e.length)return i(s),!1;return 0===t(o,e[r])||(i((()=>{n.continue(e[r])})),!1)})),n}notEqual(e){return this.inAnyRange([[Dn,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const e=Ze.apply(Je,arguments);if(0===e.length)return new this.Collection(this);try{e.sort(this._ascending)}catch(e){return dr(this,In)}const t=e.reduce(((e,t)=>e?e.concat([[e[e.length-1][1],t]]):[[Dn,t]]),null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,t){const n=this._cmp,r=this._ascending,i=this._descending,s=this._min,o=this._max;if(0===e.length)return pr(this);if(!e.every((e=>void 0!==e[0]&&void 0!==e[1]&&r(e[0],e[1])<=0)))return dr(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",gt.InvalidArgument);const a=!t||!1!==t.includeLowers,l=t&&!0===t.includeUppers;let c,u=r;function h(e,t){return u(e[0],t[0])}try{c=e.reduce((function(e,t){let r=0,i=e.length;for(;r<i;++r){const i=e[r];if(n(t[0],i[1])<0&&n(t[1],i[0])>0){i[0]=s(i[0],t[0]),i[1]=o(i[1],t[1]);break}}return r===i&&e.push(t),e}),[]),c.sort(h)}catch(e){return dr(this,In)}let f=0;const d=l?e=>r(e,c[f][1])>0:e=>r(e,c[f][1])>=0,p=a?e=>i(e,c[f][0])>0:e=>i(e,c[f][0])>=0;let m=d;const g=new this.Collection(this,(()=>yr(c[0][0],c[c.length-1][1],!a,!l)));return g._ondirectionchange=e=>{"next"===e?(m=d,u=r):(m=p,u=i),c.sort(h)},g._addAlgorithm(((e,t,n)=>{for(var i=e.key;m(i);)if(++f,f===c.length)return t(n),!1;return!!function(e){return!d(e)&&!p(e)}(i)||(0===this._cmp(i,c[f][1])||0===this._cmp(i,c[f][0])||t((()=>{u===r?e.continue(c[f][0]):e.continue(c[f][1])})),!1)})),g}startsWithAnyOf(){const e=Ze.apply(Je,arguments);return e.every((e=>"string"==typeof e))?0===e.length?pr(this):this.inAnyRange(e.map((e=>[e,e+jn]))):dr(this,"startsWithAnyOf() only works with strings")}}function wr(e){return hn((function(t){return xr(t),e(t.target.error),!1}))}function xr(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}const _r="storagemutated",kr="x-storagemutated-1",Er=Qn(null,_r);class $r{_lock(){return je(!Ut.global),++this._reculock,1!==this._reculock||Ut.global||(Ut.lockOwnerFor=this),this}_unlock(){if(je(!Ut.global),0==--this._reculock)for(Ut.global||(Ut.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{An(e[1],e[0])}catch(e){}}return this}_locked(){return this._reculock&&Ut.lockOwnerFor!==this}create(e){if(!this.mode)return this;const t=this.db.idbdb,n=this.db._state.dbOpenError;if(je(!this.idbtrans),!e&&!t)switch(n&&n.name){case"DatabaseClosedError":throw new gt.DatabaseClosed(n);case"MissingAPIError":throw new gt.MissingAPI(n.message,n);default:throw new gt.OpenFailed(n)}if(!this.active)throw new gt.TransactionInactive;return je(null===this._completion._state),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):t.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=hn((t=>{xr(t),this._reject(e.error)})),e.onabort=hn((t=>{xr(t),this.active&&this._reject(new gt.Abort(e.error)),this.active=!1,this.on("abort").fire(t)})),e.oncomplete=hn((()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&Er.storagemutated.fire(e.mutatedParts)})),this}_promise(e,t,n){if("readwrite"===e&&"readwrite"!==this.mode)return Tn(new gt.ReadOnly("Transaction is readonly"));if(!this.active)return Tn(new gt.TransactionInactive);if(this._locked())return new Ht(((r,i)=>{this._blockedFuncs.push([()=>{this._promise(e,t,n).then(r,i)},Ut])}));if(n)return bn((()=>{var e=new Ht(((e,n)=>{this._lock();const r=t(e,n,this);r&&r.then&&r.then(e,n)}));return e.finally((()=>this._unlock())),e._lib=!0,e}));var r=new Ht(((e,n)=>{var r=t(e,n,this);r&&r.then&&r.then(e,n)}));return r._lib=!0,r}_root(){return this.parent?this.parent._root():this}waitFor(e){var t=this._root();const n=Ht.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then((()=>n));else{t._waitingFor=n,t._waitingQueue=[];var r=t.idbtrans.objectStore(t.storeNames[0]);!function e(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(r.get(-1/0).onsuccess=e)}()}var i=t._waitingFor;return new Ht(((e,r)=>{n.then((n=>t._waitingQueue.push(hn(e.bind(null,n)))),(e=>t._waitingQueue.push(hn(r.bind(null,e))))).finally((()=>{t._waitingFor===i&&(t._waitingFor=null)}))}))}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new gt.Abort))}table(e){const t=this._memoizedTables||(this._memoizedTables={});if($e(t,e))return t[e];const n=this.schema[e];if(!n)throw new gt.NotFound("Table "+e+" not part of transaction");const r=new this.db.Table(e,n,this);return r.core=this.db.core.table(e),t[e]=r,r}}function Ar(e,t,n,r,i,s,o){return{name:e,keyPath:t,unique:n,multi:r,auto:i,compound:s,src:(n&&!o?"&":"")+(r?"*":"")+(i?"++":"")+Nr(t)}}function Nr(e){return"string"==typeof e?e:e?"["+[].join.call(e,"+")+"]":""}function Or(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:Ie(n,(e=>[e.name,e]))}}let Pr=e=>{try{return e.only([[]]),Pr=()=>[[]],[[]]}catch(e){return Pr=()=>jn,jn}};function Sr(e){return null==e?()=>{}:"string"==typeof e?function(e){return 1===e.split(".").length?t=>t[e]:t=>Ke(t,e)}(e):t=>Ke(t,e)}function Cr(e){return[].slice.call(e)}let Tr=0;function Br(e){return null==e?":id":"string"==typeof e?e:`[${e.join("+")}]`}function Fr(e,t,n){function r(e){if(3===e.type)return null;if(4===e.type)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:n,upper:r,lowerOpen:i,upperOpen:s}=e;return void 0===n?void 0===r?null:t.upperBound(r,!!s):void 0===r?t.lowerBound(n,!!i):t.bound(n,r,!!i,!!s)}const{schema:i,hasGetAll:s}=function(e,t){const n=Cr(e.objectStoreNames);return{schema:{name:e.name,tables:n.map((e=>t.objectStore(e))).map((e=>{const{keyPath:t,autoIncrement:n}=e,r=xe(t),i=null==t,s={},o={name:e.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:i,compound:r,keyPath:t,autoIncrement:n,unique:!0,extractKey:Sr(t)},indexes:Cr(e.indexNames).map((t=>e.index(t))).map((e=>{const{name:t,unique:n,multiEntry:r,keyPath:i}=e,o={name:t,compound:xe(i),keyPath:i,unique:n,multiEntry:r,extractKey:Sr(i)};return s[Br(i)]=o,o})),getIndexByKeyPath:e=>s[Br(e)]};return s[":id"]=o.primaryKey,null!=t&&(s[Br(t)]=o.primaryKey),o}))},hasGetAll:n.length>0&&"getAll"in t.objectStore(n[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(e,n),o=i.tables.map((e=>function(e){const t=e.name;return{name:t,schema:e,mutate:function({trans:e,type:n,keys:i,values:s,range:o}){return new Promise(((a,l)=>{a=hn(a);const c=e.objectStore(t),u=null==c.keyPath,h="put"===n||"add"===n;if(!h&&"delete"!==n&&"deleteRange"!==n)throw new Error("Invalid operation type: "+n);const{length:f}=i||s||{length:1};if(i&&s&&i.length!==s.length)throw new Error("Given keys array must have same length as given values array.");if(0===f)return a({numFailures:0,failures:{},results:[],lastResult:void 0});let d;const p=[],m=[];let g=0;const y=e=>{++g,xr(e)};if("deleteRange"===n){if(4===o.type)return a({numFailures:g,failures:m,results:[],lastResult:void 0});3===o.type?p.push(d=c.clear()):p.push(d=c.delete(r(o)))}else{const[e,t]=h?u?[s,i]:[s,null]:[i,null];if(h)for(let r=0;r<f;++r)p.push(d=t&&void 0!==t[r]?c[n](e[r],t[r]):c[n](e[r])),d.onerror=y;else for(let t=0;t<f;++t)p.push(d=c[n](e[t])),d.onerror=y}const b=e=>{const t=e.target.result;p.forEach(((e,t)=>null!=e.error&&(m[t]=e.error))),a({numFailures:g,failures:m,results:"delete"===n?i:p.map((e=>e.result)),lastResult:t})};d.onerror=e=>{y(e),b(e)},d.onsuccess=b}))},getMany:({trans:e,keys:n})=>new Promise(((r,i)=>{r=hn(r);const s=e.objectStore(t),o=n.length,a=new Array(o);let l,c=0,u=0;const h=e=>{const t=e.target;a[t._pos]=t.result,++u===c&&r(a)},f=wr(i);for(let e=0;e<o;++e)null!=n[e]&&(l=s.get(n[e]),l._pos=e,l.onsuccess=h,l.onerror=f,++c);0===c&&r(a)})),get:({trans:e,key:n})=>new Promise(((r,i)=>{r=hn(r);const s=e.objectStore(t).get(n);s.onsuccess=e=>r(e.target.result),s.onerror=wr(i)})),query:function(e){return n=>new Promise(((i,s)=>{i=hn(i);const{trans:o,values:a,limit:l,query:c}=n,u=l===1/0?void 0:l,{index:h,range:f}=c,d=o.objectStore(t),p=h.isPrimaryKey?d:d.index(h.name),m=r(f);if(0===l)return i({result:[]});if(e){const e=a?p.getAll(m,u):p.getAllKeys(m,u);e.onsuccess=e=>i({result:e.target.result}),e.onerror=wr(s)}else{let e=0;const t=a||!("openKeyCursor"in p)?p.openCursor(m):p.openKeyCursor(m),n=[];t.onsuccess=r=>{const s=t.result;return s?(n.push(a?s.value:s.primaryKey),++e===l?i({result:n}):void s.continue()):i({result:n})},t.onerror=wr(s)}}))}(s),openCursor:function({trans:e,values:n,query:i,reverse:s,unique:o}){return new Promise(((a,l)=>{a=hn(a);const{index:c,range:u}=i,h=e.objectStore(t),f=c.isPrimaryKey?h:h.index(c.name),d=s?o?"prevunique":"prev":o?"nextunique":"next",p=n||!("openKeyCursor"in f)?f.openCursor(r(u),d):f.openKeyCursor(r(u),d);p.onerror=wr(l),p.onsuccess=hn((t=>{const n=p.result;if(!n)return void a(null);n.___id=++Tr,n.done=!1;const r=n.continue.bind(n);let i=n.continuePrimaryKey;i&&(i=i.bind(n));const s=n.advance.bind(n),o=()=>{throw new Error("Cursor not stopped")};n.trans=e,n.stop=n.continue=n.continuePrimaryKey=n.advance=()=>{throw new Error("Cursor not started")},n.fail=hn(l),n.next=function(){let e=1;return this.start((()=>e--?this.continue():this.stop())).then((()=>this))},n.start=e=>{const t=new Promise(((e,t)=>{e=hn(e),p.onerror=wr(t),n.fail=t,n.stop=t=>{n.stop=n.continue=n.continuePrimaryKey=n.advance=o,e(t)}})),a=()=>{if(p.result)try{e()}catch(e){n.fail(e)}else n.done=!0,n.start=()=>{throw new Error("Cursor behind last entry")},n.stop()};return p.onsuccess=hn((e=>{p.onsuccess=a,a()})),n.continue=r,n.continuePrimaryKey=i,n.advance=s,a(),t},a(n)}),l)}))},count({query:e,trans:n}){const{index:i,range:s}=e;return new Promise(((e,o)=>{const a=n.objectStore(t),l=i.isPrimaryKey?a:a.index(i.name),c=r(s),u=c?l.count(c):l.count();u.onsuccess=hn((t=>e(t.target.result))),u.onerror=wr(o)}))}}}(e))),a={};return o.forEach((e=>a[e.name]=e)),{stack:"dbcore",transaction:e.transaction.bind(e),table(e){if(!a[e])throw new Error(`Table '${e}' not found`);return a[e]},MIN_KEY:-1/0,MAX_KEY:Pr(t),schema:i}}function jr({_novip:e},t){const n=t.db,r=function(e,t,{IDBKeyRange:n,indexedDB:r},i){const s=function(e,t){return t.reduce(((e,{create:t})=>({...e,...t(e)})),e)}(Fr(t,n,i),e.dbcore);return{dbcore:s}}(e._middlewares,n,e._deps,t);e.core=r.dbcore,e.tables.forEach((t=>{const n=t.name;e.core.schema.tables.some((e=>e.name===n))&&(t.core=e.core.table(n),e[n]instanceof e.Table&&(e[n].core=t.core))}))}function Dr({_novip:e},t,n,r){n.forEach((n=>{const i=r[n];t.forEach((t=>{const r=Ce(t,n);(!r||"value"in r&&void 0===r.value)&&(t===e.Transaction.prototype||t instanceof e.Transaction?Oe(t,n,{get(){return this.table(n)},set(e){Ne(this,n,{value:e,writable:!0,configurable:!0,enumerable:!0})}}):t[n]=new e.Table(n,i))}))}))}function Ir({_novip:e},t){t.forEach((t=>{for(let n in t)t[n]instanceof e.Table&&delete t[n]}))}function Kr(e,t){return e._cfg.version-t._cfg.version}function Rr(e,t,n,r){const i=e._dbSchema,s=e._createTransaction("readwrite",e._storeNames,i);s.create(n),s._completion.catch(r);const o=s._reject.bind(s),a=Ut.transless||Ut;bn((()=>{Ut.trans=s,Ut.transless=a,0===t?(we(i).forEach((e=>{Lr(n,e,i[e].primKey,i[e].indexes)})),jr(e,n),Ht.follow((()=>e.on.populate.fire(s))).catch(o)):function({_novip:e},t,n,r){const i=[],s=e._versions;let o=e._dbSchema=qr(e,e.idbdb,r),a=!1;function l(){return i.length?Ht.resolve(i.shift()(n.idbtrans)).then(l):Ht.resolve()}return s.filter((e=>e._cfg.version>=t)).forEach((s=>{i.push((()=>{const i=o,l=s._cfg.dbschema;Vr(e,i,r),Vr(e,l,r),o=e._dbSchema=l;const c=Mr(i,l);c.add.forEach((e=>{Lr(r,e[0],e[1].primKey,e[1].indexes)})),c.change.forEach((e=>{if(e.recreate)throw new gt.Upgrade("Not yet support for changing primary key");{const t=r.objectStore(e.name);e.add.forEach((e=>zr(t,e))),e.change.forEach((e=>{t.deleteIndex(e.name),zr(t,e)})),e.del.forEach((e=>t.deleteIndex(e)))}}));const u=s._cfg.contentUpgrade;if(u&&s._cfg.version>t){jr(e,r),n._memoizedTables={},a=!0;let t=Me(l);c.del.forEach((e=>{t[e]=i[e]})),Ir(e,[e.Transaction.prototype]),Dr(e,[e.Transaction.prototype],we(t),t),n.schema=t;const s=et(u);let o;s&&vn();const h=Ht.follow((()=>{if(o=u(n),o&&s){var e=wn.bind(null,null);o.then(e,e)}}));return o&&"function"==typeof o.then?Ht.resolve(o):h.then((()=>o))}})),i.push((t=>{if(!a||!Ln){!function(e,t){[].slice.call(t.db.objectStoreNames).forEach((n=>null==e[n]&&t.db.deleteObjectStore(n)))}(s._cfg.dbschema,t)}Ir(e,[e.Transaction.prototype]),Dr(e,[e.Transaction.prototype],e._storeNames,e._dbSchema),n.schema=e._dbSchema}))})),l().then((()=>{var e,t;t=r,we(e=o).forEach((n=>{t.db.objectStoreNames.contains(n)||Lr(t,n,e[n].primKey,e[n].indexes)}))}))}(e,t,s,n).catch(o)}))}function Mr(e,t){const n={del:[],add:[],change:[]};let r;for(r in e)t[r]||n.del.push(r);for(r in t){const i=e[r],s=t[r];if(i){const e={name:r,def:s,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(s.primKey.keyPath||"")||i.primKey.auto!==s.primKey.auto&&!Mn)e.recreate=!0,n.change.push(e);else{const t=i.idxByName,r=s.idxByName;let o;for(o in t)r[o]||e.del.push(o);for(o in r){const n=t[o],i=r[o];n?n.src!==i.src&&e.change.push(i):e.add.push(i)}(e.del.length>0||e.add.length>0||e.change.length>0)&&n.change.push(e)}}else n.add.push([r,s])}return n}function Lr(e,t,n,r){const i=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach((e=>zr(i,e))),i}function zr(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function qr(e,t,n){const r={};return Be(t.objectStoreNames,0).forEach((e=>{const t=n.objectStore(e);let i=t.keyPath;const s=Ar(Nr(i),i||"",!1,!1,!!t.autoIncrement,i&&"string"!=typeof i,!0),o=[];for(let e=0;e<t.indexNames.length;++e){const n=t.index(t.indexNames[e]);i=n.keyPath;var a=Ar(n.name,i,!!n.unique,!!n.multiEntry,!1,i&&"string"!=typeof i,!1);o.push(a)}r[e]=Or(e,s,o)})),r}function Vr({_novip:e},t,n){const r=n.db.objectStoreNames;for(let i=0;i<r.length;++i){const s=r[i],o=n.objectStore(s);e._hasGetAll="getAll"in o;for(let e=0;e<o.indexNames.length;++e){const n=o.indexNames[e],r=o.index(n).keyPath,i="string"==typeof r?r:"["+Be(r).join("+")+"]";if(t[s]){const e=t[s].idxByName[i];e&&(e.name=n,delete t[s].idxByName[i],t[s].idxByName[n]=e)}}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&ve.WorkerGlobalScope&&ve instanceof ve.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}class Ur{_parseStoresSpec(e,t){we(e).forEach((n=>{if(null!==e[n]){var r=e[n].split(",").map(((e,t)=>{const n=(e=e.trim()).replace(/([&*]|\+\+)/g,""),r=/^\[/.test(n)?n.match(/^\[(.*)\]$/)[1].split("+"):n;return Ar(n,r||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),xe(r),0===t)})),i=r.shift();if(i.multi)throw new gt.Schema("Primary key cannot be multi-valued");r.forEach((e=>{if(e.auto)throw new gt.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new gt.Schema("Index must have a name and cannot be an empty string")})),t[n]=Or(n,i,r)}}))}stores(e){const t=this.db;this._cfg.storesSource=this._cfg.storesSource?_e(this._cfg.storesSource,e):e;const n=t._versions,r={};let i={};return n.forEach((e=>{_e(r,e._cfg.storesSource),i=e._cfg.dbschema={},e._parseStoresSpec(r,i)})),t._dbSchema=i,Ir(t,[t._allTables,t,t.Transaction.prototype]),Dr(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],we(i),i),t._storeNames=we(i),this}upgrade(e){return this._cfg.contentUpgrade=Nt(this._cfg.contentUpgrade||vt,e),this}}function Wr(e,t){let n=e._dbNamesDB;return n||(n=e._dbNamesDB=new pi(Vn,{addons:[],indexedDB:e,IDBKeyRange:t}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function Xr(e){return e&&"function"==typeof e.databases}function Yr(e){return bn((function(){return Ut.letThrough=!0,e()}))}function Hr(){var e;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise((function(t){var n=function(){return indexedDB.databases().finally(t)};e=setInterval(n,100),n()})).finally((function(){return clearInterval(e)})):Promise.resolve()}function Gr(e){const t=e._state,{indexedDB:n}=e._deps;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then((()=>t.dbOpenError?Tn(t.dbOpenError):e));tt&&(t.openCanceller._stackHolder=st()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;const r=t.openCanceller;function i(){if(t.openCanceller!==r)throw new gt.DatabaseClosed("db.open() was cancelled")}let s=t.dbReadyResolve,o=null,a=!1;return Ht.race([r,("undefined"==typeof navigator?Ht.resolve():Hr()).then((()=>new Ht(((r,s)=>{if(i(),!n)throw new gt.MissingAPI;const l=e.name,c=t.autoSchema?n.open(l):n.open(l,Math.round(10*e.verno));if(!c)throw new gt.MissingAPI;c.onerror=wr(s),c.onblocked=hn(e._fireOnBlocked),c.onupgradeneeded=hn((r=>{if(o=c.transaction,t.autoSchema&&!e._options.allowEmptyDB){c.onerror=xr,o.abort(),c.result.close();const e=n.deleteDatabase(l);e.onsuccess=e.onerror=hn((()=>{s(new gt.NoSuchDatabase(`Database ${l} doesnt exist`))}))}else{o.onerror=wr(s);var i=r.oldVersion>Math.pow(2,62)?0:r.oldVersion;a=i<1,e._novip.idbdb=c.result,Rr(e,i/10,o,s)}}),s),c.onsuccess=hn((()=>{o=null;const n=e._novip.idbdb=c.result,i=Be(n.objectStoreNames);if(i.length>0)try{const r=n.transaction(1===(s=i).length?s[0]:s,"readonly");t.autoSchema?function({_novip:e},t,n){e.verno=t.version/10;const r=e._dbSchema=qr(0,t,n);e._storeNames=Be(t.objectStoreNames,0),Dr(e,[e._allTables],we(r),r)}(e,n,r):(Vr(e,e._dbSchema,r),function(e,t){const n=Mr(qr(0,e.idbdb,t),e._dbSchema);return!(n.add.length||n.change.some((e=>e.add.length||e.change.length)))}(e,r)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),jr(e,r)}catch(e){}var s;Rn.push(e),n.onversionchange=hn((n=>{t.vcFired=!0,e.on("versionchange").fire(n)})),n.onclose=hn((t=>{e.on("close").fire(t)})),a&&function({indexedDB:e,IDBKeyRange:t},n){!Xr(e)&&n!==Vn&&Wr(e,t).put({name:n}).catch(vt)}(e._deps,l),r()}),s)}))))]).then((()=>(i(),t.onReadyBeingFired=[],Ht.resolve(Yr((()=>e.on.ready.fire(e.vip)))).then((function n(){if(t.onReadyBeingFired.length>0){let r=t.onReadyBeingFired.reduce(Nt,vt);return t.onReadyBeingFired=[],Ht.resolve(Yr((()=>r(e.vip)))).then(n)}}))))).finally((()=>{t.onReadyBeingFired=null,t.isBeingOpened=!1})).then((()=>e)).catch((n=>{t.dbOpenError=n;try{o&&o.abort()}catch(e){}return r===t.openCanceller&&e._close(),Tn(n)})).finally((()=>{t.openComplete=!0,s()}))}function Qr(e){var t=t=>e.next(t),n=i(t),r=i((t=>e.throw(t)));function i(e){return t=>{var i=e(t),s=i.value;return i.done?s:s&&"function"==typeof s.then?s.then(n,r):xe(s)?Promise.all(s).then(n,r):n(s)}}return i(t)()}function Jr(e,t,n){var r=arguments.length;if(r<2)throw new gt.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];n=i.pop();var s=ze(i);return[e,s,n]}function Zr(e,t,n,r,i){return Ht.resolve().then((()=>{const s=Ut.transless||Ut,o=e._createTransaction(t,n,e._dbSchema,r),a={trans:o,transless:s};if(r)o.idbtrans=r.idbtrans;else try{o.create(),e._state.PR1398_maxLoop=3}catch(r){return r.name===pt.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then((()=>Zr(e,t,n,null,i)))):Tn(r)}const l=et(i);let c;l&&vn();const u=Ht.follow((()=>{if(c=i.call(o,o),c)if(l){var e=wn.bind(null,null);c.then(e,e)}else"function"==typeof c.next&&"function"==typeof c.throw&&(c=Qr(c))}),a);return(c&&"function"==typeof c.then?Ht.resolve(c).then((e=>o.active?e:Tn(new gt.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn")))):u.then((()=>c))).then((e=>(r&&o._resolve(),o._completion.then((()=>e))))).catch((e=>(o._reject(e),Tn(e))))}))}function ei(e,t,n){const r=xe(e)?e.slice():[e];for(let e=0;e<n;++e)r.push(t);return r}const ti={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return{...e,table(t){const n=e.table(t),{schema:r}=n,i={},s=[];function o(e,t,n){const r=Br(e),a=i[r]=i[r]||[],l=null==e?0:"string"==typeof e?1:e.length,c=t>0,u={...n,isVirtual:c,keyTail:t,keyLength:l,extractKey:Sr(e),unique:!c&&n.unique};if(a.push(u),u.isPrimaryKey||s.push(u),l>1){o(2===l?e[0]:e.slice(0,l-1),t+1,n)}return a.sort(((e,t)=>e.keyTail-t.keyTail)),u}const a=o(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[a];for(const e of r.indexes)o(e.keyPath,0,e);function l(t){const n=t.query.index;return n.isVirtual?{...t,query:{index:n,range:(r=t.query.range,i=n.keyTail,{type:1===r.type?2:r.type,lower:ei(r.lower,r.lowerOpen?e.MAX_KEY:e.MIN_KEY,i),lowerOpen:!0,upper:ei(r.upper,r.upperOpen?e.MIN_KEY:e.MAX_KEY,i),upperOpen:!0})}}:t;var r,i}const c={...n,schema:{...r,primaryKey:a,indexes:s,getIndexByKeyPath:function(e){const t=i[Br(e)];return t&&t[0]}},count:e=>n.count(l(e)),query:e=>n.query(l(e)),openCursor(t){const{keyTail:r,isVirtual:i,keyLength:s}=t.query.index;if(!i)return n.openCursor(t);return n.openCursor(l(t)).then((n=>n&&function(n){const i=Object.create(n,{continue:{value:function(i){null!=i?n.continue(ei(i,t.reverse?e.MAX_KEY:e.MIN_KEY,r)):t.unique?n.continue(n.key.slice(0,s).concat(t.reverse?e.MIN_KEY:e.MAX_KEY,r)):n.continue()}},continuePrimaryKey:{value(t,i){n.continuePrimaryKey(ei(t,e.MAX_KEY,r),i)}},primaryKey:{get:()=>n.primaryKey},key:{get(){const e=n.key;return 1===s?e[0]:e.slice(0,s)}},value:{get:()=>n.value}});return i}(n)))}};return c}}}};function ni(e,t,n,r){return n=n||{},r=r||"",we(e).forEach((i=>{if($e(t,i)){var s=e[i],o=t[i];if("object"==typeof s&&"object"==typeof o&&s&&o){const e=He(s);e!==He(o)?n[r+i]=t[i]:"Object"===e?ni(s,o,n,r+i+"."):s!==o&&(n[r+i]=t[i])}else s!==o&&(n[r+i]=t[i])}else n[r+i]=void 0})),we(t).forEach((i=>{$e(e,i)||(n[r+i]=t[i])})),n}const ri={stack:"dbcore",name:"HooksMiddleware",level:2,create:e=>({...e,table(t){const n=e.table(t),{primaryKey:r}=n.schema,i={...n,mutate(e){const i=Ut.trans,{deleting:s,creating:o,updating:a}=i.table(t).hook;switch(e.type){case"add":if(o.fire===vt)break;return i._promise("readwrite",(()=>l(e)),!0);case"put":if(o.fire===vt&&a.fire===vt)break;return i._promise("readwrite",(()=>l(e)),!0);case"delete":if(s.fire===vt)break;return i._promise("readwrite",(()=>l(e)),!0);case"deleteRange":if(s.fire===vt)break;return i._promise("readwrite",(()=>function(e){return c(e.trans,e.range,1e4)}(e)),!0)}return n.mutate(e);function l(e){const t=Ut.trans,i=e.keys||function(e,t){return"delete"===t.type?t.keys:t.keys||t.values.map(e.extractKey)}(r,e);if(!i)throw new Error("Keys missing");return"delete"!==(e="add"===e.type||"put"===e.type?{...e,keys:i}:{...e}).type&&(e.values=[...e.values]),e.keys&&(e.keys=[...e.keys]),function(e,t,n){return"add"===t.type?Promise.resolve([]):e.getMany({trans:t.trans,keys:n,cache:"immutable"})}(n,e,i).then((l=>{const c=i.map(((n,i)=>{const c=l[i],u={onerror:null,onsuccess:null};if("delete"===e.type)s.fire.call(u,n,c,t);else if("add"===e.type||void 0===c){const s=o.fire.call(u,n,e.values[i],t);null==n&&null!=s&&(n=s,e.keys[i]=n,r.outbound||Re(e.values[i],r.keyPath,n))}else{const r=ni(c,e.values[i]),s=a.fire.call(u,r,n,c,t);if(s){const t=e.values[i];Object.keys(s).forEach((e=>{$e(t,e)?t[e]=s[e]:Re(t,e,s[e])}))}}return u}));return n.mutate(e).then((({failures:t,results:n,numFailures:r,lastResult:s})=>{for(let r=0;r<i.length;++r){const s=n?n[r]:i[r],o=c[r];null==s?o.onerror&&o.onerror(t[r]):o.onsuccess&&o.onsuccess("put"===e.type&&l[r]?e.values[r]:s)}return{failures:t,results:n,numFailures:r,lastResult:s}})).catch((e=>(c.forEach((t=>t.onerror&&t.onerror(e))),Promise.reject(e))))}))}function c(e,t,i){return n.query({trans:e,values:!1,query:{index:r,range:t},limit:i}).then((({result:n})=>l({type:"delete",keys:n,trans:e}).then((r=>r.numFailures>0?Promise.reject(r.failures[0]):n.length<i?{failures:[],numFailures:0,lastResult:void 0}:c(e,{...t,lower:n[n.length-1],lowerOpen:!0},i)))))}}};return i}})};function ii(e,t,n){try{if(!t)return null;if(t.keys.length<e.length)return null;const r=[];for(let i=0,s=0;i<t.keys.length&&s<e.length;++i)0===or(t.keys[i],e[s])&&(r.push(n?We(t.values[i]):t.values[i]),++s);return r.length===e.length?r:null}catch(e){return null}}const si={stack:"dbcore",level:-1,create:e=>({table:t=>{const n=e.table(t);return{...n,getMany:e=>{if(!e.cache)return n.getMany(e);const t=ii(e.keys,e.trans._cache,"clone"===e.cache);return t?Ht.resolve(t):n.getMany(e).then((t=>(e.trans._cache={keys:e.keys,values:"clone"===e.cache?We(t):t},t)))},mutate:e=>("add"!==e.type&&(e.trans._cache=null),n.mutate(e))}}})};function oi(e){return!("from"in e)}const ai=function(e,t){if(!this){const t=new ai;return e&&"d"in e&&_e(t,e),t}_e(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0})};function li(e,t,n){const r=or(t,n);if(isNaN(r))return;if(r>0)throw RangeError();if(oi(e))return _e(e,{from:t,to:n,d:1});const i=e.l,s=e.r;if(or(n,e.from)<0)return i?li(i,t,n):e.l={from:t,to:n,d:1,l:null,r:null},hi(e);if(or(t,e.to)>0)return s?li(s,t,n):e.r={from:t,to:n,d:1,l:null,r:null},hi(e);or(t,e.from)<0&&(e.from=t,e.l=null,e.d=s?s.d+1:1),or(n,e.to)>0&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1);const o=!e.r;i&&!e.l&&ci(e,i),s&&o&&ci(e,s)}function ci(e,t){oi(t)||function e(t,{from:n,to:r,l:i,r:s}){li(t,n,r),i&&e(t,i),s&&e(t,s)}(e,t)}function ui(e){let t=oi(e)?null:{s:0,n:e};return{next(e){const n=arguments.length>0;for(;t;)switch(t.s){case 0:if(t.s=1,n)for(;t.n.l&&or(e,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!n||or(e,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function hi(e){var t,n;const r=((null===(t=e.r)||void 0===t?void 0:t.d)||0)-((null===(n=e.l)||void 0===n?void 0:n.d)||0),i=r>1?"r":r<-1?"l":"";if(i){const t="r"===i?"l":"r",n={...e},r=e[i];e.from=r.from,e.to=r.to,e[i]=r[i],n[i]=r[t],e[t]=n,n.d=fi(n)}e.d=fi(e)}function fi({r:e,l:t}){return(e?t?Math.max(e.d,t.d):e.d:t?t.d:0)+1}Ae(ai.prototype,{add(e){return ci(this,e),this},addKey(e){return li(this,e,e),this},addKeys(e){return e.forEach((e=>li(this,e,e))),this},[Ge](){return ui(this)}});const di={stack:"dbcore",level:0,create:e=>{const t=e.schema.name,n=new ai(e.MIN_KEY,e.MAX_KEY);return{...e,table:r=>{const i=e.table(r),{schema:s}=i,{primaryKey:o}=s,{extractKey:a,outbound:l}=o,c={...i,mutate:e=>{const o=e.trans,a=o.mutatedParts||(o.mutatedParts={}),l=e=>{const n=`idb://${t}/${r}/${e}`;return a[n]||(a[n]=new ai)},c=l(""),u=l(":dels"),{type:h}=e;let[f,d]="deleteRange"===e.type?[e.range]:"delete"===e.type?[e.keys]:e.values.length<50?[[],e.values]:[];const p=e.trans._cache;return i.mutate(e).then((e=>{if(xe(f)){"delete"!==h&&(f=e.results),c.addKeys(f);const t=ii(f,p);t||"add"===h||u.addKeys(f),(t||d)&&function(e,t,n,r){function i(t){const i=e(t.name||"");function s(e){return null!=e?t.extractKey(e):null}const o=e=>t.multiEntry&&xe(e)?e.forEach((e=>i.addKey(e))):i.addKey(e);(n||r).forEach(((e,t)=>{const i=n&&s(n[t]),a=r&&s(r[t]);0!==or(i,a)&&(null!=i&&o(i),null!=a&&o(a))}))}t.indexes.forEach(i)}(l,s,t,d)}else if(f){const e={from:f.lower,to:f.upper};u.add(e),c.add(e)}else c.add(n),u.add(n),s.indexes.forEach((e=>l(e.name).add(n)));return e}))}},u=({query:{index:t,range:n}})=>{var r,i;return[t,new ai(null!==(r=n.lower)&&void 0!==r?r:e.MIN_KEY,null!==(i=n.upper)&&void 0!==i?i:e.MAX_KEY)]},h={get:e=>[o,new ai(e.key)],getMany:e=>[o,(new ai).addKeys(e.keys)],count:u,query:u,openCursor:u};return we(h).forEach((e=>{c[e]=function(s){const{subscr:o}=Ut;if(o){const c=e=>{const n=`idb://${t}/${r}/${e}`;return o[n]||(o[n]=new ai)},u=c(""),f=c(":dels"),[d,p]=h[e](s);if(c(d.name||"").add(p),!d.isPrimaryKey){if("count"!==e){const t="query"===e&&l&&s.values&&i.query({...s,values:!1});return i[e].apply(this,arguments).then((n=>{if("query"===e){if(l&&s.values)return t.then((({result:e})=>(u.addKeys(e),n)));const e=s.values?n.result.map(a):n.result;s.values?u.addKeys(e):f.addKeys(e)}else if("openCursor"===e){const e=n,t=s.values;return e&&Object.create(e,{key:{get:()=>(f.addKey(e.primaryKey),e.key)},primaryKey:{get(){const t=e.primaryKey;return f.addKey(t),t}},value:{get:()=>(t&&u.addKey(e.primaryKey),e.value)}})}return n}))}f.add(n)}}return i[e].apply(this,arguments)}})),c}}}};class pi{constructor(e,t){this._middlewares={},this.verno=0;const n=pi.dependencies;this._options=t={addons:pi.addons,autoOpen:!0,indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange,...t},this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange};const{addons:r}=t;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const i={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:vt,dbReadyPromise:null,cancelOpen:vt,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};i.dbReadyPromise=new Ht((e=>{i.dbReadyResolve=e})),i.openCanceller=new Ht(((e,t)=>{i.cancelOpen=t})),this._state=i,this.name=e,this.on=Qn(this,"populate","blocked","versionchange","close",{ready:[Nt,vt]}),this.on.ready.subscribe=Fe(this.on.ready.subscribe,(e=>(t,n)=>{pi.vip((()=>{const r=this._state;if(r.openComplete)r.dbOpenError||Ht.resolve().then(t),n&&e(t);else if(r.onReadyBeingFired)r.onReadyBeingFired.push(t),n&&e(t);else{e(t);const r=this;n||e((function e(){r.on.ready.unsubscribe(t),r.on.ready.unsubscribe(e)}))}}))})),this.Collection=function(e){return Jn(cr.prototype,(function(t,n){this.db=e;let r=Yn,i=null;if(n)try{r=n()}catch(e){i=e}const s=t._ctx,o=s.table,a=o.hook.reading.fire;this._ctx={table:o,index:s.index,isPrimKey:!s.index||o.schema.primKey.keyPath&&s.index===o.schema.primKey.name,range:r,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:i,or:s.or,valueMapper:a!==wt?a:null}}))}(this),this.Table=function(e){return Jn(Gn.prototype,(function(t,n,r){this.db=e,this._tx=r,this.name=t,this.schema=n,this.hook=e._allTables[t]?e._allTables[t].hook:Qn(null,{creating:[kt,vt],reading:[xt,wt],updating:[$t,vt],deleting:[Et,vt]})}))}(this),this.Transaction=function(e){return Jn($r.prototype,(function(t,n,r,i,s){this.db=e,this.mode=t,this.storeNames=n,this.schema=r,this.chromeTransactionDurability=i,this.idbtrans=null,this.on=Qn(this,"complete","error","abort"),this.parent=s||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Ht(((e,t)=>{this._resolve=e,this._reject=t})),this._completion.then((()=>{this.active=!1,this.on.complete.fire()}),(e=>{var t=this.active;return this.active=!1,this.on.error.fire(e),this.parent?this.parent._reject(e):t&&this.idbtrans&&this.idbtrans.abort(),Tn(e)}))}))}(this),this.Version=function(e){return Jn(Ur.prototype,(function(t){this.db=e,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}}))}(this),this.WhereClause=function(e){return Jn(vr.prototype,(function(t,n,r){this.db=e,this._ctx={table:t,index:":id"===n?null:n,or:r};const i=e._deps.indexedDB;if(!i)throw new gt.MissingAPI;this._cmp=this._ascending=i.cmp.bind(i),this._descending=(e,t)=>i.cmp(t,e),this._max=(e,t)=>i.cmp(e,t)>0?e:t,this._min=(e,t)=>i.cmp(e,t)<0?e:t,this._IDBKeyRange=e._deps.IDBKeyRange}))}(this),this.on("versionchange",(e=>{e.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()})),this.on("blocked",(e=>{!e.newVersion||e.newVersion<e.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${e.oldVersion/10}`)})),this._maxKey=Pr(t.IDBKeyRange),this._createTransaction=(e,t,n,r)=>new this.Transaction(e,t,n,this._options.chromeTransactionDurability,r),this._fireOnBlocked=e=>{this.on("blocked").fire(e),Rn.filter((e=>e.name===this.name&&e!==this&&!e._state.vcFired)).map((t=>t.on("versionchange").fire(e)))},this.use(ti),this.use(ri),this.use(di),this.use(si),this.vip=Object.create(this,{_vip:{value:!0}}),r.forEach((e=>e(this)))}version(e){if(isNaN(e)||e<.1)throw new gt.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new gt.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);const t=this._versions;var n=t.filter((t=>t._cfg.version===e))[0];return n||(n=new this.Version(e),t.push(n),t.sort(Kr),n.stores({}),this._state.autoSchema=!1,n)}_whenReady(e){return this.idbdb&&(this._state.openComplete||Ut.letThrough||this._vip)?e():new Ht(((e,t)=>{if(this._state.openComplete)return t(new gt.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void t(new gt.DatabaseClosed);this.open().catch(vt)}this._state.dbReadyPromise.then(e,t)})).then(e)}use({stack:e,create:t,level:n,name:r}){r&&this.unuse({stack:e,name:r});const i=this._middlewares[e]||(this._middlewares[e]=[]);return i.push({stack:e,create:t,level:null==n?10:n,name:r}),i.sort(((e,t)=>e.level-t.level)),this}unuse({stack:e,name:t,create:n}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter((e=>n?e.create!==n:!!t&&e.name!==t))),this}open(){return Gr(this)}_close(){const e=this._state,t=Rn.indexOf(this);if(t>=0&&Rn.splice(t,1),this.idbdb){try{this.idbdb.close()}catch(e){}this._novip.idbdb=null}e.dbReadyPromise=new Ht((t=>{e.dbReadyResolve=t})),e.openCanceller=new Ht(((t,n)=>{e.cancelOpen=n}))}close(){this._close();const e=this._state;this._options.autoOpen=!1,e.dbOpenError=new gt.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){const e=arguments.length>0,t=this._state;return new Ht(((n,r)=>{const i=()=>{this.close();var e=this._deps.indexedDB.deleteDatabase(this.name);e.onsuccess=hn((()=>{!function({indexedDB:e,IDBKeyRange:t},n){!Xr(e)&&n!==Vn&&Wr(e,t).delete(n).catch(vt)}(this._deps,this.name),n()})),e.onerror=wr(r),e.onblocked=this._fireOnBlocked};if(e)throw new gt.InvalidArgument("Arguments not allowed in db.delete()");t.isBeingOpened?t.dbReadyPromise.then(i):i()}))}backendDB(){return this.idbdb}isOpen(){return null!==this.idbdb}hasBeenClosed(){const e=this._state.dbOpenError;return e&&"DatabaseClosed"===e.name}hasFailed(){return null!==this._state.dbOpenError}dynamicallyOpened(){return this._state.autoSchema}get tables(){return we(this._allTables).map((e=>this._allTables[e]))}transaction(){const e=Jr.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,t,n){let r=Ut.trans;r&&r.db===this&&-1===e.indexOf("!")||(r=null);const i=-1!==e.indexOf("?");let s,o;e=e.replace("!","").replace("?","");try{if(o=t.map((e=>{var t=e instanceof this.Table?e.name:e;if("string"!=typeof t)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return t})),"r"==e||e===Un)s=Un;else{if("rw"!=e&&e!=Wn)throw new gt.InvalidArgument("Invalid transaction mode: "+e);s=Wn}if(r){if(r.mode===Un&&s===Wn){if(!i)throw new gt.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");r=null}r&&o.forEach((e=>{if(r&&-1===r.storeNames.indexOf(e)){if(!i)throw new gt.SubTransaction("Table "+e+" not included in parent transaction.");r=null}})),i&&r&&!r.active&&(r=null)}}catch(e){return r?r._promise(null,((t,n)=>{n(e)})):Tn(e)}const a=Zr.bind(null,this,s,o,r,n);return r?r._promise(s,a,"lock"):Ut.trans?An(Ut.transless,(()=>this._whenReady(a))):this._whenReady(a)}table(e){if(!$e(this._allTables,e))throw new gt.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}}const mi="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable";class gi{constructor(e){this._subscribe=e}subscribe(e,t,n){return this._subscribe(e&&"function"!=typeof e?e:{next:e,error:t,complete:n})}[mi](){return this}}function yi(e,t){return we(t).forEach((n=>{ci(e[n]||(e[n]=new ai),t[n])})),e}function bi(e){return new gi((t=>{const n=et(e);let r=!1,i={},s={};const o={get closed(){return r},unsubscribe:()=>{r=!0,Er.storagemutated.unsubscribe(u)}};t.start&&t.start(o);let a=!1,l=!1;function c(){return we(s).some((e=>i[e]&&function(e,t){const n=ui(t);let r=n.next();if(r.done)return!1;let i=r.value;const s=ui(e);let o=s.next(i.from),a=o.value;for(;!r.done&&!o.done;){if(or(a.from,i.to)<=0&&or(a.to,i.from)>=0)return!0;or(i.from,a.from)<0?i=(r=n.next(a.from)).value:a=(o=s.next(i.from)).value}return!1}(i[e],s[e])))}const u=e=>{yi(i,e),c()&&h()},h=()=>{if(a||r)return;i={};const f={},d=function(t){n&&vn();const r=()=>bn(e,{subscr:t,trans:null}),i=Ut.trans?An(Ut.transless,r):r();return n&&i.then(wn,wn),i}(f);l||(Er(_r,u),l=!0),a=!0,Promise.resolve(d).then((e=>{a=!1,r||(c()?h():(i={},s=f,t.next&&t.next(e)))}),(e=>{a=!1,t.error&&t.error(e),o.unsubscribe()}))};return h(),o}))}let vi;try{vi={indexedDB:ve.indexedDB||ve.mozIndexedDB||ve.webkitIndexedDB||ve.msIndexedDB,IDBKeyRange:ve.IDBKeyRange||ve.webkitIDBKeyRange}}catch(e){vi={indexedDB:null,IDBKeyRange:null}}const wi=pi;function xi(e){let t=_i;try{_i=!0,Er.storagemutated.fire(e)}finally{_i=t}}Ae(wi,{...bt,delete:e=>new wi(e,{addons:[]}).delete(),exists:e=>new wi(e,{addons:[]}).open().then((e=>(e.close(),!0))).catch("NoSuchDatabaseError",(()=>!1)),getDatabaseNames(e){try{return function({indexedDB:e,IDBKeyRange:t}){return Xr(e)?Promise.resolve(e.databases()).then((e=>e.map((e=>e.name)).filter((e=>e!==Vn)))):Wr(e,t).toCollection().primaryKeys()}(wi.dependencies).then(e)}catch(e){return Tn(new gt.MissingAPI)}},defineClass:()=>function(e){_e(this,e)},ignoreTransaction:e=>Ut.trans?An(Ut.transless,e):e(),vip:Yr,async:function(e){return function(){try{var t=Qr(e.apply(this,arguments));return t&&"function"==typeof t.then?t:Ht.resolve(t)}catch(e){return Tn(e)}}},spawn:function(e,t,n){try{var r=Qr(e.apply(n,t||[]));return r&&"function"==typeof r.then?r:Ht.resolve(r)}catch(e){return Tn(e)}},currentTransaction:{get:()=>Ut.trans||null},waitFor:function(e,t){const n=Ht.resolve("function"==typeof e?wi.ignoreTransaction(e):e).timeout(t||6e4);return Ut.trans?Ut.trans.waitFor(n):n},Promise:Ht,debug:{get:()=>tt,set:e=>{nt(e,"dexie"===e?()=>!0:qn)}},derive:Pe,extend:_e,props:Ae,override:Fe,Events:Qn,on:Er,liveQuery:bi,extendObservabilitySet:yi,getByKeyPath:Ke,setByKeyPath:Re,delByKeyPath:function(e,t){"string"==typeof t?Re(e,t,void 0):"length"in t&&[].map.call(t,(function(t){Re(e,t,void 0)}))},shallowClone:Me,deepClone:We,getObjectDiff:ni,cmp:or,asap:De,minKey:Dn,addons:[],connections:Rn,errnames:pt,dependencies:vi,semVer:Fn,version:Fn.split(".").map((e=>parseInt(e))).reduce(((e,t,n)=>e+t/Math.pow(10,2*n)))}),wi.maxKey=Pr(wi.dependencies.IDBKeyRange),"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(Er(_r,(e=>{if(!_i){let t;Mn?(t=document.createEvent("CustomEvent"),t.initCustomEvent(kr,!0,!0,e)):t=new CustomEvent(kr,{detail:e}),_i=!0,dispatchEvent(t),_i=!1}})),addEventListener(kr,(({detail:e})=>{_i||xi(e)})));let _i=!1;if("undefined"!=typeof BroadcastChannel){const e=new BroadcastChannel(kr);Er(_r,(t=>{_i||e.postMessage(t)})),e.onmessage=e=>{e.data&&xi(e.data)}}else if("undefined"!=typeof self&&"undefined"!=typeof navigator){Er(_r,(e=>{try{_i||("undefined"!=typeof localStorage&&localStorage.setItem(kr,JSON.stringify({trig:Math.random(),changedParts:e})),"object"==typeof self.clients&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach((t=>t.postMessage({type:kr,changedParts:e}))))}catch(e){}})),"undefined"!=typeof addEventListener&&addEventListener("storage",(e=>{if(e.key===kr){const t=JSON.parse(e.newValue);t&&xi(t.changedParts)}}));const e=self.document&&navigator.serviceWorker;e&&e.addEventListener("message",(function({data:e}){e&&e.type===kr&&xi(e.changedParts)}))}Ht.rejectionMapper=function(e,t){if(!e||e instanceof ut||e instanceof TypeError||e instanceof SyntaxError||!e.name||!yt[e.name])return e;var n=new yt[e.name](t||e.message,e);return"stack"in e&&Oe(n,"stack",{get:function(){return this.inner.stack}}),n},nt(tt,qn);const ki=new class extends pi{constructor(){super("bookDB"),this.version(2).stores({books:"++id, meta, contents, files"})}};var Ei={},$i={};!function(e){const t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",n="["+t+"][:A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*",r=new RegExp("^"+n+"$");e.isExist=function(e){return void 0!==e},e.isEmptyObject=function(e){return 0===Object.keys(e).length},e.merge=function(e,t,n){if(t){const r=Object.keys(t),i=r.length;for(let s=0;s<i;s++)e[r[s]]="strict"===n?[t[r[s]]]:t[r[s]]}},e.getValue=function(t){return e.isExist(t)?t:""},e.isName=function(e){const t=r.exec(e);return!(null==t)},e.getAllMatches=function(e,t){const n=[];let r=t.exec(e);for(;r;){const i=[];i.startIndex=t.lastIndex-r[0].length;const s=r.length;for(let e=0;e<s;e++)i.push(r[e]);n.push(i),r=t.exec(e)}return n},e.nameRegexp=n}($i);const Ai=$i,Ni={allowBooleanAttributes:!1,unpairedTags:[]};function Oi(e){return" "===e||"\t"===e||"\n"===e||"\r"===e}function Pi(e,t){const n=t;for(;t<e.length;t++)if("?"!=e[t]&&" "!=e[t]);else{const r=e.substr(n,t-n);if(t>5&&"xml"===r)return ji("InvalidXml","XML declaration allowed only at the start of the document.",Ii(e,t));if("?"==e[t]&&">"==e[t+1]){t++;break}}return t}function Si(e,t){if(e.length>t+5&&"-"===e[t+1]&&"-"===e[t+2]){for(t+=3;t<e.length;t++)if("-"===e[t]&&"-"===e[t+1]&&">"===e[t+2]){t+=2;break}}else if(e.length>t+8&&"D"===e[t+1]&&"O"===e[t+2]&&"C"===e[t+3]&&"T"===e[t+4]&&"Y"===e[t+5]&&"P"===e[t+6]&&"E"===e[t+7]){let n=1;for(t+=8;t<e.length;t++)if("<"===e[t])n++;else if(">"===e[t]&&(n--,0===n))break}else if(e.length>t+9&&"["===e[t+1]&&"C"===e[t+2]&&"D"===e[t+3]&&"A"===e[t+4]&&"T"===e[t+5]&&"A"===e[t+6]&&"["===e[t+7])for(t+=8;t<e.length;t++)if("]"===e[t]&&"]"===e[t+1]&&">"===e[t+2]){t+=2;break}return t}Ei.validate=function(e,t){t=Object.assign({},Ni,t);const n=[];let r=!1,i=!1;"\ufeff"===e[0]&&(e=e.substr(1));for(let o=0;o<e.length;o++)if("<"===e[o]&&"?"===e[o+1]){if(o+=2,o=Pi(e,o),o.err)return o}else{if("<"!==e[o]){if(Oi(e[o]))continue;return ji("InvalidChar","char '"+e[o]+"' is not expected.",Ii(e,o))}{let a=o;if(o++,"!"===e[o]){o=Si(e,o);continue}{let l=!1;"/"===e[o]&&(l=!0,o++);let c="";for(;o<e.length&&">"!==e[o]&&" "!==e[o]&&"\t"!==e[o]&&"\n"!==e[o]&&"\r"!==e[o];o++)c+=e[o];if(c=c.trim(),"/"===c[c.length-1]&&(c=c.substring(0,c.length-1),o--),s=c,!Ai.isName(s)){let t;return t=0===c.trim().length?"Invalid space after '<'.":"Tag '"+c+"' is an invalid name.",ji("InvalidTag",t,Ii(e,o))}const u=Ci(e,o);if(!1===u)return ji("InvalidAttr","Attributes for '"+c+"' have open quote.",Ii(e,o));let h=u.value;if(o=u.index,"/"===h[h.length-1]){const n=o-h.length;h=h.substring(0,h.length-1);const i=Bi(h,t);if(!0!==i)return ji(i.err.code,i.err.msg,Ii(e,n+i.err.line));r=!0}else if(l){if(!u.tagClosed)return ji("InvalidTag","Closing tag '"+c+"' doesn't have proper closing.",Ii(e,o));if(h.trim().length>0)return ji("InvalidTag","Closing tag '"+c+"' can't have attributes or invalid starting.",Ii(e,a));{const t=n.pop();if(c!==t.tagName){let n=Ii(e,t.tagStartPos);return ji("InvalidTag","Expected closing tag '"+t.tagName+"' (opened in line "+n.line+", col "+n.col+") instead of closing tag '"+c+"'.",Ii(e,a))}0==n.length&&(i=!0)}}else{const s=Bi(h,t);if(!0!==s)return ji(s.err.code,s.err.msg,Ii(e,o-h.length+s.err.line));if(!0===i)return ji("InvalidXml","Multiple possible root nodes found.",Ii(e,o));-1!==t.unpairedTags.indexOf(c)||n.push({tagName:c,tagStartPos:a}),r=!0}for(o++;o<e.length;o++)if("<"===e[o]){if("!"===e[o+1]){o++,o=Si(e,o);continue}if("?"!==e[o+1])break;if(o=Pi(e,++o),o.err)return o}else if("&"===e[o]){const t=Fi(e,o);if(-1==t)return ji("InvalidChar","char '&' is not expected.",Ii(e,o));o=t}else if(!0===i&&!Oi(e[o]))return ji("InvalidXml","Extra text at the end",Ii(e,o));"<"===e[o]&&o--}}}var s;return r?1==n.length?ji("InvalidTag","Unclosed tag '"+n[0].tagName+"'.",Ii(e,n[0].tagStartPos)):!(n.length>0)||ji("InvalidXml","Invalid '"+JSON.stringify(n.map((e=>e.tagName)),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):ji("InvalidXml","Start tag expected.",1)};function Ci(e,t){let n="",r="",i=!1;for(;t<e.length;t++){if('"'===e[t]||"'"===e[t])""===r?r=e[t]:r!==e[t]||(r="");else if(">"===e[t]&&""===r){i=!0;break}n+=e[t]}return""===r&&{value:n,index:t,tagClosed:i}}const Ti=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function Bi(e,t){const n=Ai.getAllMatches(e,Ti),r={};for(let e=0;e<n.length;e++){if(0===n[e][1].length)return ji("InvalidAttr","Attribute '"+n[e][2]+"' has no space in starting.",Ki(n[e]));if(void 0!==n[e][3]&&void 0===n[e][4])return ji("InvalidAttr","Attribute '"+n[e][2]+"' is without value.",Ki(n[e]));if(void 0===n[e][3]&&!t.allowBooleanAttributes)return ji("InvalidAttr","boolean attribute '"+n[e][2]+"' is not allowed.",Ki(n[e]));const i=n[e][2];if(!Di(i))return ji("InvalidAttr","Attribute '"+i+"' is an invalid name.",Ki(n[e]));if(r.hasOwnProperty(i))return ji("InvalidAttr","Attribute '"+i+"' is repeated.",Ki(n[e]));r[i]=1}return!0}function Fi(e,t){if(";"===e[++t])return-1;if("#"===e[t])return function(e,t){let n=/\d/;for("x"===e[t]&&(t++,n=/[\da-fA-F]/);t<e.length;t++){if(";"===e[t])return t;if(!e[t].match(n))break}return-1}(e,++t);let n=0;for(;t<e.length;t++,n++)if(!(e[t].match(/\w/)&&n<20)){if(";"===e[t])break;return-1}return t}function ji(e,t,n){return{err:{code:e,msg:t,line:n.line||n,col:n.col}}}function Di(e){return Ai.isName(e)}function Ii(e,t){const n=e.substring(0,t).split(/\r?\n/);return{line:n.length,col:n[n.length-1].length+1}}function Ki(e){return e.startIndex+e[1].length}var Ri={};const Mi={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0},tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1};Ri.buildOptions=function(e){return Object.assign({},Mi,e)},Ri.defaultOptions=Mi;var Li=class{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){this.child.push({[e]:t})}addChild(e){e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}};const zi=RegExp("^\\s([a-zA-z0-0]+)[ \t](['\"])([^&]+)\\2");function qi(e,t){const n=zi.exec(e);n&&(t[n[1]]={regx:RegExp(`&${n[1]};`,"g"),val:n[3]})}var Vi=function(e,t){const n={};if("O"!==e[t+3]||"C"!==e[t+4]||"T"!==e[t+5]||"Y"!==e[t+6]||"P"!==e[t+7]||"E"!==e[t+8])throw new Error("Invalid Tag instead of DOCTYPE");{t+=9;let r=1,i=!1,s=!1,o=!1,a="";for(;t<e.length;t++)if("<"===e[t]){if(i&&"!"===e[t+1]&&"E"===e[t+2]&&"N"===e[t+3]&&"T"===e[t+4]&&"I"===e[t+5]&&"T"===e[t+6]&&"Y"===e[t+7])t+=7,s=!0;else if(i&&"!"===e[t+1]&&"E"===e[t+2]&&"L"===e[t+3]&&"E"===e[t+4]&&"M"===e[t+5]&&"E"===e[t+6]&&"N"===e[t+7]&&"T"===e[t+8])t+=8;else{if("!"!==e[t+1]||"-"!==e[t+2]||"-"!==e[t+3])throw new Error("Invalid DOCTYPE");o=!0}r++,a=""}else if(">"===e[t]){if(o){if("-"!==e[t-1]||"-"!==e[t-2])throw new Error("Invalid XML comment in DOCTYPE");o=!1}else s&&(qi(a,n),s=!1);if(r--,0===r)break}else"["===e[t]?i=!0:a+=e[t];if(0!==r)throw new Error("Unclosed DOCTYPE")}return{entities:n,i:t}};const Ui=/^[-+]?0x[a-fA-F0-9]+$/,Wi=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const Xi={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};const Yi=$i,Hi=Li,Gi=Vi,Qi=function(e,t={}){if(t=Object.assign({},Xi,t),!e||"string"!=typeof e)return e;let n=e.trim();if(void 0!==t.skipLike&&t.skipLike.test(n))return e;if(t.hex&&Ui.test(n))return Number.parseInt(n,16);{const r=Wi.exec(n);if(r){const i=r[1],s=r[2];let o=function(e){if(e&&-1!==e.indexOf("."))return"."===(e=e.replace(/0+$/,""))?e="0":"."===e[0]?e="0"+e:"."===e[e.length-1]&&(e=e.substr(0,e.length-1)),e;return e}(r[3]);const a=r[4]||r[6];if(!t.leadingZeros&&s.length>0&&i&&"."!==n[2])return e;if(!t.leadingZeros&&s.length>0&&!i&&"."!==n[1])return e;{const r=Number(n),l=""+r;return-1!==l.search(/[eE]/)||a?t.eNotation?r:e:-1!==n.indexOf(".")?"0"===l&&""===o||l===o||i&&l==="-"+o?r:e:s?o===l||i+o===l?r:e:n===l||n===i+l?r:e}}return e}};"<((!\\[CDATA\\[([\\s\\S]*?)(]]>))|((NAME:)?(NAME))([^>]*)>|((\\/)(NAME)\\s*>))([^<]*)".replace(/NAME/g,Yi.nameRegexp);function Ji(e){const t=Object.keys(e);for(let n=0;n<t.length;n++){const r=t[n];this.lastEntities[r]={regex:new RegExp("&"+r+";","g"),val:e[r]}}}function Zi(e,t,n,r,i,s,o){if(void 0!==e&&(this.options.trimValues&&!r&&(e=e.trim()),e.length>0)){o||(e=this.replaceEntitiesValue(e));const r=this.options.tagValueProcessor(t,e,n,i,s);if(null==r)return e;if(typeof r!=typeof e||r!==e)return r;if(this.options.trimValues)return us(e,this.options.parseTagValue,this.options.numberParseOptions);return e.trim()===e?us(e,this.options.parseTagValue,this.options.numberParseOptions):e}}function es(e){if(this.options.removeNSPrefix){const t=e.split(":"),n="/"===e.charAt(0)?"/":"";if("xmlns"===t[0])return"";2===t.length&&(e=n+t[1])}return e}const ts=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function ns(e,t){if(!this.options.ignoreAttributes&&"string"==typeof e){const n=Yi.getAllMatches(e,ts),r=n.length,i={};for(let e=0;e<r;e++){const r=this.resolveNameSpace(n[e][1]);let s=n[e][4];const o=this.options.attributeNamePrefix+r;if(r.length)if(void 0!==s){this.options.trimValues&&(s=s.trim()),s=this.replaceEntitiesValue(s);const e=this.options.attributeValueProcessor(r,s,t);i[o]=null==e?s:typeof e!=typeof s||e!==s?e:us(s,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(i[o]=!0)}if(!Object.keys(i).length)return;if(this.options.attributesGroupName){const e={};return e[this.options.attributesGroupName]=i,e}return i}}const rs=function(e){e=e.replace(/\r\n?/g,"\n");const t=new Hi("!xml");let n=t,r="",i="";for(let s=0;s<e.length;s++){if("<"===e[s])if("/"===e[s+1]){const t=as(e,">",s,"Closing Tag is not closed.");let o=e.substring(s+2,t).trim();if(this.options.removeNSPrefix){const e=o.indexOf(":");-1!==e&&(o=o.substr(e+1))}n&&(r=this.saveTextToParentTag(r,n,i)),i=i.substr(0,i.lastIndexOf(".")),n=this.tagsNodeStack.pop(),r="",s=t}else if("?"===e[s+1]){let t=ls(e,s,!1,"?>");if(!t)throw new Error("Pi Tag is not closed.");if(r=this.saveTextToParentTag(r,n,i),this.options.ignoreDeclaration&&"?xml"===t.tagName||this.options.ignorePiTags);else{const e=new Hi(t.tagName);e.add(this.options.textNodeName,""),t.tagName!==t.tagExp&&t.attrExpPresent&&(e[":@"]=this.buildAttributesMap(t.tagExp,i)),n.addChild(e)}s=t.closeIndex+1}else if("!--"===e.substr(s+1,3)){const t=as(e,"--\x3e",s+4,"Comment is not closed.");if(this.options.commentPropName){const o=e.substring(s+4,t-2);r=this.saveTextToParentTag(r,n,i),n.add(this.options.commentPropName,[{[this.options.textNodeName]:o}])}s=t}else if("!D"===e.substr(s+1,2)){const t=Gi(e,s);this.docTypeEntities=t.entities,s=t.i}else if("!["===e.substr(s+1,2)){const t=as(e,"]]>",s,"CDATA is not closed.")-2,o=e.substring(s+9,t);if(r=this.saveTextToParentTag(r,n,i),this.options.cdataPropName)n.add(this.options.cdataPropName,[{[this.options.textNodeName]:o}]);else{let e=this.parseTextData(o,n.tagname,i,!0,!1,!0);null==e&&(e=""),n.add(this.options.textNodeName,e)}s=t+2}else{let o=ls(e,s,this.options.removeNSPrefix),a=o.tagName,l=o.tagExp,c=o.attrExpPresent,u=o.closeIndex;n&&r&&"!xml"!==n.tagname&&(r=this.saveTextToParentTag(r,n,i,!1)),a!==t.tagname&&(i+=i?"."+a:a);const h=n;if(h&&-1!==this.options.unpairedTags.indexOf(h.tagname)&&(n=this.tagsNodeStack.pop()),this.isItStopNode(this.options.stopNodes,i,a)){let t="";if(l.length>0&&l.lastIndexOf("/")===l.length-1)s=o.closeIndex;else if(-1!==this.options.unpairedTags.indexOf(a))s=o.closeIndex;else{const n=this.readStopNodeData(e,a,u+1);if(!n)throw new Error(`Unexpected end of ${a}`);s=n.i,t=n.tagContent}const r=new Hi(a);a!==l&&c&&(r[":@"]=this.buildAttributesMap(l,i)),t&&(t=this.parseTextData(t,a,i,!0,c,!0,!0)),i=i.substr(0,i.lastIndexOf(".")),r.add(this.options.textNodeName,t),n.addChild(r)}else{if(l.length>0&&l.lastIndexOf("/")===l.length-1){"/"===a[a.length-1]?(a=a.substr(0,a.length-1),l=a):l=l.substr(0,l.length-1);const e=new Hi(a);a!==l&&c&&(e[":@"]=this.buildAttributesMap(l,i)),i=i.substr(0,i.lastIndexOf(".")),n.addChild(e)}else{const e=new Hi(a);this.tagsNodeStack.push(n),a!==l&&c&&(e[":@"]=this.buildAttributesMap(l,i)),n.addChild(e),n=e}r="",s=u}}else r+=e[s]}return t.child},is=function(e){if(this.options.processEntities){for(let t in this.docTypeEntities){const n=this.docTypeEntities[t];e=e.replace(n.regx,n.val)}for(let t in this.lastEntities){const n=this.lastEntities[t];e=e.replace(n.regex,n.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const n=this.htmlEntities[t];e=e.replace(n.regex,n.val)}}return e};function ss(e,t,n,r){return e&&(void 0===r&&(r=0===Object.keys(t.child).length),void 0!==(e=this.parseTextData(e,t.tagname,n,!1,!!t[":@"]&&0!==Object.keys(t[":@"]).length,r))&&""!==e&&t.add(this.options.textNodeName,e),e=""),e}function os(e,t,n){const r="*."+n;for(const n in e){const i=e[n];if(r===i||t===i)return!0}return!1}function as(e,t,n,r){const i=e.indexOf(t,n);if(-1===i)throw new Error(r);return i+t.length-1}function ls(e,t,n,r=">"){const i=function(e,t,n=">"){let r,i="";for(let s=t;s<e.length;s++){let t=e[s];if(r)t===r&&(r="");else if('"'===t||"'"===t)r=t;else if(t===n[0]){if(!n[1])return{data:i,index:s};if(e[s+1]===n[1])return{data:i,index:s}}else"\t"===t&&(t=" ");i+=t}}(e,t+1,r);if(!i)return;let s=i.data;const o=i.index,a=s.search(/\s/);let l=s,c=!0;if(-1!==a&&(l=s.substr(0,a).replace(/\s\s*$/,""),s=s.substr(a+1)),n){const e=l.indexOf(":");-1!==e&&(l=l.substr(e+1),c=l!==i.data.substr(e+1))}return{tagName:l,tagExp:s,closeIndex:o,attrExpPresent:c}}function cs(e,t,n){const r=n;let i=1;for(;n<e.length;n++)if("<"===e[n])if("/"===e[n+1]){const s=as(e,">",n,`${t} is not closed`);if(e.substring(n+2,s).trim()===t&&(i--,0===i))return{tagContent:e.substring(r,n),i:s};n=s}else{const r=ls(e,n,">");if(r){(r&&r.tagName)===t&&i++,n=r.closeIndex}}}function us(e,t,n){if(t&&"string"==typeof e){const t=e.trim();return"true"===t||"false"!==t&&Qi(e,n)}return Yi.isExist(e)?e:""}var hs=class{constructor(e){this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={amp:{regex:/&(amp|#38|#x26);/g,val:"&"},apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:""},pound:{regex:/&(pound|#163);/g,val:""},yen:{regex:/&(yen|#165);/g,val:""},euro:{regex:/&(euro|#8364);/g,val:""},copyright:{regex:/&(copy|#169);/g,val:""},reg:{regex:/&(reg|#174);/g,val:""},inr:{regex:/&(inr|#8377);/g,val:""}},this.addExternalEntities=Ji,this.parseXml=rs,this.parseTextData=Zi,this.resolveNameSpace=es,this.buildAttributesMap=ns,this.isItStopNode=os,this.replaceEntitiesValue=is,this.readStopNodeData=cs,this.saveTextToParentTag=ss}},fs={};function ds(e,t,n){let r;const i={};for(let s=0;s<e.length;s++){const o=e[s],a=ps(o);let l="";if(l=void 0===n?a:n+"."+a,a===t.textNodeName)void 0===r?r=o[a]:r+=""+o[a];else{if(void 0===a)continue;if(o[a]){let e=ds(o[a],t,l);const n=gs(e,t);o[":@"]?ms(e,o[":@"],l,t):1!==Object.keys(e).length||void 0===e[t.textNodeName]||t.alwaysCreateTextNode?0===Object.keys(e).length&&(t.alwaysCreateTextNode?e[t.textNodeName]="":e=""):e=e[t.textNodeName],void 0!==i[a]&&i.hasOwnProperty(a)?(Array.isArray(i[a])||(i[a]=[i[a]]),i[a].push(e)):t.isArray(a,l,n)?i[a]=[e]:i[a]=e}}}return"string"==typeof r?r.length>0&&(i[t.textNodeName]=r):void 0!==r&&(i[t.textNodeName]=r),i}function ps(e){const t=Object.keys(e);for(let e=0;e<t.length;e++){const n=t[e];if(":@"!==n)return n}}function ms(e,t,n,r){if(t){const i=Object.keys(t),s=i.length;for(let o=0;o<s;o++){const s=i[o];r.isArray(s,n+"."+s,!0,!0)?e[s]=[t[s]]:e[s]=t[s]}}}function gs(e,t){const n=Object.keys(e).length;return!!(0===n||1===n&&e[t.textNodeName])}fs.prettify=function(e,t){return ds(e,t)};const{buildOptions:ys}=Ri,bs=hs,{prettify:vs}=fs,ws=Ei;var xs=class{constructor(e){this.externalEntities={},this.options=ys(e)}parse(e,t){if("string"==typeof e);else{if(!e.toString)throw new Error("XML data is accepted in String or Bytes[] form.");e=e.toString()}if(t){!0===t&&(t={});const n=ws.validate(e,t);if(!0!==n)throw Error(`${n.err.msg}:${n.err.line}:${n.err.col}`)}const n=new bs(this.options);n.addExternalEntities(this.externalEntities);const r=n.parseXml(e);return this.options.preserveOrder||void 0===r?r:vs(r,this.options)}addEntity(e,t){if(-1!==t.indexOf("&"))throw new Error("Entity value can't have '&'");if(-1!==e.indexOf("&")||-1!==e.indexOf(";"))throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");this.externalEntities[e]=t}};function _s(e,t,n,r){let i="",s="";t.format&&t.indentBy.length>0&&(s="\n"+t.indentBy.repeat(r));for(let o=0;o<e.length;o++){const a=e[o],l=ks(a);let c="";if(c=0===n.length?l:`${n}.${l}`,l===t.textNodeName){let e=a[l];$s(c,t)||(e=t.tagValueProcessor(l,e),e=As(e,t)),i+=s+e;continue}if(l===t.cdataPropName){i+=s+`<![CDATA[${a[l][0][t.textNodeName]}]]>`;continue}if(l===t.commentPropName){i+=s+`\x3c!--${a[l][0][t.textNodeName]}--\x3e`;continue}if("?"===l[0]){const e=Es(a[":@"],t),n="?xml"===l?"":s;let r=a[l][0][t.textNodeName];r=0!==r.length?" "+r:"",i+=n+`<${l}${r}${e}?>`;continue}let u=s+`<${l}${Es(a[":@"],t)}`,h=_s(a[l],t,c,r+1);-1!==t.unpairedTags.indexOf(l)?t.suppressUnpairedNode?i+=u+">":i+=u+"/>":h&&0!==h.length||!t.suppressEmptyNode?i+=u+`>${h}${s}</${l}>`:i+=u+"/>"}return i}function ks(e){const t=Object.keys(e);for(let e=0;e<t.length;e++){const n=t[e];if(":@"!==n)return n}}function Es(e,t){let n="";if(e&&!t.ignoreAttributes)for(let r in e){let i=t.attributeValueProcessor(r,e[r]);i=As(i,t),!0===i&&t.suppressBooleanAttributes?n+=` ${r.substr(t.attributeNamePrefix.length)}`:n+=` ${r.substr(t.attributeNamePrefix.length)}="${i}"`}return n}function $s(e,t){let n=(e=e.substr(0,e.length-t.textNodeName.length-1)).substr(e.lastIndexOf(".")+1);for(let r in t.stopNodes)if(t.stopNodes[r]===e||t.stopNodes[r]==="*."+n)return!0;return!1}function As(e,t){if(e&&e.length>0&&t.processEntities)for(let n=0;n<t.entities.length;n++){const r=t.entities[n];e=e.replace(r.regex,r.val)}return e}const Ns=function(e,t){return _s(e,t,"",0)},Os={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[]};function Ps(e){this.options=Object.assign({},Os,e),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=Ks),this.processTextOrObjNode=Cs,this.options.format?(this.indentate=Is,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine=""),this.options.suppressEmptyNode?(this.buildTextNode=Ds,this.buildObjNode=Bs):(this.buildTextNode=Fs,this.buildObjNode=Ts),this.buildTextValNode=Fs,this.buildObjectNode=Ts,this.replaceEntitiesValue=js,this.buildAttrPairStr=Ss}function Ss(e,t){return t=this.options.attributeValueProcessor(e,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&"true"===t?" "+e:" "+e+'="'+t+'"'}function Cs(e,t,n){const r=this.j2x(e,n+1);return void 0!==e[this.options.textNodeName]&&1===Object.keys(e).length?this.buildTextNode(e[this.options.textNodeName],t,r.attrStr,n):this.buildObjNode(r.val,t,r.attrStr,n)}function Ts(e,t,n,r){let i="</"+t+this.tagEndChar,s="";return"?"===t[0]&&(s="?",i=""),n&&-1===e.indexOf("<")?this.indentate(r)+"<"+t+n+s+">"+e+i:!1!==this.options.commentPropName&&t===this.options.commentPropName&&0===s.length?this.indentate(r)+`\x3c!--${e}--\x3e`+this.newLine:this.indentate(r)+"<"+t+n+s+this.tagEndChar+e+this.indentate(r)+i}function Bs(e,t,n,r){return""!==e?this.buildObjectNode(e,t,n,r):"?"===t[0]?this.indentate(r)+"<"+t+n+"?"+this.tagEndChar:this.indentate(r)+"<"+t+n+"/"+this.tagEndChar}function Fs(e,t,n,r){if(!1!==this.options.cdataPropName&&t===this.options.cdataPropName)return this.indentate(r)+`<![CDATA[${e}]]>`+this.newLine;if(!1!==this.options.commentPropName&&t===this.options.commentPropName)return this.indentate(r)+`\x3c!--${e}--\x3e`+this.newLine;{let i=this.options.tagValueProcessor(t,e);return i=this.replaceEntitiesValue(i),""===i&&-1!==this.options.unpairedTags.indexOf(t)?this.options.suppressUnpairedNode?this.indentate(r)+"<"+t+this.tagEndChar:this.indentate(r)+"<"+t+"/"+this.tagEndChar:this.indentate(r)+"<"+t+n+">"+i+"</"+t+this.tagEndChar}}function js(e){if(e&&e.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){const n=this.options.entities[t];e=e.replace(n.regex,n.val)}return e}function Ds(e,t,n,r){return""===e&&-1!==this.options.unpairedTags.indexOf(t)?this.options.suppressUnpairedNode?this.indentate(r)+"<"+t+this.tagEndChar:this.indentate(r)+"<"+t+"/"+this.tagEndChar:""!==e?this.buildTextValNode(e,t,n,r):"?"===t[0]?this.indentate(r)+"<"+t+n+"?"+this.tagEndChar:this.indentate(r)+"<"+t+n+"/"+this.tagEndChar}function Is(e){return this.options.indentBy.repeat(e)}function Ks(e){return!!e.startsWith(this.options.attributeNamePrefix)&&e.substr(this.attrPrefixLen)}Ps.prototype.build=function(e){return this.options.preserveOrder?Ns(e,this.options):(Array.isArray(e)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(e={[this.options.arrayNodeName]:e}),this.j2x(e,0).val)},Ps.prototype.j2x=function(e,t){let n="",r="";for(let i in e)if(void 0===e[i]);else if(null===e[i])"?"===i[0]?r+=this.indentate(t)+"<"+i+"?"+this.tagEndChar:r+=this.indentate(t)+"<"+i+"/"+this.tagEndChar;else if(e[i]instanceof Date)r+=this.buildTextNode(e[i],i,"",t);else if("object"!=typeof e[i]){const s=this.isAttribute(i);if(s)n+=this.buildAttrPairStr(s,""+e[i]);else if(i===this.options.textNodeName){let t=this.options.tagValueProcessor(i,""+e[i]);r+=this.replaceEntitiesValue(t)}else r+=this.buildTextNode(e[i],i,"",t)}else if(Array.isArray(e[i])){const n=e[i].length;for(let s=0;s<n;s++){const n=e[i][s];void 0===n||(null===n?"?"===i[0]?r+=this.indentate(t)+"<"+i+"?"+this.tagEndChar:r+=this.indentate(t)+"<"+i+"/"+this.tagEndChar:r+="object"==typeof n?this.processTextOrObjNode(n,i,t):this.buildTextNode(n,i,"",t))}}else if(this.options.attributesGroupName&&i===this.options.attributesGroupName){const t=Object.keys(e[i]),r=t.length;for(let s=0;s<r;s++)n+=this.buildAttrPairStr(t[s],""+e[i][t[s]])}else r+=this.processTextOrObjNode(e[i],i,t);return{attrStr:n,val:r}};var Rs={XMLParser:xs,XMLValidator:Ei,XMLBuilder:Ps};function Ms(e){return e.arrayBuffer?e.arrayBuffer():new Promise(((t,n)=>{const r=new FileReader;r.addEventListener("loadend",(()=>{t(r.result)})),r.addEventListener("error",n),r.readAsArrayBuffer(e)}))}async function Ls(e){const t=await Ms(e);return new Uint8Array(t)}function zs(e){return"undefined"!=typeof Blob&&e instanceof Blob}function qs(e){return"undefined"!=typeof SharedArrayBuffer&&e instanceof SharedArrayBuffer}const Vs="undefined"!=typeof process&&process.versions&&void 0!==process.versions.node&&void 0===process.versions.electron;class Us{constructor(e){this.typedArray=e instanceof ArrayBuffer||qs(e)?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}async getLength(){return this.typedArray.byteLength}async read(e,t){return new Uint8Array(this.typedArray.buffer,this.typedArray.byteOffset+e,t)}}class Ws{constructor(e){this.blob=e}async getLength(){return this.blob.size}async read(e,t){const n=this.blob.slice(e,e+t),r=await Ms(n);return new Uint8Array(r)}async sliceAsBlob(e,t,n=""){return this.blob.slice(e,e+t,n)}}function Xs(e,t){var n=e.length;if(t<=n)return e;var r=new Uint8Array(Math.max(n<<1,t));return r.set(e,0),r}function Ys(e,t,n,r,i,s){for(var o=Zs,a=to,l=0;l<n;){var c=e[a(r,i)&t];i+=15&c;var u=c>>>4;if(u<=15)s[l]=u,l++;else{var h=0,f=0;16==u?(f=3+o(r,i,2),i+=2,h=s[l-1]):17==u?(f=3+o(r,i,3),i+=3):18==u&&(f=11+o(r,i,7),i+=7);for(var d=l+f;l<d;)s[l]=h,l++}}return i}function Hs(e,t,n,r){for(var i=0,s=0,o=r.length>>>1;s<n;){var a=e[s+t];r[s<<1]=0,r[1+(s<<1)]=a,a>i&&(i=a),s++}for(;s<o;)r[s<<1]=0,r[1+(s<<1)]=0,s++;return i}function Gs(e,t){for(var n,r,i,s,o=e.length,a=no.bl_count,l=0;l<=t;l++)a[l]=0;for(l=1;l<o;l+=2)a[e[l]]++;var c=no.next_code;for(n=0,a[0]=0,r=1;r<=t;r++)n=n+a[r-1]<<1,c[r]=n;for(i=0;i<o;i+=2)0!=(s=e[i+1])&&(e[i]=c[s],c[s]++)}function Qs(e,t,n){for(var r=e.length,i=no.rev15,s=0;s<r;s+=2)if(0!=e[s+1])for(var o=s>>1,a=e[s+1],l=o<<4|a,c=t-a,u=e[s]<<c,h=u+(1<<c);u!=h;){n[i[u]>>>15-t]=l,u++}}function Js(e,t){for(var n=no.rev15,r=15-t,i=0;i<e.length;i+=2){var s=e[i]<<t-e[i+1];e[i]=n[s]>>>r}}function Zs(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<n)-1}function eo(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<n)-1}function to(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)}const no=(ro=Uint16Array,io=Uint32Array,{next_code:new ro(16),bl_count:new ro(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new ro(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new io(32),flmap:new ro(512),fltree:[],fdmap:new ro(32),fdtree:[],lmap:new ro(32768),ltree:[],ttree:[],dmap:new ro(32768),dtree:[],imap:new ro(512),itree:[],rev15:new ro(32768),lhst:new io(286),dhst:new io(30),ihst:new io(19),lits:new io(15e3),strt:new ro(65536),prev:new ro(32768)});var ro,io;!function(){for(var e=0;e<32768;e++){var t=e;t=(4278255360&(t=(4042322160&(t=(3435973836&(t=(2863311530&t)>>>1|(1431655765&t)<<1))>>>2|(858993459&t)<<2))>>>4|(252645135&t)<<4))>>>8|(16711935&t)<<8,no.rev15[e]=(t>>>16|t<<16)>>>17}function n(e,t,n){for(;0!=t--;)e.push(0,n)}for(e=0;e<32;e++)no.ldef[e]=no.of0[e]<<3|no.exb[e],no.ddef[e]=no.df0[e]<<4|no.dxb[e];n(no.fltree,144,8),n(no.fltree,112,9),n(no.fltree,24,7),n(no.fltree,8,8),Gs(no.fltree,9),Qs(no.fltree,9,no.flmap),Js(no.fltree,9),n(no.fdtree,32,5),Gs(no.fdtree,5),Qs(no.fdtree,5,no.fdmap),Js(no.fdtree,5),n(no.itree,19,0),n(no.ltree,286,0),n(no.dtree,30,0),n(no.ttree,320,0)}();const so={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var n=t,r=0;r<8;r++)1&n?n=3988292384^n>>>1:n>>>=1;e[t]=n}return e}(),update:function(e,t,n,r){for(var i=0;i<r;i++)e=so.table[255&(e^t[n+i])]^e>>>8;return e},crc:function(e,t,n){return 4294967295^so.update(4294967295,e,t,n)}};function oo(e,t){return function(e,t){var n=Uint8Array;if(3==e[0]&&0==e[1])return t||new n(0);var r=eo,i=Zs,s=Ys,o=to,a=null==t;a&&(t=new n(e.length>>>2<<3));for(var l,c,u=0,h=0,f=0,d=0,p=0,m=0,g=0,y=0,b=0;0==u;)if(u=r(e,b,1),h=r(e,b+1,2),b+=3,0!=h){if(a&&(t=Xs(t,y+(1<<17))),1==h&&(l=no.flmap,c=no.fdmap,m=511,g=31),2==h){f=i(e,b,5)+257,d=i(e,b+5,5)+1,p=i(e,b+10,4)+4,b+=14;for(var v=0;v<38;v+=2)no.itree[v]=0,no.itree[v+1]=0;var w=1;for(v=0;v<p;v++){var x=i(e,b+3*v,3);no.itree[1+(no.ordr[v]<<1)]=x,x>w&&(w=x)}b+=3*p,Gs(no.itree,w),Qs(no.itree,w,no.imap),l=no.lmap,c=no.dmap,b=s(no.imap,(1<<w)-1,f+d,e,b,no.ttree);var _=Hs(no.ttree,0,f,no.ltree);m=(1<<_)-1;var k=Hs(no.ttree,f,d,no.dtree);g=(1<<k)-1,Gs(no.ltree,_),Qs(no.ltree,_,l),Gs(no.dtree,k),Qs(no.dtree,k,c)}for(;;){var E=l[o(e,b)&m];b+=15&E;var $=E>>>4;if($>>>8==0)t[y++]=$;else{if(256==$)break;var A=y+$-254;if($>264){var N=no.ldef[$-257];A=y+(N>>>3)+i(e,b,7&N),b+=7&N}var O=c[o(e,b)&g];b+=15&O;var P=O>>>4,S=no.ddef[P],C=(S>>>4)+r(e,b,15&S);for(b+=15&S,a&&(t=Xs(t,y+(1<<17)));y<A;)t[y]=t[y++-C],t[y]=t[y++-C],t[y]=t[y++-C],t[y]=t[y++-C];y=A}}}else{0!=(7&b)&&(b+=8-(7&b));var T=4+(b>>>3),B=e[T-4]|e[T-3]<<8;a&&(t=Xs(t,y+B)),t.set(new n(e.buffer,e.byteOffset+T,B),y),b=T+B<<3,y+=B}return t.length==y?t:t.slice(0,y)}(e,t)}const ao={numWorkers:1,workerURL:"",useWorkers:!1};let lo=0;const co=[];function uo(e){return new Promise(((t,n)=>{const r=new Worker(e);r.onmessage=e=>{"start"===e.data?(r.onerror=void 0,r.onmessage=void 0,t(r)):n(new Error(`unexpected message: ${e.data}`))},r.onerror=n}))}function ho(e,t,n,r){const i=new Uint8Array(t);oo(e,i),r(n?new Blob([i],{type:n}):i.buffer)}function fo(e,t,n){return new Promise(((r,i)=>{co.push({src:e,uncompressedSize:t,type:n,resolve:r,reject:i,id:lo++}),async function(){if(0!==co.length)for(;co.length;){const{src:e,uncompressedSize:t,type:n,resolve:r}=co.shift();let i=e;zs(e)&&(i=await Ls(e)),ho(i,t,n,r)}}()}))}!function(){if(Vs){const{Worker:n}=(e=module,t="worker_threads",e.require(t));return{createWorker:async e=>new n(e),addEventListener(e,t){e.on("message",(n=>{t({target:e,data:n})}))},async terminate(e){await e.terminate()}}}return{async createWorker(e){try{return await uo(e)}catch(t){console.warn("could not load worker:",e)}let t;try{const n=await fetch(e,{mode:"cors"});if(!n.ok)throw new Error(`could not load: ${e}`);t=await n.text(),e=URL.createObjectURL(new Blob([t],{type:"application/javascript"}));const r=await uo(e);return ao.workerURL=e,r}catch(t){console.warn("could not load worker via fetch:",e)}if(void 0!==t)try{e=`data:application/javascript;base64,${btoa(t)}`;const n=await uo(e);return ao.workerURL=e,n}catch(e){console.warn("could not load worker via dataURI")}throw console.warn("workers will not be used"),new Error("can not start workers")},addEventListener(e,t){e.addEventListener("message",t)},async terminate(e){e.terminate()}};var e,t}();class po{constructor(e,t){var n,r;this._reader=e,this._rawEntry=t,this.name=t.name,this.nameBytes=t.nameBytes,this.size=t.uncompressedSize,this.compressedSize=t.compressedSize,this.comment=t.comment,this.commentBytes=t.commentBytes,this.compressionMethod=t.compressionMethod,this.lastModDate=(n=t.lastModFileDate,r=t.lastModFileTime,new Date(1980+(n>>9&127),(n>>5&15)-1,31&n,r>>11&31,r>>5&63,2*(31&r),0)),this.isDirectory=0===t.uncompressedSize&&t.name.endsWith("/"),this.encrypted=!!(1&t.generalPurposeBitFlag),this.externalFileAttributes=t.externalFileAttributes,this.versionMadeBy=t.versionMadeBy}async blob(e="application/octet-stream"){return await async function(e,t,n){const{decompress:r,fileDataStart:i}=await $o(e,t);if(!r){const r=await go(e,i,t.compressedSize,n);return zs(r)?r:new Blob([qs(r.buffer)?new Uint8Array(r):r],{type:n})}const s=await go(e,i,t.compressedSize);return await fo(s,t.uncompressedSize,n)}(this._reader,this._rawEntry,e)}async arrayBuffer(){return await async function(e,t){const{decompress:n,fileDataStart:r}=await $o(e,t);if(!n){const n=await mo(e,r,t.compressedSize);return 0===(i=n).byteOffset&&i.byteLength===i.buffer.byteLength?n.buffer:n.slice().buffer}var i;const s=await go(e,r,t.compressedSize);return await fo(s,t.uncompressedSize)}(this._reader,this._rawEntry)}async text(){const e=await this.arrayBuffer();return _o(new Uint8Array(e))}async json(){const e=await this.text();return JSON.parse(e)}}async function mo(e,t,n){return await e.read(t,n)}async function go(e,t,n,r){return e.sliceAsBlob?await e.sliceAsBlob(t,n,r):await e.read(t,n)}const yo={unsigned:()=>0};function bo(e,t){return e[t]+256*e[t+1]}function vo(e,t){return e[t]+256*e[t+1]+65536*e[t+2]+16777216*e[t+3]}function wo(e,t){return vo(e,t)+4294967296*vo(e,t+4)}const xo=new TextDecoder;function _o(e,t){return qs(e.buffer)&&(e=new Uint8Array(e)),xo.decode(e)}async function ko(e,t,n,r){const i=t-20,s=await mo(e,i,20);if(117853008!==vo(s,0))throw new Error("invalid zip64 end of central directory locator signature");const o=wo(s,8),a=await mo(e,o,56);if(101075792!==vo(a,0))throw new Error("invalid zip64 end of central directory record signature");const l=wo(a,32),c=wo(a,40);return Eo(e,wo(a,48),c,l,n,r)}async function Eo(e,t,n,r,i,s){let o=0;const a=await mo(e,t,n),l=[];for(let e=0;e<r;++e){const e=a.subarray(o,o+46),t=vo(e,0);if(33639248!==t)throw new Error(`invalid central directory file header signature: 0x${t.toString(16)}`);const n={versionMadeBy:bo(e,4),versionNeededToExtract:bo(e,6),generalPurposeBitFlag:bo(e,8),compressionMethod:bo(e,10),lastModFileTime:bo(e,12),lastModFileDate:bo(e,14),crc32:vo(e,16),compressedSize:vo(e,20),uncompressedSize:vo(e,24),fileNameLength:bo(e,28),extraFieldLength:bo(e,30),fileCommentLength:bo(e,32),internalFileAttributes:bo(e,36),externalFileAttributes:vo(e,38),relativeOffsetOfLocalHeader:vo(e,42)};if(64&n.generalPurposeBitFlag)throw new Error("strong encryption is not supported");o+=46;const r=a.subarray(o,o+n.fileNameLength+n.extraFieldLength+n.fileCommentLength);n.nameBytes=r.slice(0,n.fileNameLength),n.name=_o(n.nameBytes);const i=n.fileNameLength+n.extraFieldLength,s=r.slice(n.fileNameLength,i);n.extraFields=[];let c=0;for(;c<s.length-3;){const e=bo(s,c+0),t=c+4,r=t+bo(s,c+2);if(r>s.length)throw new Error("extra field length exceeds extra field buffer size");n.extraFields.push({id:e,data:s.slice(t,r)}),c=r}if(n.commentBytes=r.slice(i,i+n.fileCommentLength),n.comment=_o(n.commentBytes),o+=r.length,4294967295===n.uncompressedSize||4294967295===n.compressedSize||4294967295===n.relativeOffsetOfLocalHeader){const e=n.extraFields.find((e=>1===e.id));if(!e)throw new Error("expected zip64 extended information extra field");const t=e.data;let r=0;if(4294967295===n.uncompressedSize){if(r+8>t.length)throw new Error("zip64 extended information extra field does not include uncompressed size");n.uncompressedSize=wo(t,r),r+=8}if(4294967295===n.compressedSize){if(r+8>t.length)throw new Error("zip64 extended information extra field does not include compressed size");n.compressedSize=wo(t,r),r+=8}if(4294967295===n.relativeOffsetOfLocalHeader){if(r+8>t.length)throw new Error("zip64 extended information extra field does not include relative header offset");n.relativeOffsetOfLocalHeader=wo(t,r),r+=8}}const u=n.extraFields.find((e=>28789===e.id&&e.data.length>=6&&1===e.data[0]&&vo(e.data,1)),yo.unsigned(n.nameBytes));if(u&&(n.fileName=_o(u.data.slice(5))),0===n.compressionMethod){let e=n.uncompressedSize;if(0!=(1&n.generalPurposeBitFlag)&&(e+=12),n.compressedSize!==e)throw new Error(`compressed size mismatch for stored file: ${n.compressedSize} != ${e}`)}l.push(n)}return{zip:{comment:i,commentBytes:s},entries:l.map((t=>new po(e,t)))}}async function $o(e,t){if(1&t.generalPurposeBitFlag)throw new Error("encrypted entries not supported");const n=await mo(e,t.relativeOffsetOfLocalHeader,30),r=await e.getLength(),i=vo(n,0);if(67324752!==i)throw new Error(`invalid local file header signature: 0x${i.toString(16)}`);const s=bo(n,26),o=bo(n,28),a=t.relativeOffsetOfLocalHeader+n.length+s+o;let l;if(0===t.compressionMethod)l=!1;else{if(8!==t.compressionMethod)throw new Error(`unsupported compression method: ${t.compressionMethod}`);l=!0}const c=a,u=c+t.compressedSize;if(0!==t.compressedSize&&u>r)throw new Error(`file data overflows file bounds: ${c} +  ${t.compressedSize}  > ${r}`);return{decompress:l,fileDataStart:c}}async function Ao(e){let t;if("undefined"!=typeof Blob&&e instanceof Blob)t=new Ws(e);else if(e instanceof ArrayBuffer||e&&e.buffer&&e.buffer instanceof ArrayBuffer)t=new Us(e);else if(qs(e)||qs(e.buffer))t=new Us(e);else if("string"==typeof e){const n=await fetch(e);if(!n.ok)throw new Error(`failed http request ${e}, status: ${n.status}: ${n.statusText}`);const r=await n.blob();t=new Ws(r)}else{if("function"!=typeof e.getLength||"function"!=typeof e.read)throw new Error("unsupported source type");t=e}const n=await t.getLength();if(n>Number.MAX_SAFE_INTEGER)throw new Error(`file too large. size: ${n}. Only file sizes up 4503599627370496 bytes are supported`);return await async function(e,t){const n=Math.min(65557,t),r=t-n,i=await mo(e,r,n);for(let t=n-22;t>=0;--t){if(101010256!==vo(i,t))continue;const n=new Uint8Array(i.buffer,i.byteOffset+t,i.byteLength-t),s=bo(n,4);if(0!==s)throw new Error(`multi-volume zip files are not supported. This is volume: ${s}`);const o=bo(n,10),a=vo(n,12),l=vo(n,16),c=bo(n,20),u=n.length-22;if(c!==u)throw new Error(`invalid comment length. expected: ${u}, actual: ${c}`);const h=new Uint8Array(n.buffer,n.byteOffset+22,c),f=_o(h);return 65535===o||4294967295===l?await ko(e,r+t,f,h):await Eo(e,l,a,o,f,h)}throw new Error("could not find end of central directory. maybe not zip file")}(t,n)}let No,Oo=[],Po=[],So=[],Co=[],To=[],Bo="";const Fo=async e=>{const{entries:t}=await async function(e){const{zip:t,entries:n}=await Ao(e);return{zip:t,entries:Object.fromEntries(n.map((e=>[e.name,e])))}}(e);let n="";for(const[e,r]of Object.entries(t))switch(e.substring(e.lastIndexOf("."))){case".opf":n=await r.text();break;case".png":case".jpg":case".jpeg":case".gif":{const t=await r.blob();Po.push({name:e,blob:t});break}case".css":{const t=await r.text();Co.push({name:e,css:t});break}case".htm":case".xml":case".html":case".xhtml":{const t=await r.text();So.push({name:e,html:t});break}case".otf":case".ttf":case".woff":{const t=await r.blob();To.push({name:e,blob:t})}}return n},jo=e=>{const t=e["dc:title"],n=e["dc:creator"];let r=Po[0].blob;for(let{name:e,blob:t}of Po){if(e.includes(Bo)){r=t;break}e.includes("cover")&&(r=t)}return{title:t,author:n,cover:r}},Do=e=>{let t=[];for(const n of e.item)"application/xhtml+xml"===n["@_media-type"]?t.push({id:n["@_id"],href:n["@_href"]}):n["@_media-type"].includes("image")&&n["@_id"].includes("cover")&&(Bo=n["@_href"]);return t},Io=(e,t)=>{let n=[];e.itemref.forEach((e=>n.push(e["@_idref"]))),Oo=n.map((e=>t.find((t=>t.id===e))))},Ko=e=>e.split("\\").pop().split("/").pop(),Ro=(e,t)=>{for(const[n,{name:r}]of t.entries())if(r.includes(e))return"ESSENCE-READER-IMAGE-"+n;return""},Mo=new DOMParser,Lo=(e,t)=>{let n=Mo.parseFromString(e,"application/xhtml+xml");n.querySelector("parsererror")&&(n=Mo.parseFromString(e,"text/html"));for(const e of n.querySelectorAll("[src],[href], image"))switch(e.tagName){case"img":{const n=Ko(e.getAttribute("src"));e.setAttribute("src",Ro(n,t)),e.style.cssText+="max-height: 100%; max-width: 100%; object-fit: scale-down;";break}case"image":{const n=Ko(e.getAttributeNS("http://www.w3.org/1999/xlink","href"));e.setAttributeNS("http://www.w3.org/1999/xlink","href",Ro(n,t));break}default:null===e.getAttribute("href")||e.getAttribute("href").includes("http")?null===e.getAttribute("src")||e.getAttribute("src").includes("http")||e.removeAttribute("src"):e.removeAttribute("href")}return n.body.innerHTML},zo=(e,t)=>{let n=[];return(e=(e=e.replace(/@(-moz-|-webkit-|-ms-)*keyframes\s(.*?){([0-9%a-zA-Z,\s.]*{(.*?)})*[\s\n]*}/g,(e=>n.push(e)&&"__keyframes__"))).replace(/([^\r\n,{}]+)(,(?=[^}]*{)|\s*{)/g,(e=>"@"===e.trim()[0]?e:e.replace(/(\s*)/,"$1"+t+" ")))).replace(/__keyframes__/g,(e=>n.shift()))},qo=async e=>{Po=[],Oo=[],So=[],To=[];try{(e=>{const t=new Rs.XMLParser({ignoreAttributes:!1}).parse(e).package,n=Do(t.manifest),r=(new Rs.XMLParser).parse(e).package;No=jo(void 0===r.metadata?r["opf:metadata"]:r.metadata),Io(t.spine,n)})(await Fo(e))}catch(t){throw new Error(e.name+" does not appear to be a valid EPUB file")}let t=[];for(let e=0;e<Oo.length;e++)for(const{name:n,html:r}of So)if(n.includes(Oo[e].href)){t.push(Lo(r,Po));break}for(let e=0;e<Co.length;e++)Co[e].css=zo(Co[e].css,"#container");return{meta:No,contents:t,files:{images:Po,fonts:To,styles:Co}}},Vo=(e,t,n)=>e.replace(/url\((?!['"]?(?:data):)['"]?([^'"\)]*)['"]?\)/g,(function(e,r){const i=r.split("\\").pop().split("/").pop();let s=[];return[".png",".jpg",".jpeg",".gif"].some((e=>i.endsWith(e)))?s=t:[".otf",".ttf",".woff"].some((e=>i.endsWith(e)))&&(s=n),"url("+Uo(i,s)+")"})),Uo=(e,t)=>{for(const{name:n,blob:r}of t)if(n.includes(e))return URL.createObjectURL(r);return""},Wo=(e,t)=>e.replace(/ESSENCE-READER-IMAGE-(\d*)/g,(function(e,n){return URL.createObjectURL(t[n].blob)})),Xo=e=>({}),Yo=e=>({}),Ho=e=>({}),Go=e=>({}),Qo=e=>({}),Jo=e=>({});function Zo(e){let t,n,r,i,s,o,a;const l=e[1].leftbar,c=u(l,e,e[0],Jo),h=e[1].toptext,m=u(h,e,e[0],Go),g=e[1].rightbar,y=u(g,e,e[0],Yo);return{c(){t=A("div"),n=A("div"),c&&c.c(),r=O(),i=A("div"),m&&m.c(),s=O(),o=A("div"),y&&y.c(),C(n,"class","buttonbar svelte-5uyilb"),C(n,"id","leftbar"),C(i,"id","toptext"),C(i,"class","svelte-5uyilb"),C(o,"class","buttonbar svelte-5uyilb"),C(o,"id","rightbar"),C(t,"id","topbar"),C(t,"class","svelte-5uyilb")},m(e,l){E(e,t,l),x(t,n),c&&c.m(n,null),x(t,r),x(t,i),m&&m.m(i,null),x(t,s),x(t,o),y&&y.m(o,null),a=!0},p(e,[t]){c&&c.p&&(!a||1&t)&&d(c,l,e,e[0],a?f(l,e[0],t,Qo):p(e[0]),Jo),m&&m.p&&(!a||1&t)&&d(m,h,e,e[0],a?f(h,e[0],t,Ho):p(e[0]),Go),y&&y.p&&(!a||1&t)&&d(y,g,e,e[0],a?f(g,e[0],t,Xo):p(e[0]),Yo)},i(e){a||(le(c,e),le(m,e),le(y,e),a=!0)},o(e){ce(c,e),ce(m,e),ce(y,e),a=!1},d(e){e&&$(t),c&&c.d(e),m&&m.d(e),y&&y.d(e)}}}function ea(e,t,n){let{$$slots:r={},$$scope:i}=t;return e.$$set=e=>{"$$scope"in e&&n(0,i=e.$$scope)},[i,r]}class ta extends be{constructor(e){super(),ye(this,e,ea,Zo,o,{})}}function na(t){let n,r,o,a,l;const c=t[4].default,h=u(c,t,t[3],null);return{c(){n=A("div"),h&&h.c(),C(n,"id","popover"),F(n,"top",t[1]),F(n,"right",t[2]),C(n,"class","svelte-5z79nf")},m(i,c){var u;E(i,n,c),h&&h.m(n,null),o=!0,a||(l=[(u=r=ia.call(null,n),u&&s(u.destroy)?u.destroy:e),S(n,"outclick",t[5])],a=!0)},p(e,t){h&&h.p&&(!o||8&t)&&d(h,c,e,e[3],o?f(c,e[3],t,null):p(e[3]),null),(!o||2&t)&&F(n,"top",e[1]),(!o||4&t)&&F(n,"right",e[2])},i(e){o||(le(h,e),o=!0)},o(e){ce(h,e),o=!1},d(e){e&&$(n),h&&h.d(e),a=!1,i(l)}}}function ra(e){let t,n,r=e[0]&&na(e);return{c(){r&&r.c(),t=P()},m(e,i){r&&r.m(e,i),E(e,t,i),n=!0},p(e,[n]){e[0]?r?(r.p(e,n),1&n&&le(r,1)):(r=na(e),r.c(),le(r,1),r.m(t.parentNode,t)):r&&(oe(),ce(r,1,1,(()=>{r=null})),ae())},i(e){n||(le(r),n=!0)},o(e){ce(r),n=!1},d(e){r&&r.d(e),e&&$(t)}}}function ia(e){const t=t=>{t.target instanceof Element&&(e.contains(t.target)||"settingsBtn"===t.target.className||e.dispatchEvent(new CustomEvent("outclick")))};return document.addEventListener("click",t,!0),{destroy(){document.removeEventListener("click",t,!0)}}}function sa(e,t,n){let{$$slots:r={},$$scope:i}=t,{visible:s}=t,{top:o}=t,{right:a}=t;return e.$$set=e=>{"visible"in e&&n(0,s=e.visible),"top"in e&&n(1,o=e.top),"right"in e&&n(2,a=e.right),"$$scope"in e&&n(3,i=e.$$scope)},[s,o,a,i,r,()=>n(0,s=!1)]}class oa extends be{constructor(e){super(),ye(this,e,sa,ra,o,{visible:0,top:1,right:2})}}function aa(t){let n,r,s,o,a,l,c,u,h;return{c(){n=A("div"),n.textContent="warm",r=O(),s=A("div"),s.textContent="black",o=O(),a=A("div"),a.textContent="dark",l=O(),c=A("div"),c.textContent="light",F(n,"background-color","#f6e4bd"),F(n,"color","#000"),C(n,"class","svelte-7vb56k"),F(s,"background-color","#000"),F(s,"color","#e9e9e9"),C(s,"class","svelte-7vb56k"),F(a,"background-color","#032038"),F(a,"color","#e9e9e9"),C(a,"class","svelte-7vb56k"),F(c,"background-color","#fff"),F(c,"color","#000"),C(c,"class","svelte-7vb56k")},m(e,i){E(e,n,i),E(e,r,i),E(e,s,i),E(e,o,i),E(e,a,i),E(e,l,i),E(e,c,i),u||(h=[S(n,"click",t[1]),S(s,"click",t[2]),S(a,"click",t[3]),S(c,"click",t[4])],u=!0)},p:e,i:e,o:e,d(e){e&&$(n),e&&$(r),e&&$(s),e&&$(o),e&&$(a),e&&$(l),e&&$(c),u=!1,i(h)}}}function la(e){const t=e=>{document.documentElement.setAttribute("data-theme",e),localStorage.setItem("theme",e)};return[t,()=>t("warm"),()=>t("black"),()=>t("dark"),()=>t("light")]}class ca extends be{constructor(e){super(),ye(this,e,la,aa,o,{})}}function ua(e){let t,n,r,s,o,a,l,c,u,h,f,d,p,m,g,y,b,v,w,_,k,N,P;return _=new ca({}),{c(){t=A("label"),t.textContent="Font:",n=O(),r=A("br"),s=O(),o=A("select"),a=A("option"),a.textContent="Verdana",l=A("option"),l.textContent="Arial",c=A("option"),c.textContent="Courier New ",u=A("option"),u.textContent="Helvetica",h=A("option"),h.textContent="Times New Roman",f=O(),d=A("br"),p=O(),m=A("label"),m.textContent="Font size:",g=O(),y=A("br"),b=O(),v=A("input"),w=O(),de(_.$$.fragment),C(t,"for","fontpicker"),F(a,"font-family","'Verdana'"),a.__value="Verdana",a.value=a.__value,F(l,"font-family","'Arial'"),l.__value="Arial",l.value=l.__value,F(c,"font-family","'Courier New '"),c.__value="Courier New ",c.value=c.__value,F(u,"font-family","'Helvetica'"),u.__value="Helvetica",u.value=u.__value,F(h,"font-family","'Times New Roman'"),h.__value="Times New Roman",h.value=h.__value,C(o,"name","fontpicker"),F(o,"width","100%"),void 0===e[0].fontFamily&&J((()=>e[2].call(o))),C(m,"for","fontsize"),C(v,"name","fontsize"),C(v,"type","range"),C(v,"min","12"),C(v,"max","40")},m(i,$){E(i,t,$),E(i,n,$),E(i,r,$),E(i,s,$),E(i,o,$),x(o,a),x(o,l),x(o,c),x(o,u),x(o,h),j(o,e[0].fontFamily),E(i,f,$),E(i,d,$),E(i,p,$),E(i,m,$),E(i,g,$),E(i,y,$),E(i,b,$),E(i,v,$),B(v,e[0].fontSize),E(i,w,$),pe(_,i,$),k=!0,N||(P=[S(o,"change",e[2]),S(v,"change",e[3]),S(v,"input",e[3])],N=!0)},p(e,t){1&t&&j(o,e[0].fontFamily),1&t&&B(v,e[0].fontSize)},i(e){k||(le(_.$$.fragment,e),k=!0)},o(e){ce(_.$$.fragment,e),k=!1},d(e){e&&$(t),e&&$(n),e&&$(r),e&&$(s),e&&$(o),e&&$(f),e&&$(d),e&&$(p),e&&$(m),e&&$(g),e&&$(y),e&&$(b),e&&$(v),e&&$(w),me(_,e),N=!1,i(P)}}}function ha(e){let t,n,r;function i(t){e[4](t)}let s={top:"3.1em",right:"1%",$$slots:{default:[ua]},$$scope:{ctx:e}};return void 0!==e[1]&&(s.visible=e[1]),t=new oa({props:s}),X.push((()=>fe(t,"visible",i))),{c(){de(t.$$.fragment)},m(e,n){pe(t,e,n),r=!0},p(e,[r]){const i={};33&r&&(i.$$scope={dirty:r,ctx:e}),!n&&2&r&&(n=!0,i.visible=e[1],Z((()=>n=!1))),t.$set(i)},i(e){r||(le(t.$$.fragment,e),r=!0)},o(e){ce(t.$$.fragment,e),r=!1},d(e){me(t,e)}}}function fa(e,t,n){let{settings:r={fontSize:16,fontFamily:"Verdana"}}=t,{settingsVisible:i=!1}=t;return e.$$set=e=>{"settings"in e&&n(0,r=e.settings),"settingsVisible"in e&&n(1,i=e.settingsVisible)},[r,i,function(){r.fontFamily=function(e){const t=e.querySelector(":checked")||e.options[0];return t&&t.__value}(this),n(0,r)},function(){var e;r.fontSize=""===(e=this.value)?null:+e,n(0,r)},function(e){i=e,n(1,i)}]}class da extends be{constructor(e){super(),ye(this,e,fa,ha,o,{settings:0,settingsVisible:1})}}const{document:pa}=ue;function ma(t){let n,r,i;return{c(){n=A("button"),n.textContent="<",C(n,"slot","leftbar"),F(n,"opacity","0.5")},m(e,s){E(e,n,s),r||(i=S(n,"click",t[12]),r=!0)},p:e,d(e){e&&$(n),r=!1,i()}}}function ga(e){let t,n,r,i,s,o,a,l,c,u,h,f,d=void 0!==e[1]?e[1].meta.title+" - ":"",p=(void 0!==e[1]?e[1].meta.author:"")+"",m=e[1].contents.length+"";return{c(){t=A("div"),n=A("h4"),r=A("b"),i=N(d),s=O(),o=N(p),a=O(),l=A("p"),c=N(e[2]),u=N("/"),h=N(m),C(n,"class","svelte-ketruh"),C(l,"id","progress"),C(l,"class","svelte-ketruh"),C(t,"slot","toptext"),C(t,"style",f="transition: opacity 0.3s; "+(e[5]>100?"opacity: 0.5;":""))},m(e,f){E(e,t,f),x(t,n),x(n,r),x(r,i),x(n,s),x(n,o),x(t,a),x(t,l),x(l,c),x(l,u),x(l,h)},p(e,n){2&n&&d!==(d=void 0!==e[1]?e[1].meta.title+" - ":"")&&T(i,d),2&n&&p!==(p=(void 0!==e[1]?e[1].meta.author:"")+"")&&T(o,p),4&n&&T(c,e[2]),2&n&&m!==(m=e[1].contents.length+"")&&T(h,m),32&n&&f!==(f="transition: opacity 0.3s; "+(e[5]>100?"opacity: 0.5;":""))&&C(t,"style",f)},d(e){e&&$(t)}}}function ya(t){let n,r,s,o,a,l,c,u;return{c(){n=A("div"),r=A("button"),r.textContent="",s=O(),o=A("button"),o.textContent="",a=O(),l=A("button"),l.textContent="",C(r,"class","settingsBtn"),C(n,"slot","rightbar"),F(n,"display","inline-block")},m(e,i){E(e,n,i),x(n,r),x(n,s),x(n,o),x(n,a),x(n,l),c||(u=[S(r,"click",t[9]),S(o,"click",t[10]),S(l,"click",t[11])],c=!0)},p:e,d(e){e&&$(n),c=!1,i(u)}}}function ba(e){let t,n,r,s,o,a,l,c,u,h,f,d,p,m,g,y,b=!1,v=()=>{b=!1},w=e[1].contents[e[2]]+"",_=e[1].contents[e[2]+1]+"";function k(t){e[13](t)}function N(t){e[14](t)}J(e[8]),pa.title=n="\n        "+e[1].meta.title+" - "+e[1].meta.author+"\n    ",s=new ta({props:{$$slots:{rightbar:[ya],toptext:[ga],leftbar:[ma]},$$scope:{ctx:e}}});let P={};return void 0!==e[3]&&(P.settingsVisible=e[3]),void 0!==e[4]&&(P.settings=e[4]),f=new da({props:P}),X.push((()=>fe(f,"settingsVisible",k))),X.push((()=>fe(f,"settings",N))),{c(){r=O(),de(s.$$.fragment),o=O(),a=A("div"),l=new D(!1),c=O(),u=new D(!1),h=O(),de(f.$$.fragment),l.a=c,u.a=null,C(a,"id","container"),F(a,"font-size",e[4].fontSize+"px"),F(a,"font-family",e[4].fontFamily),C(a,"class","svelte-ketruh")},m(n,i){E(n,r,i),pe(s,n,i),E(n,o,i),E(n,a,i),l.m(w,a),x(a,c),u.m(_,a),E(n,h,i),pe(f,n,i),m=!0,g||(y=[S(window,"keydown",e[7]),S(window,"scroll",(()=>{b=!0,clearTimeout(t),t=setTimeout(v,100),e[8]()}))],g=!0)},p(e,[r]){32&r&&!b&&(b=!0,clearTimeout(t),scrollTo(window.pageXOffset,e[5]),t=setTimeout(v,100)),(!m||2&r)&&n!==(n="\n        "+e[1].meta.title+" - "+e[1].meta.author+"\n    ")&&(pa.title=n);const i={};131119&r&&(i.$$scope={dirty:r,ctx:e}),s.$set(i),(!m||6&r)&&w!==(w=e[1].contents[e[2]]+"")&&l.p(w),(!m||6&r)&&_!==(_=e[1].contents[e[2]+1]+"")&&u.p(_),(!m||16&r)&&F(a,"font-size",e[4].fontSize+"px"),(!m||16&r)&&F(a,"font-family",e[4].fontFamily);const o={};!d&&8&r&&(d=!0,o.settingsVisible=e[3],Z((()=>d=!1))),!p&&16&r&&(p=!0,o.settings=e[4],Z((()=>p=!1))),f.$set(o)},i(e){m||(le(s.$$.fragment,e),le(f.$$.fragment,e),m=!0)},o(e){ce(s.$$.fragment,e),ce(f.$$.fragment,e),m=!1},d(e){e&&$(r),me(s,e),e&&$(o),e&&$(a),e&&$(h),me(f,e),g=!1,i(y)}}}function va(e,t,n){let{currentBook:r}=t,{reading:i}=t,s=0,o=!1,a={fontSize:16,fontFamily:"Verdana"},l=0,c=r.meta.title;var u;u=()=>{c!=r.meta.title&&(n(2,s=0),c=r.meta.title,h())},U().$$.after_update.push(u);const h=()=>{for(let e of document.getElementsByTagName("style"))e.innerHTML="";r.files.styles.forEach((e=>{const t=document.createElement("style");t.innerText=e.css,document.head.appendChild(t)}))},f=e=>{0<=s+e&&s+e<=r.contents.length&&(n(2,s+=e),n(5,l=0))};h();return e.$$set=e=>{"currentBook"in e&&n(1,r=e.currentBook),"reading"in e&&n(0,i=e.reading)},[i,r,s,o,a,l,f,({key:e})=>{switch(e){case"ArrowLeft":f(-2);break;case"ArrowRight":f(2)}},function(){n(5,l=window.pageYOffset)},()=>n(3,o=!o),()=>f(-2),()=>f(2),()=>{n(0,i=!1),document.title="Essence Reader",location.hash=""},function(e){o=e,n(3,o)},function(e){a=e,n(4,a)}]}class wa extends be{constructor(e){super(),ye(this,e,va,ba,o,{currentBook:1,reading:0})}}function xa(e){const t=e-1;return t*t*t+1}function _a(e,{from:t,to:n},r={}){const i=getComputedStyle(e),o="none"===i.transform?"":i.transform,[a,l]=i.transformOrigin.split(" ").map(parseFloat),c=t.left+t.width*a/n.width-(n.left+a),u=t.top+t.height*l/n.height-(n.top+l),{delay:h=0,duration:f=(e=>120*Math.sqrt(e)),easing:d=xa}=r;return{delay:h,duration:s(f)?f(Math.sqrt(c*c+u*u)):f,easing:d,css:(e,r)=>{const i=r*c,s=r*u,a=e+r*t.width/n.width,l=e+r*t.height/n.height;return`transform: ${o} translate(${i}px, ${s}px) scale(${a}, ${l});`}}}function ka(e,t,n){const r=e.slice();return r[18]=t[n],r}function Ea(t){let n;return{c(){n=A("h3"),n.textContent="Essence Reader",C(n,"slot","toptext"),F(n,"display","inline")},m(e,t){E(e,n,t)},p:e,d(e){e&&$(n)}}}function $a(t){let n,r,i;return{c(){n=A("button"),n.textContent="",C(n,"class","settingsBtn"),C(n,"slot","rightbar")},m(e,s){E(e,n,s),r||(i=S(n,"click",t[11]),r=!0)},p:e,d(e){e&&$(n),r=!1,i()}}}function Aa(e){let t,n,r,i,s,o,a,l,c,u,h,f,d,p;return h=new ca({}),{c(){t=A("div"),n=A("label"),r=A("input"),i=N("\n            Save books\n        "),s=A("br"),o=O(),a=A("hr"),l=O(),c=A("p"),c.textContent="Select theme",u=O(),de(h.$$.fragment),C(r,"type","checkbox"),F(n,"user-select","none"),F(c,"display","inline"),F(t,"width","8em")},m(m,g){E(m,t,g),x(t,n),x(n,r),r.checked=e[0],x(n,i),x(t,s),x(t,o),x(t,a),x(t,l),x(t,c),x(t,u),pe(h,t,null),f=!0,d||(p=S(r,"change",e[12]),d=!0)},p(e,t){1&t&&(r.checked=e[0])},i(e){f||(le(h.$$.fragment,e),f=!0)},o(e){ce(h.$$.fragment,e),f=!1},d(e){e&&$(t),me(h),d=!1,p()}}}function Na(e){let t,n=[],r=new Map,i=e[6];const s=e=>e[18].id;for(let t=0;t<i.length;t+=1){let o=ka(e,i,t),a=s(o);r.set(a,n[t]=Oa(a,o))}return{c(){for(let e=0;e<n.length;e+=1)n[e].c();t=P()},m(e,r){for(let t=0;t<n.length;t+=1)n[t].m(e,r);E(e,t,r)},p(e,o){if(578&o){i=e[6];for(let e=0;e<n.length;e+=1)n[e].r();n=function(e,t,n,r,i,s,o,a,l,c,u,h){let f=e.length,d=s.length,p=f;const m={};for(;p--;)m[e[p].key]=p;const g=[],y=new Map,b=new Map;for(p=d;p--;){const e=h(i,s,p),a=n(e);let l=o.get(a);l?r&&l.p(e,t):(l=c(a,e),l.c()),y.set(a,g[p]=l),a in m&&b.set(a,Math.abs(p-m[a]))}const v=new Set,w=new Set;function x(e){le(e,1),e.m(a,u),o.set(e.key,e),u=e.first,d--}for(;f&&d;){const t=g[d-1],n=e[f-1],r=t.key,i=n.key;t===n?(u=t.first,f--,d--):y.has(i)?!o.has(r)||v.has(r)?x(t):w.has(i)?f--:b.get(r)>b.get(i)?(w.add(r),x(t)):(v.add(i),f--):(l(n,o),f--)}for(;f--;){const t=e[f];y.has(t.key)||l(t,o)}for(;d;)x(g[d-1]);return g}(n,o,s,1,e,i,r,t.parentNode,he,Oa,t,ka);for(let e=0;e<n.length;e+=1)n[e].a()}},d(e){for(let t=0;t<n.length;t+=1)n[t].d(e);e&&$(t)}}}function Oa(t,n){let r,s,o,a,c,u,h,f,d,p,m,g,y,b,v,w,_=n[18].meta.author+"",k=n[18].meta.title+"",P=e;function B(...e){return n[14](n[18],...e)}function F(){return n[15](n[18])}return{key:t,first:null,c(){r=A("button"),s=A("button"),s.textContent="",o=O(),a=A("img"),u=O(),h=A("div"),f=A("h4"),d=N(_),p=O(),m=A("h3"),g=N(k),y=O(),C(s,"class","deleteBtn svelte-174uz3k"),l(a.src,c=void 0!==n[18].meta.cover?URL.createObjectURL(n[18].meta.cover):"")||C(a,"src",c),C(a,"alt","cover"),C(a,"class","svelte-174uz3k"),C(m,"class","svelte-174uz3k"),C(h,"class","bookInfo svelte-174uz3k"),C(r,"class","book svelte-174uz3k"),this.first=r},m(e,t){E(e,r,t),x(r,s),x(r,o),x(r,a),x(r,u),x(r,h),x(h,f),x(f,d),x(h,p),x(h,m),x(m,g),x(r,y),v||(w=[S(s,"click",B),S(r,"click",F)],v=!0)},p(e,t){n=e,64&t&&!l(a.src,c=void 0!==n[18].meta.cover?URL.createObjectURL(n[18].meta.cover):"")&&C(a,"src",c),64&t&&_!==(_=n[18].meta.author+"")&&T(d,_),64&t&&k!==(k=n[18].meta.title+"")&&T(g,k)},r(){b=r.getBoundingClientRect()},f(){q(r),P()},a(){P(),P=z(r,b,_a,{duration:200})},d(e){e&&$(r),v=!1,i(w)}}}function Pa(e){let t,n,r,i,s=e[4]?"+":"Drop anywhere or click to select a file";return{c(){t=A("h1"),t.textContent="",n=O(),r=A("h2"),i=N(s),C(t,"class","svelte-174uz3k")},m(e,s){E(e,t,s),E(e,n,s),E(e,r,s),x(r,i)},p(e,t){16&t&&s!==(s=e[4]?"+":"Drop anywhere or click to select a file")&&T(i,s)},d(e){e&&$(t),e&&$(n),e&&$(r)}}}function Sa(t){let n,r,i;return{c(){n=A("h1"),n.textContent="",r=O(),i=A("h2"),i.textContent="...",C(n,"class","svelte-174uz3k")},m(e,t){E(e,n,t),E(e,r,t),E(e,i,t)},p:e,d(e){e&&$(n),e&&$(r),e&&$(i)}}}function Ca(e){let t,n,r,i,s,o=e[3]?"Loading":"Drop anywhere or click to select a file";return{c(){t=A("div"),n=A("h4"),n.textContent="Load new book",r=O(),i=A("h3"),s=N(o),F(i,"color",e[2]?"#87CEFA":""),C(i,"class","svelte-174uz3k"),C(t,"class","bookInfo svelte-174uz3k")},m(e,o){E(e,t,o),x(t,n),x(t,r),x(t,i),x(i,s)},p(e,t){8&t&&o!==(o=e[3]?"Loading":"Drop anywhere or click to select a file")&&T(s,o),4&t&&F(i,"color",e[2]?"#87CEFA":"")},d(e){e&&$(t)}}}function Ta(e){let t,n,r,i,s,o,a,l,c,u,h,f,d,p,g;function y(t){e[13](t)}t=new ta({props:{$$slots:{rightbar:[$a],toptext:[Ea]},$$scope:{ctx:e}}});let b={top:"3.1em",right:"1%",$$slots:{default:[Aa]},$$scope:{ctx:e}};void 0!==e[5]&&(b.visible=e[5]),r=new oa({props:b}),X.push((()=>fe(r,"visible",y)));let v=e[6]&&Na(e);function w(e,t){return e[3]?Sa:Pa}let _=w(e),k=_(e),N=e[4]&&Ca(e);return{c(){de(t.$$.fragment),n=O(),de(r.$$.fragment),s=O(),o=A("div"),v&&v.c(),a=O(),l=A("button"),c=A("div"),k.c(),h=O(),N&&N.c(),C(c,"id","dropInfo"),C(c,"class",u=m(e[3]?"loading":"")+" svelte-174uz3k"),F(c,"max-width",e[4]?"":"100% "),F(c,"background-color",e[2]?" #87CEFA":""),C(l,"class","book svelte-174uz3k"),C(l,"style",f=e[4]?"":"max-width: 50vw"),C(o,"id","parent"),C(o,"class","svelte-174uz3k")},m(i,u){pe(t,i,u),E(i,n,u),pe(r,i,u),E(i,s,u),E(i,o,u),v&&v.m(o,null),x(o,a),x(o,l),x(l,c),k.m(c,null),x(l,h),N&&N.m(l,null),d=!0,p||(g=S(l,"click",e[16]),p=!0)},p(e,[n]){const s={};2097184&n&&(s.$$scope={dirty:n,ctx:e}),t.$set(s);const h={};2097153&n&&(h.$$scope={dirty:n,ctx:e}),!i&&32&n&&(i=!0,h.visible=e[5],Z((()=>i=!1))),r.$set(h),e[6]?v?v.p(e,n):(v=Na(e),v.c(),v.m(o,a)):v&&(v.d(1),v=null),_===(_=w(e))&&k?k.p(e,n):(k.d(1),k=_(e),k&&(k.c(),k.m(c,null))),(!d||8&n&&u!==(u=m(e[3]?"loading":"")+" svelte-174uz3k"))&&C(c,"class",u),(!d||16&n)&&F(c,"max-width",e[4]?"":"100% "),(!d||4&n)&&F(c,"background-color",e[2]?" #87CEFA":""),e[4]?N?N.p(e,n):(N=Ca(e),N.c(),N.m(l,null)):N&&(N.d(1),N=null),(!d||16&n&&f!==(f=e[4]?"":"max-width: 50vw"))&&C(l,"style",f)},i(e){d||(le(t.$$.fragment,e),le(r.$$.fragment,e),d=!0)},o(e){ce(t.$$.fragment,e),ce(r.$$.fragment,e),d=!1},d(e){me(t,e),e&&$(n),me(r,e),e&&$(s),e&&$(o),v&&v.d(),k.d(),N&&N.d(),p=!1,g()}}}function Ba(e,t,n){let r,{readFiles:i=(e=>{})}=t,{openExisting:s=(e=>{})}=t,{dragging:o}=t,{saveBooksOn:a}=t,{loading:l}=t,u=bi((()=>ki.books.toArray()));c(e,u,(e=>n(6,r=e)));let h=!1,f=!1;const d=()=>{let e=document.createElement("input");e.type="file",e.onchange=e=>{i(e.target.files[0])},e.click()};async function p(e){await ki.books.delete(e)}!async function(){if(a){const e=await ki.books.count().catch((()=>n(0,a=!1)));n(4,h=e>0)}}();return e.$$set=e=>{"readFiles"in e&&n(10,i=e.readFiles),"openExisting"in e&&n(1,s=e.openExisting),"dragging"in e&&n(2,o=e.dragging),"saveBooksOn"in e&&n(0,a=e.saveBooksOn),"loading"in e&&n(3,l=e.loading)},[a,s,o,l,h,f,r,u,d,p,i,()=>n(5,f=!f),function(){a=this.checked,n(0,a)},function(e){f=e,n(5,f)},(e,t)=>{t.stopPropagation(),p(e.id)},e=>s(e.id),()=>d()]}class Fa extends be{constructor(e){super(),ye(this,e,Ba,Ta,o,{readFiles:10,openExisting:1,dragging:2,saveBooksOn:0,loading:3})}}function ja(e){let t,n,r,i;function s(t){e[8](t)}function o(t){e[9](t)}let a={readFiles:e[5],openExisting:e[6],dragging:e[3]};return void 0!==e[0]&&(a.saveBooksOn=e[0]),void 0!==e[4]&&(a.loading=e[4]),t=new Fa({props:a}),X.push((()=>fe(t,"saveBooksOn",s))),X.push((()=>fe(t,"loading",o))),{c(){de(t.$$.fragment)},m(e,n){pe(t,e,n),i=!0},p(e,i){const s={};8&i&&(s.dragging=e[3]),!n&&1&i&&(n=!0,s.saveBooksOn=e[0],Z((()=>n=!1))),!r&&16&i&&(r=!0,s.loading=e[4],Z((()=>r=!1))),t.$set(s)},i(e){i||(le(t.$$.fragment,e),i=!0)},o(e){ce(t.$$.fragment,e),i=!1},d(e){me(t,e)}}}function Da(e){let t,n,r;function i(t){e[7](t)}let s={currentBook:e[1]};return void 0!==e[2]&&(s.reading=e[2]),t=new wa({props:s}),X.push((()=>fe(t,"reading",i))),{c(){de(t.$$.fragment)},m(e,n){pe(t,e,n),r=!0},p(e,r){const i={};2&r&&(i.currentBook=e[1]),!n&&4&r&&(n=!0,i.reading=e[2],Z((()=>n=!1))),t.$set(i)},i(e){r||(le(t.$$.fragment,e),r=!0)},o(e){ce(t.$$.fragment,e),r=!1},d(e){me(t,e)}}}function Ia(e){let t,n,r,i;const s=[Da,ja],o=[];function a(e,t){return e[2]?0:1}return n=a(e),r=o[n]=s[n](e),{c(){t=A("main"),r.c()},m(e,r){E(e,t,r),o[n].m(t,null),i=!0},p(e,[i]){let l=n;n=a(e),n===l?o[n].p(e,i):(oe(),ce(o[l],1,1,(()=>{o[l]=null})),ae(),r=o[n],r?r.p(e,i):(r=o[n]=s[n](e),r.c()),le(r,1),r.m(t,null))},i(e){i||(le(r),i=!0)},o(e){ce(r),i=!1},d(e){e&&$(t),o[n].d()}}}function Ka(e,t,n){let r,i=!1,s=!1,o=!1;const a=async e=>{try{n(4,o=!0);const t=await qo(e);if(l&&e.size<3e7){const e=await(async e=>{for(let t of await ki.books.toArray())if(t.meta.title===e.meta.title)return t.id;try{return await ki.books.add(e)}catch(e){console.log(e)}})(t);c(t,e)}else c(t)}catch(e){alert(e)}n(4,o=!1)};let l;l=null===localStorage.getItem("saveBooksOn")||JSON.parse(localStorage.getItem("saveBooksOn"));window.addEventListener("dragenter",(e=>{e.dataTransfer.types.includes("Files")&&n(3,s=!0)})),window.addEventListener("dragleave",(e=>{n(3,s=!1),e.preventDefault()}));const c=(e,t)=>{n(1,r=(e=>{let t=[];for(const n of e.contents)t.push(Wo(n,e.files.images));let n=e.files.styles;for(let t=0;t<n.length;t++)n[t].css=Vo(n[t].css,e.files.images,e.files.fonts);return{meta:e.meta,contents:t,files:e.files}})(e)),n(2,i=!0),location.hash=t?t.toString():""},u=e=>{ki.transaction("r",ki.books,(async()=>{let t=await ki.books.get(e);t&&c(t,t.id)}))};var h;return h=()=>{""!==location.hash&&u(parseInt(location.hash.substring(1)))},U().$$.on_mount.push(h),window.onhashchange=()=>{l&&i&&""===location.hash?(document.title="Essence Reader",n(2,i=!1)):l&&!i&&""!==location.hash&&u(parseInt(location.hash.substring(1)))},window.addEventListener("dragover",(e=>e.preventDefault())),window.addEventListener("drop",(e=>{e.preventDefault(),n(3,s=!1),a(e.dataTransfer.files[0])})),e.$$.update=()=>{1&e.$$.dirty&&localStorage.setItem("saveBooksOn",JSON.stringify(l))},[l,r,i,s,o,a,u,function(e){i=e,n(2,i)},function(e){l=e,n(0,l)},function(e){o=e,n(4,o)}]}return new class extends be{constructor(e){super(),ye(this,e,Ka,Ia,o,{})}}({target:document.body})}();
