var app=function(){"use strict";function e(){}function t(e){return e()}function n(){return Object.create(null)}function r(e){e.forEach(t)}function i(e){return"function"==typeof e}function s(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}let o,a;function l(e,t){return o||(o=document.createElement("a")),o.href=t,e===o.href}function c(t,n,r){t.$$.on_destroy.push(function(t,...n){if(null==t)return e;const r=t.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}(n,r))}function u(e,t,n,r){if(e){const i=h(e,t,n,r);return e[0](i)}}function h(e,t,n,r){return e[1]&&r?function(e,t){for(const n in t)e[n]=t[n];return e}(n.ctx.slice(),e[1](r(t))):n.ctx}function d(e,t,n,r){if(e[2]&&r){const i=e[2](r(n));if(void 0===t.dirty)return i;if("object"==typeof i){const e=[],n=Math.max(t.dirty.length,i.length);for(let r=0;r<n;r+=1)e[r]=t.dirty[r]|i[r];return e}return t.dirty|i}return t.dirty}function f(e,t,n,r,i,s){if(i){const o=h(t,n,r,s);e.p(o,i)}}function p(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let e=0;e<n;e++)t[e]=-1;return t}return-1}function m(e,t){e.appendChild(t)}function g(e,t,n){e.insertBefore(t,n||null)}function y(e){e.parentNode.removeChild(e)}function b(e){return document.createElement(e)}function v(e){return document.createTextNode(e)}function w(){return v(" ")}function x(){return v("")}function _(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function k(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function E(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function A(e,t){e.value=null==t?"":t}function N(e,t,n,r){null===n?e.style.removeProperty(t):e.style.setProperty(t,n,r?"important":"")}function O(e,t){for(let n=0;n<e.options.length;n+=1){const r=e.options[n];if(r.__value===t)return void(r.selected=!0)}e.selectedIndex=-1}class ${constructor(e=!1){this.is_svg=!1,this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,t,n=null){var r;this.e||(this.is_svg?this.e=(r=t.nodeName,document.createElementNS("http://www.w3.org/2000/svg",r)):this.e=b(t.nodeName),this.t=t,this.c(e)),this.i(n)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)g(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(y)}}function P(e){a=e}function S(){if(!a)throw new Error("Function called outside component initialization");return a}const C=[],T=[],j=[],B=[],F=Promise.resolve();let D=!1;function I(e){j.push(e)}function K(e){B.push(e)}const R=new Set;let M=0;function L(){const e=a;do{for(;M<C.length;){const e=C[M];M++,P(e),z(e.$$)}for(P(null),C.length=0,M=0;T.length;)T.pop()();for(let e=0;e<j.length;e+=1){const t=j[e];R.has(t)||(R.add(t),t())}j.length=0}while(C.length);for(;B.length;)B.pop()();D=!1,R.clear(),P(e)}function z(e){if(null!==e.fragment){e.update(),r(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(I)}}const q=new Set;let V;function U(){V={r:0,c:[],p:V}}function W(){V.r||r(V.c),V=V.p}function X(e,t){e&&e.i&&(q.delete(e),e.i(t))}function Y(e,t,n,r){if(e&&e.o){if(q.has(e))return;q.add(e),V.c.push((()=>{q.delete(e),r&&(n&&e.d(1),r())})),e.o(t)}else r&&r()}const H="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function G(e,t){e.d(1),t.delete(e.key)}function Q(e,t,n){const r=e.$$.props[t];void 0!==r&&(e.$$.bound[r]=n,n(e.$$.ctx[r]))}function J(e){e&&e.c()}function Z(e,n,s,o){const{fragment:a,on_mount:l,on_destroy:c,after_update:u}=e.$$;a&&a.m(n,s),o||I((()=>{const n=l.map(t).filter(i);c?c.push(...n):r(n),e.$$.on_mount=[]})),u.forEach(I)}function ee(e,t){const n=e.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function te(e,t){-1===e.$$.dirty[0]&&(C.push(e),D||(D=!0,F.then(L)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function ne(t,i,s,o,l,c,u,h=[-1]){const d=a;P(t);const f=t.$$={fragment:null,ctx:null,props:c,update:e,not_equal:l,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(i.context||(d?d.$$.context:[])),callbacks:n(),dirty:h,skip_bound:!1,root:i.target||d.$$.root};u&&u(f.root);let p=!1;if(f.ctx=s?s(t,i.props||{},((e,n,...r)=>{const i=r.length?r[0]:n;return f.ctx&&l(f.ctx[e],f.ctx[e]=i)&&(!f.skip_bound&&f.bound[e]&&f.bound[e](i),p&&te(t,e)),n})):[],f.update(),p=!0,r(f.before_update),f.fragment=!!o&&o(f.ctx),i.target){if(i.hydrate){const e=function(e){return Array.from(e.childNodes)}(i.target);f.fragment&&f.fragment.l(e),e.forEach(y)}else f.fragment&&f.fragment.c();i.intro&&X(t.$$.fragment),Z(t,i.target,i.anchor,i.customElement),L()}P(d)}class re{$destroy(){ee(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const ie="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,se=Object.keys,oe=Array.isArray;function ae(e,t){return"object"!=typeof t||se(t).forEach((function(n){e[n]=t[n]})),e}"undefined"==typeof Promise||ie.Promise||(ie.Promise=Promise);const le=Object.getPrototypeOf,ce={}.hasOwnProperty;function ue(e,t){return ce.call(e,t)}function he(e,t){"function"==typeof t&&(t=t(le(e))),("undefined"==typeof Reflect?se:Reflect.ownKeys)(t).forEach((n=>{fe(e,n,t[n])}))}const de=Object.defineProperty;function fe(e,t,n,r){de(e,t,ae(n&&ue(n,"get")&&"function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function pe(e){return{from:function(t){return e.prototype=Object.create(t.prototype),fe(e.prototype,"constructor",e),{extend:he.bind(null,e.prototype)}}}}const me=Object.getOwnPropertyDescriptor;function ge(e,t){let n;return me(e,t)||(n=le(e))&&ge(n,t)}const ye=[].slice;function be(e,t,n){return ye.call(e,t,n)}function ve(e,t){return t(e)}function we(e){if(!e)throw new Error("Assertion Failed")}function xe(e){ie.setImmediate?setImmediate(e):setTimeout(e,0)}function _e(e,t){return e.reduce(((e,n,r)=>{var i=t(n,r);return i&&(e[i[0]]=i[1]),e}),{})}function ke(e,t){if(ue(e,t))return e[t];if(!t)return e;if("string"!=typeof t){for(var n=[],r=0,i=t.length;r<i;++r){var s=ke(e,t[r]);n.push(s)}return n}var o=t.indexOf(".");if(-1!==o){var a=e[t.substr(0,o)];return void 0===a?void 0:ke(a,t.substr(o+1))}}function Ee(e,t,n){if(e&&void 0!==t&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){we("string"!=typeof n&&"length"in n);for(var r=0,i=t.length;r<i;++r)Ee(e,t[r],n[r])}else{var s=t.indexOf(".");if(-1!==s){var o=t.substr(0,s),a=t.substr(s+1);if(""===a)void 0===n?oe(e)&&!isNaN(parseInt(o))?e.splice(o,1):delete e[o]:e[o]=n;else{var l=e[o];l&&ue(e,o)||(l=e[o]={}),Ee(l,a,n)}}else void 0===n?oe(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function Ae(e){var t={};for(var n in e)ue(e,n)&&(t[n]=e[n]);return t}const Ne=[].concat;function Oe(e){return Ne.apply([],e)}const $e="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Oe([8,16,32,64].map((e=>["Int","Uint","Float"].map((t=>t+e+"Array")))))).filter((e=>ie[e])),Pe=$e.map((e=>ie[e]));_e($e,(e=>[e,!0]));let Se=null;function Ce(e){Se="undefined"!=typeof WeakMap&&new WeakMap;const t=Te(e);return Se=null,t}function Te(e){if(!e||"object"!=typeof e)return e;let t=Se&&Se.get(e);if(t)return t;if(oe(e)){t=[],Se&&Se.set(e,t);for(var n=0,r=e.length;n<r;++n)t.push(Te(e[n]))}else if(Pe.indexOf(e.constructor)>=0)t=e;else{const n=le(e);for(var i in t=n===Object.prototype?{}:Object.create(n),Se&&Se.set(e,t),e)ue(e,i)&&(t[i]=Te(e[i]))}return t}const{toString:je}={};function Be(e){return je.call(e).slice(8,-1)}const Fe="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",De="symbol"==typeof Fe?function(e){var t;return null!=e&&(t=e[Fe])&&t.apply(e)}:function(){return null},Ie={};function Ke(e){var t,n,r,i;if(1===arguments.length){if(oe(e))return e.slice();if(this===Ie&&"string"==typeof e)return[e];if(i=De(e)){for(n=[];!(r=i.next()).done;)n.push(r.value);return n}if(null==e)return[e];if("number"==typeof(t=e.length)){for(n=new Array(t);t--;)n[t]=e[t];return n}return[e]}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}const Re="undefined"!=typeof Symbol?e=>"AsyncFunction"===e[Symbol.toStringTag]:()=>!1;var Me="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Le(e,t){Me=e,ze=t}var ze=()=>!0;const qe=!new Error("").stack;function Ve(){if(qe)try{throw Ve.arguments,new Error}catch(e){return e}return new Error}function Ue(e,t){var n=e.stack;return n?(t=t||0,0===n.indexOf(e.name)&&(t+=(e.name+e.message).split("\n").length),n.split("\n").slice(t).filter(ze).map((e=>"\n"+e)).join("")):""}var We=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Xe=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(We),Ye={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function He(e,t){this._e=Ve(),this.name=e,this.message=t}function Ge(e,t){return e+". Errors: "+Object.keys(t).map((e=>t[e].toString())).filter(((e,t,n)=>n.indexOf(e)===t)).join("\n")}function Qe(e,t,n,r){this._e=Ve(),this.failures=t,this.failedKeys=r,this.successCount=n,this.message=Ge(e,t)}function Je(e,t){this._e=Ve(),this.name="BulkError",this.failures=Object.keys(t).map((e=>t[e])),this.failuresByPos=t,this.message=Ge(e,t)}pe(He).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Ue(this._e,2))}},toString:function(){return this.name+": "+this.message}}),pe(Qe).from(He),pe(Je).from(He);var Ze=Xe.reduce(((e,t)=>(e[t]=t+"Error",e)),{});const et=He;var tt=Xe.reduce(((e,t)=>{var n=t+"Error";function r(e,r){this._e=Ve(),this.name=n,e?"string"==typeof e?(this.message=`${e}${r?"\n "+r:""}`,this.inner=r||null):"object"==typeof e&&(this.message=`${e.name} ${e.message}`,this.inner=e):(this.message=Ye[t]||n,this.inner=null)}return pe(r).from(et),e[t]=r,e}),{});tt.Syntax=SyntaxError,tt.Type=TypeError,tt.Range=RangeError;var nt=We.reduce(((e,t)=>(e[t+"Error"]=tt[t],e)),{});var rt=Xe.reduce(((e,t)=>(-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=tt[t]),e)),{});function it(){}function st(e){return e}function ot(e,t){return null==e||e===st?t:function(n){return t(e(n))}}function at(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function lt(e,t){return e===it?t:function(){var n=e.apply(this,arguments);void 0!==n&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var s=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?at(r,this.onsuccess):r),i&&(this.onerror=this.onerror?at(i,this.onerror):i),void 0!==s?s:n}}function ct(e,t){return e===it?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?at(n,this.onsuccess):n),r&&(this.onerror=this.onerror?at(r,this.onerror):r)}}function ut(e,t){return e===it?t:function(n){var r=e.apply(this,arguments);ae(n,r);var i=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?at(i,this.onsuccess):i),s&&(this.onerror=this.onerror?at(s,this.onerror):s),void 0===r?void 0===o?void 0:o:ae(r,o)}}function ht(e,t){return e===it?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function dt(e,t){return e===it?t:function(){var n=e.apply(this,arguments);if(n&&"function"==typeof n.then){for(var r=this,i=arguments.length,s=new Array(i);i--;)s[i]=arguments[i];return n.then((function(){return t.apply(r,s)}))}return t.apply(this,arguments)}}rt.ModifyError=Qe,rt.DexieError=He,rt.BulkError=Je;var ft={};const[pt,mt,gt]="undefined"==typeof Promise?[]:(()=>{let e=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[e,le(e),e];const t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,le(t),e]})(),yt=mt&&mt.then,bt=pt&&pt.constructor,vt=!!gt;var wt=!1,xt=gt?()=>{gt.then(Vt)}:ie.setImmediate?setImmediate.bind(null,Vt):ie.MutationObserver?()=>{var e=document.createElement("div");new MutationObserver((()=>{Vt(),e=null})).observe(e,{attributes:!0}),e.setAttribute("i","1")}:()=>{setTimeout(Vt,0)},_t=function(e,t){Ct.push([e,t]),Et&&(xt(),Et=!1)},kt=!0,Et=!0,At=[],Nt=[],Ot=null,$t=st,Pt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:gn,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach((e=>{try{gn(e[0],e[1])}catch(e){}}))}},St=Pt,Ct=[],Tt=0,jt=[];function Bt(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=it,this._lib=!1;var t=this._PSD=St;if(Me&&(this._stackHolder=Ve(),this._prev=null,this._numPrev=0),"function"!=typeof e){if(e!==ft)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&Kt(this,this._value))}this._state=null,this._value=null,++t.ref,It(this,e)}const Ft={get:function(){var e=St,t=en;function n(n,r){var i=!e.global&&(e!==St||t!==en);const s=i&&!sn();var o=new Bt(((t,o)=>{Mt(this,new Dt(fn(n,e,i,s),fn(r,e,i,s),t,o,e))}));return Me&&qt(o,this),o}return n.prototype=ft,n},set:function(e){fe(this,"then",e&&e.prototype===ft?Ft:{get:function(){return e},set:Ft.set})}};function Dt(e,t,n,r,i){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r,this.psd=i}function It(e,t){try{t((t=>{if(null===e._state){if(t===e)throw new TypeError("A promise cannot be resolved with itself.");var n=e._lib&&Ut();t&&"function"==typeof t.then?It(e,((e,n)=>{t instanceof Bt?t._then(e,n):t.then(e,n)})):(e._state=!0,e._value=t,Rt(e)),n&&Wt()}}),Kt.bind(null,e))}catch(t){Kt(e,t)}}function Kt(e,t){if(Nt.push(t),null===e._state){var n=e._lib&&Ut();t=$t(t),e._state=!1,e._value=t,Me&&null!==t&&"object"==typeof t&&!t._promise&&function(e,t,n){try{e.apply(null,n)}catch(e){t&&t(e)}}((()=>{var n=ge(t,"stack");t._promise=e,fe(t,"stack",{get:()=>wt?n&&(n.get?n.get.apply(t):n.value):e.stack})})),function(e){At.some((t=>t._value===e._value))||At.push(e)}(e),Rt(e),n&&Wt()}}function Rt(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)Mt(e,t[n]);var i=e._PSD;--i.ref||i.finalize(),0===Tt&&(++Tt,_t((()=>{0==--Tt&&Xt()}),[]))}function Mt(e,t){if(null!==e._state){var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Tt,_t(Lt,[n,e,t])}else e._listeners.push(t)}function Lt(e,t,n){try{Ot=t;var r,i=t._value;t._state?r=e(i):(Nt.length&&(Nt=[]),r=e(i),-1===Nt.indexOf(i)&&function(e){var t=At.length;for(;t;)if(At[--t]._value===e._value)return void At.splice(t,1)}(t)),n.resolve(r)}catch(e){n.reject(e)}finally{Ot=null,0==--Tt&&Xt(),--n.psd.ref||n.psd.finalize()}}function zt(e,t,n){if(t.length===n)return t;var r="";if(!1===e._state){var i,s,o=e._value;null!=o?(i=o.name||"Error",s=o.message||o,r=Ue(o,0)):(i=o,s=""),t.push(i+(s?": "+s:"")+r)}return Me&&((r=Ue(e._stackHolder,2))&&-1===t.indexOf(r)&&t.push(r),e._prev&&zt(e._prev,t,n)),t}function qt(e,t){var n=t?t._numPrev+1:0;n<100&&(e._prev=t,e._numPrev=n)}function Vt(){Ut()&&Wt()}function Ut(){var e=kt;return kt=!1,Et=!1,e}function Wt(){var e,t,n;do{for(;Ct.length>0;)for(e=Ct,Ct=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}}while(Ct.length>0);kt=!0,Et=!0}function Xt(){var e=At;At=[],e.forEach((e=>{e._PSD.onunhandled.call(null,e._value,e)}));for(var t=jt.slice(0),n=t.length;n;)t[--n]()}function Yt(e){return new Bt(ft,!1,e)}function Ht(e,t){var n=St;return function(){var r=Ut(),i=St;try{return cn(n,!0),e.apply(this,arguments)}catch(e){t&&t(e)}finally{cn(i,!1),r&&Wt()}}}he(Bt.prototype,{then:Ft,_then:function(e,t){Mt(this,new Dt(null,null,e,t,St))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=arguments[0],n=arguments[1];return"function"==typeof t?this.then(null,(e=>e instanceof t?n(e):Yt(e))):this.then(null,(e=>e&&e.name===t?n(e):Yt(e)))},finally:function(e){return this.then((t=>(e(),t)),(t=>(e(),Yt(t))))},stack:{get:function(){if(this._stack)return this._stack;try{wt=!0;var e=zt(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=e),e}finally{wt=!1}}},timeout:function(e,t){return e<1/0?new Bt(((n,r)=>{var i=setTimeout((()=>r(new tt.Timeout(t))),e);this.then(n,r).finally(clearTimeout.bind(null,i))})):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&fe(Bt.prototype,Symbol.toStringTag,"Dexie.Promise"),Pt.env=un(),he(Bt,{all:function(){var e=Ke.apply(null,arguments).map(on);return new Bt((function(t,n){0===e.length&&t([]);var r=e.length;e.forEach(((i,s)=>Bt.resolve(i).then((n=>{e[s]=n,--r||t(e)}),n)))}))},resolve:e=>{if(e instanceof Bt)return e;if(e&&"function"==typeof e.then)return new Bt(((t,n)=>{e.then(t,n)}));var t=new Bt(ft,!0,e);return qt(t,Ot),t},reject:Yt,race:function(){var e=Ke.apply(null,arguments).map(on);return new Bt(((t,n)=>{e.map((e=>Bt.resolve(e).then(t,n)))}))},PSD:{get:()=>St,set:e=>St=e},totalEchoes:{get:()=>en},newPSD:nn,usePSD:hn,scheduler:{get:()=>_t,set:e=>{_t=e}},rejectionMapper:{get:()=>$t,set:e=>{$t=e}},follow:(e,t)=>new Bt(((n,r)=>nn(((t,n)=>{var r=St;r.unhandleds=[],r.onunhandled=n,r.finalize=at((function(){!function(e){function t(){e(),jt.splice(jt.indexOf(t),1)}jt.push(t),++Tt,_t((()=>{0==--Tt&&Xt()}),[])}((()=>{0===this.unhandleds.length?t():n(this.unhandleds[0])}))}),r.finalize),e()}),t,n,r)))}),bt&&(bt.allSettled&&fe(Bt,"allSettled",(function(){const e=Ke.apply(null,arguments).map(on);return new Bt((t=>{0===e.length&&t([]);let n=e.length;const r=new Array(n);e.forEach(((e,i)=>Bt.resolve(e).then((e=>r[i]={status:"fulfilled",value:e}),(e=>r[i]={status:"rejected",reason:e})).then((()=>--n||t(r)))))}))})),bt.any&&"undefined"!=typeof AggregateError&&fe(Bt,"any",(function(){const e=Ke.apply(null,arguments).map(on);return new Bt(((t,n)=>{0===e.length&&n(new AggregateError([]));let r=e.length;const i=new Array(r);e.forEach(((e,s)=>Bt.resolve(e).then((e=>t(e)),(e=>{i[s]=e,--r||n(new AggregateError(i))}))))}))})));const Gt={awaits:0,echoes:0,id:0};var Qt=0,Jt=[],Zt=0,en=0,tn=0;function nn(e,t,n,r){var i=St,s=Object.create(i);s.parent=i,s.ref=0,s.global=!1,s.id=++tn;var o=Pt.env;s.env=vt?{Promise:Bt,PromiseProp:{value:Bt,configurable:!0,writable:!0},all:Bt.all,race:Bt.race,allSettled:Bt.allSettled,any:Bt.any,resolve:Bt.resolve,reject:Bt.reject,nthen:pn(o.nthen,s),gthen:pn(o.gthen,s)}:{},t&&ae(s,t),++i.ref,s.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=hn(s,e,n,r);return 0===s.ref&&s.finalize(),a}function rn(){return Gt.id||(Gt.id=++Qt),++Gt.awaits,Gt.echoes+=100,Gt.id}function sn(){return!!Gt.awaits&&(0==--Gt.awaits&&(Gt.id=0),Gt.echoes=100*Gt.awaits,!0)}function on(e){return Gt.echoes&&e&&e.constructor===bt?(rn(),e.then((e=>(sn(),e)),(e=>(sn(),yn(e))))):e}function an(e){++en,Gt.echoes&&0!=--Gt.echoes||(Gt.echoes=Gt.id=0),Jt.push(St),cn(e,!0)}function ln(){var e=Jt[Jt.length-1];Jt.pop(),cn(e,!1)}function cn(e,t){var n=St;if((t?!Gt.echoes||Zt++&&e===St:!Zt||--Zt&&e===St)||dn(t?an.bind(null,e):ln),e!==St&&(St=e,n===Pt&&(Pt.env=un()),vt)){var r=Pt.env.Promise,i=e.env;mt.then=i.nthen,r.prototype.then=i.gthen,(n.global||e.global)&&(Object.defineProperty(ie,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function un(){var e=ie.Promise;return vt?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(ie,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject,nthen:mt.then,gthen:e.prototype.then}:{}}function hn(e,t,n,r,i){var s=St;try{return cn(e,!0),t(n,r,i)}finally{cn(s,!1)}}function dn(e){yt.call(pt,e)}function fn(e,t,n,r){return"function"!=typeof e?e:function(){var i=St;n&&rn(),cn(t,!0);try{return e.apply(this,arguments)}finally{cn(i,!1),r&&dn(sn)}}}function pn(e,t){return function(n,r){return e.call(this,fn(n,t),fn(r,t))}}-1===(""+yt).indexOf("[native code]")&&(rn=sn=it);const mn="unhandledrejection";function gn(e,t){var n;try{n=t.onuncatched(e)}catch(e){}if(!1!==n)try{var r,i={promise:t,reason:e};if(ie.document&&document.createEvent?((r=document.createEvent("Event")).initEvent(mn,!0,!0),ae(r,i)):ie.CustomEvent&&ae(r=new CustomEvent(mn,{detail:i}),i),r&&ie.dispatchEvent&&(dispatchEvent(r),!ie.PromiseRejectionEvent&&ie.onunhandledrejection))try{ie.onunhandledrejection(r)}catch(e){}Me&&r&&!r.defaultPrevented&&console.warn(`Unhandled rejection: ${e.stack||e}`)}catch(e){}}var yn=Bt.reject;function bn(e,t,n,r){if(e.idbdb&&(e._state.openComplete||St.letThrough||e._vip)){var i=e._createTransaction(t,n,e._dbSchema);try{i.create(),e._state.PR1398_maxLoop=3}catch(i){return i.name===Ze.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then((()=>bn(e,t,n,r)))):yn(i)}return i._promise(t,((e,t)=>nn((()=>(St.trans=i,r(e,t,i)))))).then((e=>i._completion.then((()=>e))))}if(e._state.openComplete)return yn(new tt.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._options.autoOpen)return yn(new tt.DatabaseClosed);e.open().catch(it)}return e._state.dbReadyPromise.then((()=>bn(e,t,n,r)))}const vn="3.2.2",wn=String.fromCharCode(65535),xn=-1/0,_n="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",kn="String expected.",En=[],An="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Nn=An,On=An,$n=e=>!/(dexie\.js|dexie\.min\.js)/.test(e),Pn="__dbnames",Sn="readonly",Cn="readwrite";function Tn(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}const jn={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Bn(e){return"string"!=typeof e||/\./.test(e)?e=>e:t=>(void 0===t[e]&&e in t&&delete(t=Ce(t))[e],t)}class Fn{_trans(e,t,n){const r=this._tx||St.trans,i=this.name;function s(e,n,r){if(!r.schema[i])throw new tt.NotFound("Table "+i+" not part of transaction");return t(r.idbtrans,r)}const o=Ut();try{return r&&r.db===this.db?r===St.trans?r._promise(e,s,n):nn((()=>r._promise(e,s,n)),{trans:r,transless:St.transless||St}):bn(this.db,e,[this.name],s)}finally{o&&Wt()}}get(e,t){return e&&e.constructor===Object?this.where(e).first(t):this._trans("readonly",(t=>this.core.get({trans:t,key:e}).then((e=>this.hook.reading.fire(e))))).then(t)}where(e){if("string"==typeof e)return new this.db.WhereClause(this,e);if(oe(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);const t=se(e);if(1===t.length)return this.where(t[0]).equals(e[t[0]]);const n=this.schema.indexes.concat(this.schema.primKey).filter((e=>e.compound&&t.every((t=>e.keyPath.indexOf(t)>=0))&&e.keyPath.every((e=>t.indexOf(e)>=0))))[0];if(n&&this.db._maxKey!==wn)return this.where(n.name).equals(n.keyPath.map((t=>e[t])));!n&&Me&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${t.join("+")}]`);const{idxByName:r}=this.schema,i=this.db._deps.indexedDB;function s(e,t){try{return 0===i.cmp(e,t)}catch(e){return!1}}const[o,a]=t.reduce((([t,n],i)=>{const o=r[i],a=e[i];return[t||o,t||!o?Tn(n,o&&o.multi?e=>{const t=ke(e,i);return oe(t)&&t.some((e=>s(a,e)))}:e=>s(a,ke(e,i))):n]}),[null,null]);return o?this.where(o.name).equals(e[o.keyPath]).filter(a):n?this.filter(a):this.where(t).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,oe(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;const t=t=>{if(!t)return t;const n=Object.create(e.prototype);for(var r in t)if(ue(t,r))try{n[r]=t[r]}catch(e){}return n};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=t,this.hook("reading",t),e}defineClass(){return this.mapToClass((function(e){ae(this,e)}))}add(e,t){const{auto:n,keyPath:r}=this.schema.primKey;let i=e;return r&&n&&(i=Bn(r)(e)),this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"add",keys:null!=t?[t]:null,values:[i]}))).then((e=>e.numFailures?Bt.reject(e.failures[0]):e.lastResult)).then((t=>{if(r)try{Ee(e,r,t)}catch(e){}return t}))}update(e,t){if("object"!=typeof e||oe(e))return this.where(":id").equals(e).modify(t);{const n=ke(e,this.schema.primKey.keyPath);if(void 0===n)return yn(new tt.InvalidArgument("Given object does not contain its primary key"));try{"function"!=typeof t?se(t).forEach((n=>{Ee(e,n,t[n])})):t(e,{value:e,primKey:n})}catch(e){}return this.where(":id").equals(n).modify(t)}}put(e,t){const{auto:n,keyPath:r}=this.schema.primKey;let i=e;return r&&n&&(i=Bn(r)(e)),this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"put",values:[i],keys:null!=t?[t]:null}))).then((e=>e.numFailures?Bt.reject(e.failures[0]):e.lastResult)).then((t=>{if(r)try{Ee(e,r,t)}catch(e){}return t}))}delete(e){return this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"delete",keys:[e]}))).then((e=>e.numFailures?Bt.reject(e.failures[0]):void 0))}clear(){return this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"deleteRange",range:jn}))).then((e=>e.numFailures?Bt.reject(e.failures[0]):void 0))}bulkGet(e){return this._trans("readonly",(t=>this.core.getMany({keys:e,trans:t}).then((e=>e.map((e=>this.hook.reading.fire(e)))))))}bulkAdd(e,t,n){const r=Array.isArray(t)?t:void 0,i=(n=n||(r?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",(t=>{const{auto:n,keyPath:s}=this.schema.primKey;if(s&&r)throw new tt.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(r&&r.length!==e.length)throw new tt.InvalidArgument("Arguments objects and keys must have the same length");const o=e.length;let a=s&&n?e.map(Bn(s)):e;return this.core.mutate({trans:t,type:"add",keys:r,values:a,wantResults:i}).then((({numFailures:e,results:t,lastResult:n,failures:r})=>{if(0===e)return i?t:n;throw new Je(`${this.name}.bulkAdd(): ${e} of ${o} operations failed`,r)}))}))}bulkPut(e,t,n){const r=Array.isArray(t)?t:void 0,i=(n=n||(r?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",(t=>{const{auto:n,keyPath:s}=this.schema.primKey;if(s&&r)throw new tt.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(r&&r.length!==e.length)throw new tt.InvalidArgument("Arguments objects and keys must have the same length");const o=e.length;let a=s&&n?e.map(Bn(s)):e;return this.core.mutate({trans:t,type:"put",keys:r,values:a,wantResults:i}).then((({numFailures:e,results:t,lastResult:n,failures:r})=>{if(0===e)return i?t:n;throw new Je(`${this.name}.bulkPut(): ${e} of ${o} operations failed`,r)}))}))}bulkDelete(e){const t=e.length;return this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"delete",keys:e}))).then((({numFailures:e,lastResult:n,failures:r})=>{if(0===e)return n;throw new Je(`${this.name}.bulkDelete(): ${e} of ${t} operations failed`,r)}))}}function Dn(e){var t={},n=function(n,r){if(r){for(var i=arguments.length,s=new Array(i-1);--i;)s[i-1]=arguments[i];return t[n].subscribe.apply(null,s),e}if("string"==typeof n)return t[n]};n.addEventType=s;for(var r=1,i=arguments.length;r<i;++r)s(arguments[r]);return n;function s(e,r,i){if("object"==typeof e)return o(e);r||(r=ht),i||(i=it);var s={subscribers:[],fire:i,subscribe:function(e){-1===s.subscribers.indexOf(e)&&(s.subscribers.push(e),s.fire=r(s.fire,e))},unsubscribe:function(e){s.subscribers=s.subscribers.filter((function(t){return t!==e})),s.fire=s.subscribers.reduce(r,i)}};return t[e]=n[e]=s,s}function o(e){se(e).forEach((function(t){var n=e[t];if(oe(n))s(t,e[t][0],e[t][1]);else{if("asap"!==n)throw new tt.InvalidArgument("Invalid event config");var r=s(t,st,(function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];r.subscribers.forEach((function(e){xe((function(){e.apply(null,t)}))}))}))}}))}}function In(e,t){return pe(t).from({prototype:e}),t}function Kn(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Rn(e,t){e.filter=Tn(e.filter,t)}function Mn(e,t,n){var r=e.replayFilter;e.replayFilter=r?()=>Tn(r(),t()):t,e.justLimit=n&&!r}function Ln(e,t){if(e.isPrimKey)return t.primaryKey;const n=t.getIndexByKeyPath(e.index);if(!n)throw new tt.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function zn(e,t,n){const r=Ln(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:"prev"===e.dir,unique:!!e.unique,query:{index:r,range:e.range}})}function qn(e,t,n,r){const i=e.replayFilter?Tn(e.filter,e.replayFilter()):e.filter;if(e.or){const s={},o=(e,n,r)=>{if(!i||i(n,r,(e=>n.stop(e)),(e=>n.fail(e)))){var o=n.primaryKey,a=""+o;"[object ArrayBuffer]"===a&&(a=""+new Uint8Array(o)),ue(s,a)||(s[a]=!0,t(e,n,r))}};return Promise.all([e.or._iterate(o,n),Vn(zn(e,r,n),e.algorithm,o,!e.keysOnly&&e.valueMapper)])}return Vn(zn(e,r,n),Tn(e.algorithm,i),t,!e.keysOnly&&e.valueMapper)}function Vn(e,t,n,r){var i=Ht(r?(e,t,i)=>n(r(e),t,i):n);return e.then((e=>{if(e)return e.start((()=>{var n=()=>e.continue();t&&!t(e,(e=>n=e),(t=>{e.stop(t),n=it}),(t=>{e.fail(t),n=it}))||i(e.value,e,(e=>n=e)),n()}))}))}function Un(e,t){try{const n=Wn(e),r=Wn(t);if(n!==r)return"Array"===n?1:"Array"===r?-1:"binary"===n?1:"binary"===r?-1:"string"===n?1:"string"===r?-1:"Date"===n?1:"Date"!==r?NaN:-1;switch(n){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return function(e,t){const n=e.length,r=t.length,i=n<r?n:r;for(let n=0;n<i;++n)if(e[n]!==t[n])return e[n]<t[n]?-1:1;return n===r?0:n<r?-1:1}(Xn(e),Xn(t));case"Array":return function(e,t){const n=e.length,r=t.length,i=n<r?n:r;for(let n=0;n<i;++n){const r=Un(e[n],t[n]);if(0!==r)return r}return n===r?0:n<r?-1:1}(e,t)}}catch(e){}return NaN}function Wn(e){const t=typeof e;if("object"!==t)return t;if(ArrayBuffer.isView(e))return"binary";const n=Be(e);return"ArrayBuffer"===n?"binary":n}function Xn(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}class Yn{_read(e,t){var n=this._ctx;return n.error?n.table._trans(null,yn.bind(null,n.error)):n.table._trans("readonly",e).then(t)}_write(e){var t=this._ctx;return t.error?t.table._trans(null,yn.bind(null,t.error)):t.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var t=this._ctx;t.algorithm=Tn(t.algorithm,e)}_iterate(e,t){return qn(this._ctx,e,t,this._ctx.table.core)}clone(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&ae(n,e),t._ctx=n,t}raw(){return this._ctx.valueMapper=null,this}each(e){var t=this._ctx;return this._read((n=>qn(t,e,n,t.table.core)))}count(e){return this._read((e=>{const t=this._ctx,n=t.table.core;if(Kn(t,!0))return n.count({trans:e,query:{index:Ln(t,n.schema),range:t.range}}).then((e=>Math.min(e,t.limit)));var r=0;return qn(t,(()=>(++r,!1)),e,n).then((()=>r))})).then(e)}sortBy(e,t){const n=e.split(".").reverse(),r=n[0],i=n.length-1;function s(e,t){return t?s(e[n[t]],t-1):e[r]}var o="next"===this._ctx.dir?1:-1;function a(e,t){var n=s(e,i),r=s(t,i);return n<r?-o:n>r?o:0}return this.toArray((function(e){return e.sort(a)})).then(t)}toArray(e){return this._read((e=>{var t=this._ctx;if("next"===t.dir&&Kn(t,!0)&&t.limit>0){const{valueMapper:n}=t,r=Ln(t,t.table.core.schema);return t.table.core.query({trans:e,limit:t.limit,values:!0,query:{index:r,range:t.range}}).then((({result:e})=>n?e.map(n):e))}{const n=[];return qn(t,(e=>n.push(e)),e,t.table.core).then((()=>n))}}),e)}offset(e){var t=this._ctx;return e<=0||(t.offset+=e,Kn(t)?Mn(t,(()=>{var t=e;return(e,n)=>0===t||(1===t?(--t,!1):(n((()=>{e.advance(t),t=0})),!1))})):Mn(t,(()=>{var t=e;return()=>--t<0}))),this}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Mn(this._ctx,(()=>{var t=e;return function(e,n,r){return--t<=0&&n(r),t>=0}}),!0),this}until(e,t){return Rn(this._ctx,(function(n,r,i){return!e(n.value)||(r(i),t)})),this}first(e){return this.limit(1).toArray((function(e){return e[0]})).then(e)}last(e){return this.reverse().first(e)}filter(e){var t,n;return Rn(this._ctx,(function(t){return e(t.value)})),t=this._ctx,n=e,t.isMatch=Tn(t.isMatch,n),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,n){e(n.key,n)}))}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,n){e(n.primaryKey,n)}))}keys(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each((function(e,t){n.push(t.key)})).then((function(){return n})).then(e)}primaryKeys(e){var t=this._ctx;if("next"===t.dir&&Kn(t,!0)&&t.limit>0)return this._read((e=>{var n=Ln(t,t.table.core.schema);return t.table.core.query({trans:e,values:!1,limit:t.limit,query:{index:n,range:t.range}})})).then((({result:e})=>e)).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each((function(e,t){n.push(t.primaryKey)})).then((function(){return n})).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys((function(e){return e[0]})).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var n={};return Rn(this._ctx,(function(e){var t=e.primaryKey.toString(),r=ue(n,t);return n[t]=!0,!r})),this}modify(e){var t=this._ctx;return this._write((n=>{var r;if("function"==typeof e)r=e;else{var i=se(e),s=i.length;r=function(t){for(var n=!1,r=0;r<s;++r){var o=i[r],a=e[o];ke(t,o)!==a&&(Ee(t,o,a),n=!0)}return n}}const o=t.table.core,{outbound:a,extractKey:l}=o.schema.primaryKey,c=this.db._options.modifyChunkSize||200,u=[];let h=0;const d=[],f=(e,t)=>{const{failures:n,numFailures:r}=t;h+=e-r;for(let e of se(n))u.push(n[e])};return this.clone().primaryKeys().then((i=>{const s=u=>{const h=Math.min(c,i.length-u);return o.getMany({trans:n,keys:i.slice(u,u+h),cache:"immutable"}).then((d=>{const p=[],m=[],g=a?[]:null,y=[];for(let e=0;e<h;++e){const t=d[e],n={value:Ce(t),primKey:i[u+e]};!1!==r.call(n,n.value,n)&&(null==n.value?y.push(i[u+e]):a||0===Un(l(t),l(n.value))?(m.push(n.value),a&&g.push(i[u+e])):(y.push(i[u+e]),p.push(n.value)))}const b=Kn(t)&&t.limit===1/0&&("function"!=typeof e||e===Hn)&&{index:t.index,range:t.range};return Promise.resolve(p.length>0&&o.mutate({trans:n,type:"add",values:p}).then((e=>{for(let t in e.failures)y.splice(parseInt(t),1);f(p.length,e)}))).then((()=>(m.length>0||b&&"object"==typeof e)&&o.mutate({trans:n,type:"put",keys:g,values:m,criteria:b,changeSpec:"function"!=typeof e&&e}).then((e=>f(m.length,e))))).then((()=>(y.length>0||b&&e===Hn)&&o.mutate({trans:n,type:"delete",keys:y,criteria:b}).then((e=>f(y.length,e))))).then((()=>i.length>u+h&&s(u+c)))}))};return s(0).then((()=>{if(u.length>0)throw new Qe("Error modifying one or more objects",u,h,d);return i.length}))}))}))}delete(){var e=this._ctx,t=e.range;return Kn(e)&&(e.isPrimKey&&!On||3===t.type)?this._write((n=>{const{primaryKey:r}=e.table.core.schema,i=t;return e.table.core.count({trans:n,query:{index:r,range:i}}).then((t=>e.table.core.mutate({trans:n,type:"deleteRange",range:i}).then((({failures:e,lastResult:n,results:r,numFailures:i})=>{if(i)throw new Qe("Could not delete some values",Object.keys(e).map((t=>e[t])),t-i);return t-i}))))})):this.modify(Hn)}}const Hn=(e,t)=>t.value=null;function Gn(e,t){return e<t?-1:e===t?0:1}function Qn(e,t){return e>t?-1:e===t?0:1}function Jn(e,t,n){var r=e instanceof ir?new e.Collection(e):e;return r._ctx.error=n?new n(t):new TypeError(t),r}function Zn(e){return new e.Collection(e,(()=>rr(""))).limit(0)}function er(e,t,n,r,i,s){for(var o=Math.min(e.length,r.length),a=-1,l=0;l<o;++l){var c=t[l];if(c!==r[l])return i(e[l],n[l])<0?e.substr(0,l)+n[l]+n.substr(l+1):i(e[l],r[l])<0?e.substr(0,l)+r[l]+n.substr(l+1):a>=0?e.substr(0,a)+t[a]+n.substr(a+1):null;i(e[l],c)<0&&(a=l)}return o<r.length&&"next"===s?e+n.substr(e.length):o<e.length&&"prev"===s?e.substr(0,n.length):a<0?null:e.substr(0,a)+r[a]+n.substr(a+1)}function tr(e,t,n,r){var i,s,o,a,l,c,u,h=n.length;if(!n.every((e=>"string"==typeof e)))return Jn(e,kn);function d(e){i=function(e){return"next"===e?e=>e.toUpperCase():e=>e.toLowerCase()}(e),s=function(e){return"next"===e?e=>e.toLowerCase():e=>e.toUpperCase()}(e),o="next"===e?Gn:Qn;var t=n.map((function(e){return{lower:s(e),upper:i(e)}})).sort((function(e,t){return o(e.lower,t.lower)}));a=t.map((function(e){return e.upper})),l=t.map((function(e){return e.lower})),c=e,u="next"===e?"":r}d("next");var f=new e.Collection(e,(()=>nr(a[0],l[h-1]+r)));f._ondirectionchange=function(e){d(e)};var p=0;return f._addAlgorithm((function(e,n,r){var i=e.key;if("string"!=typeof i)return!1;var d=s(i);if(t(d,l,p))return!0;for(var f=null,m=p;m<h;++m){var g=er(i,d,a[m],l[m],o,c);null===g&&null===f?p=m+1:(null===f||o(f,g)>0)&&(f=g)}return n(null!==f?function(){e.continue(f+u)}:r),!1})),f}function nr(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function rr(e){return{type:1,lower:e,upper:e}}class ir{get Collection(){return this._ctx.table.db.Collection}between(e,t,n,r){n=!1!==n,r=!0===r;try{return this._cmp(e,t)>0||0===this._cmp(e,t)&&(n||r)&&(!n||!r)?Zn(this):new this.Collection(this,(()=>nr(e,t,!n,!r)))}catch(e){return Jn(this,_n)}}equals(e){return null==e?Jn(this,_n):new this.Collection(this,(()=>rr(e)))}above(e){return null==e?Jn(this,_n):new this.Collection(this,(()=>nr(e,void 0,!0)))}aboveOrEqual(e){return null==e?Jn(this,_n):new this.Collection(this,(()=>nr(e,void 0,!1)))}below(e){return null==e?Jn(this,_n):new this.Collection(this,(()=>nr(void 0,e,!1,!0)))}belowOrEqual(e){return null==e?Jn(this,_n):new this.Collection(this,(()=>nr(void 0,e)))}startsWith(e){return"string"!=typeof e?Jn(this,kn):this.between(e,e+wn,!0,!0)}startsWithIgnoreCase(e){return""===e?this.startsWith(e):tr(this,((e,t)=>0===e.indexOf(t[0])),[e],wn)}equalsIgnoreCase(e){return tr(this,((e,t)=>e===t[0]),[e],"")}anyOfIgnoreCase(){var e=Ke.apply(Ie,arguments);return 0===e.length?Zn(this):tr(this,((e,t)=>-1!==t.indexOf(e)),e,"")}startsWithAnyOfIgnoreCase(){var e=Ke.apply(Ie,arguments);return 0===e.length?Zn(this):tr(this,((e,t)=>t.some((t=>0===e.indexOf(t)))),e,wn)}anyOf(){const e=Ke.apply(Ie,arguments);let t=this._cmp;try{e.sort(t)}catch(e){return Jn(this,_n)}if(0===e.length)return Zn(this);const n=new this.Collection(this,(()=>nr(e[0],e[e.length-1])));n._ondirectionchange=n=>{t="next"===n?this._ascending:this._descending,e.sort(t)};let r=0;return n._addAlgorithm(((n,i,s)=>{const o=n.key;for(;t(o,e[r])>0;)if(++r,r===e.length)return i(s),!1;return 0===t(o,e[r])||(i((()=>{n.continue(e[r])})),!1)})),n}notEqual(e){return this.inAnyRange([[xn,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const e=Ke.apply(Ie,arguments);if(0===e.length)return new this.Collection(this);try{e.sort(this._ascending)}catch(e){return Jn(this,_n)}const t=e.reduce(((e,t)=>e?e.concat([[e[e.length-1][1],t]]):[[xn,t]]),null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,t){const n=this._cmp,r=this._ascending,i=this._descending,s=this._min,o=this._max;if(0===e.length)return Zn(this);if(!e.every((e=>void 0!==e[0]&&void 0!==e[1]&&r(e[0],e[1])<=0)))return Jn(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",tt.InvalidArgument);const a=!t||!1!==t.includeLowers,l=t&&!0===t.includeUppers;let c,u=r;function h(e,t){return u(e[0],t[0])}try{c=e.reduce((function(e,t){let r=0,i=e.length;for(;r<i;++r){const i=e[r];if(n(t[0],i[1])<0&&n(t[1],i[0])>0){i[0]=s(i[0],t[0]),i[1]=o(i[1],t[1]);break}}return r===i&&e.push(t),e}),[]),c.sort(h)}catch(e){return Jn(this,_n)}let d=0;const f=l?e=>r(e,c[d][1])>0:e=>r(e,c[d][1])>=0,p=a?e=>i(e,c[d][0])>0:e=>i(e,c[d][0])>=0;let m=f;const g=new this.Collection(this,(()=>nr(c[0][0],c[c.length-1][1],!a,!l)));return g._ondirectionchange=e=>{"next"===e?(m=f,u=r):(m=p,u=i),c.sort(h)},g._addAlgorithm(((e,t,n)=>{for(var i=e.key;m(i);)if(++d,d===c.length)return t(n),!1;return!!function(e){return!f(e)&&!p(e)}(i)||(0===this._cmp(i,c[d][1])||0===this._cmp(i,c[d][0])||t((()=>{u===r?e.continue(c[d][0]):e.continue(c[d][1])})),!1)})),g}startsWithAnyOf(){const e=Ke.apply(Ie,arguments);return e.every((e=>"string"==typeof e))?0===e.length?Zn(this):this.inAnyRange(e.map((e=>[e,e+wn]))):Jn(this,"startsWithAnyOf() only works with strings")}}function sr(e){return Ht((function(t){return or(t),e(t.target.error),!1}))}function or(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}const ar="storagemutated",lr="x-storagemutated-1",cr=Dn(null,ar);class ur{_lock(){return we(!St.global),++this._reculock,1!==this._reculock||St.global||(St.lockOwnerFor=this),this}_unlock(){if(we(!St.global),0==--this._reculock)for(St.global||(St.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{hn(e[1],e[0])}catch(e){}}return this}_locked(){return this._reculock&&St.lockOwnerFor!==this}create(e){if(!this.mode)return this;const t=this.db.idbdb,n=this.db._state.dbOpenError;if(we(!this.idbtrans),!e&&!t)switch(n&&n.name){case"DatabaseClosedError":throw new tt.DatabaseClosed(n);case"MissingAPIError":throw new tt.MissingAPI(n.message,n);default:throw new tt.OpenFailed(n)}if(!this.active)throw new tt.TransactionInactive;return we(null===this._completion._state),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):t.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=Ht((t=>{or(t),this._reject(e.error)})),e.onabort=Ht((t=>{or(t),this.active&&this._reject(new tt.Abort(e.error)),this.active=!1,this.on("abort").fire(t)})),e.oncomplete=Ht((()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&cr.storagemutated.fire(e.mutatedParts)})),this}_promise(e,t,n){if("readwrite"===e&&"readwrite"!==this.mode)return yn(new tt.ReadOnly("Transaction is readonly"));if(!this.active)return yn(new tt.TransactionInactive);if(this._locked())return new Bt(((r,i)=>{this._blockedFuncs.push([()=>{this._promise(e,t,n).then(r,i)},St])}));if(n)return nn((()=>{var e=new Bt(((e,n)=>{this._lock();const r=t(e,n,this);r&&r.then&&r.then(e,n)}));return e.finally((()=>this._unlock())),e._lib=!0,e}));var r=new Bt(((e,n)=>{var r=t(e,n,this);r&&r.then&&r.then(e,n)}));return r._lib=!0,r}_root(){return this.parent?this.parent._root():this}waitFor(e){var t=this._root();const n=Bt.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then((()=>n));else{t._waitingFor=n,t._waitingQueue=[];var r=t.idbtrans.objectStore(t.storeNames[0]);!function e(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(r.get(-1/0).onsuccess=e)}()}var i=t._waitingFor;return new Bt(((e,r)=>{n.then((n=>t._waitingQueue.push(Ht(e.bind(null,n)))),(e=>t._waitingQueue.push(Ht(r.bind(null,e))))).finally((()=>{t._waitingFor===i&&(t._waitingFor=null)}))}))}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new tt.Abort))}table(e){const t=this._memoizedTables||(this._memoizedTables={});if(ue(t,e))return t[e];const n=this.schema[e];if(!n)throw new tt.NotFound("Table "+e+" not part of transaction");const r=new this.db.Table(e,n,this);return r.core=this.db.core.table(e),t[e]=r,r}}function hr(e,t,n,r,i,s,o){return{name:e,keyPath:t,unique:n,multi:r,auto:i,compound:s,src:(n&&!o?"&":"")+(r?"*":"")+(i?"++":"")+dr(t)}}function dr(e){return"string"==typeof e?e:e?"["+[].join.call(e,"+")+"]":""}function fr(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:_e(n,(e=>[e.name,e]))}}let pr=e=>{try{return e.only([[]]),pr=()=>[[]],[[]]}catch(e){return pr=()=>wn,wn}};function mr(e){return null==e?()=>{}:"string"==typeof e?function(e){return 1===e.split(".").length?t=>t[e]:t=>ke(t,e)}(e):t=>ke(t,e)}function gr(e){return[].slice.call(e)}let yr=0;function br(e){return null==e?":id":"string"==typeof e?e:`[${e.join("+")}]`}function vr(e,t,n){function r(e){if(3===e.type)return null;if(4===e.type)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:n,upper:r,lowerOpen:i,upperOpen:s}=e;return void 0===n?void 0===r?null:t.upperBound(r,!!s):void 0===r?t.lowerBound(n,!!i):t.bound(n,r,!!i,!!s)}const{schema:i,hasGetAll:s}=function(e,t){const n=gr(e.objectStoreNames);return{schema:{name:e.name,tables:n.map((e=>t.objectStore(e))).map((e=>{const{keyPath:t,autoIncrement:n}=e,r=oe(t),i=null==t,s={},o={name:e.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:i,compound:r,keyPath:t,autoIncrement:n,unique:!0,extractKey:mr(t)},indexes:gr(e.indexNames).map((t=>e.index(t))).map((e=>{const{name:t,unique:n,multiEntry:r,keyPath:i}=e,o={name:t,compound:oe(i),keyPath:i,unique:n,multiEntry:r,extractKey:mr(i)};return s[br(i)]=o,o})),getIndexByKeyPath:e=>s[br(e)]};return s[":id"]=o.primaryKey,null!=t&&(s[br(t)]=o.primaryKey),o}))},hasGetAll:n.length>0&&"getAll"in t.objectStore(n[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(e,n),o=i.tables.map((e=>function(e){const t=e.name;return{name:t,schema:e,mutate:function({trans:e,type:n,keys:i,values:s,range:o}){return new Promise(((a,l)=>{a=Ht(a);const c=e.objectStore(t),u=null==c.keyPath,h="put"===n||"add"===n;if(!h&&"delete"!==n&&"deleteRange"!==n)throw new Error("Invalid operation type: "+n);const{length:d}=i||s||{length:1};if(i&&s&&i.length!==s.length)throw new Error("Given keys array must have same length as given values array.");if(0===d)return a({numFailures:0,failures:{},results:[],lastResult:void 0});let f;const p=[],m=[];let g=0;const y=e=>{++g,or(e)};if("deleteRange"===n){if(4===o.type)return a({numFailures:g,failures:m,results:[],lastResult:void 0});3===o.type?p.push(f=c.clear()):p.push(f=c.delete(r(o)))}else{const[e,t]=h?u?[s,i]:[s,null]:[i,null];if(h)for(let r=0;r<d;++r)p.push(f=t&&void 0!==t[r]?c[n](e[r],t[r]):c[n](e[r])),f.onerror=y;else for(let t=0;t<d;++t)p.push(f=c[n](e[t])),f.onerror=y}const b=e=>{const t=e.target.result;p.forEach(((e,t)=>null!=e.error&&(m[t]=e.error))),a({numFailures:g,failures:m,results:"delete"===n?i:p.map((e=>e.result)),lastResult:t})};f.onerror=e=>{y(e),b(e)},f.onsuccess=b}))},getMany:({trans:e,keys:n})=>new Promise(((r,i)=>{r=Ht(r);const s=e.objectStore(t),o=n.length,a=new Array(o);let l,c=0,u=0;const h=e=>{const t=e.target;a[t._pos]=t.result,++u===c&&r(a)},d=sr(i);for(let e=0;e<o;++e)null!=n[e]&&(l=s.get(n[e]),l._pos=e,l.onsuccess=h,l.onerror=d,++c);0===c&&r(a)})),get:({trans:e,key:n})=>new Promise(((r,i)=>{r=Ht(r);const s=e.objectStore(t).get(n);s.onsuccess=e=>r(e.target.result),s.onerror=sr(i)})),query:function(e){return n=>new Promise(((i,s)=>{i=Ht(i);const{trans:o,values:a,limit:l,query:c}=n,u=l===1/0?void 0:l,{index:h,range:d}=c,f=o.objectStore(t),p=h.isPrimaryKey?f:f.index(h.name),m=r(d);if(0===l)return i({result:[]});if(e){const e=a?p.getAll(m,u):p.getAllKeys(m,u);e.onsuccess=e=>i({result:e.target.result}),e.onerror=sr(s)}else{let e=0;const t=a||!("openKeyCursor"in p)?p.openCursor(m):p.openKeyCursor(m),n=[];t.onsuccess=r=>{const s=t.result;return s?(n.push(a?s.value:s.primaryKey),++e===l?i({result:n}):void s.continue()):i({result:n})},t.onerror=sr(s)}}))}(s),openCursor:function({trans:e,values:n,query:i,reverse:s,unique:o}){return new Promise(((a,l)=>{a=Ht(a);const{index:c,range:u}=i,h=e.objectStore(t),d=c.isPrimaryKey?h:h.index(c.name),f=s?o?"prevunique":"prev":o?"nextunique":"next",p=n||!("openKeyCursor"in d)?d.openCursor(r(u),f):d.openKeyCursor(r(u),f);p.onerror=sr(l),p.onsuccess=Ht((t=>{const n=p.result;if(!n)return void a(null);n.___id=++yr,n.done=!1;const r=n.continue.bind(n);let i=n.continuePrimaryKey;i&&(i=i.bind(n));const s=n.advance.bind(n),o=()=>{throw new Error("Cursor not stopped")};n.trans=e,n.stop=n.continue=n.continuePrimaryKey=n.advance=()=>{throw new Error("Cursor not started")},n.fail=Ht(l),n.next=function(){let e=1;return this.start((()=>e--?this.continue():this.stop())).then((()=>this))},n.start=e=>{const t=new Promise(((e,t)=>{e=Ht(e),p.onerror=sr(t),n.fail=t,n.stop=t=>{n.stop=n.continue=n.continuePrimaryKey=n.advance=o,e(t)}})),a=()=>{if(p.result)try{e()}catch(e){n.fail(e)}else n.done=!0,n.start=()=>{throw new Error("Cursor behind last entry")},n.stop()};return p.onsuccess=Ht((e=>{p.onsuccess=a,a()})),n.continue=r,n.continuePrimaryKey=i,n.advance=s,a(),t},a(n)}),l)}))},count({query:e,trans:n}){const{index:i,range:s}=e;return new Promise(((e,o)=>{const a=n.objectStore(t),l=i.isPrimaryKey?a:a.index(i.name),c=r(s),u=c?l.count(c):l.count();u.onsuccess=Ht((t=>e(t.target.result))),u.onerror=sr(o)}))}}}(e))),a={};return o.forEach((e=>a[e.name]=e)),{stack:"dbcore",transaction:e.transaction.bind(e),table(e){if(!a[e])throw new Error(`Table '${e}' not found`);return a[e]},MIN_KEY:-1/0,MAX_KEY:pr(t),schema:i}}function wr({_novip:e},t){const n=t.db,r=function(e,t,{IDBKeyRange:n,indexedDB:r},i){const s=function(e,t){return t.reduce(((e,{create:t})=>({...e,...t(e)})),e)}(vr(t,n,i),e.dbcore);return{dbcore:s}}(e._middlewares,n,e._deps,t);e.core=r.dbcore,e.tables.forEach((t=>{const n=t.name;e.core.schema.tables.some((e=>e.name===n))&&(t.core=e.core.table(n),e[n]instanceof e.Table&&(e[n].core=t.core))}))}function xr({_novip:e},t,n,r){n.forEach((n=>{const i=r[n];t.forEach((t=>{const r=ge(t,n);(!r||"value"in r&&void 0===r.value)&&(t===e.Transaction.prototype||t instanceof e.Transaction?fe(t,n,{get(){return this.table(n)},set(e){de(this,n,{value:e,writable:!0,configurable:!0,enumerable:!0})}}):t[n]=new e.Table(n,i))}))}))}function _r({_novip:e},t){t.forEach((t=>{for(let n in t)t[n]instanceof e.Table&&delete t[n]}))}function kr(e,t){return e._cfg.version-t._cfg.version}function Er(e,t,n,r){const i=e._dbSchema,s=e._createTransaction("readwrite",e._storeNames,i);s.create(n),s._completion.catch(r);const o=s._reject.bind(s),a=St.transless||St;nn((()=>{St.trans=s,St.transless=a,0===t?(se(i).forEach((e=>{Nr(n,e,i[e].primKey,i[e].indexes)})),wr(e,n),Bt.follow((()=>e.on.populate.fire(s))).catch(o)):function({_novip:e},t,n,r){const i=[],s=e._versions;let o=e._dbSchema=$r(e,e.idbdb,r),a=!1;function l(){return i.length?Bt.resolve(i.shift()(n.idbtrans)).then(l):Bt.resolve()}return s.filter((e=>e._cfg.version>=t)).forEach((s=>{i.push((()=>{const i=o,l=s._cfg.dbschema;Pr(e,i,r),Pr(e,l,r),o=e._dbSchema=l;const c=Ar(i,l);c.add.forEach((e=>{Nr(r,e[0],e[1].primKey,e[1].indexes)})),c.change.forEach((e=>{if(e.recreate)throw new tt.Upgrade("Not yet support for changing primary key");{const t=r.objectStore(e.name);e.add.forEach((e=>Or(t,e))),e.change.forEach((e=>{t.deleteIndex(e.name),Or(t,e)})),e.del.forEach((e=>t.deleteIndex(e)))}}));const u=s._cfg.contentUpgrade;if(u&&s._cfg.version>t){wr(e,r),n._memoizedTables={},a=!0;let t=Ae(l);c.del.forEach((e=>{t[e]=i[e]})),_r(e,[e.Transaction.prototype]),xr(e,[e.Transaction.prototype],se(t),t),n.schema=t;const s=Re(u);let o;s&&rn();const h=Bt.follow((()=>{if(o=u(n),o&&s){var e=sn.bind(null,null);o.then(e,e)}}));return o&&"function"==typeof o.then?Bt.resolve(o):h.then((()=>o))}})),i.push((t=>{if(!a||!Nn){!function(e,t){[].slice.call(t.db.objectStoreNames).forEach((n=>null==e[n]&&t.db.deleteObjectStore(n)))}(s._cfg.dbschema,t)}_r(e,[e.Transaction.prototype]),xr(e,[e.Transaction.prototype],e._storeNames,e._dbSchema),n.schema=e._dbSchema}))})),l().then((()=>{var e,t;t=r,se(e=o).forEach((n=>{t.db.objectStoreNames.contains(n)||Nr(t,n,e[n].primKey,e[n].indexes)}))}))}(e,t,s,n).catch(o)}))}function Ar(e,t){const n={del:[],add:[],change:[]};let r;for(r in e)t[r]||n.del.push(r);for(r in t){const i=e[r],s=t[r];if(i){const e={name:r,def:s,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(s.primKey.keyPath||"")||i.primKey.auto!==s.primKey.auto&&!An)e.recreate=!0,n.change.push(e);else{const t=i.idxByName,r=s.idxByName;let o;for(o in t)r[o]||e.del.push(o);for(o in r){const n=t[o],i=r[o];n?n.src!==i.src&&e.change.push(i):e.add.push(i)}(e.del.length>0||e.add.length>0||e.change.length>0)&&n.change.push(e)}}else n.add.push([r,s])}return n}function Nr(e,t,n,r){const i=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach((e=>Or(i,e))),i}function Or(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function $r(e,t,n){const r={};return be(t.objectStoreNames,0).forEach((e=>{const t=n.objectStore(e);let i=t.keyPath;const s=hr(dr(i),i||"",!1,!1,!!t.autoIncrement,i&&"string"!=typeof i,!0),o=[];for(let e=0;e<t.indexNames.length;++e){const n=t.index(t.indexNames[e]);i=n.keyPath;var a=hr(n.name,i,!!n.unique,!!n.multiEntry,!1,i&&"string"!=typeof i,!1);o.push(a)}r[e]=fr(e,s,o)})),r}function Pr({_novip:e},t,n){const r=n.db.objectStoreNames;for(let i=0;i<r.length;++i){const s=r[i],o=n.objectStore(s);e._hasGetAll="getAll"in o;for(let e=0;e<o.indexNames.length;++e){const n=o.indexNames[e],r=o.index(n).keyPath,i="string"==typeof r?r:"["+be(r).join("+")+"]";if(t[s]){const e=t[s].idxByName[i];e&&(e.name=n,delete t[s].idxByName[i],t[s].idxByName[n]=e)}}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&ie.WorkerGlobalScope&&ie instanceof ie.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}class Sr{_parseStoresSpec(e,t){se(e).forEach((n=>{if(null!==e[n]){var r=e[n].split(",").map(((e,t)=>{const n=(e=e.trim()).replace(/([&*]|\+\+)/g,""),r=/^\[/.test(n)?n.match(/^\[(.*)\]$/)[1].split("+"):n;return hr(n,r||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),oe(r),0===t)})),i=r.shift();if(i.multi)throw new tt.Schema("Primary key cannot be multi-valued");r.forEach((e=>{if(e.auto)throw new tt.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new tt.Schema("Index must have a name and cannot be an empty string")})),t[n]=fr(n,i,r)}}))}stores(e){const t=this.db;this._cfg.storesSource=this._cfg.storesSource?ae(this._cfg.storesSource,e):e;const n=t._versions,r={};let i={};return n.forEach((e=>{ae(r,e._cfg.storesSource),i=e._cfg.dbschema={},e._parseStoresSpec(r,i)})),t._dbSchema=i,_r(t,[t._allTables,t,t.Transaction.prototype]),xr(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],se(i),i),t._storeNames=se(i),this}upgrade(e){return this._cfg.contentUpgrade=dt(this._cfg.contentUpgrade||it,e),this}}function Cr(e,t){let n=e._dbNamesDB;return n||(n=e._dbNamesDB=new Zr(Pn,{addons:[],indexedDB:e,IDBKeyRange:t}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function Tr(e){return e&&"function"==typeof e.databases}function jr(e){return nn((function(){return St.letThrough=!0,e()}))}function Br(){var e;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise((function(t){var n=function(){return indexedDB.databases().finally(t)};e=setInterval(n,100),n()})).finally((function(){return clearInterval(e)})):Promise.resolve()}function Fr(e){const t=e._state,{indexedDB:n}=e._deps;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then((()=>t.dbOpenError?yn(t.dbOpenError):e));Me&&(t.openCanceller._stackHolder=Ve()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;const r=t.openCanceller;function i(){if(t.openCanceller!==r)throw new tt.DatabaseClosed("db.open() was cancelled")}let s=t.dbReadyResolve,o=null,a=!1;return Bt.race([r,("undefined"==typeof navigator?Bt.resolve():Br()).then((()=>new Bt(((r,s)=>{if(i(),!n)throw new tt.MissingAPI;const l=e.name,c=t.autoSchema?n.open(l):n.open(l,Math.round(10*e.verno));if(!c)throw new tt.MissingAPI;c.onerror=sr(s),c.onblocked=Ht(e._fireOnBlocked),c.onupgradeneeded=Ht((r=>{if(o=c.transaction,t.autoSchema&&!e._options.allowEmptyDB){c.onerror=or,o.abort(),c.result.close();const e=n.deleteDatabase(l);e.onsuccess=e.onerror=Ht((()=>{s(new tt.NoSuchDatabase(`Database ${l} doesnt exist`))}))}else{o.onerror=sr(s);var i=r.oldVersion>Math.pow(2,62)?0:r.oldVersion;a=i<1,e._novip.idbdb=c.result,Er(e,i/10,o,s)}}),s),c.onsuccess=Ht((()=>{o=null;const n=e._novip.idbdb=c.result,i=be(n.objectStoreNames);if(i.length>0)try{const r=n.transaction(1===(s=i).length?s[0]:s,"readonly");t.autoSchema?function({_novip:e},t,n){e.verno=t.version/10;const r=e._dbSchema=$r(0,t,n);e._storeNames=be(t.objectStoreNames,0),xr(e,[e._allTables],se(r),r)}(e,n,r):(Pr(e,e._dbSchema,r),function(e,t){const n=Ar($r(0,e.idbdb,t),e._dbSchema);return!(n.add.length||n.change.some((e=>e.add.length||e.change.length)))}(e,r)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),wr(e,r)}catch(e){}var s;En.push(e),n.onversionchange=Ht((n=>{t.vcFired=!0,e.on("versionchange").fire(n)})),n.onclose=Ht((t=>{e.on("close").fire(t)})),a&&function({indexedDB:e,IDBKeyRange:t},n){!Tr(e)&&n!==Pn&&Cr(e,t).put({name:n}).catch(it)}(e._deps,l),r()}),s)}))))]).then((()=>(i(),t.onReadyBeingFired=[],Bt.resolve(jr((()=>e.on.ready.fire(e.vip)))).then((function n(){if(t.onReadyBeingFired.length>0){let r=t.onReadyBeingFired.reduce(dt,it);return t.onReadyBeingFired=[],Bt.resolve(jr((()=>r(e.vip)))).then(n)}}))))).finally((()=>{t.onReadyBeingFired=null,t.isBeingOpened=!1})).then((()=>e)).catch((n=>{t.dbOpenError=n;try{o&&o.abort()}catch(e){}return r===t.openCanceller&&e._close(),yn(n)})).finally((()=>{t.openComplete=!0,s()}))}function Dr(e){var t=t=>e.next(t),n=i(t),r=i((t=>e.throw(t)));function i(e){return t=>{var i=e(t),s=i.value;return i.done?s:s&&"function"==typeof s.then?s.then(n,r):oe(s)?Promise.all(s).then(n,r):n(s)}}return i(t)()}function Ir(e,t,n){var r=arguments.length;if(r<2)throw new tt.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];n=i.pop();var s=Oe(i);return[e,s,n]}function Kr(e,t,n,r,i){return Bt.resolve().then((()=>{const s=St.transless||St,o=e._createTransaction(t,n,e._dbSchema,r),a={trans:o,transless:s};if(r)o.idbtrans=r.idbtrans;else try{o.create(),e._state.PR1398_maxLoop=3}catch(r){return r.name===Ze.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then((()=>Kr(e,t,n,null,i)))):yn(r)}const l=Re(i);let c;l&&rn();const u=Bt.follow((()=>{if(c=i.call(o,o),c)if(l){var e=sn.bind(null,null);c.then(e,e)}else"function"==typeof c.next&&"function"==typeof c.throw&&(c=Dr(c))}),a);return(c&&"function"==typeof c.then?Bt.resolve(c).then((e=>o.active?e:yn(new tt.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn")))):u.then((()=>c))).then((e=>(r&&o._resolve(),o._completion.then((()=>e))))).catch((e=>(o._reject(e),yn(e))))}))}function Rr(e,t,n){const r=oe(e)?e.slice():[e];for(let e=0;e<n;++e)r.push(t);return r}const Mr={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return{...e,table(t){const n=e.table(t),{schema:r}=n,i={},s=[];function o(e,t,n){const r=br(e),a=i[r]=i[r]||[],l=null==e?0:"string"==typeof e?1:e.length,c=t>0,u={...n,isVirtual:c,keyTail:t,keyLength:l,extractKey:mr(e),unique:!c&&n.unique};if(a.push(u),u.isPrimaryKey||s.push(u),l>1){o(2===l?e[0]:e.slice(0,l-1),t+1,n)}return a.sort(((e,t)=>e.keyTail-t.keyTail)),u}const a=o(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[a];for(const e of r.indexes)o(e.keyPath,0,e);function l(t){const n=t.query.index;return n.isVirtual?{...t,query:{index:n,range:(r=t.query.range,i=n.keyTail,{type:1===r.type?2:r.type,lower:Rr(r.lower,r.lowerOpen?e.MAX_KEY:e.MIN_KEY,i),lowerOpen:!0,upper:Rr(r.upper,r.upperOpen?e.MIN_KEY:e.MAX_KEY,i),upperOpen:!0})}}:t;var r,i}const c={...n,schema:{...r,primaryKey:a,indexes:s,getIndexByKeyPath:function(e){const t=i[br(e)];return t&&t[0]}},count:e=>n.count(l(e)),query:e=>n.query(l(e)),openCursor(t){const{keyTail:r,isVirtual:i,keyLength:s}=t.query.index;if(!i)return n.openCursor(t);return n.openCursor(l(t)).then((n=>n&&function(n){const i=Object.create(n,{continue:{value:function(i){null!=i?n.continue(Rr(i,t.reverse?e.MAX_KEY:e.MIN_KEY,r)):t.unique?n.continue(n.key.slice(0,s).concat(t.reverse?e.MIN_KEY:e.MAX_KEY,r)):n.continue()}},continuePrimaryKey:{value(t,i){n.continuePrimaryKey(Rr(t,e.MAX_KEY,r),i)}},primaryKey:{get:()=>n.primaryKey},key:{get(){const e=n.key;return 1===s?e[0]:e.slice(0,s)}},value:{get:()=>n.value}});return i}(n)))}};return c}}}};function Lr(e,t,n,r){return n=n||{},r=r||"",se(e).forEach((i=>{if(ue(t,i)){var s=e[i],o=t[i];if("object"==typeof s&&"object"==typeof o&&s&&o){const e=Be(s);e!==Be(o)?n[r+i]=t[i]:"Object"===e?Lr(s,o,n,r+i+"."):s!==o&&(n[r+i]=t[i])}else s!==o&&(n[r+i]=t[i])}else n[r+i]=void 0})),se(t).forEach((i=>{ue(e,i)||(n[r+i]=t[i])})),n}const zr={stack:"dbcore",name:"HooksMiddleware",level:2,create:e=>({...e,table(t){const n=e.table(t),{primaryKey:r}=n.schema,i={...n,mutate(e){const i=St.trans,{deleting:s,creating:o,updating:a}=i.table(t).hook;switch(e.type){case"add":if(o.fire===it)break;return i._promise("readwrite",(()=>l(e)),!0);case"put":if(o.fire===it&&a.fire===it)break;return i._promise("readwrite",(()=>l(e)),!0);case"delete":if(s.fire===it)break;return i._promise("readwrite",(()=>l(e)),!0);case"deleteRange":if(s.fire===it)break;return i._promise("readwrite",(()=>function(e){return c(e.trans,e.range,1e4)}(e)),!0)}return n.mutate(e);function l(e){const t=St.trans,i=e.keys||function(e,t){return"delete"===t.type?t.keys:t.keys||t.values.map(e.extractKey)}(r,e);if(!i)throw new Error("Keys missing");return"delete"!==(e="add"===e.type||"put"===e.type?{...e,keys:i}:{...e}).type&&(e.values=[...e.values]),e.keys&&(e.keys=[...e.keys]),function(e,t,n){return"add"===t.type?Promise.resolve([]):e.getMany({trans:t.trans,keys:n,cache:"immutable"})}(n,e,i).then((l=>{const c=i.map(((n,i)=>{const c=l[i],u={onerror:null,onsuccess:null};if("delete"===e.type)s.fire.call(u,n,c,t);else if("add"===e.type||void 0===c){const s=o.fire.call(u,n,e.values[i],t);null==n&&null!=s&&(n=s,e.keys[i]=n,r.outbound||Ee(e.values[i],r.keyPath,n))}else{const r=Lr(c,e.values[i]),s=a.fire.call(u,r,n,c,t);if(s){const t=e.values[i];Object.keys(s).forEach((e=>{ue(t,e)?t[e]=s[e]:Ee(t,e,s[e])}))}}return u}));return n.mutate(e).then((({failures:t,results:n,numFailures:r,lastResult:s})=>{for(let r=0;r<i.length;++r){const s=n?n[r]:i[r],o=c[r];null==s?o.onerror&&o.onerror(t[r]):o.onsuccess&&o.onsuccess("put"===e.type&&l[r]?e.values[r]:s)}return{failures:t,results:n,numFailures:r,lastResult:s}})).catch((e=>(c.forEach((t=>t.onerror&&t.onerror(e))),Promise.reject(e))))}))}function c(e,t,i){return n.query({trans:e,values:!1,query:{index:r,range:t},limit:i}).then((({result:n})=>l({type:"delete",keys:n,trans:e}).then((r=>r.numFailures>0?Promise.reject(r.failures[0]):n.length<i?{failures:[],numFailures:0,lastResult:void 0}:c(e,{...t,lower:n[n.length-1],lowerOpen:!0},i)))))}}};return i}})};function qr(e,t,n){try{if(!t)return null;if(t.keys.length<e.length)return null;const r=[];for(let i=0,s=0;i<t.keys.length&&s<e.length;++i)0===Un(t.keys[i],e[s])&&(r.push(n?Ce(t.values[i]):t.values[i]),++s);return r.length===e.length?r:null}catch(e){return null}}const Vr={stack:"dbcore",level:-1,create:e=>({table:t=>{const n=e.table(t);return{...n,getMany:e=>{if(!e.cache)return n.getMany(e);const t=qr(e.keys,e.trans._cache,"clone"===e.cache);return t?Bt.resolve(t):n.getMany(e).then((t=>(e.trans._cache={keys:e.keys,values:"clone"===e.cache?Ce(t):t},t)))},mutate:e=>("add"!==e.type&&(e.trans._cache=null),n.mutate(e))}}})};function Ur(e){return!("from"in e)}const Wr=function(e,t){if(!this){const t=new Wr;return e&&"d"in e&&ae(t,e),t}ae(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0})};function Xr(e,t,n){const r=Un(t,n);if(isNaN(r))return;if(r>0)throw RangeError();if(Ur(e))return ae(e,{from:t,to:n,d:1});const i=e.l,s=e.r;if(Un(n,e.from)<0)return i?Xr(i,t,n):e.l={from:t,to:n,d:1,l:null,r:null},Gr(e);if(Un(t,e.to)>0)return s?Xr(s,t,n):e.r={from:t,to:n,d:1,l:null,r:null},Gr(e);Un(t,e.from)<0&&(e.from=t,e.l=null,e.d=s?s.d+1:1),Un(n,e.to)>0&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1);const o=!e.r;i&&!e.l&&Yr(e,i),s&&o&&Yr(e,s)}function Yr(e,t){Ur(t)||function e(t,{from:n,to:r,l:i,r:s}){Xr(t,n,r),i&&e(t,i),s&&e(t,s)}(e,t)}function Hr(e){let t=Ur(e)?null:{s:0,n:e};return{next(e){const n=arguments.length>0;for(;t;)switch(t.s){case 0:if(t.s=1,n)for(;t.n.l&&Un(e,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!n||Un(e,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function Gr(e){var t,n;const r=((null===(t=e.r)||void 0===t?void 0:t.d)||0)-((null===(n=e.l)||void 0===n?void 0:n.d)||0),i=r>1?"r":r<-1?"l":"";if(i){const t="r"===i?"l":"r",n={...e},r=e[i];e.from=r.from,e.to=r.to,e[i]=r[i],n[i]=r[t],e[t]=n,n.d=Qr(n)}e.d=Qr(e)}function Qr({r:e,l:t}){return(e?t?Math.max(e.d,t.d):e.d:t?t.d:0)+1}he(Wr.prototype,{add(e){return Yr(this,e),this},addKey(e){return Xr(this,e,e),this},addKeys(e){return e.forEach((e=>Xr(this,e,e))),this},[Fe](){return Hr(this)}});const Jr={stack:"dbcore",level:0,create:e=>{const t=e.schema.name,n=new Wr(e.MIN_KEY,e.MAX_KEY);return{...e,table:r=>{const i=e.table(r),{schema:s}=i,{primaryKey:o}=s,{extractKey:a,outbound:l}=o,c={...i,mutate:e=>{const o=e.trans,a=o.mutatedParts||(o.mutatedParts={}),l=e=>{const n=`idb://${t}/${r}/${e}`;return a[n]||(a[n]=new Wr)},c=l(""),u=l(":dels"),{type:h}=e;let[d,f]="deleteRange"===e.type?[e.range]:"delete"===e.type?[e.keys]:e.values.length<50?[[],e.values]:[];const p=e.trans._cache;return i.mutate(e).then((e=>{if(oe(d)){"delete"!==h&&(d=e.results),c.addKeys(d);const t=qr(d,p);t||"add"===h||u.addKeys(d),(t||f)&&function(e,t,n,r){function i(t){const i=e(t.name||"");function s(e){return null!=e?t.extractKey(e):null}const o=e=>t.multiEntry&&oe(e)?e.forEach((e=>i.addKey(e))):i.addKey(e);(n||r).forEach(((e,t)=>{const i=n&&s(n[t]),a=r&&s(r[t]);0!==Un(i,a)&&(null!=i&&o(i),null!=a&&o(a))}))}t.indexes.forEach(i)}(l,s,t,f)}else if(d){const e={from:d.lower,to:d.upper};u.add(e),c.add(e)}else c.add(n),u.add(n),s.indexes.forEach((e=>l(e.name).add(n)));return e}))}},u=({query:{index:t,range:n}})=>{var r,i;return[t,new Wr(null!==(r=n.lower)&&void 0!==r?r:e.MIN_KEY,null!==(i=n.upper)&&void 0!==i?i:e.MAX_KEY)]},h={get:e=>[o,new Wr(e.key)],getMany:e=>[o,(new Wr).addKeys(e.keys)],count:u,query:u,openCursor:u};return se(h).forEach((e=>{c[e]=function(s){const{subscr:o}=St;if(o){const c=e=>{const n=`idb://${t}/${r}/${e}`;return o[n]||(o[n]=new Wr)},u=c(""),d=c(":dels"),[f,p]=h[e](s);if(c(f.name||"").add(p),!f.isPrimaryKey){if("count"!==e){const t="query"===e&&l&&s.values&&i.query({...s,values:!1});return i[e].apply(this,arguments).then((n=>{if("query"===e){if(l&&s.values)return t.then((({result:e})=>(u.addKeys(e),n)));const e=s.values?n.result.map(a):n.result;s.values?u.addKeys(e):d.addKeys(e)}else if("openCursor"===e){const e=n,t=s.values;return e&&Object.create(e,{key:{get:()=>(d.addKey(e.primaryKey),e.key)},primaryKey:{get(){const t=e.primaryKey;return d.addKey(t),t}},value:{get:()=>(t&&u.addKey(e.primaryKey),e.value)}})}return n}))}d.add(n)}}return i[e].apply(this,arguments)}})),c}}}};class Zr{constructor(e,t){this._middlewares={},this.verno=0;const n=Zr.dependencies;this._options=t={addons:Zr.addons,autoOpen:!0,indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange,...t},this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange};const{addons:r}=t;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const i={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:it,dbReadyPromise:null,cancelOpen:it,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};i.dbReadyPromise=new Bt((e=>{i.dbReadyResolve=e})),i.openCanceller=new Bt(((e,t)=>{i.cancelOpen=t})),this._state=i,this.name=e,this.on=Dn(this,"populate","blocked","versionchange","close",{ready:[dt,it]}),this.on.ready.subscribe=ve(this.on.ready.subscribe,(e=>(t,n)=>{Zr.vip((()=>{const r=this._state;if(r.openComplete)r.dbOpenError||Bt.resolve().then(t),n&&e(t);else if(r.onReadyBeingFired)r.onReadyBeingFired.push(t),n&&e(t);else{e(t);const r=this;n||e((function e(){r.on.ready.unsubscribe(t),r.on.ready.unsubscribe(e)}))}}))})),this.Collection=function(e){return In(Yn.prototype,(function(t,n){this.db=e;let r=jn,i=null;if(n)try{r=n()}catch(e){i=e}const s=t._ctx,o=s.table,a=o.hook.reading.fire;this._ctx={table:o,index:s.index,isPrimKey:!s.index||o.schema.primKey.keyPath&&s.index===o.schema.primKey.name,range:r,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:i,or:s.or,valueMapper:a!==st?a:null}}))}(this),this.Table=function(e){return In(Fn.prototype,(function(t,n,r){this.db=e,this._tx=r,this.name=t,this.schema=n,this.hook=e._allTables[t]?e._allTables[t].hook:Dn(null,{creating:[lt,it],reading:[ot,st],updating:[ut,it],deleting:[ct,it]})}))}(this),this.Transaction=function(e){return In(ur.prototype,(function(t,n,r,i,s){this.db=e,this.mode=t,this.storeNames=n,this.schema=r,this.chromeTransactionDurability=i,this.idbtrans=null,this.on=Dn(this,"complete","error","abort"),this.parent=s||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Bt(((e,t)=>{this._resolve=e,this._reject=t})),this._completion.then((()=>{this.active=!1,this.on.complete.fire()}),(e=>{var t=this.active;return this.active=!1,this.on.error.fire(e),this.parent?this.parent._reject(e):t&&this.idbtrans&&this.idbtrans.abort(),yn(e)}))}))}(this),this.Version=function(e){return In(Sr.prototype,(function(t){this.db=e,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}}))}(this),this.WhereClause=function(e){return In(ir.prototype,(function(t,n,r){this.db=e,this._ctx={table:t,index:":id"===n?null:n,or:r};const i=e._deps.indexedDB;if(!i)throw new tt.MissingAPI;this._cmp=this._ascending=i.cmp.bind(i),this._descending=(e,t)=>i.cmp(t,e),this._max=(e,t)=>i.cmp(e,t)>0?e:t,this._min=(e,t)=>i.cmp(e,t)<0?e:t,this._IDBKeyRange=e._deps.IDBKeyRange}))}(this),this.on("versionchange",(e=>{e.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()})),this.on("blocked",(e=>{!e.newVersion||e.newVersion<e.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${e.oldVersion/10}`)})),this._maxKey=pr(t.IDBKeyRange),this._createTransaction=(e,t,n,r)=>new this.Transaction(e,t,n,this._options.chromeTransactionDurability,r),this._fireOnBlocked=e=>{this.on("blocked").fire(e),En.filter((e=>e.name===this.name&&e!==this&&!e._state.vcFired)).map((t=>t.on("versionchange").fire(e)))},this.use(Mr),this.use(zr),this.use(Jr),this.use(Vr),this.vip=Object.create(this,{_vip:{value:!0}}),r.forEach((e=>e(this)))}version(e){if(isNaN(e)||e<.1)throw new tt.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new tt.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);const t=this._versions;var n=t.filter((t=>t._cfg.version===e))[0];return n||(n=new this.Version(e),t.push(n),t.sort(kr),n.stores({}),this._state.autoSchema=!1,n)}_whenReady(e){return this.idbdb&&(this._state.openComplete||St.letThrough||this._vip)?e():new Bt(((e,t)=>{if(this._state.openComplete)return t(new tt.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void t(new tt.DatabaseClosed);this.open().catch(it)}this._state.dbReadyPromise.then(e,t)})).then(e)}use({stack:e,create:t,level:n,name:r}){r&&this.unuse({stack:e,name:r});const i=this._middlewares[e]||(this._middlewares[e]=[]);return i.push({stack:e,create:t,level:null==n?10:n,name:r}),i.sort(((e,t)=>e.level-t.level)),this}unuse({stack:e,name:t,create:n}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter((e=>n?e.create!==n:!!t&&e.name!==t))),this}open(){return Fr(this)}_close(){const e=this._state,t=En.indexOf(this);if(t>=0&&En.splice(t,1),this.idbdb){try{this.idbdb.close()}catch(e){}this._novip.idbdb=null}e.dbReadyPromise=new Bt((t=>{e.dbReadyResolve=t})),e.openCanceller=new Bt(((t,n)=>{e.cancelOpen=n}))}close(){this._close();const e=this._state;this._options.autoOpen=!1,e.dbOpenError=new tt.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){const e=arguments.length>0,t=this._state;return new Bt(((n,r)=>{const i=()=>{this.close();var e=this._deps.indexedDB.deleteDatabase(this.name);e.onsuccess=Ht((()=>{!function({indexedDB:e,IDBKeyRange:t},n){!Tr(e)&&n!==Pn&&Cr(e,t).delete(n).catch(it)}(this._deps,this.name),n()})),e.onerror=sr(r),e.onblocked=this._fireOnBlocked};if(e)throw new tt.InvalidArgument("Arguments not allowed in db.delete()");t.isBeingOpened?t.dbReadyPromise.then(i):i()}))}backendDB(){return this.idbdb}isOpen(){return null!==this.idbdb}hasBeenClosed(){const e=this._state.dbOpenError;return e&&"DatabaseClosed"===e.name}hasFailed(){return null!==this._state.dbOpenError}dynamicallyOpened(){return this._state.autoSchema}get tables(){return se(this._allTables).map((e=>this._allTables[e]))}transaction(){const e=Ir.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,t,n){let r=St.trans;r&&r.db===this&&-1===e.indexOf("!")||(r=null);const i=-1!==e.indexOf("?");let s,o;e=e.replace("!","").replace("?","");try{if(o=t.map((e=>{var t=e instanceof this.Table?e.name:e;if("string"!=typeof t)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return t})),"r"==e||e===Sn)s=Sn;else{if("rw"!=e&&e!=Cn)throw new tt.InvalidArgument("Invalid transaction mode: "+e);s=Cn}if(r){if(r.mode===Sn&&s===Cn){if(!i)throw new tt.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");r=null}r&&o.forEach((e=>{if(r&&-1===r.storeNames.indexOf(e)){if(!i)throw new tt.SubTransaction("Table "+e+" not included in parent transaction.");r=null}})),i&&r&&!r.active&&(r=null)}}catch(e){return r?r._promise(null,((t,n)=>{n(e)})):yn(e)}const a=Kr.bind(null,this,s,o,r,n);return r?r._promise(s,a,"lock"):St.trans?hn(St.transless,(()=>this._whenReady(a))):this._whenReady(a)}table(e){if(!ue(this._allTables,e))throw new tt.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}}const ei="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable";class ti{constructor(e){this._subscribe=e}subscribe(e,t,n){return this._subscribe(e&&"function"!=typeof e?e:{next:e,error:t,complete:n})}[ei](){return this}}function ni(e,t){return se(t).forEach((n=>{Yr(e[n]||(e[n]=new Wr),t[n])})),e}function ri(e){return new ti((t=>{const n=Re(e);let r=!1,i={},s={};const o={get closed(){return r},unsubscribe:()=>{r=!0,cr.storagemutated.unsubscribe(u)}};t.start&&t.start(o);let a=!1,l=!1;function c(){return se(s).some((e=>i[e]&&function(e,t){const n=Hr(t);let r=n.next();if(r.done)return!1;let i=r.value;const s=Hr(e);let o=s.next(i.from),a=o.value;for(;!r.done&&!o.done;){if(Un(a.from,i.to)<=0&&Un(a.to,i.from)>=0)return!0;Un(i.from,a.from)<0?i=(r=n.next(a.from)).value:a=(o=s.next(i.from)).value}return!1}(i[e],s[e])))}const u=e=>{ni(i,e),c()&&h()},h=()=>{if(a||r)return;i={};const d={},f=function(t){n&&rn();const r=()=>nn(e,{subscr:t,trans:null}),i=St.trans?hn(St.transless,r):r();return n&&i.then(sn,sn),i}(d);l||(cr(ar,u),l=!0),a=!0,Promise.resolve(f).then((e=>{a=!1,r||(c()?h():(i={},s=d,t.next&&t.next(e)))}),(e=>{a=!1,t.error&&t.error(e),o.unsubscribe()}))};return h(),o}))}let ii;try{ii={indexedDB:ie.indexedDB||ie.mozIndexedDB||ie.webkitIndexedDB||ie.msIndexedDB,IDBKeyRange:ie.IDBKeyRange||ie.webkitIDBKeyRange}}catch(e){ii={indexedDB:null,IDBKeyRange:null}}const si=Zr;function oi(e){let t=ai;try{ai=!0,cr.storagemutated.fire(e)}finally{ai=t}}he(si,{...rt,delete:e=>new si(e,{addons:[]}).delete(),exists:e=>new si(e,{addons:[]}).open().then((e=>(e.close(),!0))).catch("NoSuchDatabaseError",(()=>!1)),getDatabaseNames(e){try{return function({indexedDB:e,IDBKeyRange:t}){return Tr(e)?Promise.resolve(e.databases()).then((e=>e.map((e=>e.name)).filter((e=>e!==Pn)))):Cr(e,t).toCollection().primaryKeys()}(si.dependencies).then(e)}catch(e){return yn(new tt.MissingAPI)}},defineClass:()=>function(e){ae(this,e)},ignoreTransaction:e=>St.trans?hn(St.transless,e):e(),vip:jr,async:function(e){return function(){try{var t=Dr(e.apply(this,arguments));return t&&"function"==typeof t.then?t:Bt.resolve(t)}catch(e){return yn(e)}}},spawn:function(e,t,n){try{var r=Dr(e.apply(n,t||[]));return r&&"function"==typeof r.then?r:Bt.resolve(r)}catch(e){return yn(e)}},currentTransaction:{get:()=>St.trans||null},waitFor:function(e,t){const n=Bt.resolve("function"==typeof e?si.ignoreTransaction(e):e).timeout(t||6e4);return St.trans?St.trans.waitFor(n):n},Promise:Bt,debug:{get:()=>Me,set:e=>{Le(e,"dexie"===e?()=>!0:$n)}},derive:pe,extend:ae,props:he,override:ve,Events:Dn,on:cr,liveQuery:ri,extendObservabilitySet:ni,getByKeyPath:ke,setByKeyPath:Ee,delByKeyPath:function(e,t){"string"==typeof t?Ee(e,t,void 0):"length"in t&&[].map.call(t,(function(t){Ee(e,t,void 0)}))},shallowClone:Ae,deepClone:Ce,getObjectDiff:Lr,cmp:Un,asap:xe,minKey:xn,addons:[],connections:En,errnames:Ze,dependencies:ii,semVer:vn,version:vn.split(".").map((e=>parseInt(e))).reduce(((e,t,n)=>e+t/Math.pow(10,2*n)))}),si.maxKey=pr(si.dependencies.IDBKeyRange),"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(cr(ar,(e=>{if(!ai){let t;An?(t=document.createEvent("CustomEvent"),t.initCustomEvent(lr,!0,!0,e)):t=new CustomEvent(lr,{detail:e}),ai=!0,dispatchEvent(t),ai=!1}})),addEventListener(lr,(({detail:e})=>{ai||oi(e)})));let ai=!1;if("undefined"!=typeof BroadcastChannel){const e=new BroadcastChannel(lr);cr(ar,(t=>{ai||e.postMessage(t)})),e.onmessage=e=>{e.data&&oi(e.data)}}else if("undefined"!=typeof self&&"undefined"!=typeof navigator){cr(ar,(e=>{try{ai||("undefined"!=typeof localStorage&&localStorage.setItem(lr,JSON.stringify({trig:Math.random(),changedParts:e})),"object"==typeof self.clients&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach((t=>t.postMessage({type:lr,changedParts:e}))))}catch(e){}})),"undefined"!=typeof addEventListener&&addEventListener("storage",(e=>{if(e.key===lr){const t=JSON.parse(e.newValue);t&&oi(t.changedParts)}}));const e=self.document&&navigator.serviceWorker;e&&e.addEventListener("message",(function({data:e}){e&&e.type===lr&&oi(e.changedParts)}))}Bt.rejectionMapper=function(e,t){if(!e||e instanceof He||e instanceof TypeError||e instanceof SyntaxError||!e.name||!nt[e.name])return e;var n=new nt[e.name](t||e.message,e);return"stack"in e&&fe(n,"stack",{get:function(){return this.inner.stack}}),n},Le(Me,$n);const li=new class extends Zr{constructor(){super("bookDB"),this.version(1).stores({books:"++id, meta, extracted"})}};var ci={},ui={};!function(e){const t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",n="["+t+"][:A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*",r=new RegExp("^"+n+"$");e.isExist=function(e){return void 0!==e},e.isEmptyObject=function(e){return 0===Object.keys(e).length},e.merge=function(e,t,n){if(t){const r=Object.keys(t),i=r.length;for(let s=0;s<i;s++)e[r[s]]="strict"===n?[t[r[s]]]:t[r[s]]}},e.getValue=function(t){return e.isExist(t)?t:""},e.isName=function(e){const t=r.exec(e);return!(null==t)},e.getAllMatches=function(e,t){const n=[];let r=t.exec(e);for(;r;){const i=[];i.startIndex=t.lastIndex-r[0].length;const s=r.length;for(let e=0;e<s;e++)i.push(r[e]);n.push(i),r=t.exec(e)}return n},e.nameRegexp=n}(ui);const hi=ui,di={allowBooleanAttributes:!1,unpairedTags:[]};function fi(e){return" "===e||"\t"===e||"\n"===e||"\r"===e}function pi(e,t){const n=t;for(;t<e.length;t++)if("?"!=e[t]&&" "!=e[t]);else{const r=e.substr(n,t-n);if(t>5&&"xml"===r)return wi("InvalidXml","XML declaration allowed only at the start of the document.",_i(e,t));if("?"==e[t]&&">"==e[t+1]){t++;break}}return t}function mi(e,t){if(e.length>t+5&&"-"===e[t+1]&&"-"===e[t+2]){for(t+=3;t<e.length;t++)if("-"===e[t]&&"-"===e[t+1]&&">"===e[t+2]){t+=2;break}}else if(e.length>t+8&&"D"===e[t+1]&&"O"===e[t+2]&&"C"===e[t+3]&&"T"===e[t+4]&&"Y"===e[t+5]&&"P"===e[t+6]&&"E"===e[t+7]){let n=1;for(t+=8;t<e.length;t++)if("<"===e[t])n++;else if(">"===e[t]&&(n--,0===n))break}else if(e.length>t+9&&"["===e[t+1]&&"C"===e[t+2]&&"D"===e[t+3]&&"A"===e[t+4]&&"T"===e[t+5]&&"A"===e[t+6]&&"["===e[t+7])for(t+=8;t<e.length;t++)if("]"===e[t]&&"]"===e[t+1]&&">"===e[t+2]){t+=2;break}return t}ci.validate=function(e,t){t=Object.assign({},di,t);const n=[];let r=!1,i=!1;"\ufeff"===e[0]&&(e=e.substr(1));for(let o=0;o<e.length;o++)if("<"===e[o]&&"?"===e[o+1]){if(o+=2,o=pi(e,o),o.err)return o}else{if("<"!==e[o]){if(fi(e[o]))continue;return wi("InvalidChar","char '"+e[o]+"' is not expected.",_i(e,o))}{let a=o;if(o++,"!"===e[o]){o=mi(e,o);continue}{let l=!1;"/"===e[o]&&(l=!0,o++);let c="";for(;o<e.length&&">"!==e[o]&&" "!==e[o]&&"\t"!==e[o]&&"\n"!==e[o]&&"\r"!==e[o];o++)c+=e[o];if(c=c.trim(),"/"===c[c.length-1]&&(c=c.substring(0,c.length-1),o--),s=c,!hi.isName(s)){let t;return t=0===c.trim().length?"Invalid space after '<'.":"Tag '"+c+"' is an invalid name.",wi("InvalidTag",t,_i(e,o))}const u=gi(e,o);if(!1===u)return wi("InvalidAttr","Attributes for '"+c+"' have open quote.",_i(e,o));let h=u.value;if(o=u.index,"/"===h[h.length-1]){const n=o-h.length;h=h.substring(0,h.length-1);const i=bi(h,t);if(!0!==i)return wi(i.err.code,i.err.msg,_i(e,n+i.err.line));r=!0}else if(l){if(!u.tagClosed)return wi("InvalidTag","Closing tag '"+c+"' doesn't have proper closing.",_i(e,o));if(h.trim().length>0)return wi("InvalidTag","Closing tag '"+c+"' can't have attributes or invalid starting.",_i(e,a));{const t=n.pop();if(c!==t.tagName){let n=_i(e,t.tagStartPos);return wi("InvalidTag","Expected closing tag '"+t.tagName+"' (opened in line "+n.line+", col "+n.col+") instead of closing tag '"+c+"'.",_i(e,a))}0==n.length&&(i=!0)}}else{const s=bi(h,t);if(!0!==s)return wi(s.err.code,s.err.msg,_i(e,o-h.length+s.err.line));if(!0===i)return wi("InvalidXml","Multiple possible root nodes found.",_i(e,o));-1!==t.unpairedTags.indexOf(c)||n.push({tagName:c,tagStartPos:a}),r=!0}for(o++;o<e.length;o++)if("<"===e[o]){if("!"===e[o+1]){o++,o=mi(e,o);continue}if("?"!==e[o+1])break;if(o=pi(e,++o),o.err)return o}else if("&"===e[o]){const t=vi(e,o);if(-1==t)return wi("InvalidChar","char '&' is not expected.",_i(e,o));o=t}else if(!0===i&&!fi(e[o]))return wi("InvalidXml","Extra text at the end",_i(e,o));"<"===e[o]&&o--}}}var s;return r?1==n.length?wi("InvalidTag","Unclosed tag '"+n[0].tagName+"'.",_i(e,n[0].tagStartPos)):!(n.length>0)||wi("InvalidXml","Invalid '"+JSON.stringify(n.map((e=>e.tagName)),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):wi("InvalidXml","Start tag expected.",1)};function gi(e,t){let n="",r="",i=!1;for(;t<e.length;t++){if('"'===e[t]||"'"===e[t])""===r?r=e[t]:r!==e[t]||(r="");else if(">"===e[t]&&""===r){i=!0;break}n+=e[t]}return""===r&&{value:n,index:t,tagClosed:i}}const yi=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function bi(e,t){const n=hi.getAllMatches(e,yi),r={};for(let e=0;e<n.length;e++){if(0===n[e][1].length)return wi("InvalidAttr","Attribute '"+n[e][2]+"' has no space in starting.",ki(n[e]));if(void 0!==n[e][3]&&void 0===n[e][4])return wi("InvalidAttr","Attribute '"+n[e][2]+"' is without value.",ki(n[e]));if(void 0===n[e][3]&&!t.allowBooleanAttributes)return wi("InvalidAttr","boolean attribute '"+n[e][2]+"' is not allowed.",ki(n[e]));const i=n[e][2];if(!xi(i))return wi("InvalidAttr","Attribute '"+i+"' is an invalid name.",ki(n[e]));if(r.hasOwnProperty(i))return wi("InvalidAttr","Attribute '"+i+"' is repeated.",ki(n[e]));r[i]=1}return!0}function vi(e,t){if(";"===e[++t])return-1;if("#"===e[t])return function(e,t){let n=/\d/;for("x"===e[t]&&(t++,n=/[\da-fA-F]/);t<e.length;t++){if(";"===e[t])return t;if(!e[t].match(n))break}return-1}(e,++t);let n=0;for(;t<e.length;t++,n++)if(!(e[t].match(/\w/)&&n<20)){if(";"===e[t])break;return-1}return t}function wi(e,t,n){return{err:{code:e,msg:t,line:n.line||n,col:n.col}}}function xi(e){return hi.isName(e)}function _i(e,t){const n=e.substring(0,t).split(/\r?\n/);return{line:n.length,col:n[n.length-1].length+1}}function ki(e){return e.startIndex+e[1].length}var Ei={};const Ai={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0},tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1};Ei.buildOptions=function(e){return Object.assign({},Ai,e)},Ei.defaultOptions=Ai;var Ni=class{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){this.child.push({[e]:t})}addChild(e){e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}};const Oi=RegExp("^\\s([a-zA-z0-0]+)[ \t](['\"])([^&]+)\\2");function $i(e,t){const n=Oi.exec(e);n&&(t[n[1]]={regx:RegExp(`&${n[1]};`,"g"),val:n[3]})}var Pi=function(e,t){const n={};if("O"!==e[t+3]||"C"!==e[t+4]||"T"!==e[t+5]||"Y"!==e[t+6]||"P"!==e[t+7]||"E"!==e[t+8])throw new Error("Invalid Tag instead of DOCTYPE");{t+=9;let r=1,i=!1,s=!1,o=!1,a="";for(;t<e.length;t++)if("<"===e[t]){if(i&&"!"===e[t+1]&&"E"===e[t+2]&&"N"===e[t+3]&&"T"===e[t+4]&&"I"===e[t+5]&&"T"===e[t+6]&&"Y"===e[t+7])t+=7,s=!0;else if(i&&"!"===e[t+1]&&"E"===e[t+2]&&"L"===e[t+3]&&"E"===e[t+4]&&"M"===e[t+5]&&"E"===e[t+6]&&"N"===e[t+7]&&"T"===e[t+8])t+=8;else{if("!"!==e[t+1]||"-"!==e[t+2]||"-"!==e[t+3])throw new Error("Invalid DOCTYPE");o=!0}r++,a=""}else if(">"===e[t]){if(o){if("-"!==e[t-1]||"-"!==e[t-2])throw new Error("Invalid XML comment in DOCTYPE");o=!1}else s&&($i(a,n),s=!1);if(r--,0===r)break}else"["===e[t]?i=!0:a+=e[t];if(0!==r)throw new Error("Unclosed DOCTYPE")}return{entities:n,i:t}};const Si=/^[-+]?0x[a-fA-F0-9]+$/,Ci=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const Ti={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};const ji=ui,Bi=Ni,Fi=Pi,Di=function(e,t={}){if(t=Object.assign({},Ti,t),!e||"string"!=typeof e)return e;let n=e.trim();if(void 0!==t.skipLike&&t.skipLike.test(n))return e;if(t.hex&&Si.test(n))return Number.parseInt(n,16);{const r=Ci.exec(n);if(r){const i=r[1],s=r[2];let o=function(e){if(e&&-1!==e.indexOf("."))return"."===(e=e.replace(/0+$/,""))?e="0":"."===e[0]?e="0"+e:"."===e[e.length-1]&&(e=e.substr(0,e.length-1)),e;return e}(r[3]);const a=r[4]||r[6];if(!t.leadingZeros&&s.length>0&&i&&"."!==n[2])return e;if(!t.leadingZeros&&s.length>0&&!i&&"."!==n[1])return e;{const r=Number(n),l=""+r;return-1!==l.search(/[eE]/)||a?t.eNotation?r:e:-1!==n.indexOf(".")?"0"===l&&""===o||l===o||i&&l==="-"+o?r:e:s?o===l||i+o===l?r:e:n===l||n===i+l?r:e}}return e}};"<((!\\[CDATA\\[([\\s\\S]*?)(]]>))|((NAME:)?(NAME))([^>]*)>|((\\/)(NAME)\\s*>))([^<]*)".replace(/NAME/g,ji.nameRegexp);function Ii(e){const t=Object.keys(e);for(let n=0;n<t.length;n++){const r=t[n];this.lastEntities[r]={regex:new RegExp("&"+r+";","g"),val:e[r]}}}function Ki(e,t,n,r,i,s,o){if(void 0!==e&&(this.options.trimValues&&!r&&(e=e.trim()),e.length>0)){o||(e=this.replaceEntitiesValue(e));const r=this.options.tagValueProcessor(t,e,n,i,s);if(null==r)return e;if(typeof r!=typeof e||r!==e)return r;if(this.options.trimValues)return Hi(e,this.options.parseTagValue,this.options.numberParseOptions);return e.trim()===e?Hi(e,this.options.parseTagValue,this.options.numberParseOptions):e}}function Ri(e){if(this.options.removeNSPrefix){const t=e.split(":"),n="/"===e.charAt(0)?"/":"";if("xmlns"===t[0])return"";2===t.length&&(e=n+t[1])}return e}const Mi=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function Li(e,t){if(!this.options.ignoreAttributes&&"string"==typeof e){const n=ji.getAllMatches(e,Mi),r=n.length,i={};for(let e=0;e<r;e++){const r=this.resolveNameSpace(n[e][1]);let s=n[e][4];const o=this.options.attributeNamePrefix+r;if(r.length)if(void 0!==s){this.options.trimValues&&(s=s.trim()),s=this.replaceEntitiesValue(s);const e=this.options.attributeValueProcessor(r,s,t);i[o]=null==e?s:typeof e!=typeof s||e!==s?e:Hi(s,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(i[o]=!0)}if(!Object.keys(i).length)return;if(this.options.attributesGroupName){const e={};return e[this.options.attributesGroupName]=i,e}return i}}const zi=function(e){e=e.replace(/\r\n?/g,"\n");const t=new Bi("!xml");let n=t,r="",i="";for(let s=0;s<e.length;s++){if("<"===e[s])if("/"===e[s+1]){const t=Wi(e,">",s,"Closing Tag is not closed.");let o=e.substring(s+2,t).trim();if(this.options.removeNSPrefix){const e=o.indexOf(":");-1!==e&&(o=o.substr(e+1))}n&&(r=this.saveTextToParentTag(r,n,i)),i=i.substr(0,i.lastIndexOf(".")),n=this.tagsNodeStack.pop(),r="",s=t}else if("?"===e[s+1]){let t=Xi(e,s,!1,"?>");if(!t)throw new Error("Pi Tag is not closed.");if(r=this.saveTextToParentTag(r,n,i),this.options.ignoreDeclaration&&"?xml"===t.tagName||this.options.ignorePiTags);else{const e=new Bi(t.tagName);e.add(this.options.textNodeName,""),t.tagName!==t.tagExp&&t.attrExpPresent&&(e[":@"]=this.buildAttributesMap(t.tagExp,i)),n.addChild(e)}s=t.closeIndex+1}else if("!--"===e.substr(s+1,3)){const t=Wi(e,"--\x3e",s+4,"Comment is not closed.");if(this.options.commentPropName){const o=e.substring(s+4,t-2);r=this.saveTextToParentTag(r,n,i),n.add(this.options.commentPropName,[{[this.options.textNodeName]:o}])}s=t}else if("!D"===e.substr(s+1,2)){const t=Fi(e,s);this.docTypeEntities=t.entities,s=t.i}else if("!["===e.substr(s+1,2)){const t=Wi(e,"]]>",s,"CDATA is not closed.")-2,o=e.substring(s+9,t);if(r=this.saveTextToParentTag(r,n,i),this.options.cdataPropName)n.add(this.options.cdataPropName,[{[this.options.textNodeName]:o}]);else{let e=this.parseTextData(o,n.tagname,i,!0,!1,!0);null==e&&(e=""),n.add(this.options.textNodeName,e)}s=t+2}else{let o=Xi(e,s,this.options.removeNSPrefix),a=o.tagName,l=o.tagExp,c=o.attrExpPresent,u=o.closeIndex;n&&r&&"!xml"!==n.tagname&&(r=this.saveTextToParentTag(r,n,i,!1)),a!==t.tagname&&(i+=i?"."+a:a);const h=n;if(h&&-1!==this.options.unpairedTags.indexOf(h.tagname)&&(n=this.tagsNodeStack.pop()),this.isItStopNode(this.options.stopNodes,i,a)){let t="";if(l.length>0&&l.lastIndexOf("/")===l.length-1)s=o.closeIndex;else if(-1!==this.options.unpairedTags.indexOf(a))s=o.closeIndex;else{const n=this.readStopNodeData(e,a,u+1);if(!n)throw new Error(`Unexpected end of ${a}`);s=n.i,t=n.tagContent}const r=new Bi(a);a!==l&&c&&(r[":@"]=this.buildAttributesMap(l,i)),t&&(t=this.parseTextData(t,a,i,!0,c,!0,!0)),i=i.substr(0,i.lastIndexOf(".")),r.add(this.options.textNodeName,t),n.addChild(r)}else{if(l.length>0&&l.lastIndexOf("/")===l.length-1){"/"===a[a.length-1]?(a=a.substr(0,a.length-1),l=a):l=l.substr(0,l.length-1);const e=new Bi(a);a!==l&&c&&(e[":@"]=this.buildAttributesMap(l,i)),i=i.substr(0,i.lastIndexOf(".")),n.addChild(e)}else{const e=new Bi(a);this.tagsNodeStack.push(n),a!==l&&c&&(e[":@"]=this.buildAttributesMap(l,i)),n.addChild(e),n=e}r="",s=u}}else r+=e[s]}return t.child},qi=function(e){if(this.options.processEntities){for(let t in this.docTypeEntities){const n=this.docTypeEntities[t];e=e.replace(n.regx,n.val)}for(let t in this.lastEntities){const n=this.lastEntities[t];e=e.replace(n.regex,n.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const n=this.htmlEntities[t];e=e.replace(n.regex,n.val)}}return e};function Vi(e,t,n,r){return e&&(void 0===r&&(r=0===Object.keys(t.child).length),void 0!==(e=this.parseTextData(e,t.tagname,n,!1,!!t[":@"]&&0!==Object.keys(t[":@"]).length,r))&&""!==e&&t.add(this.options.textNodeName,e),e=""),e}function Ui(e,t,n){const r="*."+n;for(const n in e){const i=e[n];if(r===i||t===i)return!0}return!1}function Wi(e,t,n,r){const i=e.indexOf(t,n);if(-1===i)throw new Error(r);return i+t.length-1}function Xi(e,t,n,r=">"){const i=function(e,t,n=">"){let r,i="";for(let s=t;s<e.length;s++){let t=e[s];if(r)t===r&&(r="");else if('"'===t||"'"===t)r=t;else if(t===n[0]){if(!n[1])return{data:i,index:s};if(e[s+1]===n[1])return{data:i,index:s}}else"\t"===t&&(t=" ");i+=t}}(e,t+1,r);if(!i)return;let s=i.data;const o=i.index,a=s.search(/\s/);let l=s,c=!0;if(-1!==a&&(l=s.substr(0,a).replace(/\s\s*$/,""),s=s.substr(a+1)),n){const e=l.indexOf(":");-1!==e&&(l=l.substr(e+1),c=l!==i.data.substr(e+1))}return{tagName:l,tagExp:s,closeIndex:o,attrExpPresent:c}}function Yi(e,t,n){const r=n;let i=1;for(;n<e.length;n++)if("<"===e[n])if("/"===e[n+1]){const s=Wi(e,">",n,`${t} is not closed`);if(e.substring(n+2,s).trim()===t&&(i--,0===i))return{tagContent:e.substring(r,n),i:s};n=s}else{const r=Xi(e,n,">");if(r){(r&&r.tagName)===t&&i++,n=r.closeIndex}}}function Hi(e,t,n){if(t&&"string"==typeof e){const t=e.trim();return"true"===t||"false"!==t&&Di(e,n)}return ji.isExist(e)?e:""}var Gi=class{constructor(e){this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={amp:{regex:/&(amp|#38|#x26);/g,val:"&"},apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:""},pound:{regex:/&(pound|#163);/g,val:""},yen:{regex:/&(yen|#165);/g,val:""},euro:{regex:/&(euro|#8364);/g,val:""},copyright:{regex:/&(copy|#169);/g,val:""},reg:{regex:/&(reg|#174);/g,val:""},inr:{regex:/&(inr|#8377);/g,val:""}},this.addExternalEntities=Ii,this.parseXml=zi,this.parseTextData=Ki,this.resolveNameSpace=Ri,this.buildAttributesMap=Li,this.isItStopNode=Ui,this.replaceEntitiesValue=qi,this.readStopNodeData=Yi,this.saveTextToParentTag=Vi}},Qi={};function Ji(e,t,n){let r;const i={};for(let s=0;s<e.length;s++){const o=e[s],a=Zi(o);let l="";if(l=void 0===n?a:n+"."+a,a===t.textNodeName)void 0===r?r=o[a]:r+=""+o[a];else{if(void 0===a)continue;if(o[a]){let e=Ji(o[a],t,l);const n=ts(e,t);o[":@"]?es(e,o[":@"],l,t):1!==Object.keys(e).length||void 0===e[t.textNodeName]||t.alwaysCreateTextNode?0===Object.keys(e).length&&(t.alwaysCreateTextNode?e[t.textNodeName]="":e=""):e=e[t.textNodeName],void 0!==i[a]&&i.hasOwnProperty(a)?(Array.isArray(i[a])||(i[a]=[i[a]]),i[a].push(e)):t.isArray(a,l,n)?i[a]=[e]:i[a]=e}}}return"string"==typeof r?r.length>0&&(i[t.textNodeName]=r):void 0!==r&&(i[t.textNodeName]=r),i}function Zi(e){const t=Object.keys(e);for(let e=0;e<t.length;e++){const n=t[e];if(":@"!==n)return n}}function es(e,t,n,r){if(t){const i=Object.keys(t),s=i.length;for(let o=0;o<s;o++){const s=i[o];r.isArray(s,n+"."+s,!0,!0)?e[s]=[t[s]]:e[s]=t[s]}}}function ts(e,t){const n=Object.keys(e).length;return!!(0===n||1===n&&e[t.textNodeName])}Qi.prettify=function(e,t){return Ji(e,t)};const{buildOptions:ns}=Ei,rs=Gi,{prettify:is}=Qi,ss=ci;var os=class{constructor(e){this.externalEntities={},this.options=ns(e)}parse(e,t){if("string"==typeof e);else{if(!e.toString)throw new Error("XML data is accepted in String or Bytes[] form.");e=e.toString()}if(t){!0===t&&(t={});const n=ss.validate(e,t);if(!0!==n)throw Error(`${n.err.msg}:${n.err.line}:${n.err.col}`)}const n=new rs(this.options);n.addExternalEntities(this.externalEntities);const r=n.parseXml(e);return this.options.preserveOrder||void 0===r?r:is(r,this.options)}addEntity(e,t){if(-1!==t.indexOf("&"))throw new Error("Entity value can't have '&'");if(-1!==e.indexOf("&")||-1!==e.indexOf(";"))throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");this.externalEntities[e]=t}};function as(e,t,n,r){let i="",s="";t.format&&t.indentBy.length>0&&(s="\n"+t.indentBy.repeat(r));for(let o=0;o<e.length;o++){const a=e[o],l=ls(a);let c="";if(c=0===n.length?l:`${n}.${l}`,l===t.textNodeName){let e=a[l];us(c,t)||(e=t.tagValueProcessor(l,e),e=hs(e,t)),i+=s+e;continue}if(l===t.cdataPropName){i+=s+`<![CDATA[${a[l][0][t.textNodeName]}]]>`;continue}if(l===t.commentPropName){i+=s+`\x3c!--${a[l][0][t.textNodeName]}--\x3e`;continue}if("?"===l[0]){const e=cs(a[":@"],t),n="?xml"===l?"":s;let r=a[l][0][t.textNodeName];r=0!==r.length?" "+r:"",i+=n+`<${l}${r}${e}?>`;continue}let u=s+`<${l}${cs(a[":@"],t)}`,h=as(a[l],t,c,r+1);-1!==t.unpairedTags.indexOf(l)?t.suppressUnpairedNode?i+=u+">":i+=u+"/>":h&&0!==h.length||!t.suppressEmptyNode?i+=u+`>${h}${s}</${l}>`:i+=u+"/>"}return i}function ls(e){const t=Object.keys(e);for(let e=0;e<t.length;e++){const n=t[e];if(":@"!==n)return n}}function cs(e,t){let n="";if(e&&!t.ignoreAttributes)for(let r in e){let i=t.attributeValueProcessor(r,e[r]);i=hs(i,t),!0===i&&t.suppressBooleanAttributes?n+=` ${r.substr(t.attributeNamePrefix.length)}`:n+=` ${r.substr(t.attributeNamePrefix.length)}="${i}"`}return n}function us(e,t){let n=(e=e.substr(0,e.length-t.textNodeName.length-1)).substr(e.lastIndexOf(".")+1);for(let r in t.stopNodes)if(t.stopNodes[r]===e||t.stopNodes[r]==="*."+n)return!0;return!1}function hs(e,t){if(e&&e.length>0&&t.processEntities)for(let n=0;n<t.entities.length;n++){const r=t.entities[n];e=e.replace(r.regex,r.val)}return e}const ds=function(e,t){return as(e,t,"",0)},fs={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[]};function ps(e){this.options=Object.assign({},fs,e),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=ks),this.processTextOrObjNode=gs,this.options.format?(this.indentate=_s,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine=""),this.options.suppressEmptyNode?(this.buildTextNode=xs,this.buildObjNode=bs):(this.buildTextNode=vs,this.buildObjNode=ys),this.buildTextValNode=vs,this.buildObjectNode=ys,this.replaceEntitiesValue=ws,this.buildAttrPairStr=ms}function ms(e,t){return t=this.options.attributeValueProcessor(e,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&"true"===t?" "+e:" "+e+'="'+t+'"'}function gs(e,t,n){const r=this.j2x(e,n+1);return void 0!==e[this.options.textNodeName]&&1===Object.keys(e).length?this.buildTextNode(e[this.options.textNodeName],t,r.attrStr,n):this.buildObjNode(r.val,t,r.attrStr,n)}function ys(e,t,n,r){let i="</"+t+this.tagEndChar,s="";return"?"===t[0]&&(s="?",i=""),n&&-1===e.indexOf("<")?this.indentate(r)+"<"+t+n+s+">"+e+i:!1!==this.options.commentPropName&&t===this.options.commentPropName&&0===s.length?this.indentate(r)+`\x3c!--${e}--\x3e`+this.newLine:this.indentate(r)+"<"+t+n+s+this.tagEndChar+e+this.indentate(r)+i}function bs(e,t,n,r){return""!==e?this.buildObjectNode(e,t,n,r):"?"===t[0]?this.indentate(r)+"<"+t+n+"?"+this.tagEndChar:this.indentate(r)+"<"+t+n+"/"+this.tagEndChar}function vs(e,t,n,r){if(!1!==this.options.cdataPropName&&t===this.options.cdataPropName)return this.indentate(r)+`<![CDATA[${e}]]>`+this.newLine;if(!1!==this.options.commentPropName&&t===this.options.commentPropName)return this.indentate(r)+`\x3c!--${e}--\x3e`+this.newLine;{let i=this.options.tagValueProcessor(t,e);return i=this.replaceEntitiesValue(i),""===i&&-1!==this.options.unpairedTags.indexOf(t)?this.options.suppressUnpairedNode?this.indentate(r)+"<"+t+this.tagEndChar:this.indentate(r)+"<"+t+"/"+this.tagEndChar:this.indentate(r)+"<"+t+n+">"+i+"</"+t+this.tagEndChar}}function ws(e){if(e&&e.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){const n=this.options.entities[t];e=e.replace(n.regex,n.val)}return e}function xs(e,t,n,r){return""===e&&-1!==this.options.unpairedTags.indexOf(t)?this.options.suppressUnpairedNode?this.indentate(r)+"<"+t+this.tagEndChar:this.indentate(r)+"<"+t+"/"+this.tagEndChar:""!==e?this.buildTextValNode(e,t,n,r):"?"===t[0]?this.indentate(r)+"<"+t+n+"?"+this.tagEndChar:this.indentate(r)+"<"+t+n+"/"+this.tagEndChar}function _s(e){return this.options.indentBy.repeat(e)}function ks(e){return!!e.startsWith(this.options.attributeNamePrefix)&&e.substr(this.attrPrefixLen)}ps.prototype.build=function(e){return this.options.preserveOrder?ds(e,this.options):(Array.isArray(e)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(e={[this.options.arrayNodeName]:e}),this.j2x(e,0).val)},ps.prototype.j2x=function(e,t){let n="",r="";for(let i in e)if(void 0===e[i]);else if(null===e[i])"?"===i[0]?r+=this.indentate(t)+"<"+i+"?"+this.tagEndChar:r+=this.indentate(t)+"<"+i+"/"+this.tagEndChar;else if(e[i]instanceof Date)r+=this.buildTextNode(e[i],i,"",t);else if("object"!=typeof e[i]){const s=this.isAttribute(i);if(s)n+=this.buildAttrPairStr(s,""+e[i]);else if(i===this.options.textNodeName){let t=this.options.tagValueProcessor(i,""+e[i]);r+=this.replaceEntitiesValue(t)}else r+=this.buildTextNode(e[i],i,"",t)}else if(Array.isArray(e[i])){const n=e[i].length;for(let s=0;s<n;s++){const n=e[i][s];void 0===n||(null===n?"?"===i[0]?r+=this.indentate(t)+"<"+i+"?"+this.tagEndChar:r+=this.indentate(t)+"<"+i+"/"+this.tagEndChar:r+="object"==typeof n?this.processTextOrObjNode(n,i,t):this.buildTextNode(n,i,"",t))}}else if(this.options.attributesGroupName&&i===this.options.attributesGroupName){const t=Object.keys(e[i]),r=t.length;for(let s=0;s<r;s++)n+=this.buildAttrPairStr(t[s],""+e[i][t[s]])}else r+=this.processTextOrObjNode(e[i],i,t);return{attrStr:n,val:r}};var Es={XMLParser:os,XMLValidator:ci,XMLBuilder:ps};function As(e){return e.arrayBuffer?e.arrayBuffer():new Promise(((t,n)=>{const r=new FileReader;r.addEventListener("loadend",(()=>{t(r.result)})),r.addEventListener("error",n),r.readAsArrayBuffer(e)}))}async function Ns(e){const t=await As(e);return new Uint8Array(t)}function Os(e){return"undefined"!=typeof Blob&&e instanceof Blob}function $s(e){return"undefined"!=typeof SharedArrayBuffer&&e instanceof SharedArrayBuffer}const Ps="undefined"!=typeof process&&process.versions&&void 0!==process.versions.node&&void 0===process.versions.electron;class Ss{constructor(e){this.typedArray=e instanceof ArrayBuffer||$s(e)?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}async getLength(){return this.typedArray.byteLength}async read(e,t){return new Uint8Array(this.typedArray.buffer,this.typedArray.byteOffset+e,t)}}class Cs{constructor(e){this.blob=e}async getLength(){return this.blob.size}async read(e,t){const n=this.blob.slice(e,e+t),r=await As(n);return new Uint8Array(r)}async sliceAsBlob(e,t,n=""){return this.blob.slice(e,e+t,n)}}function Ts(e,t){var n=e.length;if(t<=n)return e;var r=new Uint8Array(Math.max(n<<1,t));return r.set(e,0),r}function js(e,t,n,r,i,s){for(var o=Ks,a=Ms,l=0;l<n;){var c=e[a(r,i)&t];i+=15&c;var u=c>>>4;if(u<=15)s[l]=u,l++;else{var h=0,d=0;16==u?(d=3+o(r,i,2),i+=2,h=s[l-1]):17==u?(d=3+o(r,i,3),i+=3):18==u&&(d=11+o(r,i,7),i+=7);for(var f=l+d;l<f;)s[l]=h,l++}}return i}function Bs(e,t,n,r){for(var i=0,s=0,o=r.length>>>1;s<n;){var a=e[s+t];r[s<<1]=0,r[1+(s<<1)]=a,a>i&&(i=a),s++}for(;s<o;)r[s<<1]=0,r[1+(s<<1)]=0,s++;return i}function Fs(e,t){for(var n,r,i,s,o=e.length,a=Ls.bl_count,l=0;l<=t;l++)a[l]=0;for(l=1;l<o;l+=2)a[e[l]]++;var c=Ls.next_code;for(n=0,a[0]=0,r=1;r<=t;r++)n=n+a[r-1]<<1,c[r]=n;for(i=0;i<o;i+=2)0!=(s=e[i+1])&&(e[i]=c[s],c[s]++)}function Ds(e,t,n){for(var r=e.length,i=Ls.rev15,s=0;s<r;s+=2)if(0!=e[s+1])for(var o=s>>1,a=e[s+1],l=o<<4|a,c=t-a,u=e[s]<<c,h=u+(1<<c);u!=h;){n[i[u]>>>15-t]=l,u++}}function Is(e,t){for(var n=Ls.rev15,r=15-t,i=0;i<e.length;i+=2){var s=e[i]<<t-e[i+1];e[i]=n[s]>>>r}}function Ks(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<n)-1}function Rs(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<n)-1}function Ms(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)}const Ls=(zs=Uint16Array,qs=Uint32Array,{next_code:new zs(16),bl_count:new zs(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new zs(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new qs(32),flmap:new zs(512),fltree:[],fdmap:new zs(32),fdtree:[],lmap:new zs(32768),ltree:[],ttree:[],dmap:new zs(32768),dtree:[],imap:new zs(512),itree:[],rev15:new zs(32768),lhst:new qs(286),dhst:new qs(30),ihst:new qs(19),lits:new qs(15e3),strt:new zs(65536),prev:new zs(32768)});var zs,qs;!function(){for(var e=0;e<32768;e++){var t=e;t=(4278255360&(t=(4042322160&(t=(3435973836&(t=(2863311530&t)>>>1|(1431655765&t)<<1))>>>2|(858993459&t)<<2))>>>4|(252645135&t)<<4))>>>8|(16711935&t)<<8,Ls.rev15[e]=(t>>>16|t<<16)>>>17}function n(e,t,n){for(;0!=t--;)e.push(0,n)}for(e=0;e<32;e++)Ls.ldef[e]=Ls.of0[e]<<3|Ls.exb[e],Ls.ddef[e]=Ls.df0[e]<<4|Ls.dxb[e];n(Ls.fltree,144,8),n(Ls.fltree,112,9),n(Ls.fltree,24,7),n(Ls.fltree,8,8),Fs(Ls.fltree,9),Ds(Ls.fltree,9,Ls.flmap),Is(Ls.fltree,9),n(Ls.fdtree,32,5),Fs(Ls.fdtree,5),Ds(Ls.fdtree,5,Ls.fdmap),Is(Ls.fdtree,5),n(Ls.itree,19,0),n(Ls.ltree,286,0),n(Ls.dtree,30,0),n(Ls.ttree,320,0)}();const Vs={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var n=t,r=0;r<8;r++)1&n?n=3988292384^n>>>1:n>>>=1;e[t]=n}return e}(),update:function(e,t,n,r){for(var i=0;i<r;i++)e=Vs.table[255&(e^t[n+i])]^e>>>8;return e},crc:function(e,t,n){return 4294967295^Vs.update(4294967295,e,t,n)}};function Us(e,t){return function(e,t){var n=Uint8Array;if(3==e[0]&&0==e[1])return t||new n(0);var r=Rs,i=Ks,s=js,o=Ms,a=null==t;a&&(t=new n(e.length>>>2<<3));for(var l,c,u=0,h=0,d=0,f=0,p=0,m=0,g=0,y=0,b=0;0==u;)if(u=r(e,b,1),h=r(e,b+1,2),b+=3,0!=h){if(a&&(t=Ts(t,y+(1<<17))),1==h&&(l=Ls.flmap,c=Ls.fdmap,m=511,g=31),2==h){d=i(e,b,5)+257,f=i(e,b+5,5)+1,p=i(e,b+10,4)+4,b+=14;for(var v=0;v<38;v+=2)Ls.itree[v]=0,Ls.itree[v+1]=0;var w=1;for(v=0;v<p;v++){var x=i(e,b+3*v,3);Ls.itree[1+(Ls.ordr[v]<<1)]=x,x>w&&(w=x)}b+=3*p,Fs(Ls.itree,w),Ds(Ls.itree,w,Ls.imap),l=Ls.lmap,c=Ls.dmap,b=s(Ls.imap,(1<<w)-1,d+f,e,b,Ls.ttree);var _=Bs(Ls.ttree,0,d,Ls.ltree);m=(1<<_)-1;var k=Bs(Ls.ttree,d,f,Ls.dtree);g=(1<<k)-1,Fs(Ls.ltree,_),Ds(Ls.ltree,_,l),Fs(Ls.dtree,k),Ds(Ls.dtree,k,c)}for(;;){var E=l[o(e,b)&m];b+=15&E;var A=E>>>4;if(A>>>8==0)t[y++]=A;else{if(256==A)break;var N=y+A-254;if(A>264){var O=Ls.ldef[A-257];N=y+(O>>>3)+i(e,b,7&O),b+=7&O}var $=c[o(e,b)&g];b+=15&$;var P=$>>>4,S=Ls.ddef[P],C=(S>>>4)+r(e,b,15&S);for(b+=15&S,a&&(t=Ts(t,y+(1<<17)));y<N;)t[y]=t[y++-C],t[y]=t[y++-C],t[y]=t[y++-C],t[y]=t[y++-C];y=N}}}else{0!=(7&b)&&(b+=8-(7&b));var T=4+(b>>>3),j=e[T-4]|e[T-3]<<8;a&&(t=Ts(t,y+j)),t.set(new n(e.buffer,e.byteOffset+T,j),y),b=T+j<<3,y+=j}return t.length==y?t:t.slice(0,y)}(e,t)}const Ws={numWorkers:1,workerURL:"",useWorkers:!1};let Xs=0;const Ys=[];function Hs(e){return new Promise(((t,n)=>{const r=new Worker(e);r.onmessage=e=>{"start"===e.data?(r.onerror=void 0,r.onmessage=void 0,t(r)):n(new Error(`unexpected message: ${e.data}`))},r.onerror=n}))}function Gs(e,t,n,r){const i=new Uint8Array(t);Us(e,i),r(n?new Blob([i],{type:n}):i.buffer)}function Qs(e,t,n){return new Promise(((r,i)=>{Ys.push({src:e,uncompressedSize:t,type:n,resolve:r,reject:i,id:Xs++}),async function(){if(0!==Ys.length)for(;Ys.length;){const{src:e,uncompressedSize:t,type:n,resolve:r}=Ys.shift();let i=e;Os(e)&&(i=await Ns(e)),Gs(i,t,n,r)}}()}))}!function(){if(Ps){const{Worker:n}=(e=module,t="worker_threads",e.require(t));return{createWorker:async e=>new n(e),addEventListener(e,t){e.on("message",(n=>{t({target:e,data:n})}))},async terminate(e){await e.terminate()}}}return{async createWorker(e){try{return await Hs(e)}catch(t){console.warn("could not load worker:",e)}let t;try{const n=await fetch(e,{mode:"cors"});if(!n.ok)throw new Error(`could not load: ${e}`);t=await n.text(),e=URL.createObjectURL(new Blob([t],{type:"application/javascript"}));const r=await Hs(e);return Ws.workerURL=e,r}catch(t){console.warn("could not load worker via fetch:",e)}if(void 0!==t)try{e=`data:application/javascript;base64,${btoa(t)}`;const n=await Hs(e);return Ws.workerURL=e,n}catch(e){console.warn("could not load worker via dataURI")}throw console.warn("workers will not be used"),new Error("can not start workers")},addEventListener(e,t){e.addEventListener("message",t)},async terminate(e){e.terminate()}};var e,t}();class Js{constructor(e,t){var n,r;this._reader=e,this._rawEntry=t,this.name=t.name,this.nameBytes=t.nameBytes,this.size=t.uncompressedSize,this.compressedSize=t.compressedSize,this.comment=t.comment,this.commentBytes=t.commentBytes,this.compressionMethod=t.compressionMethod,this.lastModDate=(n=t.lastModFileDate,r=t.lastModFileTime,new Date(1980+(n>>9&127),(n>>5&15)-1,31&n,r>>11&31,r>>5&63,2*(31&r),0)),this.isDirectory=0===t.uncompressedSize&&t.name.endsWith("/"),this.encrypted=!!(1&t.generalPurposeBitFlag),this.externalFileAttributes=t.externalFileAttributes,this.versionMadeBy=t.versionMadeBy}async blob(e="application/octet-stream"){return await async function(e,t,n){const{decompress:r,fileDataStart:i}=await co(e,t);if(!r){const r=await eo(e,i,t.compressedSize,n);return Os(r)?r:new Blob([$s(r.buffer)?new Uint8Array(r):r],{type:n})}const s=await eo(e,i,t.compressedSize);return await Qs(s,t.uncompressedSize,n)}(this._reader,this._rawEntry,e)}async arrayBuffer(){return await async function(e,t){const{decompress:n,fileDataStart:r}=await co(e,t);if(!n){const n=await Zs(e,r,t.compressedSize);return 0===(i=n).byteOffset&&i.byteLength===i.buffer.byteLength?n.buffer:n.slice().buffer}var i;const s=await eo(e,r,t.compressedSize);return await Qs(s,t.uncompressedSize)}(this._reader,this._rawEntry)}async text(){const e=await this.arrayBuffer();return oo(new Uint8Array(e))}async json(){const e=await this.text();return JSON.parse(e)}}async function Zs(e,t,n){return await e.read(t,n)}async function eo(e,t,n,r){return e.sliceAsBlob?await e.sliceAsBlob(t,n,r):await e.read(t,n)}const to={unsigned:()=>0};function no(e,t){return e[t]+256*e[t+1]}function ro(e,t){return e[t]+256*e[t+1]+65536*e[t+2]+16777216*e[t+3]}function io(e,t){return ro(e,t)+4294967296*ro(e,t+4)}const so=new TextDecoder;function oo(e,t){return $s(e.buffer)&&(e=new Uint8Array(e)),so.decode(e)}async function ao(e,t,n,r){const i=t-20,s=await Zs(e,i,20);if(117853008!==ro(s,0))throw new Error("invalid zip64 end of central directory locator signature");const o=io(s,8),a=await Zs(e,o,56);if(101075792!==ro(a,0))throw new Error("invalid zip64 end of central directory record signature");const l=io(a,32),c=io(a,40);return lo(e,io(a,48),c,l,n,r)}async function lo(e,t,n,r,i,s){let o=0;const a=await Zs(e,t,n),l=[];for(let e=0;e<r;++e){const e=a.subarray(o,o+46),t=ro(e,0);if(33639248!==t)throw new Error(`invalid central directory file header signature: 0x${t.toString(16)}`);const n={versionMadeBy:no(e,4),versionNeededToExtract:no(e,6),generalPurposeBitFlag:no(e,8),compressionMethod:no(e,10),lastModFileTime:no(e,12),lastModFileDate:no(e,14),crc32:ro(e,16),compressedSize:ro(e,20),uncompressedSize:ro(e,24),fileNameLength:no(e,28),extraFieldLength:no(e,30),fileCommentLength:no(e,32),internalFileAttributes:no(e,36),externalFileAttributes:ro(e,38),relativeOffsetOfLocalHeader:ro(e,42)};if(64&n.generalPurposeBitFlag)throw new Error("strong encryption is not supported");o+=46;const r=a.subarray(o,o+n.fileNameLength+n.extraFieldLength+n.fileCommentLength);n.nameBytes=r.slice(0,n.fileNameLength),n.name=oo(n.nameBytes);const i=n.fileNameLength+n.extraFieldLength,s=r.slice(n.fileNameLength,i);n.extraFields=[];let c=0;for(;c<s.length-3;){const e=no(s,c+0),t=c+4,r=t+no(s,c+2);if(r>s.length)throw new Error("extra field length exceeds extra field buffer size");n.extraFields.push({id:e,data:s.slice(t,r)}),c=r}if(n.commentBytes=r.slice(i,i+n.fileCommentLength),n.comment=oo(n.commentBytes),o+=r.length,4294967295===n.uncompressedSize||4294967295===n.compressedSize||4294967295===n.relativeOffsetOfLocalHeader){const e=n.extraFields.find((e=>1===e.id));if(!e)throw new Error("expected zip64 extended information extra field");const t=e.data;let r=0;if(4294967295===n.uncompressedSize){if(r+8>t.length)throw new Error("zip64 extended information extra field does not include uncompressed size");n.uncompressedSize=io(t,r),r+=8}if(4294967295===n.compressedSize){if(r+8>t.length)throw new Error("zip64 extended information extra field does not include compressed size");n.compressedSize=io(t,r),r+=8}if(4294967295===n.relativeOffsetOfLocalHeader){if(r+8>t.length)throw new Error("zip64 extended information extra field does not include relative header offset");n.relativeOffsetOfLocalHeader=io(t,r),r+=8}}const u=n.extraFields.find((e=>28789===e.id&&e.data.length>=6&&1===e.data[0]&&ro(e.data,1)),to.unsigned(n.nameBytes));if(u&&(n.fileName=oo(u.data.slice(5))),0===n.compressionMethod){let e=n.uncompressedSize;if(0!=(1&n.generalPurposeBitFlag)&&(e+=12),n.compressedSize!==e)throw new Error(`compressed size mismatch for stored file: ${n.compressedSize} != ${e}`)}l.push(n)}return{zip:{comment:i,commentBytes:s},entries:l.map((t=>new Js(e,t)))}}async function co(e,t){if(1&t.generalPurposeBitFlag)throw new Error("encrypted entries not supported");const n=await Zs(e,t.relativeOffsetOfLocalHeader,30),r=await e.getLength(),i=ro(n,0);if(67324752!==i)throw new Error(`invalid local file header signature: 0x${i.toString(16)}`);const s=no(n,26),o=no(n,28),a=t.relativeOffsetOfLocalHeader+n.length+s+o;let l;if(0===t.compressionMethod)l=!1;else{if(8!==t.compressionMethod)throw new Error(`unsupported compression method: ${t.compressionMethod}`);l=!0}const c=a,u=c+t.compressedSize;if(0!==t.compressedSize&&u>r)throw new Error(`file data overflows file bounds: ${c} +  ${t.compressedSize}  > ${r}`);return{decompress:l,fileDataStart:c}}async function uo(e){let t;if("undefined"!=typeof Blob&&e instanceof Blob)t=new Cs(e);else if(e instanceof ArrayBuffer||e&&e.buffer&&e.buffer instanceof ArrayBuffer)t=new Ss(e);else if($s(e)||$s(e.buffer))t=new Ss(e);else if("string"==typeof e){const n=await fetch(e);if(!n.ok)throw new Error(`failed http request ${e}, status: ${n.status}: ${n.statusText}`);const r=await n.blob();t=new Cs(r)}else{if("function"!=typeof e.getLength||"function"!=typeof e.read)throw new Error("unsupported source type");t=e}const n=await t.getLength();if(n>Number.MAX_SAFE_INTEGER)throw new Error(`file too large. size: ${n}. Only file sizes up 4503599627370496 bytes are supported`);return await async function(e,t){const n=Math.min(65557,t),r=t-n,i=await Zs(e,r,n);for(let t=n-22;t>=0;--t){if(101010256!==ro(i,t))continue;const n=new Uint8Array(i.buffer,i.byteOffset+t,i.byteLength-t),s=no(n,4);if(0!==s)throw new Error(`multi-volume zip files are not supported. This is volume: ${s}`);const o=no(n,10),a=ro(n,12),l=ro(n,16),c=no(n,20),u=n.length-22;if(c!==u)throw new Error(`invalid comment length. expected: ${u}, actual: ${c}`);const h=new Uint8Array(n.buffer,n.byteOffset+22,c),d=oo(h);return 65535===o||4294967295===l?await ao(e,r+t,d,h):await lo(e,l,a,o,d,h)}throw new Error("could not find end of central directory. maybe not zip file")}(t,n)}let ho,fo=[],po=[],mo=[],go=[],yo=[],bo="";const vo=async e=>(po=[],fo=[],mo=[],yo=[],(e=>{const t=new Es.XMLParser({ignoreAttributes:!1}).parse(e).package,n=_o(t.manifest),r=(new Es.XMLParser).parse(e).package;ho=xo(void 0===r.metadata?r["opf:metadata"]:r.metadata),ko(t.spine,n)})(await wo(e)),{meta:ho,extracted:{sections:fo,htmls:mo,images:po,fonts:yo,styles:go}}),wo=async e=>{const{entries:t}=await async function(e){const{zip:t,entries:n}=await uo(e);return{zip:t,entries:Object.fromEntries(n.map((e=>[e.name,e])))}}(e);let n="";for(const[e,r]of Object.entries(t))switch(e.substring(e.lastIndexOf("."))){case".opf":n=await r.text();break;case".png":case".jpg":case".jpeg":case".gif":{const t=await r.blob();po.push({name:e,blob:t});break}case".css":{const t=await r.text();go.push({name:e,css:t});break}case".htm":case".xml":case".html":case".xhtml":{const t=await r.text();mo.push({name:e,html:t});break}case".otf":case".ttf":case".woff":{const t=await r.blob();yo.push({name:e,blob:t})}}return n},xo=e=>{const t=e["dc:title"],n=e["dc:creator"];let r=po[0].blob;for(let{name:e,blob:t}of po){if(e.includes(bo)){r=t;break}e.includes("cover")&&(r=t)}return{title:t,author:n,cover:r}},_o=e=>{let t=[];for(const n of e.item)"application/xhtml+xml"===n["@_media-type"]?t.push({id:n["@_id"],href:n["@_href"]}):n["@_media-type"].includes("image")&&n["@_id"].includes("cover")&&(bo=n["@_href"]);return t},ko=(e,t)=>{let n=[];e.itemref.forEach((e=>n.push(e["@_idref"]))),fo=n.map((e=>t.find((t=>t.id===e))))},Eo=(e,t,n)=>{let r=((e,t)=>{let n=[];return(e=(e=e.replace(/@(-moz-|-webkit-|-ms-)*keyframes\s(.*?){([0-9%a-zA-Z,\s.]*{(.*?)})*[\s\n]*}/g,(e=>n.push(e)&&"__keyframes__"))).replace(/([^\r\n,{}]+)(,(?=[^}]*{)|\s*{)/g,(e=>"@"===e.trim()[0]?e:e.replace(/(\s*)/,"$1"+t+" ")))).replace(/__keyframes__/g,(e=>n.shift()))})(e,"#container");return r=r.replace(/url\((?!['"]?(?:data):)['"]?([^'"\)]*)['"]?\)/g,(function(e,r){const i=Ao(r);let s=[];return[".png",".jpg",".jpeg",".gif"].some((e=>i.endsWith(e)))?s=t:[".otf",".ttf",".woff"].some((e=>i.endsWith(e)))&&(s=n),"url("+No(i,s)+")"})),r},Ao=e=>e.split("\\").pop().split("/").pop(),No=(e,t)=>{for(const{name:n,blob:r}of t)if(n.includes(e))return URL.createObjectURL(r);return""},Oo=new DOMParser,$o=(e,t)=>{const n=Oo.parseFromString(e,"application/xhtml+xml");for(const e of n.querySelectorAll("[src],[href], image"))switch(e.tagName){case"img":{const n=Ao(e.getAttribute("src"));e.setAttribute("src",No(n,t)),e.style.cssText+="max-height: 100%; max-width: 100%; object-fit: scale-down;";break}case"image":{const n=Ao(e.getAttributeNS("http://www.w3.org/1999/xlink","href"));e.setAttributeNS("http://www.w3.org/1999/xlink","href",No(n,t));break}default:null===e.getAttribute("href")||e.getAttribute("href").includes("http")?null===e.getAttribute("src")||e.getAttribute("src").includes("http")||e.removeAttribute("src"):e.removeAttribute("href")}return n.body.innerHTML},Po=e=>({}),So=e=>({}),Co=e=>({}),To=e=>({}),jo=e=>({}),Bo=e=>({});function Fo(e){let t,n,r,i,s,o,a;const l=e[1].leftbar,c=u(l,e,e[0],Bo),h=e[1].toptext,v=u(h,e,e[0],To),x=e[1].rightbar,_=u(x,e,e[0],So);return{c(){t=b("div"),n=b("div"),c&&c.c(),r=w(),i=b("div"),v&&v.c(),s=w(),o=b("div"),_&&_.c(),k(n,"class","buttonbar svelte-5uyilb"),k(n,"id","leftbar"),k(i,"id","toptext"),k(i,"class","svelte-5uyilb"),k(o,"class","buttonbar svelte-5uyilb"),k(o,"id","rightbar"),k(t,"id","topbar"),k(t,"class","svelte-5uyilb")},m(e,l){g(e,t,l),m(t,n),c&&c.m(n,null),m(t,r),m(t,i),v&&v.m(i,null),m(t,s),m(t,o),_&&_.m(o,null),a=!0},p(e,[t]){c&&c.p&&(!a||1&t)&&f(c,l,e,e[0],a?d(l,e[0],t,jo):p(e[0]),Bo),v&&v.p&&(!a||1&t)&&f(v,h,e,e[0],a?d(h,e[0],t,Co):p(e[0]),To),_&&_.p&&(!a||1&t)&&f(_,x,e,e[0],a?d(x,e[0],t,Po):p(e[0]),So)},i(e){a||(X(c,e),X(v,e),X(_,e),a=!0)},o(e){Y(c,e),Y(v,e),Y(_,e),a=!1},d(e){e&&y(t),c&&c.d(e),v&&v.d(e),_&&_.d(e)}}}function Do(e,t,n){let{$$slots:r={},$$scope:i}=t;return e.$$set=e=>{"$$scope"in e&&n(0,i=e.$$scope)},[i,r]}class Io extends re{constructor(e){super(),ne(this,e,Do,Fo,s,{})}}function Ko(t){let n,s,o,a,l;const c=t[4].default,h=u(c,t,t[3],null);return{c(){n=b("div"),h&&h.c(),k(n,"id","popover"),N(n,"top",t[1]),N(n,"right",t[2]),k(n,"class","svelte-5z79nf")},m(r,c){var u;g(r,n,c),h&&h.m(n,null),o=!0,a||(l=[(u=s=Mo.call(null,n),u&&i(u.destroy)?u.destroy:e),_(n,"outclick",t[5])],a=!0)},p(e,t){h&&h.p&&(!o||8&t)&&f(h,c,e,e[3],o?d(c,e[3],t,null):p(e[3]),null),(!o||2&t)&&N(n,"top",e[1]),(!o||4&t)&&N(n,"right",e[2])},i(e){o||(X(h,e),o=!0)},o(e){Y(h,e),o=!1},d(e){e&&y(n),h&&h.d(e),a=!1,r(l)}}}function Ro(e){let t,n,r=e[0]&&Ko(e);return{c(){r&&r.c(),t=x()},m(e,i){r&&r.m(e,i),g(e,t,i),n=!0},p(e,[n]){e[0]?r?(r.p(e,n),1&n&&X(r,1)):(r=Ko(e),r.c(),X(r,1),r.m(t.parentNode,t)):r&&(U(),Y(r,1,1,(()=>{r=null})),W())},i(e){n||(X(r),n=!0)},o(e){Y(r),n=!1},d(e){r&&r.d(e),e&&y(t)}}}function Mo(e){const t=t=>{t.target instanceof Element&&(e.contains(t.target)||"settingsBtn"===t.target.className||e.dispatchEvent(new CustomEvent("outclick")))};return document.addEventListener("click",t,!0),{destroy(){document.removeEventListener("click",t,!0)}}}function Lo(e,t,n){let{$$slots:r={},$$scope:i}=t,{visible:s}=t,{top:o}=t,{right:a}=t;return e.$$set=e=>{"visible"in e&&n(0,s=e.visible),"top"in e&&n(1,o=e.top),"right"in e&&n(2,a=e.right),"$$scope"in e&&n(3,i=e.$$scope)},[s,o,a,i,r,()=>n(0,s=!1)]}class zo extends re{constructor(e){super(),ne(this,e,Lo,Ro,s,{visible:0,top:1,right:2})}}function qo(t){let n,i,s,o,a,l,c,u,h;return{c(){n=b("div"),n.textContent="warm",i=w(),s=b("div"),s.textContent="black",o=w(),a=b("div"),a.textContent="dark",l=w(),c=b("div"),c.textContent="light",N(n,"background-color","#f6e4bd"),N(n,"color","#000"),k(n,"class","svelte-7vb56k"),N(s,"background-color","#000"),N(s,"color","#e9e9e9"),k(s,"class","svelte-7vb56k"),N(a,"background-color","#032038"),N(a,"color","#e9e9e9"),k(a,"class","svelte-7vb56k"),N(c,"background-color","#fff"),N(c,"color","#000"),k(c,"class","svelte-7vb56k")},m(e,r){g(e,n,r),g(e,i,r),g(e,s,r),g(e,o,r),g(e,a,r),g(e,l,r),g(e,c,r),u||(h=[_(n,"click",t[1]),_(s,"click",t[2]),_(a,"click",t[3]),_(c,"click",t[4])],u=!0)},p:e,i:e,o:e,d(e){e&&y(n),e&&y(i),e&&y(s),e&&y(o),e&&y(a),e&&y(l),e&&y(c),u=!1,r(h)}}}function Vo(e){const t=e=>{document.documentElement.setAttribute("data-theme",e),localStorage.setItem("theme",e)};return[t,()=>t("warm"),()=>t("black"),()=>t("dark"),()=>t("light")]}class Uo extends re{constructor(e){super(),ne(this,e,Vo,qo,s,{})}}function Wo(e){let t,n,i,s,o,a,l,c,u,h,d,f,p,v,x,E,$,P,S,C,T,j,B;return C=new Uo({}),{c(){t=b("label"),t.textContent="Font:",n=w(),i=b("br"),s=w(),o=b("select"),a=b("option"),a.textContent="Verdana",l=b("option"),l.textContent="Arial",c=b("option"),c.textContent="Courier New ",u=b("option"),u.textContent="Helvetica",h=b("option"),h.textContent="Times New Roman",d=w(),f=b("br"),p=w(),v=b("label"),v.textContent="Font size:",x=w(),E=b("br"),$=w(),P=b("input"),S=w(),J(C.$$.fragment),k(t,"for","fontpicker"),N(a,"font-family","'Verdana'"),a.__value="Verdana",a.value=a.__value,N(l,"font-family","'Arial'"),l.__value="Arial",l.value=l.__value,N(c,"font-family","'Courier New '"),c.__value="Courier New ",c.value=c.__value,N(u,"font-family","'Helvetica'"),u.__value="Helvetica",u.value=u.__value,N(h,"font-family","'Times New Roman'"),h.__value="Times New Roman",h.value=h.__value,k(o,"name","fontpicker"),N(o,"width","100%"),void 0===e[0].fontFamily&&I((()=>e[2].call(o))),k(v,"for","fontsize"),k(P,"name","fontsize"),k(P,"type","range"),k(P,"min","12"),k(P,"max","40")},m(r,y){g(r,t,y),g(r,n,y),g(r,i,y),g(r,s,y),g(r,o,y),m(o,a),m(o,l),m(o,c),m(o,u),m(o,h),O(o,e[0].fontFamily),g(r,d,y),g(r,f,y),g(r,p,y),g(r,v,y),g(r,x,y),g(r,E,y),g(r,$,y),g(r,P,y),A(P,e[0].fontSize),g(r,S,y),Z(C,r,y),T=!0,j||(B=[_(o,"change",e[2]),_(P,"change",e[3]),_(P,"input",e[3])],j=!0)},p(e,t){1&t&&O(o,e[0].fontFamily),1&t&&A(P,e[0].fontSize)},i(e){T||(X(C.$$.fragment,e),T=!0)},o(e){Y(C.$$.fragment,e),T=!1},d(e){e&&y(t),e&&y(n),e&&y(i),e&&y(s),e&&y(o),e&&y(d),e&&y(f),e&&y(p),e&&y(v),e&&y(x),e&&y(E),e&&y($),e&&y(P),e&&y(S),ee(C,e),j=!1,r(B)}}}function Xo(e){let t,n,r;function i(t){e[4](t)}let s={top:"3.1em",right:"1%",$$slots:{default:[Wo]},$$scope:{ctx:e}};return void 0!==e[1]&&(s.visible=e[1]),t=new zo({props:s}),T.push((()=>Q(t,"visible",i))),{c(){J(t.$$.fragment)},m(e,n){Z(t,e,n),r=!0},p(e,[r]){const i={};33&r&&(i.$$scope={dirty:r,ctx:e}),!n&&2&r&&(n=!0,i.visible=e[1],K((()=>n=!1))),t.$set(i)},i(e){r||(X(t.$$.fragment,e),r=!0)},o(e){Y(t.$$.fragment,e),r=!1},d(e){ee(t,e)}}}function Yo(e,t,n){let{settings:r={fontSize:16,fontFamily:"Verdana"}}=t,{settingsVisible:i=!1}=t;return e.$$set=e=>{"settings"in e&&n(0,r=e.settings),"settingsVisible"in e&&n(1,i=e.settingsVisible)},[r,i,function(){r.fontFamily=function(e){const t=e.querySelector(":checked")||e.options[0];return t&&t.__value}(this),n(0,r)},function(){var e;r.fontSize=""===(e=this.value)?null:+e,n(0,r)},function(e){i=e,n(1,i)}]}class Ho extends re{constructor(e){super(),ne(this,e,Yo,Xo,s,{settings:0,settingsVisible:1})}}const{document:Go}=H;function Qo(t){let n,r,i;return{c(){n=b("button"),n.textContent="<",k(n,"slot","leftbar"),N(n,"opacity","0.5")},m(e,s){g(e,n,s),r||(i=_(n,"click",t[12]),r=!0)},p:e,d(e){e&&y(n),r=!1,i()}}}function Jo(e){let t,n,r,i,s,o,a,l,c,u,h,d,f=void 0!==e[1]?e[1].meta.title+" - ":"",p=(void 0!==e[1]?e[1].meta.author:"")+"",x=e[1].contents.length+"";return{c(){t=b("div"),n=b("h4"),r=b("b"),i=v(f),s=w(),o=v(p),a=w(),l=b("p"),c=v(e[2]),u=v("/"),h=v(x),k(n,"class","svelte-ketruh"),k(l,"id","progress"),k(l,"class","svelte-ketruh"),k(t,"slot","toptext"),k(t,"style",d="transition: opacity 0.3s; "+(e[5]>100?"opacity: 0.5;":""))},m(e,d){g(e,t,d),m(t,n),m(n,r),m(r,i),m(n,s),m(n,o),m(t,a),m(t,l),m(l,c),m(l,u),m(l,h)},p(e,n){2&n&&f!==(f=void 0!==e[1]?e[1].meta.title+" - ":"")&&E(i,f),2&n&&p!==(p=(void 0!==e[1]?e[1].meta.author:"")+"")&&E(o,p),4&n&&E(c,e[2]),2&n&&x!==(x=e[1].contents.length+"")&&E(h,x),32&n&&d!==(d="transition: opacity 0.3s; "+(e[5]>100?"opacity: 0.5;":""))&&k(t,"style",d)},d(e){e&&y(t)}}}function Zo(t){let n,i,s,o,a,l,c,u;return{c(){n=b("div"),i=b("button"),i.textContent="",s=w(),o=b("button"),o.textContent="",a=w(),l=b("button"),l.textContent="",k(i,"class","settingsBtn"),k(n,"slot","rightbar"),N(n,"display","inline-block")},m(e,r){g(e,n,r),m(n,i),m(n,s),m(n,o),m(n,a),m(n,l),c||(u=[_(i,"click",t[9]),_(o,"click",t[10]),_(l,"click",t[11])],c=!0)},p:e,d(e){e&&y(n),c=!1,r(u)}}}function ea(e){let t,n,i,s,o,a,l,c,u,h,d,f,p,v,x,E,A=!1,O=()=>{A=!1},P=e[1].contents[e[2]]+"",S=e[1].contents[e[2]+1]+"";function C(t){e[13](t)}function j(t){e[14](t)}I(e[8]),Go.title=n="\n        "+e[1].meta.title+" - "+e[1].meta.author+"\n    ",s=new Io({props:{$$slots:{rightbar:[Zo],toptext:[Jo],leftbar:[Qo]},$$scope:{ctx:e}}});let B={};return void 0!==e[3]&&(B.settingsVisible=e[3]),void 0!==e[4]&&(B.settings=e[4]),d=new Ho({props:B}),T.push((()=>Q(d,"settingsVisible",C))),T.push((()=>Q(d,"settings",j))),{c(){i=w(),J(s.$$.fragment),o=w(),a=b("div"),l=new $(!1),c=w(),u=new $(!1),h=w(),J(d.$$.fragment),l.a=c,u.a=null,k(a,"id","container"),N(a,"font-size",e[4].fontSize+"px"),N(a,"font-family",e[4].fontFamily),k(a,"class","svelte-ketruh")},m(n,r){g(n,i,r),Z(s,n,r),g(n,o,r),g(n,a,r),l.m(P,a),m(a,c),u.m(S,a),g(n,h,r),Z(d,n,r),v=!0,x||(E=[_(window,"keydown",e[7]),_(window,"scroll",(()=>{A=!0,clearTimeout(t),t=setTimeout(O,100),e[8]()}))],x=!0)},p(e,[r]){32&r&&!A&&(A=!0,clearTimeout(t),scrollTo(window.pageXOffset,e[5]),t=setTimeout(O,100)),(!v||2&r)&&n!==(n="\n        "+e[1].meta.title+" - "+e[1].meta.author+"\n    ")&&(Go.title=n);const i={};131119&r&&(i.$$scope={dirty:r,ctx:e}),s.$set(i),(!v||6&r)&&P!==(P=e[1].contents[e[2]]+"")&&l.p(P),(!v||6&r)&&S!==(S=e[1].contents[e[2]+1]+"")&&u.p(S),(!v||16&r)&&N(a,"font-size",e[4].fontSize+"px"),(!v||16&r)&&N(a,"font-family",e[4].fontFamily);const o={};!f&&8&r&&(f=!0,o.settingsVisible=e[3],K((()=>f=!1))),!p&&16&r&&(p=!0,o.settings=e[4],K((()=>p=!1))),d.$set(o)},i(e){v||(X(s.$$.fragment,e),X(d.$$.fragment,e),v=!0)},o(e){Y(s.$$.fragment,e),Y(d.$$.fragment,e),v=!1},d(e){e&&y(i),ee(s,e),e&&y(o),e&&y(a),e&&y(h),ee(d,e),x=!1,r(E)}}}function ta(e,t,n){let{book:r}=t,{reading:i}=t,s=0,o=!1,a={fontSize:16,fontFamily:"Verdana"},l=0,c=r.meta.title;var u;u=()=>{c!=r.meta.title&&(n(2,s=0),c=r.meta.title,h())},S().$$.after_update.push(u);const h=()=>{for(let e of document.getElementsByTagName("style"))e.innerHTML="";r.styles.forEach((e=>{const t=document.createElement("style");t.innerText=e.css,document.head.appendChild(t)}))},d=e=>{0<=s+e&&s+e<=r.contents.length&&(n(2,s+=e),n(5,l=0))};h();return e.$$set=e=>{"book"in e&&n(1,r=e.book),"reading"in e&&n(0,i=e.reading)},[i,r,s,o,a,l,d,({key:e})=>{switch(e){case"ArrowLeft":d(-2);break;case"ArrowRight":d(2)}},function(){n(5,l=window.pageYOffset)},()=>n(3,o=!o),()=>d(-2),()=>d(2),()=>{n(0,i=!1),document.title="Essence Reader",location.hash=""},function(e){o=e,n(3,o)},function(e){a=e,n(4,a)}]}class na extends re{constructor(e){super(),ne(this,e,ta,ea,s,{book:1,reading:0})}}function ra(e,t,n){const r=e.slice();return r[17]=t[n],r}function ia(t){let n;return{c(){n=b("h3"),n.textContent="Essence Reader",k(n,"slot","toptext"),N(n,"display","inline")},m(e,t){g(e,n,t)},p:e,d(e){e&&y(n)}}}function sa(t){let n,r,i;return{c(){n=b("button"),n.textContent="",k(n,"class","settingsBtn"),k(n,"slot","rightbar")},m(e,s){g(e,n,s),r||(i=_(n,"click",t[10]),r=!0)},p:e,d(e){e&&y(n),r=!1,i()}}}function oa(e){let t,n,r,i,s,o,a,l,c,u,h,d,f,p;return h=new Uo({}),{c(){t=b("div"),n=b("label"),r=b("input"),i=v("\n            Save books\n        "),s=b("br"),o=w(),a=b("hr"),l=w(),c=b("p"),c.textContent="Select theme",u=w(),J(h.$$.fragment),k(r,"type","checkbox"),N(n,"user-select","none"),N(c,"display","inline"),N(t,"width","8em")},m(y,b){g(y,t,b),m(t,n),m(n,r),r.checked=e[0],m(n,i),m(t,s),m(t,o),m(t,a),m(t,l),m(t,c),m(t,u),Z(h,t,null),d=!0,f||(p=_(r,"change",e[11]),f=!0)},p(e,t){1&t&&(r.checked=e[0])},i(e){d||(X(h.$$.fragment,e),d=!0)},o(e){Y(h.$$.fragment,e),d=!1},d(e){e&&y(t),ee(h),f=!1,p()}}}function aa(e){let t,n=[],r=new Map,i=e[5];const s=e=>e[17].id;for(let t=0;t<i.length;t+=1){let o=ra(e,i,t),a=s(o);r.set(a,n[t]=la(a,o))}return{c(){for(let e=0;e<n.length;e+=1)n[e].c();t=x()},m(e,r){for(let t=0;t<n.length;t+=1)n[t].m(e,r);g(e,t,r)},p(e,o){290&o&&(i=e[5],n=function(e,t,n,r,i,s,o,a,l,c,u,h){let d=e.length,f=s.length,p=d;const m={};for(;p--;)m[e[p].key]=p;const g=[],y=new Map,b=new Map;for(p=f;p--;){const e=h(i,s,p),a=n(e);let l=o.get(a);l?r&&l.p(e,t):(l=c(a,e),l.c()),y.set(a,g[p]=l),a in m&&b.set(a,Math.abs(p-m[a]))}const v=new Set,w=new Set;function x(e){X(e,1),e.m(a,u),o.set(e.key,e),u=e.first,f--}for(;d&&f;){const t=g[f-1],n=e[d-1],r=t.key,i=n.key;t===n?(u=t.first,d--,f--):y.has(i)?!o.has(r)||v.has(r)?x(t):w.has(i)?d--:b.get(r)>b.get(i)?(w.add(r),x(t)):(v.add(i),d--):(l(n,o),d--)}for(;d--;){const t=e[d];y.has(t.key)||l(t,o)}for(;f;)x(g[f-1]);return g}(n,o,s,1,e,i,r,t.parentNode,G,la,t,ra))},d(e){for(let t=0;t<n.length;t+=1)n[t].d(e);e&&y(t)}}}function la(e,t){let n,i,s,o,a,c,u,h,d,f,p,x=t[17].meta.author+" - "+t[17].meta.title;function A(...e){return t[13](t[17],...e)}function N(){return t[14](t[17])}return{key:e,first:null,c(){n=b("div"),i=b("button"),i.textContent="Delete book",s=w(),o=b("img"),c=w(),u=b("p"),h=v(x),d=w(),k(i,"class","deleteBtn svelte-1r9o3c9"),l(o.src,a=void 0!==t[17].meta.cover?URL.createObjectURL(t[17].meta.cover):"")||k(o,"src",a),k(o,"alt","cover"),k(o,"class","svelte-1r9o3c9"),k(u,"class","svelte-1r9o3c9"),k(n,"class","book svelte-1r9o3c9"),this.first=n},m(e,t){g(e,n,t),m(n,i),m(n,s),m(n,o),m(n,c),m(n,u),m(u,h),m(n,d),f||(p=[_(i,"click",A),_(n,"click",N)],f=!0)},p(e,n){t=e,32&n&&!l(o.src,a=void 0!==t[17].meta.cover?URL.createObjectURL(t[17].meta.cover):"")&&k(o,"src",a),32&n&&x!==(x=t[17].meta.author+" - "+t[17].meta.title)&&E(h,x)},d(e){e&&y(n),f=!1,r(p)}}}function ca(e){let t,n;return{c(){t=b("p"),n=v("Drop anywhere or click to select a file"),N(t,"color",e[2]?"#87CEFA":"inherit"),k(t,"class","svelte-1r9o3c9")},m(e,r){g(e,t,r),m(t,n)},p(e,n){4&n&&N(t,"color",e[2]?"#87CEFA":"inherit")},d(e){e&&y(t)}}}function ua(e){let t,n,r,i,s,o,a,l,c,u,h,d,f,p,x,A,O,$,P,S=e[3]?"+":"Drop anywhere or click to select a file";function C(t){e[12](t)}t=new Io({props:{$$slots:{rightbar:[sa],toptext:[ia]},$$scope:{ctx:e}}});let j={top:"3.1em",right:"1%",$$slots:{default:[oa]},$$scope:{ctx:e}};void 0!==e[4]&&(j.visible=e[4]),r=new zo({props:j}),T.push((()=>Q(r,"visible",C)));let B=e[5]&&aa(e),F=e[3]&&ca(e);return{c(){J(t.$$.fragment),n=w(),J(r.$$.fragment),s=w(),o=b("div"),B&&B.c(),a=w(),l=b("div"),c=b("div"),u=b("h1"),u.textContent="",h=w(),d=b("h2"),f=v(S),p=w(),F&&F.c(),k(u,"class","svelte-1r9o3c9"),k(d,"class","svelte-1r9o3c9"),k(c,"id","dropInfo"),N(c,"max-width",e[3]?"":"100% "),N(c,"background-color",e[2]?" #87CEFA":""),k(c,"class","svelte-1r9o3c9"),k(l,"class","book svelte-1r9o3c9"),k(l,"style",x=e[3]?"":"max-width: 80em   "),k(o,"id","parent"),k(o,"style",A=e[3]?"":"justify-content: center"),k(o,"class","svelte-1r9o3c9")},m(i,y){Z(t,i,y),g(i,n,y),Z(r,i,y),g(i,s,y),g(i,o,y),B&&B.m(o,null),m(o,a),m(o,l),m(l,c),m(c,u),m(c,h),m(c,d),m(d,f),m(l,p),F&&F.m(l,null),O=!0,$||(P=_(l,"click",e[15]),$=!0)},p(e,[n]){const s={};1048592&n&&(s.$$scope={dirty:n,ctx:e}),t.$set(s);const u={};1048577&n&&(u.$$scope={dirty:n,ctx:e}),!i&&16&n&&(i=!0,u.visible=e[4],K((()=>i=!1))),r.$set(u),e[5]?B?B.p(e,n):(B=aa(e),B.c(),B.m(o,a)):B&&(B.d(1),B=null),(!O||8&n)&&S!==(S=e[3]?"+":"Drop anywhere or click to select a file")&&E(f,S),(!O||8&n)&&N(c,"max-width",e[3]?"":"100% "),(!O||4&n)&&N(c,"background-color",e[2]?" #87CEFA":""),e[3]?F?F.p(e,n):(F=ca(e),F.c(),F.m(l,null)):F&&(F.d(1),F=null),(!O||8&n&&x!==(x=e[3]?"":"max-width: 80em   "))&&k(l,"style",x),(!O||8&n&&A!==(A=e[3]?"":"justify-content: center"))&&k(o,"style",A)},i(e){O||(X(t.$$.fragment,e),X(r.$$.fragment,e),O=!0)},o(e){Y(t.$$.fragment,e),Y(r.$$.fragment,e),O=!1},d(e){ee(t,e),e&&y(n),ee(r,e),e&&y(s),e&&y(o),B&&B.d(),F&&F.d(),$=!1,P()}}}function ha(e,t,n){let r,{readFiles:i=(e=>{})}=t,{openExisting:s=(e=>{})}=t,{dragging:o}=t,{saveBooksOn:a}=t,l=ri((()=>li.books.toArray()));c(e,l,(e=>n(5,r=e)));let u=!1,h=!1;const d=()=>{let e=document.createElement("input");e.type="file",e.onchange=e=>{i(e.target.files[0])},e.click()};async function f(e){await li.books.delete(e)}!async function(){if(a){const e=await li.books.count().catch((()=>n(0,a=!1)));n(3,u=e>0)}}();return e.$$set=e=>{"readFiles"in e&&n(9,i=e.readFiles),"openExisting"in e&&n(1,s=e.openExisting),"dragging"in e&&n(2,o=e.dragging),"saveBooksOn"in e&&n(0,a=e.saveBooksOn)},[a,s,o,u,h,r,l,d,f,i,()=>n(4,h=!h),function(){a=this.checked,n(0,a)},function(e){h=e,n(4,h)},(e,t)=>{t.stopPropagation(),f(e.id)},e=>s(e.id),()=>d()]}class da extends re{constructor(e){super(),ne(this,e,ha,ua,s,{readFiles:9,openExisting:1,dragging:2,saveBooksOn:0})}}function fa(e){let t,n,r;function i(t){e[7](t)}let s={readFiles:e[4],openExisting:e[5],dragging:e[3]};return void 0!==e[0]&&(s.saveBooksOn=e[0]),t=new da({props:s}),T.push((()=>Q(t,"saveBooksOn",i))),{c(){J(t.$$.fragment)},m(e,n){Z(t,e,n),r=!0},p(e,r){const i={};8&r&&(i.dragging=e[3]),!n&&1&r&&(n=!0,i.saveBooksOn=e[0],K((()=>n=!1))),t.$set(i)},i(e){r||(X(t.$$.fragment,e),r=!0)},o(e){Y(t.$$.fragment,e),r=!1},d(e){ee(t,e)}}}function pa(e){let t,n,r;function i(t){e[6](t)}let s={book:e[1]};return void 0!==e[2]&&(s.reading=e[2]),t=new na({props:s}),T.push((()=>Q(t,"reading",i))),{c(){J(t.$$.fragment)},m(e,n){Z(t,e,n),r=!0},p(e,r){const i={};2&r&&(i.book=e[1]),!n&&4&r&&(n=!0,i.reading=e[2],K((()=>n=!1))),t.$set(i)},i(e){r||(X(t.$$.fragment,e),r=!0)},o(e){Y(t.$$.fragment,e),r=!1},d(e){ee(t,e)}}}function ma(e){let t,n,r,i;const s=[pa,fa],o=[];function a(e,t){return e[2]?0:1}return n=a(e),r=o[n]=s[n](e),{c(){t=b("main"),r.c()},m(e,r){g(e,t,r),o[n].m(t,null),i=!0},p(e,[i]){let l=n;n=a(e),n===l?o[n].p(e,i):(U(),Y(o[l],1,1,(()=>{o[l]=null})),W(),r=o[n],r?r.p(e,i):(r=o[n]=s[n](e),r.c()),X(r,1),r.m(t,null))},i(e){i||(X(r),i=!0)},o(e){Y(r),i=!1},d(e){e&&y(t),o[n].d()}}}function ga(e,t,n){let r,i=!1,s=!1;const o=async e=>{let t=await vo(e);if(a&&e.size<3e7){const e=await(async(e,t)=>{for(let t of await li.books.toArray())if(t.meta.title===e.title)return t.id;try{return await li.books.add({meta:e,extracted:t})}catch(e){console.log(e)}})(t.meta,t.extracted);l(t.meta,t.extracted,e)}else l(t.meta,t.extracted)};let a;a=null===localStorage.getItem("saveBooksOn")||JSON.parse(localStorage.getItem("saveBooksOn"));window.addEventListener("dragenter",(e=>{e.dataTransfer.types.includes("Files")&&n(3,s=!0)})),window.addEventListener("dragleave",(e=>{n(3,s=!1),e.preventDefault()}));const l=(e,t,s)=>{n(1,r=((e,{sections:t,htmls:n,images:r,fonts:i,styles:s})=>{let o=[];for(let e=0;e<t.length;e++)for(const{name:i,html:s}of n)if(i.includes(t[e].href)){o.push($o(s,r));break}for(let e=0;e<s.length;e++)s[e].css=Eo(s[e].css,r,i);return{meta:e,contents:o,styles:s}})(e,t)),location.hash=s?s.toString():"",n(2,i=!0)},c=async e=>{let t=await li.books.get(e);t&&l(t.meta,t.extracted,t.id)};var u;return u=()=>{""!==location.hash&&c(parseInt(location.hash.substring(1)))},S().$$.on_mount.push(u),window.onhashchange=()=>{a&&i&&""===location.hash?(document.title="Essence Reader",n(2,i=!1)):a&&!i&&""!==location.hash&&c(parseInt(location.hash.substring(1)))},window.addEventListener("dragover",(e=>e.preventDefault())),window.addEventListener("drop",(e=>{e.preventDefault(),n(3,s=!1),o(e.dataTransfer.files[0])})),e.$$.update=()=>{1&e.$$.dirty&&localStorage.setItem("saveBooksOn",JSON.stringify(a))},[a,r,i,s,o,c,function(e){i=e,n(2,i)},function(e){a=e,n(0,a)}]}return new class extends re{constructor(e){super(),ne(this,e,ga,ma,s,{})}}({target:document.body})}();
