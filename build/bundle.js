var app=function(){"use strict";function e(){}function t(e){return e()}function n(){return Object.create(null)}function r(e){e.forEach(t)}function i(e){return"function"==typeof e}function s(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}let o,a;function l(e,t){return o||(o=document.createElement("a")),o.href=t,e===o.href}function c(t,n,r){t.$$.on_destroy.push(function(t,...n){if(null==t)return e;const r=t.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}(n,r))}function u(e,t,n,r){if(e){const i=h(e,t,n,r);return e[0](i)}}function h(e,t,n,r){return e[1]&&r?function(e,t){for(const n in t)e[n]=t[n];return e}(n.ctx.slice(),e[1](r(t))):n.ctx}function d(e,t,n,r){if(e[2]&&r){const i=e[2](r(n));if(void 0===t.dirty)return i;if("object"==typeof i){const e=[],n=Math.max(t.dirty.length,i.length);for(let r=0;r<n;r+=1)e[r]=t.dirty[r]|i[r];return e}return t.dirty|i}return t.dirty}function f(e,t,n,r,i,s){if(i){const o=h(t,n,r,s);e.p(o,i)}}function p(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let e=0;e<n;e++)t[e]=-1;return t}return-1}function m(e){return null==e?"":e}function g(e,t){e.appendChild(t)}function y(e,t,n){e.insertBefore(t,n||null)}function b(e){e.parentNode.removeChild(e)}function v(e){return document.createElement(e)}function w(e){return document.createTextNode(e)}function x(){return w(" ")}function _(){return w("")}function k(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function E(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function A(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function N(e,t){e.value=null==t?"":t}function O(e,t,n,r){null===n?e.style.removeProperty(t):e.style.setProperty(t,n,r?"important":"")}function $(e,t){for(let n=0;n<e.options.length;n+=1){const r=e.options[n];if(r.__value===t)return void(r.selected=!0)}e.selectedIndex=-1}class P{constructor(e=!1){this.is_svg=!1,this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,t,n=null){var r;this.e||(this.is_svg?this.e=(r=t.nodeName,document.createElementNS("http://www.w3.org/2000/svg",r)):this.e=v(t.nodeName),this.t=t,this.c(e)),this.i(n)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)y(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(b)}}function S(e){a=e}function C(){if(!a)throw new Error("Function called outside component initialization");return a}const T=[],B=[],j=[],F=[],D=Promise.resolve();let I=!1;function K(e){j.push(e)}function R(e){F.push(e)}const M=new Set;let L=0;function z(){const e=a;do{for(;L<T.length;){const e=T[L];L++,S(e),q(e.$$)}for(S(null),T.length=0,L=0;B.length;)B.pop()();for(let e=0;e<j.length;e+=1){const t=j[e];M.has(t)||(M.add(t),t())}j.length=0}while(T.length);for(;F.length;)F.pop()();I=!1,M.clear(),S(e)}function q(e){if(null!==e.fragment){e.update(),r(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(K)}}const V=new Set;let U;function W(){U={r:0,c:[],p:U}}function X(){U.r||r(U.c),U=U.p}function Y(e,t){e&&e.i&&(V.delete(e),e.i(t))}function H(e,t,n,r){if(e&&e.o){if(V.has(e))return;V.add(e),U.c.push((()=>{V.delete(e),r&&(n&&e.d(1),r())})),e.o(t)}else r&&r()}const G="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function Q(e,t){e.d(1),t.delete(e.key)}function J(e,t,n){const r=e.$$.props[t];void 0!==r&&(e.$$.bound[r]=n,n(e.$$.ctx[r]))}function Z(e){e&&e.c()}function ee(e,n,s,o){const{fragment:a,on_mount:l,on_destroy:c,after_update:u}=e.$$;a&&a.m(n,s),o||K((()=>{const n=l.map(t).filter(i);c?c.push(...n):r(n),e.$$.on_mount=[]})),u.forEach(K)}function te(e,t){const n=e.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function ne(e,t){-1===e.$$.dirty[0]&&(T.push(e),I||(I=!0,D.then(z)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function re(t,i,s,o,l,c,u,h=[-1]){const d=a;S(t);const f=t.$$={fragment:null,ctx:null,props:c,update:e,not_equal:l,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(i.context||(d?d.$$.context:[])),callbacks:n(),dirty:h,skip_bound:!1,root:i.target||d.$$.root};u&&u(f.root);let p=!1;if(f.ctx=s?s(t,i.props||{},((e,n,...r)=>{const i=r.length?r[0]:n;return f.ctx&&l(f.ctx[e],f.ctx[e]=i)&&(!f.skip_bound&&f.bound[e]&&f.bound[e](i),p&&ne(t,e)),n})):[],f.update(),p=!0,r(f.before_update),f.fragment=!!o&&o(f.ctx),i.target){if(i.hydrate){const e=function(e){return Array.from(e.childNodes)}(i.target);f.fragment&&f.fragment.l(e),e.forEach(b)}else f.fragment&&f.fragment.c();i.intro&&Y(t.$$.fragment),ee(t,i.target,i.anchor,i.customElement),z()}S(d)}class ie{$destroy(){te(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const se="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,oe=Object.keys,ae=Array.isArray;function le(e,t){return"object"!=typeof t||oe(t).forEach((function(n){e[n]=t[n]})),e}"undefined"==typeof Promise||se.Promise||(se.Promise=Promise);const ce=Object.getPrototypeOf,ue={}.hasOwnProperty;function he(e,t){return ue.call(e,t)}function de(e,t){"function"==typeof t&&(t=t(ce(e))),("undefined"==typeof Reflect?oe:Reflect.ownKeys)(t).forEach((n=>{pe(e,n,t[n])}))}const fe=Object.defineProperty;function pe(e,t,n,r){fe(e,t,le(n&&he(n,"get")&&"function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function me(e){return{from:function(t){return e.prototype=Object.create(t.prototype),pe(e.prototype,"constructor",e),{extend:de.bind(null,e.prototype)}}}}const ge=Object.getOwnPropertyDescriptor;function ye(e,t){let n;return ge(e,t)||(n=ce(e))&&ye(n,t)}const be=[].slice;function ve(e,t,n){return be.call(e,t,n)}function we(e,t){return t(e)}function xe(e){if(!e)throw new Error("Assertion Failed")}function _e(e){se.setImmediate?setImmediate(e):setTimeout(e,0)}function ke(e,t){return e.reduce(((e,n,r)=>{var i=t(n,r);return i&&(e[i[0]]=i[1]),e}),{})}function Ee(e,t){if(he(e,t))return e[t];if(!t)return e;if("string"!=typeof t){for(var n=[],r=0,i=t.length;r<i;++r){var s=Ee(e,t[r]);n.push(s)}return n}var o=t.indexOf(".");if(-1!==o){var a=e[t.substr(0,o)];return void 0===a?void 0:Ee(a,t.substr(o+1))}}function Ae(e,t,n){if(e&&void 0!==t&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){xe("string"!=typeof n&&"length"in n);for(var r=0,i=t.length;r<i;++r)Ae(e,t[r],n[r])}else{var s=t.indexOf(".");if(-1!==s){var o=t.substr(0,s),a=t.substr(s+1);if(""===a)void 0===n?ae(e)&&!isNaN(parseInt(o))?e.splice(o,1):delete e[o]:e[o]=n;else{var l=e[o];l&&he(e,o)||(l=e[o]={}),Ae(l,a,n)}}else void 0===n?ae(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function Ne(e){var t={};for(var n in e)he(e,n)&&(t[n]=e[n]);return t}const Oe=[].concat;function $e(e){return Oe.apply([],e)}const Pe="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat($e([8,16,32,64].map((e=>["Int","Uint","Float"].map((t=>t+e+"Array")))))).filter((e=>se[e])),Se=Pe.map((e=>se[e]));ke(Pe,(e=>[e,!0]));let Ce=null;function Te(e){Ce="undefined"!=typeof WeakMap&&new WeakMap;const t=Be(e);return Ce=null,t}function Be(e){if(!e||"object"!=typeof e)return e;let t=Ce&&Ce.get(e);if(t)return t;if(ae(e)){t=[],Ce&&Ce.set(e,t);for(var n=0,r=e.length;n<r;++n)t.push(Be(e[n]))}else if(Se.indexOf(e.constructor)>=0)t=e;else{const n=ce(e);for(var i in t=n===Object.prototype?{}:Object.create(n),Ce&&Ce.set(e,t),e)he(e,i)&&(t[i]=Be(e[i]))}return t}const{toString:je}={};function Fe(e){return je.call(e).slice(8,-1)}const De="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",Ie="symbol"==typeof De?function(e){var t;return null!=e&&(t=e[De])&&t.apply(e)}:function(){return null},Ke={};function Re(e){var t,n,r,i;if(1===arguments.length){if(ae(e))return e.slice();if(this===Ke&&"string"==typeof e)return[e];if(i=Ie(e)){for(n=[];!(r=i.next()).done;)n.push(r.value);return n}if(null==e)return[e];if("number"==typeof(t=e.length)){for(n=new Array(t);t--;)n[t]=e[t];return n}return[e]}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}const Me="undefined"!=typeof Symbol?e=>"AsyncFunction"===e[Symbol.toStringTag]:()=>!1;var Le="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function ze(e,t){Le=e,qe=t}var qe=()=>!0;const Ve=!new Error("").stack;function Ue(){if(Ve)try{throw Ue.arguments,new Error}catch(e){return e}return new Error}function We(e,t){var n=e.stack;return n?(t=t||0,0===n.indexOf(e.name)&&(t+=(e.name+e.message).split("\n").length),n.split("\n").slice(t).filter(qe).map((e=>"\n"+e)).join("")):""}var Xe=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Ye=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Xe),He={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Ge(e,t){this._e=Ue(),this.name=e,this.message=t}function Qe(e,t){return e+". Errors: "+Object.keys(t).map((e=>t[e].toString())).filter(((e,t,n)=>n.indexOf(e)===t)).join("\n")}function Je(e,t,n,r){this._e=Ue(),this.failures=t,this.failedKeys=r,this.successCount=n,this.message=Qe(e,t)}function Ze(e,t){this._e=Ue(),this.name="BulkError",this.failures=Object.keys(t).map((e=>t[e])),this.failuresByPos=t,this.message=Qe(e,t)}me(Ge).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+We(this._e,2))}},toString:function(){return this.name+": "+this.message}}),me(Je).from(Ge),me(Ze).from(Ge);var et=Ye.reduce(((e,t)=>(e[t]=t+"Error",e)),{});const tt=Ge;var nt=Ye.reduce(((e,t)=>{var n=t+"Error";function r(e,r){this._e=Ue(),this.name=n,e?"string"==typeof e?(this.message=`${e}${r?"\n "+r:""}`,this.inner=r||null):"object"==typeof e&&(this.message=`${e.name} ${e.message}`,this.inner=e):(this.message=He[t]||n,this.inner=null)}return me(r).from(tt),e[t]=r,e}),{});nt.Syntax=SyntaxError,nt.Type=TypeError,nt.Range=RangeError;var rt=Xe.reduce(((e,t)=>(e[t+"Error"]=nt[t],e)),{});var it=Ye.reduce(((e,t)=>(-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=nt[t]),e)),{});function st(){}function ot(e){return e}function at(e,t){return null==e||e===ot?t:function(n){return t(e(n))}}function lt(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function ct(e,t){return e===st?t:function(){var n=e.apply(this,arguments);void 0!==n&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var s=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?lt(r,this.onsuccess):r),i&&(this.onerror=this.onerror?lt(i,this.onerror):i),void 0!==s?s:n}}function ut(e,t){return e===st?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?lt(n,this.onsuccess):n),r&&(this.onerror=this.onerror?lt(r,this.onerror):r)}}function ht(e,t){return e===st?t:function(n){var r=e.apply(this,arguments);le(n,r);var i=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?lt(i,this.onsuccess):i),s&&(this.onerror=this.onerror?lt(s,this.onerror):s),void 0===r?void 0===o?void 0:o:le(r,o)}}function dt(e,t){return e===st?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function ft(e,t){return e===st?t:function(){var n=e.apply(this,arguments);if(n&&"function"==typeof n.then){for(var r=this,i=arguments.length,s=new Array(i);i--;)s[i]=arguments[i];return n.then((function(){return t.apply(r,s)}))}return t.apply(this,arguments)}}it.ModifyError=Je,it.DexieError=Ge,it.BulkError=Ze;var pt={};const[mt,gt,yt]="undefined"==typeof Promise?[]:(()=>{let e=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[e,ce(e),e];const t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,ce(t),e]})(),bt=gt&&gt.then,vt=mt&&mt.constructor,wt=!!yt;var xt=!1,_t=yt?()=>{yt.then(Ut)}:se.setImmediate?setImmediate.bind(null,Ut):se.MutationObserver?()=>{var e=document.createElement("div");new MutationObserver((()=>{Ut(),e=null})).observe(e,{attributes:!0}),e.setAttribute("i","1")}:()=>{setTimeout(Ut,0)},kt=function(e,t){Tt.push([e,t]),At&&(_t(),At=!1)},Et=!0,At=!0,Nt=[],Ot=[],$t=null,Pt=ot,St={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:yn,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach((e=>{try{yn(e[0],e[1])}catch(e){}}))}},Ct=St,Tt=[],Bt=0,jt=[];function Ft(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=st,this._lib=!1;var t=this._PSD=Ct;if(Le&&(this._stackHolder=Ue(),this._prev=null,this._numPrev=0),"function"!=typeof e){if(e!==pt)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&Rt(this,this._value))}this._state=null,this._value=null,++t.ref,Kt(this,e)}const Dt={get:function(){var e=Ct,t=tn;function n(n,r){var i=!e.global&&(e!==Ct||t!==tn);const s=i&&!on();var o=new Ft(((t,o)=>{Lt(this,new It(pn(n,e,i,s),pn(r,e,i,s),t,o,e))}));return Le&&Vt(o,this),o}return n.prototype=pt,n},set:function(e){pe(this,"then",e&&e.prototype===pt?Dt:{get:function(){return e},set:Dt.set})}};function It(e,t,n,r,i){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r,this.psd=i}function Kt(e,t){try{t((t=>{if(null===e._state){if(t===e)throw new TypeError("A promise cannot be resolved with itself.");var n=e._lib&&Wt();t&&"function"==typeof t.then?Kt(e,((e,n)=>{t instanceof Ft?t._then(e,n):t.then(e,n)})):(e._state=!0,e._value=t,Mt(e)),n&&Xt()}}),Rt.bind(null,e))}catch(t){Rt(e,t)}}function Rt(e,t){if(Ot.push(t),null===e._state){var n=e._lib&&Wt();t=Pt(t),e._state=!1,e._value=t,Le&&null!==t&&"object"==typeof t&&!t._promise&&function(e,t,n){try{e.apply(null,n)}catch(e){t&&t(e)}}((()=>{var n=ye(t,"stack");t._promise=e,pe(t,"stack",{get:()=>xt?n&&(n.get?n.get.apply(t):n.value):e.stack})})),function(e){Nt.some((t=>t._value===e._value))||Nt.push(e)}(e),Mt(e),n&&Xt()}}function Mt(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)Lt(e,t[n]);var i=e._PSD;--i.ref||i.finalize(),0===Bt&&(++Bt,kt((()=>{0==--Bt&&Yt()}),[]))}function Lt(e,t){if(null!==e._state){var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Bt,kt(zt,[n,e,t])}else e._listeners.push(t)}function zt(e,t,n){try{$t=t;var r,i=t._value;t._state?r=e(i):(Ot.length&&(Ot=[]),r=e(i),-1===Ot.indexOf(i)&&function(e){var t=Nt.length;for(;t;)if(Nt[--t]._value===e._value)return void Nt.splice(t,1)}(t)),n.resolve(r)}catch(e){n.reject(e)}finally{$t=null,0==--Bt&&Yt(),--n.psd.ref||n.psd.finalize()}}function qt(e,t,n){if(t.length===n)return t;var r="";if(!1===e._state){var i,s,o=e._value;null!=o?(i=o.name||"Error",s=o.message||o,r=We(o,0)):(i=o,s=""),t.push(i+(s?": "+s:"")+r)}return Le&&((r=We(e._stackHolder,2))&&-1===t.indexOf(r)&&t.push(r),e._prev&&qt(e._prev,t,n)),t}function Vt(e,t){var n=t?t._numPrev+1:0;n<100&&(e._prev=t,e._numPrev=n)}function Ut(){Wt()&&Xt()}function Wt(){var e=Et;return Et=!1,At=!1,e}function Xt(){var e,t,n;do{for(;Tt.length>0;)for(e=Tt,Tt=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}}while(Tt.length>0);Et=!0,At=!0}function Yt(){var e=Nt;Nt=[],e.forEach((e=>{e._PSD.onunhandled.call(null,e._value,e)}));for(var t=jt.slice(0),n=t.length;n;)t[--n]()}function Ht(e){return new Ft(pt,!1,e)}function Gt(e,t){var n=Ct;return function(){var r=Wt(),i=Ct;try{return un(n,!0),e.apply(this,arguments)}catch(e){t&&t(e)}finally{un(i,!1),r&&Xt()}}}de(Ft.prototype,{then:Dt,_then:function(e,t){Lt(this,new It(null,null,e,t,Ct))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=arguments[0],n=arguments[1];return"function"==typeof t?this.then(null,(e=>e instanceof t?n(e):Ht(e))):this.then(null,(e=>e&&e.name===t?n(e):Ht(e)))},finally:function(e){return this.then((t=>(e(),t)),(t=>(e(),Ht(t))))},stack:{get:function(){if(this._stack)return this._stack;try{xt=!0;var e=qt(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=e),e}finally{xt=!1}}},timeout:function(e,t){return e<1/0?new Ft(((n,r)=>{var i=setTimeout((()=>r(new nt.Timeout(t))),e);this.then(n,r).finally(clearTimeout.bind(null,i))})):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&pe(Ft.prototype,Symbol.toStringTag,"Dexie.Promise"),St.env=hn(),de(Ft,{all:function(){var e=Re.apply(null,arguments).map(an);return new Ft((function(t,n){0===e.length&&t([]);var r=e.length;e.forEach(((i,s)=>Ft.resolve(i).then((n=>{e[s]=n,--r||t(e)}),n)))}))},resolve:e=>{if(e instanceof Ft)return e;if(e&&"function"==typeof e.then)return new Ft(((t,n)=>{e.then(t,n)}));var t=new Ft(pt,!0,e);return Vt(t,$t),t},reject:Ht,race:function(){var e=Re.apply(null,arguments).map(an);return new Ft(((t,n)=>{e.map((e=>Ft.resolve(e).then(t,n)))}))},PSD:{get:()=>Ct,set:e=>Ct=e},totalEchoes:{get:()=>tn},newPSD:rn,usePSD:dn,scheduler:{get:()=>kt,set:e=>{kt=e}},rejectionMapper:{get:()=>Pt,set:e=>{Pt=e}},follow:(e,t)=>new Ft(((n,r)=>rn(((t,n)=>{var r=Ct;r.unhandleds=[],r.onunhandled=n,r.finalize=lt((function(){!function(e){function t(){e(),jt.splice(jt.indexOf(t),1)}jt.push(t),++Bt,kt((()=>{0==--Bt&&Yt()}),[])}((()=>{0===this.unhandleds.length?t():n(this.unhandleds[0])}))}),r.finalize),e()}),t,n,r)))}),vt&&(vt.allSettled&&pe(Ft,"allSettled",(function(){const e=Re.apply(null,arguments).map(an);return new Ft((t=>{0===e.length&&t([]);let n=e.length;const r=new Array(n);e.forEach(((e,i)=>Ft.resolve(e).then((e=>r[i]={status:"fulfilled",value:e}),(e=>r[i]={status:"rejected",reason:e})).then((()=>--n||t(r)))))}))})),vt.any&&"undefined"!=typeof AggregateError&&pe(Ft,"any",(function(){const e=Re.apply(null,arguments).map(an);return new Ft(((t,n)=>{0===e.length&&n(new AggregateError([]));let r=e.length;const i=new Array(r);e.forEach(((e,s)=>Ft.resolve(e).then((e=>t(e)),(e=>{i[s]=e,--r||n(new AggregateError(i))}))))}))})));const Qt={awaits:0,echoes:0,id:0};var Jt=0,Zt=[],en=0,tn=0,nn=0;function rn(e,t,n,r){var i=Ct,s=Object.create(i);s.parent=i,s.ref=0,s.global=!1,s.id=++nn;var o=St.env;s.env=wt?{Promise:Ft,PromiseProp:{value:Ft,configurable:!0,writable:!0},all:Ft.all,race:Ft.race,allSettled:Ft.allSettled,any:Ft.any,resolve:Ft.resolve,reject:Ft.reject,nthen:mn(o.nthen,s),gthen:mn(o.gthen,s)}:{},t&&le(s,t),++i.ref,s.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=dn(s,e,n,r);return 0===s.ref&&s.finalize(),a}function sn(){return Qt.id||(Qt.id=++Jt),++Qt.awaits,Qt.echoes+=100,Qt.id}function on(){return!!Qt.awaits&&(0==--Qt.awaits&&(Qt.id=0),Qt.echoes=100*Qt.awaits,!0)}function an(e){return Qt.echoes&&e&&e.constructor===vt?(sn(),e.then((e=>(on(),e)),(e=>(on(),bn(e))))):e}function ln(e){++tn,Qt.echoes&&0!=--Qt.echoes||(Qt.echoes=Qt.id=0),Zt.push(Ct),un(e,!0)}function cn(){var e=Zt[Zt.length-1];Zt.pop(),un(e,!1)}function un(e,t){var n=Ct;if((t?!Qt.echoes||en++&&e===Ct:!en||--en&&e===Ct)||fn(t?ln.bind(null,e):cn),e!==Ct&&(Ct=e,n===St&&(St.env=hn()),wt)){var r=St.env.Promise,i=e.env;gt.then=i.nthen,r.prototype.then=i.gthen,(n.global||e.global)&&(Object.defineProperty(se,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function hn(){var e=se.Promise;return wt?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(se,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject,nthen:gt.then,gthen:e.prototype.then}:{}}function dn(e,t,n,r,i){var s=Ct;try{return un(e,!0),t(n,r,i)}finally{un(s,!1)}}function fn(e){bt.call(mt,e)}function pn(e,t,n,r){return"function"!=typeof e?e:function(){var i=Ct;n&&sn(),un(t,!0);try{return e.apply(this,arguments)}finally{un(i,!1),r&&fn(on)}}}function mn(e,t){return function(n,r){return e.call(this,pn(n,t),pn(r,t))}}-1===(""+bt).indexOf("[native code]")&&(sn=on=st);const gn="unhandledrejection";function yn(e,t){var n;try{n=t.onuncatched(e)}catch(e){}if(!1!==n)try{var r,i={promise:t,reason:e};if(se.document&&document.createEvent?((r=document.createEvent("Event")).initEvent(gn,!0,!0),le(r,i)):se.CustomEvent&&le(r=new CustomEvent(gn,{detail:i}),i),r&&se.dispatchEvent&&(dispatchEvent(r),!se.PromiseRejectionEvent&&se.onunhandledrejection))try{se.onunhandledrejection(r)}catch(e){}Le&&r&&!r.defaultPrevented&&console.warn(`Unhandled rejection: ${e.stack||e}`)}catch(e){}}var bn=Ft.reject;function vn(e,t,n,r){if(e.idbdb&&(e._state.openComplete||Ct.letThrough||e._vip)){var i=e._createTransaction(t,n,e._dbSchema);try{i.create(),e._state.PR1398_maxLoop=3}catch(i){return i.name===et.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then((()=>vn(e,t,n,r)))):bn(i)}return i._promise(t,((e,t)=>rn((()=>(Ct.trans=i,r(e,t,i)))))).then((e=>i._completion.then((()=>e))))}if(e._state.openComplete)return bn(new nt.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._options.autoOpen)return bn(new nt.DatabaseClosed);e.open().catch(st)}return e._state.dbReadyPromise.then((()=>vn(e,t,n,r)))}const wn="3.2.2",xn=String.fromCharCode(65535),_n=-1/0,kn="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",En="String expected.",An=[],Nn="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),On=Nn,$n=Nn,Pn=e=>!/(dexie\.js|dexie\.min\.js)/.test(e),Sn="__dbnames",Cn="readonly",Tn="readwrite";function Bn(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}const jn={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Fn(e){return"string"!=typeof e||/\./.test(e)?e=>e:t=>(void 0===t[e]&&e in t&&delete(t=Te(t))[e],t)}class Dn{_trans(e,t,n){const r=this._tx||Ct.trans,i=this.name;function s(e,n,r){if(!r.schema[i])throw new nt.NotFound("Table "+i+" not part of transaction");return t(r.idbtrans,r)}const o=Wt();try{return r&&r.db===this.db?r===Ct.trans?r._promise(e,s,n):rn((()=>r._promise(e,s,n)),{trans:r,transless:Ct.transless||Ct}):vn(this.db,e,[this.name],s)}finally{o&&Xt()}}get(e,t){return e&&e.constructor===Object?this.where(e).first(t):this._trans("readonly",(t=>this.core.get({trans:t,key:e}).then((e=>this.hook.reading.fire(e))))).then(t)}where(e){if("string"==typeof e)return new this.db.WhereClause(this,e);if(ae(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);const t=oe(e);if(1===t.length)return this.where(t[0]).equals(e[t[0]]);const n=this.schema.indexes.concat(this.schema.primKey).filter((e=>e.compound&&t.every((t=>e.keyPath.indexOf(t)>=0))&&e.keyPath.every((e=>t.indexOf(e)>=0))))[0];if(n&&this.db._maxKey!==xn)return this.where(n.name).equals(n.keyPath.map((t=>e[t])));!n&&Le&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${t.join("+")}]`);const{idxByName:r}=this.schema,i=this.db._deps.indexedDB;function s(e,t){try{return 0===i.cmp(e,t)}catch(e){return!1}}const[o,a]=t.reduce((([t,n],i)=>{const o=r[i],a=e[i];return[t||o,t||!o?Bn(n,o&&o.multi?e=>{const t=Ee(e,i);return ae(t)&&t.some((e=>s(a,e)))}:e=>s(a,Ee(e,i))):n]}),[null,null]);return o?this.where(o.name).equals(e[o.keyPath]).filter(a):n?this.filter(a):this.where(t).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,ae(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;const t=t=>{if(!t)return t;const n=Object.create(e.prototype);for(var r in t)if(he(t,r))try{n[r]=t[r]}catch(e){}return n};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=t,this.hook("reading",t),e}defineClass(){return this.mapToClass((function(e){le(this,e)}))}add(e,t){const{auto:n,keyPath:r}=this.schema.primKey;let i=e;return r&&n&&(i=Fn(r)(e)),this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"add",keys:null!=t?[t]:null,values:[i]}))).then((e=>e.numFailures?Ft.reject(e.failures[0]):e.lastResult)).then((t=>{if(r)try{Ae(e,r,t)}catch(e){}return t}))}update(e,t){if("object"!=typeof e||ae(e))return this.where(":id").equals(e).modify(t);{const n=Ee(e,this.schema.primKey.keyPath);if(void 0===n)return bn(new nt.InvalidArgument("Given object does not contain its primary key"));try{"function"!=typeof t?oe(t).forEach((n=>{Ae(e,n,t[n])})):t(e,{value:e,primKey:n})}catch(e){}return this.where(":id").equals(n).modify(t)}}put(e,t){const{auto:n,keyPath:r}=this.schema.primKey;let i=e;return r&&n&&(i=Fn(r)(e)),this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"put",values:[i],keys:null!=t?[t]:null}))).then((e=>e.numFailures?Ft.reject(e.failures[0]):e.lastResult)).then((t=>{if(r)try{Ae(e,r,t)}catch(e){}return t}))}delete(e){return this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"delete",keys:[e]}))).then((e=>e.numFailures?Ft.reject(e.failures[0]):void 0))}clear(){return this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"deleteRange",range:jn}))).then((e=>e.numFailures?Ft.reject(e.failures[0]):void 0))}bulkGet(e){return this._trans("readonly",(t=>this.core.getMany({keys:e,trans:t}).then((e=>e.map((e=>this.hook.reading.fire(e)))))))}bulkAdd(e,t,n){const r=Array.isArray(t)?t:void 0,i=(n=n||(r?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",(t=>{const{auto:n,keyPath:s}=this.schema.primKey;if(s&&r)throw new nt.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(r&&r.length!==e.length)throw new nt.InvalidArgument("Arguments objects and keys must have the same length");const o=e.length;let a=s&&n?e.map(Fn(s)):e;return this.core.mutate({trans:t,type:"add",keys:r,values:a,wantResults:i}).then((({numFailures:e,results:t,lastResult:n,failures:r})=>{if(0===e)return i?t:n;throw new Ze(`${this.name}.bulkAdd(): ${e} of ${o} operations failed`,r)}))}))}bulkPut(e,t,n){const r=Array.isArray(t)?t:void 0,i=(n=n||(r?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",(t=>{const{auto:n,keyPath:s}=this.schema.primKey;if(s&&r)throw new nt.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(r&&r.length!==e.length)throw new nt.InvalidArgument("Arguments objects and keys must have the same length");const o=e.length;let a=s&&n?e.map(Fn(s)):e;return this.core.mutate({trans:t,type:"put",keys:r,values:a,wantResults:i}).then((({numFailures:e,results:t,lastResult:n,failures:r})=>{if(0===e)return i?t:n;throw new Ze(`${this.name}.bulkPut(): ${e} of ${o} operations failed`,r)}))}))}bulkDelete(e){const t=e.length;return this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"delete",keys:e}))).then((({numFailures:e,lastResult:n,failures:r})=>{if(0===e)return n;throw new Ze(`${this.name}.bulkDelete(): ${e} of ${t} operations failed`,r)}))}}function In(e){var t={},n=function(n,r){if(r){for(var i=arguments.length,s=new Array(i-1);--i;)s[i-1]=arguments[i];return t[n].subscribe.apply(null,s),e}if("string"==typeof n)return t[n]};n.addEventType=s;for(var r=1,i=arguments.length;r<i;++r)s(arguments[r]);return n;function s(e,r,i){if("object"==typeof e)return o(e);r||(r=dt),i||(i=st);var s={subscribers:[],fire:i,subscribe:function(e){-1===s.subscribers.indexOf(e)&&(s.subscribers.push(e),s.fire=r(s.fire,e))},unsubscribe:function(e){s.subscribers=s.subscribers.filter((function(t){return t!==e})),s.fire=s.subscribers.reduce(r,i)}};return t[e]=n[e]=s,s}function o(e){oe(e).forEach((function(t){var n=e[t];if(ae(n))s(t,e[t][0],e[t][1]);else{if("asap"!==n)throw new nt.InvalidArgument("Invalid event config");var r=s(t,ot,(function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];r.subscribers.forEach((function(e){_e((function(){e.apply(null,t)}))}))}))}}))}}function Kn(e,t){return me(t).from({prototype:e}),t}function Rn(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Mn(e,t){e.filter=Bn(e.filter,t)}function Ln(e,t,n){var r=e.replayFilter;e.replayFilter=r?()=>Bn(r(),t()):t,e.justLimit=n&&!r}function zn(e,t){if(e.isPrimKey)return t.primaryKey;const n=t.getIndexByKeyPath(e.index);if(!n)throw new nt.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function qn(e,t,n){const r=zn(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:"prev"===e.dir,unique:!!e.unique,query:{index:r,range:e.range}})}function Vn(e,t,n,r){const i=e.replayFilter?Bn(e.filter,e.replayFilter()):e.filter;if(e.or){const s={},o=(e,n,r)=>{if(!i||i(n,r,(e=>n.stop(e)),(e=>n.fail(e)))){var o=n.primaryKey,a=""+o;"[object ArrayBuffer]"===a&&(a=""+new Uint8Array(o)),he(s,a)||(s[a]=!0,t(e,n,r))}};return Promise.all([e.or._iterate(o,n),Un(qn(e,r,n),e.algorithm,o,!e.keysOnly&&e.valueMapper)])}return Un(qn(e,r,n),Bn(e.algorithm,i),t,!e.keysOnly&&e.valueMapper)}function Un(e,t,n,r){var i=Gt(r?(e,t,i)=>n(r(e),t,i):n);return e.then((e=>{if(e)return e.start((()=>{var n=()=>e.continue();t&&!t(e,(e=>n=e),(t=>{e.stop(t),n=st}),(t=>{e.fail(t),n=st}))||i(e.value,e,(e=>n=e)),n()}))}))}function Wn(e,t){try{const n=Xn(e),r=Xn(t);if(n!==r)return"Array"===n?1:"Array"===r?-1:"binary"===n?1:"binary"===r?-1:"string"===n?1:"string"===r?-1:"Date"===n?1:"Date"!==r?NaN:-1;switch(n){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return function(e,t){const n=e.length,r=t.length,i=n<r?n:r;for(let n=0;n<i;++n)if(e[n]!==t[n])return e[n]<t[n]?-1:1;return n===r?0:n<r?-1:1}(Yn(e),Yn(t));case"Array":return function(e,t){const n=e.length,r=t.length,i=n<r?n:r;for(let n=0;n<i;++n){const r=Wn(e[n],t[n]);if(0!==r)return r}return n===r?0:n<r?-1:1}(e,t)}}catch(e){}return NaN}function Xn(e){const t=typeof e;if("object"!==t)return t;if(ArrayBuffer.isView(e))return"binary";const n=Fe(e);return"ArrayBuffer"===n?"binary":n}function Yn(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}class Hn{_read(e,t){var n=this._ctx;return n.error?n.table._trans(null,bn.bind(null,n.error)):n.table._trans("readonly",e).then(t)}_write(e){var t=this._ctx;return t.error?t.table._trans(null,bn.bind(null,t.error)):t.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var t=this._ctx;t.algorithm=Bn(t.algorithm,e)}_iterate(e,t){return Vn(this._ctx,e,t,this._ctx.table.core)}clone(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&le(n,e),t._ctx=n,t}raw(){return this._ctx.valueMapper=null,this}each(e){var t=this._ctx;return this._read((n=>Vn(t,e,n,t.table.core)))}count(e){return this._read((e=>{const t=this._ctx,n=t.table.core;if(Rn(t,!0))return n.count({trans:e,query:{index:zn(t,n.schema),range:t.range}}).then((e=>Math.min(e,t.limit)));var r=0;return Vn(t,(()=>(++r,!1)),e,n).then((()=>r))})).then(e)}sortBy(e,t){const n=e.split(".").reverse(),r=n[0],i=n.length-1;function s(e,t){return t?s(e[n[t]],t-1):e[r]}var o="next"===this._ctx.dir?1:-1;function a(e,t){var n=s(e,i),r=s(t,i);return n<r?-o:n>r?o:0}return this.toArray((function(e){return e.sort(a)})).then(t)}toArray(e){return this._read((e=>{var t=this._ctx;if("next"===t.dir&&Rn(t,!0)&&t.limit>0){const{valueMapper:n}=t,r=zn(t,t.table.core.schema);return t.table.core.query({trans:e,limit:t.limit,values:!0,query:{index:r,range:t.range}}).then((({result:e})=>n?e.map(n):e))}{const n=[];return Vn(t,(e=>n.push(e)),e,t.table.core).then((()=>n))}}),e)}offset(e){var t=this._ctx;return e<=0||(t.offset+=e,Rn(t)?Ln(t,(()=>{var t=e;return(e,n)=>0===t||(1===t?(--t,!1):(n((()=>{e.advance(t),t=0})),!1))})):Ln(t,(()=>{var t=e;return()=>--t<0}))),this}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Ln(this._ctx,(()=>{var t=e;return function(e,n,r){return--t<=0&&n(r),t>=0}}),!0),this}until(e,t){return Mn(this._ctx,(function(n,r,i){return!e(n.value)||(r(i),t)})),this}first(e){return this.limit(1).toArray((function(e){return e[0]})).then(e)}last(e){return this.reverse().first(e)}filter(e){var t,n;return Mn(this._ctx,(function(t){return e(t.value)})),t=this._ctx,n=e,t.isMatch=Bn(t.isMatch,n),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,n){e(n.key,n)}))}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,n){e(n.primaryKey,n)}))}keys(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each((function(e,t){n.push(t.key)})).then((function(){return n})).then(e)}primaryKeys(e){var t=this._ctx;if("next"===t.dir&&Rn(t,!0)&&t.limit>0)return this._read((e=>{var n=zn(t,t.table.core.schema);return t.table.core.query({trans:e,values:!1,limit:t.limit,query:{index:n,range:t.range}})})).then((({result:e})=>e)).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each((function(e,t){n.push(t.primaryKey)})).then((function(){return n})).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys((function(e){return e[0]})).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var n={};return Mn(this._ctx,(function(e){var t=e.primaryKey.toString(),r=he(n,t);return n[t]=!0,!r})),this}modify(e){var t=this._ctx;return this._write((n=>{var r;if("function"==typeof e)r=e;else{var i=oe(e),s=i.length;r=function(t){for(var n=!1,r=0;r<s;++r){var o=i[r],a=e[o];Ee(t,o)!==a&&(Ae(t,o,a),n=!0)}return n}}const o=t.table.core,{outbound:a,extractKey:l}=o.schema.primaryKey,c=this.db._options.modifyChunkSize||200,u=[];let h=0;const d=[],f=(e,t)=>{const{failures:n,numFailures:r}=t;h+=e-r;for(let e of oe(n))u.push(n[e])};return this.clone().primaryKeys().then((i=>{const s=u=>{const h=Math.min(c,i.length-u);return o.getMany({trans:n,keys:i.slice(u,u+h),cache:"immutable"}).then((d=>{const p=[],m=[],g=a?[]:null,y=[];for(let e=0;e<h;++e){const t=d[e],n={value:Te(t),primKey:i[u+e]};!1!==r.call(n,n.value,n)&&(null==n.value?y.push(i[u+e]):a||0===Wn(l(t),l(n.value))?(m.push(n.value),a&&g.push(i[u+e])):(y.push(i[u+e]),p.push(n.value)))}const b=Rn(t)&&t.limit===1/0&&("function"!=typeof e||e===Gn)&&{index:t.index,range:t.range};return Promise.resolve(p.length>0&&o.mutate({trans:n,type:"add",values:p}).then((e=>{for(let t in e.failures)y.splice(parseInt(t),1);f(p.length,e)}))).then((()=>(m.length>0||b&&"object"==typeof e)&&o.mutate({trans:n,type:"put",keys:g,values:m,criteria:b,changeSpec:"function"!=typeof e&&e}).then((e=>f(m.length,e))))).then((()=>(y.length>0||b&&e===Gn)&&o.mutate({trans:n,type:"delete",keys:y,criteria:b}).then((e=>f(y.length,e))))).then((()=>i.length>u+h&&s(u+c)))}))};return s(0).then((()=>{if(u.length>0)throw new Je("Error modifying one or more objects",u,h,d);return i.length}))}))}))}delete(){var e=this._ctx,t=e.range;return Rn(e)&&(e.isPrimKey&&!$n||3===t.type)?this._write((n=>{const{primaryKey:r}=e.table.core.schema,i=t;return e.table.core.count({trans:n,query:{index:r,range:i}}).then((t=>e.table.core.mutate({trans:n,type:"deleteRange",range:i}).then((({failures:e,lastResult:n,results:r,numFailures:i})=>{if(i)throw new Je("Could not delete some values",Object.keys(e).map((t=>e[t])),t-i);return t-i}))))})):this.modify(Gn)}}const Gn=(e,t)=>t.value=null;function Qn(e,t){return e<t?-1:e===t?0:1}function Jn(e,t){return e>t?-1:e===t?0:1}function Zn(e,t,n){var r=e instanceof sr?new e.Collection(e):e;return r._ctx.error=n?new n(t):new TypeError(t),r}function er(e){return new e.Collection(e,(()=>ir(""))).limit(0)}function tr(e,t,n,r,i,s){for(var o=Math.min(e.length,r.length),a=-1,l=0;l<o;++l){var c=t[l];if(c!==r[l])return i(e[l],n[l])<0?e.substr(0,l)+n[l]+n.substr(l+1):i(e[l],r[l])<0?e.substr(0,l)+r[l]+n.substr(l+1):a>=0?e.substr(0,a)+t[a]+n.substr(a+1):null;i(e[l],c)<0&&(a=l)}return o<r.length&&"next"===s?e+n.substr(e.length):o<e.length&&"prev"===s?e.substr(0,n.length):a<0?null:e.substr(0,a)+r[a]+n.substr(a+1)}function nr(e,t,n,r){var i,s,o,a,l,c,u,h=n.length;if(!n.every((e=>"string"==typeof e)))return Zn(e,En);function d(e){i=function(e){return"next"===e?e=>e.toUpperCase():e=>e.toLowerCase()}(e),s=function(e){return"next"===e?e=>e.toLowerCase():e=>e.toUpperCase()}(e),o="next"===e?Qn:Jn;var t=n.map((function(e){return{lower:s(e),upper:i(e)}})).sort((function(e,t){return o(e.lower,t.lower)}));a=t.map((function(e){return e.upper})),l=t.map((function(e){return e.lower})),c=e,u="next"===e?"":r}d("next");var f=new e.Collection(e,(()=>rr(a[0],l[h-1]+r)));f._ondirectionchange=function(e){d(e)};var p=0;return f._addAlgorithm((function(e,n,r){var i=e.key;if("string"!=typeof i)return!1;var d=s(i);if(t(d,l,p))return!0;for(var f=null,m=p;m<h;++m){var g=tr(i,d,a[m],l[m],o,c);null===g&&null===f?p=m+1:(null===f||o(f,g)>0)&&(f=g)}return n(null!==f?function(){e.continue(f+u)}:r),!1})),f}function rr(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function ir(e){return{type:1,lower:e,upper:e}}class sr{get Collection(){return this._ctx.table.db.Collection}between(e,t,n,r){n=!1!==n,r=!0===r;try{return this._cmp(e,t)>0||0===this._cmp(e,t)&&(n||r)&&(!n||!r)?er(this):new this.Collection(this,(()=>rr(e,t,!n,!r)))}catch(e){return Zn(this,kn)}}equals(e){return null==e?Zn(this,kn):new this.Collection(this,(()=>ir(e)))}above(e){return null==e?Zn(this,kn):new this.Collection(this,(()=>rr(e,void 0,!0)))}aboveOrEqual(e){return null==e?Zn(this,kn):new this.Collection(this,(()=>rr(e,void 0,!1)))}below(e){return null==e?Zn(this,kn):new this.Collection(this,(()=>rr(void 0,e,!1,!0)))}belowOrEqual(e){return null==e?Zn(this,kn):new this.Collection(this,(()=>rr(void 0,e)))}startsWith(e){return"string"!=typeof e?Zn(this,En):this.between(e,e+xn,!0,!0)}startsWithIgnoreCase(e){return""===e?this.startsWith(e):nr(this,((e,t)=>0===e.indexOf(t[0])),[e],xn)}equalsIgnoreCase(e){return nr(this,((e,t)=>e===t[0]),[e],"")}anyOfIgnoreCase(){var e=Re.apply(Ke,arguments);return 0===e.length?er(this):nr(this,((e,t)=>-1!==t.indexOf(e)),e,"")}startsWithAnyOfIgnoreCase(){var e=Re.apply(Ke,arguments);return 0===e.length?er(this):nr(this,((e,t)=>t.some((t=>0===e.indexOf(t)))),e,xn)}anyOf(){const e=Re.apply(Ke,arguments);let t=this._cmp;try{e.sort(t)}catch(e){return Zn(this,kn)}if(0===e.length)return er(this);const n=new this.Collection(this,(()=>rr(e[0],e[e.length-1])));n._ondirectionchange=n=>{t="next"===n?this._ascending:this._descending,e.sort(t)};let r=0;return n._addAlgorithm(((n,i,s)=>{const o=n.key;for(;t(o,e[r])>0;)if(++r,r===e.length)return i(s),!1;return 0===t(o,e[r])||(i((()=>{n.continue(e[r])})),!1)})),n}notEqual(e){return this.inAnyRange([[_n,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const e=Re.apply(Ke,arguments);if(0===e.length)return new this.Collection(this);try{e.sort(this._ascending)}catch(e){return Zn(this,kn)}const t=e.reduce(((e,t)=>e?e.concat([[e[e.length-1][1],t]]):[[_n,t]]),null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,t){const n=this._cmp,r=this._ascending,i=this._descending,s=this._min,o=this._max;if(0===e.length)return er(this);if(!e.every((e=>void 0!==e[0]&&void 0!==e[1]&&r(e[0],e[1])<=0)))return Zn(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",nt.InvalidArgument);const a=!t||!1!==t.includeLowers,l=t&&!0===t.includeUppers;let c,u=r;function h(e,t){return u(e[0],t[0])}try{c=e.reduce((function(e,t){let r=0,i=e.length;for(;r<i;++r){const i=e[r];if(n(t[0],i[1])<0&&n(t[1],i[0])>0){i[0]=s(i[0],t[0]),i[1]=o(i[1],t[1]);break}}return r===i&&e.push(t),e}),[]),c.sort(h)}catch(e){return Zn(this,kn)}let d=0;const f=l?e=>r(e,c[d][1])>0:e=>r(e,c[d][1])>=0,p=a?e=>i(e,c[d][0])>0:e=>i(e,c[d][0])>=0;let m=f;const g=new this.Collection(this,(()=>rr(c[0][0],c[c.length-1][1],!a,!l)));return g._ondirectionchange=e=>{"next"===e?(m=f,u=r):(m=p,u=i),c.sort(h)},g._addAlgorithm(((e,t,n)=>{for(var i=e.key;m(i);)if(++d,d===c.length)return t(n),!1;return!!function(e){return!f(e)&&!p(e)}(i)||(0===this._cmp(i,c[d][1])||0===this._cmp(i,c[d][0])||t((()=>{u===r?e.continue(c[d][0]):e.continue(c[d][1])})),!1)})),g}startsWithAnyOf(){const e=Re.apply(Ke,arguments);return e.every((e=>"string"==typeof e))?0===e.length?er(this):this.inAnyRange(e.map((e=>[e,e+xn]))):Zn(this,"startsWithAnyOf() only works with strings")}}function or(e){return Gt((function(t){return ar(t),e(t.target.error),!1}))}function ar(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}const lr="storagemutated",cr="x-storagemutated-1",ur=In(null,lr);class hr{_lock(){return xe(!Ct.global),++this._reculock,1!==this._reculock||Ct.global||(Ct.lockOwnerFor=this),this}_unlock(){if(xe(!Ct.global),0==--this._reculock)for(Ct.global||(Ct.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{dn(e[1],e[0])}catch(e){}}return this}_locked(){return this._reculock&&Ct.lockOwnerFor!==this}create(e){if(!this.mode)return this;const t=this.db.idbdb,n=this.db._state.dbOpenError;if(xe(!this.idbtrans),!e&&!t)switch(n&&n.name){case"DatabaseClosedError":throw new nt.DatabaseClosed(n);case"MissingAPIError":throw new nt.MissingAPI(n.message,n);default:throw new nt.OpenFailed(n)}if(!this.active)throw new nt.TransactionInactive;return xe(null===this._completion._state),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):t.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=Gt((t=>{ar(t),this._reject(e.error)})),e.onabort=Gt((t=>{ar(t),this.active&&this._reject(new nt.Abort(e.error)),this.active=!1,this.on("abort").fire(t)})),e.oncomplete=Gt((()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&ur.storagemutated.fire(e.mutatedParts)})),this}_promise(e,t,n){if("readwrite"===e&&"readwrite"!==this.mode)return bn(new nt.ReadOnly("Transaction is readonly"));if(!this.active)return bn(new nt.TransactionInactive);if(this._locked())return new Ft(((r,i)=>{this._blockedFuncs.push([()=>{this._promise(e,t,n).then(r,i)},Ct])}));if(n)return rn((()=>{var e=new Ft(((e,n)=>{this._lock();const r=t(e,n,this);r&&r.then&&r.then(e,n)}));return e.finally((()=>this._unlock())),e._lib=!0,e}));var r=new Ft(((e,n)=>{var r=t(e,n,this);r&&r.then&&r.then(e,n)}));return r._lib=!0,r}_root(){return this.parent?this.parent._root():this}waitFor(e){var t=this._root();const n=Ft.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then((()=>n));else{t._waitingFor=n,t._waitingQueue=[];var r=t.idbtrans.objectStore(t.storeNames[0]);!function e(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(r.get(-1/0).onsuccess=e)}()}var i=t._waitingFor;return new Ft(((e,r)=>{n.then((n=>t._waitingQueue.push(Gt(e.bind(null,n)))),(e=>t._waitingQueue.push(Gt(r.bind(null,e))))).finally((()=>{t._waitingFor===i&&(t._waitingFor=null)}))}))}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new nt.Abort))}table(e){const t=this._memoizedTables||(this._memoizedTables={});if(he(t,e))return t[e];const n=this.schema[e];if(!n)throw new nt.NotFound("Table "+e+" not part of transaction");const r=new this.db.Table(e,n,this);return r.core=this.db.core.table(e),t[e]=r,r}}function dr(e,t,n,r,i,s,o){return{name:e,keyPath:t,unique:n,multi:r,auto:i,compound:s,src:(n&&!o?"&":"")+(r?"*":"")+(i?"++":"")+fr(t)}}function fr(e){return"string"==typeof e?e:e?"["+[].join.call(e,"+")+"]":""}function pr(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:ke(n,(e=>[e.name,e]))}}let mr=e=>{try{return e.only([[]]),mr=()=>[[]],[[]]}catch(e){return mr=()=>xn,xn}};function gr(e){return null==e?()=>{}:"string"==typeof e?function(e){return 1===e.split(".").length?t=>t[e]:t=>Ee(t,e)}(e):t=>Ee(t,e)}function yr(e){return[].slice.call(e)}let br=0;function vr(e){return null==e?":id":"string"==typeof e?e:`[${e.join("+")}]`}function wr(e,t,n){function r(e){if(3===e.type)return null;if(4===e.type)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:n,upper:r,lowerOpen:i,upperOpen:s}=e;return void 0===n?void 0===r?null:t.upperBound(r,!!s):void 0===r?t.lowerBound(n,!!i):t.bound(n,r,!!i,!!s)}const{schema:i,hasGetAll:s}=function(e,t){const n=yr(e.objectStoreNames);return{schema:{name:e.name,tables:n.map((e=>t.objectStore(e))).map((e=>{const{keyPath:t,autoIncrement:n}=e,r=ae(t),i=null==t,s={},o={name:e.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:i,compound:r,keyPath:t,autoIncrement:n,unique:!0,extractKey:gr(t)},indexes:yr(e.indexNames).map((t=>e.index(t))).map((e=>{const{name:t,unique:n,multiEntry:r,keyPath:i}=e,o={name:t,compound:ae(i),keyPath:i,unique:n,multiEntry:r,extractKey:gr(i)};return s[vr(i)]=o,o})),getIndexByKeyPath:e=>s[vr(e)]};return s[":id"]=o.primaryKey,null!=t&&(s[vr(t)]=o.primaryKey),o}))},hasGetAll:n.length>0&&"getAll"in t.objectStore(n[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(e,n),o=i.tables.map((e=>function(e){const t=e.name;return{name:t,schema:e,mutate:function({trans:e,type:n,keys:i,values:s,range:o}){return new Promise(((a,l)=>{a=Gt(a);const c=e.objectStore(t),u=null==c.keyPath,h="put"===n||"add"===n;if(!h&&"delete"!==n&&"deleteRange"!==n)throw new Error("Invalid operation type: "+n);const{length:d}=i||s||{length:1};if(i&&s&&i.length!==s.length)throw new Error("Given keys array must have same length as given values array.");if(0===d)return a({numFailures:0,failures:{},results:[],lastResult:void 0});let f;const p=[],m=[];let g=0;const y=e=>{++g,ar(e)};if("deleteRange"===n){if(4===o.type)return a({numFailures:g,failures:m,results:[],lastResult:void 0});3===o.type?p.push(f=c.clear()):p.push(f=c.delete(r(o)))}else{const[e,t]=h?u?[s,i]:[s,null]:[i,null];if(h)for(let r=0;r<d;++r)p.push(f=t&&void 0!==t[r]?c[n](e[r],t[r]):c[n](e[r])),f.onerror=y;else for(let t=0;t<d;++t)p.push(f=c[n](e[t])),f.onerror=y}const b=e=>{const t=e.target.result;p.forEach(((e,t)=>null!=e.error&&(m[t]=e.error))),a({numFailures:g,failures:m,results:"delete"===n?i:p.map((e=>e.result)),lastResult:t})};f.onerror=e=>{y(e),b(e)},f.onsuccess=b}))},getMany:({trans:e,keys:n})=>new Promise(((r,i)=>{r=Gt(r);const s=e.objectStore(t),o=n.length,a=new Array(o);let l,c=0,u=0;const h=e=>{const t=e.target;a[t._pos]=t.result,++u===c&&r(a)},d=or(i);for(let e=0;e<o;++e)null!=n[e]&&(l=s.get(n[e]),l._pos=e,l.onsuccess=h,l.onerror=d,++c);0===c&&r(a)})),get:({trans:e,key:n})=>new Promise(((r,i)=>{r=Gt(r);const s=e.objectStore(t).get(n);s.onsuccess=e=>r(e.target.result),s.onerror=or(i)})),query:function(e){return n=>new Promise(((i,s)=>{i=Gt(i);const{trans:o,values:a,limit:l,query:c}=n,u=l===1/0?void 0:l,{index:h,range:d}=c,f=o.objectStore(t),p=h.isPrimaryKey?f:f.index(h.name),m=r(d);if(0===l)return i({result:[]});if(e){const e=a?p.getAll(m,u):p.getAllKeys(m,u);e.onsuccess=e=>i({result:e.target.result}),e.onerror=or(s)}else{let e=0;const t=a||!("openKeyCursor"in p)?p.openCursor(m):p.openKeyCursor(m),n=[];t.onsuccess=r=>{const s=t.result;return s?(n.push(a?s.value:s.primaryKey),++e===l?i({result:n}):void s.continue()):i({result:n})},t.onerror=or(s)}}))}(s),openCursor:function({trans:e,values:n,query:i,reverse:s,unique:o}){return new Promise(((a,l)=>{a=Gt(a);const{index:c,range:u}=i,h=e.objectStore(t),d=c.isPrimaryKey?h:h.index(c.name),f=s?o?"prevunique":"prev":o?"nextunique":"next",p=n||!("openKeyCursor"in d)?d.openCursor(r(u),f):d.openKeyCursor(r(u),f);p.onerror=or(l),p.onsuccess=Gt((t=>{const n=p.result;if(!n)return void a(null);n.___id=++br,n.done=!1;const r=n.continue.bind(n);let i=n.continuePrimaryKey;i&&(i=i.bind(n));const s=n.advance.bind(n),o=()=>{throw new Error("Cursor not stopped")};n.trans=e,n.stop=n.continue=n.continuePrimaryKey=n.advance=()=>{throw new Error("Cursor not started")},n.fail=Gt(l),n.next=function(){let e=1;return this.start((()=>e--?this.continue():this.stop())).then((()=>this))},n.start=e=>{const t=new Promise(((e,t)=>{e=Gt(e),p.onerror=or(t),n.fail=t,n.stop=t=>{n.stop=n.continue=n.continuePrimaryKey=n.advance=o,e(t)}})),a=()=>{if(p.result)try{e()}catch(e){n.fail(e)}else n.done=!0,n.start=()=>{throw new Error("Cursor behind last entry")},n.stop()};return p.onsuccess=Gt((e=>{p.onsuccess=a,a()})),n.continue=r,n.continuePrimaryKey=i,n.advance=s,a(),t},a(n)}),l)}))},count({query:e,trans:n}){const{index:i,range:s}=e;return new Promise(((e,o)=>{const a=n.objectStore(t),l=i.isPrimaryKey?a:a.index(i.name),c=r(s),u=c?l.count(c):l.count();u.onsuccess=Gt((t=>e(t.target.result))),u.onerror=or(o)}))}}}(e))),a={};return o.forEach((e=>a[e.name]=e)),{stack:"dbcore",transaction:e.transaction.bind(e),table(e){if(!a[e])throw new Error(`Table '${e}' not found`);return a[e]},MIN_KEY:-1/0,MAX_KEY:mr(t),schema:i}}function xr({_novip:e},t){const n=t.db,r=function(e,t,{IDBKeyRange:n,indexedDB:r},i){const s=function(e,t){return t.reduce(((e,{create:t})=>({...e,...t(e)})),e)}(wr(t,n,i),e.dbcore);return{dbcore:s}}(e._middlewares,n,e._deps,t);e.core=r.dbcore,e.tables.forEach((t=>{const n=t.name;e.core.schema.tables.some((e=>e.name===n))&&(t.core=e.core.table(n),e[n]instanceof e.Table&&(e[n].core=t.core))}))}function _r({_novip:e},t,n,r){n.forEach((n=>{const i=r[n];t.forEach((t=>{const r=ye(t,n);(!r||"value"in r&&void 0===r.value)&&(t===e.Transaction.prototype||t instanceof e.Transaction?pe(t,n,{get(){return this.table(n)},set(e){fe(this,n,{value:e,writable:!0,configurable:!0,enumerable:!0})}}):t[n]=new e.Table(n,i))}))}))}function kr({_novip:e},t){t.forEach((t=>{for(let n in t)t[n]instanceof e.Table&&delete t[n]}))}function Er(e,t){return e._cfg.version-t._cfg.version}function Ar(e,t,n,r){const i=e._dbSchema,s=e._createTransaction("readwrite",e._storeNames,i);s.create(n),s._completion.catch(r);const o=s._reject.bind(s),a=Ct.transless||Ct;rn((()=>{Ct.trans=s,Ct.transless=a,0===t?(oe(i).forEach((e=>{Or(n,e,i[e].primKey,i[e].indexes)})),xr(e,n),Ft.follow((()=>e.on.populate.fire(s))).catch(o)):function({_novip:e},t,n,r){const i=[],s=e._versions;let o=e._dbSchema=Pr(e,e.idbdb,r),a=!1;function l(){return i.length?Ft.resolve(i.shift()(n.idbtrans)).then(l):Ft.resolve()}return s.filter((e=>e._cfg.version>=t)).forEach((s=>{i.push((()=>{const i=o,l=s._cfg.dbschema;Sr(e,i,r),Sr(e,l,r),o=e._dbSchema=l;const c=Nr(i,l);c.add.forEach((e=>{Or(r,e[0],e[1].primKey,e[1].indexes)})),c.change.forEach((e=>{if(e.recreate)throw new nt.Upgrade("Not yet support for changing primary key");{const t=r.objectStore(e.name);e.add.forEach((e=>$r(t,e))),e.change.forEach((e=>{t.deleteIndex(e.name),$r(t,e)})),e.del.forEach((e=>t.deleteIndex(e)))}}));const u=s._cfg.contentUpgrade;if(u&&s._cfg.version>t){xr(e,r),n._memoizedTables={},a=!0;let t=Ne(l);c.del.forEach((e=>{t[e]=i[e]})),kr(e,[e.Transaction.prototype]),_r(e,[e.Transaction.prototype],oe(t),t),n.schema=t;const s=Me(u);let o;s&&sn();const h=Ft.follow((()=>{if(o=u(n),o&&s){var e=on.bind(null,null);o.then(e,e)}}));return o&&"function"==typeof o.then?Ft.resolve(o):h.then((()=>o))}})),i.push((t=>{if(!a||!On){!function(e,t){[].slice.call(t.db.objectStoreNames).forEach((n=>null==e[n]&&t.db.deleteObjectStore(n)))}(s._cfg.dbschema,t)}kr(e,[e.Transaction.prototype]),_r(e,[e.Transaction.prototype],e._storeNames,e._dbSchema),n.schema=e._dbSchema}))})),l().then((()=>{var e,t;t=r,oe(e=o).forEach((n=>{t.db.objectStoreNames.contains(n)||Or(t,n,e[n].primKey,e[n].indexes)}))}))}(e,t,s,n).catch(o)}))}function Nr(e,t){const n={del:[],add:[],change:[]};let r;for(r in e)t[r]||n.del.push(r);for(r in t){const i=e[r],s=t[r];if(i){const e={name:r,def:s,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(s.primKey.keyPath||"")||i.primKey.auto!==s.primKey.auto&&!Nn)e.recreate=!0,n.change.push(e);else{const t=i.idxByName,r=s.idxByName;let o;for(o in t)r[o]||e.del.push(o);for(o in r){const n=t[o],i=r[o];n?n.src!==i.src&&e.change.push(i):e.add.push(i)}(e.del.length>0||e.add.length>0||e.change.length>0)&&n.change.push(e)}}else n.add.push([r,s])}return n}function Or(e,t,n,r){const i=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach((e=>$r(i,e))),i}function $r(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function Pr(e,t,n){const r={};return ve(t.objectStoreNames,0).forEach((e=>{const t=n.objectStore(e);let i=t.keyPath;const s=dr(fr(i),i||"",!1,!1,!!t.autoIncrement,i&&"string"!=typeof i,!0),o=[];for(let e=0;e<t.indexNames.length;++e){const n=t.index(t.indexNames[e]);i=n.keyPath;var a=dr(n.name,i,!!n.unique,!!n.multiEntry,!1,i&&"string"!=typeof i,!1);o.push(a)}r[e]=pr(e,s,o)})),r}function Sr({_novip:e},t,n){const r=n.db.objectStoreNames;for(let i=0;i<r.length;++i){const s=r[i],o=n.objectStore(s);e._hasGetAll="getAll"in o;for(let e=0;e<o.indexNames.length;++e){const n=o.indexNames[e],r=o.index(n).keyPath,i="string"==typeof r?r:"["+ve(r).join("+")+"]";if(t[s]){const e=t[s].idxByName[i];e&&(e.name=n,delete t[s].idxByName[i],t[s].idxByName[n]=e)}}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&se.WorkerGlobalScope&&se instanceof se.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}class Cr{_parseStoresSpec(e,t){oe(e).forEach((n=>{if(null!==e[n]){var r=e[n].split(",").map(((e,t)=>{const n=(e=e.trim()).replace(/([&*]|\+\+)/g,""),r=/^\[/.test(n)?n.match(/^\[(.*)\]$/)[1].split("+"):n;return dr(n,r||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),ae(r),0===t)})),i=r.shift();if(i.multi)throw new nt.Schema("Primary key cannot be multi-valued");r.forEach((e=>{if(e.auto)throw new nt.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new nt.Schema("Index must have a name and cannot be an empty string")})),t[n]=pr(n,i,r)}}))}stores(e){const t=this.db;this._cfg.storesSource=this._cfg.storesSource?le(this._cfg.storesSource,e):e;const n=t._versions,r={};let i={};return n.forEach((e=>{le(r,e._cfg.storesSource),i=e._cfg.dbschema={},e._parseStoresSpec(r,i)})),t._dbSchema=i,kr(t,[t._allTables,t,t.Transaction.prototype]),_r(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],oe(i),i),t._storeNames=oe(i),this}upgrade(e){return this._cfg.contentUpgrade=ft(this._cfg.contentUpgrade||st,e),this}}function Tr(e,t){let n=e._dbNamesDB;return n||(n=e._dbNamesDB=new ei(Sn,{addons:[],indexedDB:e,IDBKeyRange:t}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function Br(e){return e&&"function"==typeof e.databases}function jr(e){return rn((function(){return Ct.letThrough=!0,e()}))}function Fr(){var e;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise((function(t){var n=function(){return indexedDB.databases().finally(t)};e=setInterval(n,100),n()})).finally((function(){return clearInterval(e)})):Promise.resolve()}function Dr(e){const t=e._state,{indexedDB:n}=e._deps;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then((()=>t.dbOpenError?bn(t.dbOpenError):e));Le&&(t.openCanceller._stackHolder=Ue()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;const r=t.openCanceller;function i(){if(t.openCanceller!==r)throw new nt.DatabaseClosed("db.open() was cancelled")}let s=t.dbReadyResolve,o=null,a=!1;return Ft.race([r,("undefined"==typeof navigator?Ft.resolve():Fr()).then((()=>new Ft(((r,s)=>{if(i(),!n)throw new nt.MissingAPI;const l=e.name,c=t.autoSchema?n.open(l):n.open(l,Math.round(10*e.verno));if(!c)throw new nt.MissingAPI;c.onerror=or(s),c.onblocked=Gt(e._fireOnBlocked),c.onupgradeneeded=Gt((r=>{if(o=c.transaction,t.autoSchema&&!e._options.allowEmptyDB){c.onerror=ar,o.abort(),c.result.close();const e=n.deleteDatabase(l);e.onsuccess=e.onerror=Gt((()=>{s(new nt.NoSuchDatabase(`Database ${l} doesnt exist`))}))}else{o.onerror=or(s);var i=r.oldVersion>Math.pow(2,62)?0:r.oldVersion;a=i<1,e._novip.idbdb=c.result,Ar(e,i/10,o,s)}}),s),c.onsuccess=Gt((()=>{o=null;const n=e._novip.idbdb=c.result,i=ve(n.objectStoreNames);if(i.length>0)try{const r=n.transaction(1===(s=i).length?s[0]:s,"readonly");t.autoSchema?function({_novip:e},t,n){e.verno=t.version/10;const r=e._dbSchema=Pr(0,t,n);e._storeNames=ve(t.objectStoreNames,0),_r(e,[e._allTables],oe(r),r)}(e,n,r):(Sr(e,e._dbSchema,r),function(e,t){const n=Nr(Pr(0,e.idbdb,t),e._dbSchema);return!(n.add.length||n.change.some((e=>e.add.length||e.change.length)))}(e,r)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),xr(e,r)}catch(e){}var s;An.push(e),n.onversionchange=Gt((n=>{t.vcFired=!0,e.on("versionchange").fire(n)})),n.onclose=Gt((t=>{e.on("close").fire(t)})),a&&function({indexedDB:e,IDBKeyRange:t},n){!Br(e)&&n!==Sn&&Tr(e,t).put({name:n}).catch(st)}(e._deps,l),r()}),s)}))))]).then((()=>(i(),t.onReadyBeingFired=[],Ft.resolve(jr((()=>e.on.ready.fire(e.vip)))).then((function n(){if(t.onReadyBeingFired.length>0){let r=t.onReadyBeingFired.reduce(ft,st);return t.onReadyBeingFired=[],Ft.resolve(jr((()=>r(e.vip)))).then(n)}}))))).finally((()=>{t.onReadyBeingFired=null,t.isBeingOpened=!1})).then((()=>e)).catch((n=>{t.dbOpenError=n;try{o&&o.abort()}catch(e){}return r===t.openCanceller&&e._close(),bn(n)})).finally((()=>{t.openComplete=!0,s()}))}function Ir(e){var t=t=>e.next(t),n=i(t),r=i((t=>e.throw(t)));function i(e){return t=>{var i=e(t),s=i.value;return i.done?s:s&&"function"==typeof s.then?s.then(n,r):ae(s)?Promise.all(s).then(n,r):n(s)}}return i(t)()}function Kr(e,t,n){var r=arguments.length;if(r<2)throw new nt.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];n=i.pop();var s=$e(i);return[e,s,n]}function Rr(e,t,n,r,i){return Ft.resolve().then((()=>{const s=Ct.transless||Ct,o=e._createTransaction(t,n,e._dbSchema,r),a={trans:o,transless:s};if(r)o.idbtrans=r.idbtrans;else try{o.create(),e._state.PR1398_maxLoop=3}catch(r){return r.name===et.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then((()=>Rr(e,t,n,null,i)))):bn(r)}const l=Me(i);let c;l&&sn();const u=Ft.follow((()=>{if(c=i.call(o,o),c)if(l){var e=on.bind(null,null);c.then(e,e)}else"function"==typeof c.next&&"function"==typeof c.throw&&(c=Ir(c))}),a);return(c&&"function"==typeof c.then?Ft.resolve(c).then((e=>o.active?e:bn(new nt.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn")))):u.then((()=>c))).then((e=>(r&&o._resolve(),o._completion.then((()=>e))))).catch((e=>(o._reject(e),bn(e))))}))}function Mr(e,t,n){const r=ae(e)?e.slice():[e];for(let e=0;e<n;++e)r.push(t);return r}const Lr={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return{...e,table(t){const n=e.table(t),{schema:r}=n,i={},s=[];function o(e,t,n){const r=vr(e),a=i[r]=i[r]||[],l=null==e?0:"string"==typeof e?1:e.length,c=t>0,u={...n,isVirtual:c,keyTail:t,keyLength:l,extractKey:gr(e),unique:!c&&n.unique};if(a.push(u),u.isPrimaryKey||s.push(u),l>1){o(2===l?e[0]:e.slice(0,l-1),t+1,n)}return a.sort(((e,t)=>e.keyTail-t.keyTail)),u}const a=o(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[a];for(const e of r.indexes)o(e.keyPath,0,e);function l(t){const n=t.query.index;return n.isVirtual?{...t,query:{index:n,range:(r=t.query.range,i=n.keyTail,{type:1===r.type?2:r.type,lower:Mr(r.lower,r.lowerOpen?e.MAX_KEY:e.MIN_KEY,i),lowerOpen:!0,upper:Mr(r.upper,r.upperOpen?e.MIN_KEY:e.MAX_KEY,i),upperOpen:!0})}}:t;var r,i}const c={...n,schema:{...r,primaryKey:a,indexes:s,getIndexByKeyPath:function(e){const t=i[vr(e)];return t&&t[0]}},count:e=>n.count(l(e)),query:e=>n.query(l(e)),openCursor(t){const{keyTail:r,isVirtual:i,keyLength:s}=t.query.index;if(!i)return n.openCursor(t);return n.openCursor(l(t)).then((n=>n&&function(n){const i=Object.create(n,{continue:{value:function(i){null!=i?n.continue(Mr(i,t.reverse?e.MAX_KEY:e.MIN_KEY,r)):t.unique?n.continue(n.key.slice(0,s).concat(t.reverse?e.MIN_KEY:e.MAX_KEY,r)):n.continue()}},continuePrimaryKey:{value(t,i){n.continuePrimaryKey(Mr(t,e.MAX_KEY,r),i)}},primaryKey:{get:()=>n.primaryKey},key:{get(){const e=n.key;return 1===s?e[0]:e.slice(0,s)}},value:{get:()=>n.value}});return i}(n)))}};return c}}}};function zr(e,t,n,r){return n=n||{},r=r||"",oe(e).forEach((i=>{if(he(t,i)){var s=e[i],o=t[i];if("object"==typeof s&&"object"==typeof o&&s&&o){const e=Fe(s);e!==Fe(o)?n[r+i]=t[i]:"Object"===e?zr(s,o,n,r+i+"."):s!==o&&(n[r+i]=t[i])}else s!==o&&(n[r+i]=t[i])}else n[r+i]=void 0})),oe(t).forEach((i=>{he(e,i)||(n[r+i]=t[i])})),n}const qr={stack:"dbcore",name:"HooksMiddleware",level:2,create:e=>({...e,table(t){const n=e.table(t),{primaryKey:r}=n.schema,i={...n,mutate(e){const i=Ct.trans,{deleting:s,creating:o,updating:a}=i.table(t).hook;switch(e.type){case"add":if(o.fire===st)break;return i._promise("readwrite",(()=>l(e)),!0);case"put":if(o.fire===st&&a.fire===st)break;return i._promise("readwrite",(()=>l(e)),!0);case"delete":if(s.fire===st)break;return i._promise("readwrite",(()=>l(e)),!0);case"deleteRange":if(s.fire===st)break;return i._promise("readwrite",(()=>function(e){return c(e.trans,e.range,1e4)}(e)),!0)}return n.mutate(e);function l(e){const t=Ct.trans,i=e.keys||function(e,t){return"delete"===t.type?t.keys:t.keys||t.values.map(e.extractKey)}(r,e);if(!i)throw new Error("Keys missing");return"delete"!==(e="add"===e.type||"put"===e.type?{...e,keys:i}:{...e}).type&&(e.values=[...e.values]),e.keys&&(e.keys=[...e.keys]),function(e,t,n){return"add"===t.type?Promise.resolve([]):e.getMany({trans:t.trans,keys:n,cache:"immutable"})}(n,e,i).then((l=>{const c=i.map(((n,i)=>{const c=l[i],u={onerror:null,onsuccess:null};if("delete"===e.type)s.fire.call(u,n,c,t);else if("add"===e.type||void 0===c){const s=o.fire.call(u,n,e.values[i],t);null==n&&null!=s&&(n=s,e.keys[i]=n,r.outbound||Ae(e.values[i],r.keyPath,n))}else{const r=zr(c,e.values[i]),s=a.fire.call(u,r,n,c,t);if(s){const t=e.values[i];Object.keys(s).forEach((e=>{he(t,e)?t[e]=s[e]:Ae(t,e,s[e])}))}}return u}));return n.mutate(e).then((({failures:t,results:n,numFailures:r,lastResult:s})=>{for(let r=0;r<i.length;++r){const s=n?n[r]:i[r],o=c[r];null==s?o.onerror&&o.onerror(t[r]):o.onsuccess&&o.onsuccess("put"===e.type&&l[r]?e.values[r]:s)}return{failures:t,results:n,numFailures:r,lastResult:s}})).catch((e=>(c.forEach((t=>t.onerror&&t.onerror(e))),Promise.reject(e))))}))}function c(e,t,i){return n.query({trans:e,values:!1,query:{index:r,range:t},limit:i}).then((({result:n})=>l({type:"delete",keys:n,trans:e}).then((r=>r.numFailures>0?Promise.reject(r.failures[0]):n.length<i?{failures:[],numFailures:0,lastResult:void 0}:c(e,{...t,lower:n[n.length-1],lowerOpen:!0},i)))))}}};return i}})};function Vr(e,t,n){try{if(!t)return null;if(t.keys.length<e.length)return null;const r=[];for(let i=0,s=0;i<t.keys.length&&s<e.length;++i)0===Wn(t.keys[i],e[s])&&(r.push(n?Te(t.values[i]):t.values[i]),++s);return r.length===e.length?r:null}catch(e){return null}}const Ur={stack:"dbcore",level:-1,create:e=>({table:t=>{const n=e.table(t);return{...n,getMany:e=>{if(!e.cache)return n.getMany(e);const t=Vr(e.keys,e.trans._cache,"clone"===e.cache);return t?Ft.resolve(t):n.getMany(e).then((t=>(e.trans._cache={keys:e.keys,values:"clone"===e.cache?Te(t):t},t)))},mutate:e=>("add"!==e.type&&(e.trans._cache=null),n.mutate(e))}}})};function Wr(e){return!("from"in e)}const Xr=function(e,t){if(!this){const t=new Xr;return e&&"d"in e&&le(t,e),t}le(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0})};function Yr(e,t,n){const r=Wn(t,n);if(isNaN(r))return;if(r>0)throw RangeError();if(Wr(e))return le(e,{from:t,to:n,d:1});const i=e.l,s=e.r;if(Wn(n,e.from)<0)return i?Yr(i,t,n):e.l={from:t,to:n,d:1,l:null,r:null},Qr(e);if(Wn(t,e.to)>0)return s?Yr(s,t,n):e.r={from:t,to:n,d:1,l:null,r:null},Qr(e);Wn(t,e.from)<0&&(e.from=t,e.l=null,e.d=s?s.d+1:1),Wn(n,e.to)>0&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1);const o=!e.r;i&&!e.l&&Hr(e,i),s&&o&&Hr(e,s)}function Hr(e,t){Wr(t)||function e(t,{from:n,to:r,l:i,r:s}){Yr(t,n,r),i&&e(t,i),s&&e(t,s)}(e,t)}function Gr(e){let t=Wr(e)?null:{s:0,n:e};return{next(e){const n=arguments.length>0;for(;t;)switch(t.s){case 0:if(t.s=1,n)for(;t.n.l&&Wn(e,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!n||Wn(e,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function Qr(e){var t,n;const r=((null===(t=e.r)||void 0===t?void 0:t.d)||0)-((null===(n=e.l)||void 0===n?void 0:n.d)||0),i=r>1?"r":r<-1?"l":"";if(i){const t="r"===i?"l":"r",n={...e},r=e[i];e.from=r.from,e.to=r.to,e[i]=r[i],n[i]=r[t],e[t]=n,n.d=Jr(n)}e.d=Jr(e)}function Jr({r:e,l:t}){return(e?t?Math.max(e.d,t.d):e.d:t?t.d:0)+1}de(Xr.prototype,{add(e){return Hr(this,e),this},addKey(e){return Yr(this,e,e),this},addKeys(e){return e.forEach((e=>Yr(this,e,e))),this},[De](){return Gr(this)}});const Zr={stack:"dbcore",level:0,create:e=>{const t=e.schema.name,n=new Xr(e.MIN_KEY,e.MAX_KEY);return{...e,table:r=>{const i=e.table(r),{schema:s}=i,{primaryKey:o}=s,{extractKey:a,outbound:l}=o,c={...i,mutate:e=>{const o=e.trans,a=o.mutatedParts||(o.mutatedParts={}),l=e=>{const n=`idb://${t}/${r}/${e}`;return a[n]||(a[n]=new Xr)},c=l(""),u=l(":dels"),{type:h}=e;let[d,f]="deleteRange"===e.type?[e.range]:"delete"===e.type?[e.keys]:e.values.length<50?[[],e.values]:[];const p=e.trans._cache;return i.mutate(e).then((e=>{if(ae(d)){"delete"!==h&&(d=e.results),c.addKeys(d);const t=Vr(d,p);t||"add"===h||u.addKeys(d),(t||f)&&function(e,t,n,r){function i(t){const i=e(t.name||"");function s(e){return null!=e?t.extractKey(e):null}const o=e=>t.multiEntry&&ae(e)?e.forEach((e=>i.addKey(e))):i.addKey(e);(n||r).forEach(((e,t)=>{const i=n&&s(n[t]),a=r&&s(r[t]);0!==Wn(i,a)&&(null!=i&&o(i),null!=a&&o(a))}))}t.indexes.forEach(i)}(l,s,t,f)}else if(d){const e={from:d.lower,to:d.upper};u.add(e),c.add(e)}else c.add(n),u.add(n),s.indexes.forEach((e=>l(e.name).add(n)));return e}))}},u=({query:{index:t,range:n}})=>{var r,i;return[t,new Xr(null!==(r=n.lower)&&void 0!==r?r:e.MIN_KEY,null!==(i=n.upper)&&void 0!==i?i:e.MAX_KEY)]},h={get:e=>[o,new Xr(e.key)],getMany:e=>[o,(new Xr).addKeys(e.keys)],count:u,query:u,openCursor:u};return oe(h).forEach((e=>{c[e]=function(s){const{subscr:o}=Ct;if(o){const c=e=>{const n=`idb://${t}/${r}/${e}`;return o[n]||(o[n]=new Xr)},u=c(""),d=c(":dels"),[f,p]=h[e](s);if(c(f.name||"").add(p),!f.isPrimaryKey){if("count"!==e){const t="query"===e&&l&&s.values&&i.query({...s,values:!1});return i[e].apply(this,arguments).then((n=>{if("query"===e){if(l&&s.values)return t.then((({result:e})=>(u.addKeys(e),n)));const e=s.values?n.result.map(a):n.result;s.values?u.addKeys(e):d.addKeys(e)}else if("openCursor"===e){const e=n,t=s.values;return e&&Object.create(e,{key:{get:()=>(d.addKey(e.primaryKey),e.key)},primaryKey:{get(){const t=e.primaryKey;return d.addKey(t),t}},value:{get:()=>(t&&u.addKey(e.primaryKey),e.value)}})}return n}))}d.add(n)}}return i[e].apply(this,arguments)}})),c}}}};class ei{constructor(e,t){this._middlewares={},this.verno=0;const n=ei.dependencies;this._options=t={addons:ei.addons,autoOpen:!0,indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange,...t},this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange};const{addons:r}=t;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const i={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:st,dbReadyPromise:null,cancelOpen:st,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};i.dbReadyPromise=new Ft((e=>{i.dbReadyResolve=e})),i.openCanceller=new Ft(((e,t)=>{i.cancelOpen=t})),this._state=i,this.name=e,this.on=In(this,"populate","blocked","versionchange","close",{ready:[ft,st]}),this.on.ready.subscribe=we(this.on.ready.subscribe,(e=>(t,n)=>{ei.vip((()=>{const r=this._state;if(r.openComplete)r.dbOpenError||Ft.resolve().then(t),n&&e(t);else if(r.onReadyBeingFired)r.onReadyBeingFired.push(t),n&&e(t);else{e(t);const r=this;n||e((function e(){r.on.ready.unsubscribe(t),r.on.ready.unsubscribe(e)}))}}))})),this.Collection=function(e){return Kn(Hn.prototype,(function(t,n){this.db=e;let r=jn,i=null;if(n)try{r=n()}catch(e){i=e}const s=t._ctx,o=s.table,a=o.hook.reading.fire;this._ctx={table:o,index:s.index,isPrimKey:!s.index||o.schema.primKey.keyPath&&s.index===o.schema.primKey.name,range:r,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:i,or:s.or,valueMapper:a!==ot?a:null}}))}(this),this.Table=function(e){return Kn(Dn.prototype,(function(t,n,r){this.db=e,this._tx=r,this.name=t,this.schema=n,this.hook=e._allTables[t]?e._allTables[t].hook:In(null,{creating:[ct,st],reading:[at,ot],updating:[ht,st],deleting:[ut,st]})}))}(this),this.Transaction=function(e){return Kn(hr.prototype,(function(t,n,r,i,s){this.db=e,this.mode=t,this.storeNames=n,this.schema=r,this.chromeTransactionDurability=i,this.idbtrans=null,this.on=In(this,"complete","error","abort"),this.parent=s||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Ft(((e,t)=>{this._resolve=e,this._reject=t})),this._completion.then((()=>{this.active=!1,this.on.complete.fire()}),(e=>{var t=this.active;return this.active=!1,this.on.error.fire(e),this.parent?this.parent._reject(e):t&&this.idbtrans&&this.idbtrans.abort(),bn(e)}))}))}(this),this.Version=function(e){return Kn(Cr.prototype,(function(t){this.db=e,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}}))}(this),this.WhereClause=function(e){return Kn(sr.prototype,(function(t,n,r){this.db=e,this._ctx={table:t,index:":id"===n?null:n,or:r};const i=e._deps.indexedDB;if(!i)throw new nt.MissingAPI;this._cmp=this._ascending=i.cmp.bind(i),this._descending=(e,t)=>i.cmp(t,e),this._max=(e,t)=>i.cmp(e,t)>0?e:t,this._min=(e,t)=>i.cmp(e,t)<0?e:t,this._IDBKeyRange=e._deps.IDBKeyRange}))}(this),this.on("versionchange",(e=>{e.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()})),this.on("blocked",(e=>{!e.newVersion||e.newVersion<e.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${e.oldVersion/10}`)})),this._maxKey=mr(t.IDBKeyRange),this._createTransaction=(e,t,n,r)=>new this.Transaction(e,t,n,this._options.chromeTransactionDurability,r),this._fireOnBlocked=e=>{this.on("blocked").fire(e),An.filter((e=>e.name===this.name&&e!==this&&!e._state.vcFired)).map((t=>t.on("versionchange").fire(e)))},this.use(Lr),this.use(qr),this.use(Zr),this.use(Ur),this.vip=Object.create(this,{_vip:{value:!0}}),r.forEach((e=>e(this)))}version(e){if(isNaN(e)||e<.1)throw new nt.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new nt.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);const t=this._versions;var n=t.filter((t=>t._cfg.version===e))[0];return n||(n=new this.Version(e),t.push(n),t.sort(Er),n.stores({}),this._state.autoSchema=!1,n)}_whenReady(e){return this.idbdb&&(this._state.openComplete||Ct.letThrough||this._vip)?e():new Ft(((e,t)=>{if(this._state.openComplete)return t(new nt.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void t(new nt.DatabaseClosed);this.open().catch(st)}this._state.dbReadyPromise.then(e,t)})).then(e)}use({stack:e,create:t,level:n,name:r}){r&&this.unuse({stack:e,name:r});const i=this._middlewares[e]||(this._middlewares[e]=[]);return i.push({stack:e,create:t,level:null==n?10:n,name:r}),i.sort(((e,t)=>e.level-t.level)),this}unuse({stack:e,name:t,create:n}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter((e=>n?e.create!==n:!!t&&e.name!==t))),this}open(){return Dr(this)}_close(){const e=this._state,t=An.indexOf(this);if(t>=0&&An.splice(t,1),this.idbdb){try{this.idbdb.close()}catch(e){}this._novip.idbdb=null}e.dbReadyPromise=new Ft((t=>{e.dbReadyResolve=t})),e.openCanceller=new Ft(((t,n)=>{e.cancelOpen=n}))}close(){this._close();const e=this._state;this._options.autoOpen=!1,e.dbOpenError=new nt.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){const e=arguments.length>0,t=this._state;return new Ft(((n,r)=>{const i=()=>{this.close();var e=this._deps.indexedDB.deleteDatabase(this.name);e.onsuccess=Gt((()=>{!function({indexedDB:e,IDBKeyRange:t},n){!Br(e)&&n!==Sn&&Tr(e,t).delete(n).catch(st)}(this._deps,this.name),n()})),e.onerror=or(r),e.onblocked=this._fireOnBlocked};if(e)throw new nt.InvalidArgument("Arguments not allowed in db.delete()");t.isBeingOpened?t.dbReadyPromise.then(i):i()}))}backendDB(){return this.idbdb}isOpen(){return null!==this.idbdb}hasBeenClosed(){const e=this._state.dbOpenError;return e&&"DatabaseClosed"===e.name}hasFailed(){return null!==this._state.dbOpenError}dynamicallyOpened(){return this._state.autoSchema}get tables(){return oe(this._allTables).map((e=>this._allTables[e]))}transaction(){const e=Kr.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,t,n){let r=Ct.trans;r&&r.db===this&&-1===e.indexOf("!")||(r=null);const i=-1!==e.indexOf("?");let s,o;e=e.replace("!","").replace("?","");try{if(o=t.map((e=>{var t=e instanceof this.Table?e.name:e;if("string"!=typeof t)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return t})),"r"==e||e===Cn)s=Cn;else{if("rw"!=e&&e!=Tn)throw new nt.InvalidArgument("Invalid transaction mode: "+e);s=Tn}if(r){if(r.mode===Cn&&s===Tn){if(!i)throw new nt.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");r=null}r&&o.forEach((e=>{if(r&&-1===r.storeNames.indexOf(e)){if(!i)throw new nt.SubTransaction("Table "+e+" not included in parent transaction.");r=null}})),i&&r&&!r.active&&(r=null)}}catch(e){return r?r._promise(null,((t,n)=>{n(e)})):bn(e)}const a=Rr.bind(null,this,s,o,r,n);return r?r._promise(s,a,"lock"):Ct.trans?dn(Ct.transless,(()=>this._whenReady(a))):this._whenReady(a)}table(e){if(!he(this._allTables,e))throw new nt.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}}const ti="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable";class ni{constructor(e){this._subscribe=e}subscribe(e,t,n){return this._subscribe(e&&"function"!=typeof e?e:{next:e,error:t,complete:n})}[ti](){return this}}function ri(e,t){return oe(t).forEach((n=>{Hr(e[n]||(e[n]=new Xr),t[n])})),e}function ii(e){return new ni((t=>{const n=Me(e);let r=!1,i={},s={};const o={get closed(){return r},unsubscribe:()=>{r=!0,ur.storagemutated.unsubscribe(u)}};t.start&&t.start(o);let a=!1,l=!1;function c(){return oe(s).some((e=>i[e]&&function(e,t){const n=Gr(t);let r=n.next();if(r.done)return!1;let i=r.value;const s=Gr(e);let o=s.next(i.from),a=o.value;for(;!r.done&&!o.done;){if(Wn(a.from,i.to)<=0&&Wn(a.to,i.from)>=0)return!0;Wn(i.from,a.from)<0?i=(r=n.next(a.from)).value:a=(o=s.next(i.from)).value}return!1}(i[e],s[e])))}const u=e=>{ri(i,e),c()&&h()},h=()=>{if(a||r)return;i={};const d={},f=function(t){n&&sn();const r=()=>rn(e,{subscr:t,trans:null}),i=Ct.trans?dn(Ct.transless,r):r();return n&&i.then(on,on),i}(d);l||(ur(lr,u),l=!0),a=!0,Promise.resolve(f).then((e=>{a=!1,r||(c()?h():(i={},s=d,t.next&&t.next(e)))}),(e=>{a=!1,t.error&&t.error(e),o.unsubscribe()}))};return h(),o}))}let si;try{si={indexedDB:se.indexedDB||se.mozIndexedDB||se.webkitIndexedDB||se.msIndexedDB,IDBKeyRange:se.IDBKeyRange||se.webkitIDBKeyRange}}catch(e){si={indexedDB:null,IDBKeyRange:null}}const oi=ei;function ai(e){let t=li;try{li=!0,ur.storagemutated.fire(e)}finally{li=t}}de(oi,{...it,delete:e=>new oi(e,{addons:[]}).delete(),exists:e=>new oi(e,{addons:[]}).open().then((e=>(e.close(),!0))).catch("NoSuchDatabaseError",(()=>!1)),getDatabaseNames(e){try{return function({indexedDB:e,IDBKeyRange:t}){return Br(e)?Promise.resolve(e.databases()).then((e=>e.map((e=>e.name)).filter((e=>e!==Sn)))):Tr(e,t).toCollection().primaryKeys()}(oi.dependencies).then(e)}catch(e){return bn(new nt.MissingAPI)}},defineClass:()=>function(e){le(this,e)},ignoreTransaction:e=>Ct.trans?dn(Ct.transless,e):e(),vip:jr,async:function(e){return function(){try{var t=Ir(e.apply(this,arguments));return t&&"function"==typeof t.then?t:Ft.resolve(t)}catch(e){return bn(e)}}},spawn:function(e,t,n){try{var r=Ir(e.apply(n,t||[]));return r&&"function"==typeof r.then?r:Ft.resolve(r)}catch(e){return bn(e)}},currentTransaction:{get:()=>Ct.trans||null},waitFor:function(e,t){const n=Ft.resolve("function"==typeof e?oi.ignoreTransaction(e):e).timeout(t||6e4);return Ct.trans?Ct.trans.waitFor(n):n},Promise:Ft,debug:{get:()=>Le,set:e=>{ze(e,"dexie"===e?()=>!0:Pn)}},derive:me,extend:le,props:de,override:we,Events:In,on:ur,liveQuery:ii,extendObservabilitySet:ri,getByKeyPath:Ee,setByKeyPath:Ae,delByKeyPath:function(e,t){"string"==typeof t?Ae(e,t,void 0):"length"in t&&[].map.call(t,(function(t){Ae(e,t,void 0)}))},shallowClone:Ne,deepClone:Te,getObjectDiff:zr,cmp:Wn,asap:_e,minKey:_n,addons:[],connections:An,errnames:et,dependencies:si,semVer:wn,version:wn.split(".").map((e=>parseInt(e))).reduce(((e,t,n)=>e+t/Math.pow(10,2*n)))}),oi.maxKey=mr(oi.dependencies.IDBKeyRange),"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(ur(lr,(e=>{if(!li){let t;Nn?(t=document.createEvent("CustomEvent"),t.initCustomEvent(cr,!0,!0,e)):t=new CustomEvent(cr,{detail:e}),li=!0,dispatchEvent(t),li=!1}})),addEventListener(cr,(({detail:e})=>{li||ai(e)})));let li=!1;if("undefined"!=typeof BroadcastChannel){const e=new BroadcastChannel(cr);ur(lr,(t=>{li||e.postMessage(t)})),e.onmessage=e=>{e.data&&ai(e.data)}}else if("undefined"!=typeof self&&"undefined"!=typeof navigator){ur(lr,(e=>{try{li||("undefined"!=typeof localStorage&&localStorage.setItem(cr,JSON.stringify({trig:Math.random(),changedParts:e})),"object"==typeof self.clients&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach((t=>t.postMessage({type:cr,changedParts:e}))))}catch(e){}})),"undefined"!=typeof addEventListener&&addEventListener("storage",(e=>{if(e.key===cr){const t=JSON.parse(e.newValue);t&&ai(t.changedParts)}}));const e=self.document&&navigator.serviceWorker;e&&e.addEventListener("message",(function({data:e}){e&&e.type===cr&&ai(e.changedParts)}))}Ft.rejectionMapper=function(e,t){if(!e||e instanceof Ge||e instanceof TypeError||e instanceof SyntaxError||!e.name||!rt[e.name])return e;var n=new rt[e.name](t||e.message,e);return"stack"in e&&pe(n,"stack",{get:function(){return this.inner.stack}}),n},ze(Le,Pn);const ci=new class extends ei{constructor(){super("bookDB"),this.version(2).stores({books:"++id, meta, contents, files"})}};var ui={},hi={};!function(e){const t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",n="["+t+"][:A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*",r=new RegExp("^"+n+"$");e.isExist=function(e){return void 0!==e},e.isEmptyObject=function(e){return 0===Object.keys(e).length},e.merge=function(e,t,n){if(t){const r=Object.keys(t),i=r.length;for(let s=0;s<i;s++)e[r[s]]="strict"===n?[t[r[s]]]:t[r[s]]}},e.getValue=function(t){return e.isExist(t)?t:""},e.isName=function(e){const t=r.exec(e);return!(null==t)},e.getAllMatches=function(e,t){const n=[];let r=t.exec(e);for(;r;){const i=[];i.startIndex=t.lastIndex-r[0].length;const s=r.length;for(let e=0;e<s;e++)i.push(r[e]);n.push(i),r=t.exec(e)}return n},e.nameRegexp=n}(hi);const di=hi,fi={allowBooleanAttributes:!1,unpairedTags:[]};function pi(e){return" "===e||"\t"===e||"\n"===e||"\r"===e}function mi(e,t){const n=t;for(;t<e.length;t++)if("?"!=e[t]&&" "!=e[t]);else{const r=e.substr(n,t-n);if(t>5&&"xml"===r)return xi("InvalidXml","XML declaration allowed only at the start of the document.",ki(e,t));if("?"==e[t]&&">"==e[t+1]){t++;break}}return t}function gi(e,t){if(e.length>t+5&&"-"===e[t+1]&&"-"===e[t+2]){for(t+=3;t<e.length;t++)if("-"===e[t]&&"-"===e[t+1]&&">"===e[t+2]){t+=2;break}}else if(e.length>t+8&&"D"===e[t+1]&&"O"===e[t+2]&&"C"===e[t+3]&&"T"===e[t+4]&&"Y"===e[t+5]&&"P"===e[t+6]&&"E"===e[t+7]){let n=1;for(t+=8;t<e.length;t++)if("<"===e[t])n++;else if(">"===e[t]&&(n--,0===n))break}else if(e.length>t+9&&"["===e[t+1]&&"C"===e[t+2]&&"D"===e[t+3]&&"A"===e[t+4]&&"T"===e[t+5]&&"A"===e[t+6]&&"["===e[t+7])for(t+=8;t<e.length;t++)if("]"===e[t]&&"]"===e[t+1]&&">"===e[t+2]){t+=2;break}return t}ui.validate=function(e,t){t=Object.assign({},fi,t);const n=[];let r=!1,i=!1;"\ufeff"===e[0]&&(e=e.substr(1));for(let o=0;o<e.length;o++)if("<"===e[o]&&"?"===e[o+1]){if(o+=2,o=mi(e,o),o.err)return o}else{if("<"!==e[o]){if(pi(e[o]))continue;return xi("InvalidChar","char '"+e[o]+"' is not expected.",ki(e,o))}{let a=o;if(o++,"!"===e[o]){o=gi(e,o);continue}{let l=!1;"/"===e[o]&&(l=!0,o++);let c="";for(;o<e.length&&">"!==e[o]&&" "!==e[o]&&"\t"!==e[o]&&"\n"!==e[o]&&"\r"!==e[o];o++)c+=e[o];if(c=c.trim(),"/"===c[c.length-1]&&(c=c.substring(0,c.length-1),o--),s=c,!di.isName(s)){let t;return t=0===c.trim().length?"Invalid space after '<'.":"Tag '"+c+"' is an invalid name.",xi("InvalidTag",t,ki(e,o))}const u=yi(e,o);if(!1===u)return xi("InvalidAttr","Attributes for '"+c+"' have open quote.",ki(e,o));let h=u.value;if(o=u.index,"/"===h[h.length-1]){const n=o-h.length;h=h.substring(0,h.length-1);const i=vi(h,t);if(!0!==i)return xi(i.err.code,i.err.msg,ki(e,n+i.err.line));r=!0}else if(l){if(!u.tagClosed)return xi("InvalidTag","Closing tag '"+c+"' doesn't have proper closing.",ki(e,o));if(h.trim().length>0)return xi("InvalidTag","Closing tag '"+c+"' can't have attributes or invalid starting.",ki(e,a));{const t=n.pop();if(c!==t.tagName){let n=ki(e,t.tagStartPos);return xi("InvalidTag","Expected closing tag '"+t.tagName+"' (opened in line "+n.line+", col "+n.col+") instead of closing tag '"+c+"'.",ki(e,a))}0==n.length&&(i=!0)}}else{const s=vi(h,t);if(!0!==s)return xi(s.err.code,s.err.msg,ki(e,o-h.length+s.err.line));if(!0===i)return xi("InvalidXml","Multiple possible root nodes found.",ki(e,o));-1!==t.unpairedTags.indexOf(c)||n.push({tagName:c,tagStartPos:a}),r=!0}for(o++;o<e.length;o++)if("<"===e[o]){if("!"===e[o+1]){o++,o=gi(e,o);continue}if("?"!==e[o+1])break;if(o=mi(e,++o),o.err)return o}else if("&"===e[o]){const t=wi(e,o);if(-1==t)return xi("InvalidChar","char '&' is not expected.",ki(e,o));o=t}else if(!0===i&&!pi(e[o]))return xi("InvalidXml","Extra text at the end",ki(e,o));"<"===e[o]&&o--}}}var s;return r?1==n.length?xi("InvalidTag","Unclosed tag '"+n[0].tagName+"'.",ki(e,n[0].tagStartPos)):!(n.length>0)||xi("InvalidXml","Invalid '"+JSON.stringify(n.map((e=>e.tagName)),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):xi("InvalidXml","Start tag expected.",1)};function yi(e,t){let n="",r="",i=!1;for(;t<e.length;t++){if('"'===e[t]||"'"===e[t])""===r?r=e[t]:r!==e[t]||(r="");else if(">"===e[t]&&""===r){i=!0;break}n+=e[t]}return""===r&&{value:n,index:t,tagClosed:i}}const bi=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function vi(e,t){const n=di.getAllMatches(e,bi),r={};for(let e=0;e<n.length;e++){if(0===n[e][1].length)return xi("InvalidAttr","Attribute '"+n[e][2]+"' has no space in starting.",Ei(n[e]));if(void 0!==n[e][3]&&void 0===n[e][4])return xi("InvalidAttr","Attribute '"+n[e][2]+"' is without value.",Ei(n[e]));if(void 0===n[e][3]&&!t.allowBooleanAttributes)return xi("InvalidAttr","boolean attribute '"+n[e][2]+"' is not allowed.",Ei(n[e]));const i=n[e][2];if(!_i(i))return xi("InvalidAttr","Attribute '"+i+"' is an invalid name.",Ei(n[e]));if(r.hasOwnProperty(i))return xi("InvalidAttr","Attribute '"+i+"' is repeated.",Ei(n[e]));r[i]=1}return!0}function wi(e,t){if(";"===e[++t])return-1;if("#"===e[t])return function(e,t){let n=/\d/;for("x"===e[t]&&(t++,n=/[\da-fA-F]/);t<e.length;t++){if(";"===e[t])return t;if(!e[t].match(n))break}return-1}(e,++t);let n=0;for(;t<e.length;t++,n++)if(!(e[t].match(/\w/)&&n<20)){if(";"===e[t])break;return-1}return t}function xi(e,t,n){return{err:{code:e,msg:t,line:n.line||n,col:n.col}}}function _i(e){return di.isName(e)}function ki(e,t){const n=e.substring(0,t).split(/\r?\n/);return{line:n.length,col:n[n.length-1].length+1}}function Ei(e){return e.startIndex+e[1].length}var Ai={};const Ni={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0},tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1};Ai.buildOptions=function(e){return Object.assign({},Ni,e)},Ai.defaultOptions=Ni;var Oi=class{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){this.child.push({[e]:t})}addChild(e){e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}};const $i=RegExp("^\\s([a-zA-z0-0]+)[ \t](['\"])([^&]+)\\2");function Pi(e,t){const n=$i.exec(e);n&&(t[n[1]]={regx:RegExp(`&${n[1]};`,"g"),val:n[3]})}var Si=function(e,t){const n={};if("O"!==e[t+3]||"C"!==e[t+4]||"T"!==e[t+5]||"Y"!==e[t+6]||"P"!==e[t+7]||"E"!==e[t+8])throw new Error("Invalid Tag instead of DOCTYPE");{t+=9;let r=1,i=!1,s=!1,o=!1,a="";for(;t<e.length;t++)if("<"===e[t]){if(i&&"!"===e[t+1]&&"E"===e[t+2]&&"N"===e[t+3]&&"T"===e[t+4]&&"I"===e[t+5]&&"T"===e[t+6]&&"Y"===e[t+7])t+=7,s=!0;else if(i&&"!"===e[t+1]&&"E"===e[t+2]&&"L"===e[t+3]&&"E"===e[t+4]&&"M"===e[t+5]&&"E"===e[t+6]&&"N"===e[t+7]&&"T"===e[t+8])t+=8;else{if("!"!==e[t+1]||"-"!==e[t+2]||"-"!==e[t+3])throw new Error("Invalid DOCTYPE");o=!0}r++,a=""}else if(">"===e[t]){if(o){if("-"!==e[t-1]||"-"!==e[t-2])throw new Error("Invalid XML comment in DOCTYPE");o=!1}else s&&(Pi(a,n),s=!1);if(r--,0===r)break}else"["===e[t]?i=!0:a+=e[t];if(0!==r)throw new Error("Unclosed DOCTYPE")}return{entities:n,i:t}};const Ci=/^[-+]?0x[a-fA-F0-9]+$/,Ti=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const Bi={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};const ji=hi,Fi=Oi,Di=Si,Ii=function(e,t={}){if(t=Object.assign({},Bi,t),!e||"string"!=typeof e)return e;let n=e.trim();if(void 0!==t.skipLike&&t.skipLike.test(n))return e;if(t.hex&&Ci.test(n))return Number.parseInt(n,16);{const r=Ti.exec(n);if(r){const i=r[1],s=r[2];let o=function(e){if(e&&-1!==e.indexOf("."))return"."===(e=e.replace(/0+$/,""))?e="0":"."===e[0]?e="0"+e:"."===e[e.length-1]&&(e=e.substr(0,e.length-1)),e;return e}(r[3]);const a=r[4]||r[6];if(!t.leadingZeros&&s.length>0&&i&&"."!==n[2])return e;if(!t.leadingZeros&&s.length>0&&!i&&"."!==n[1])return e;{const r=Number(n),l=""+r;return-1!==l.search(/[eE]/)||a?t.eNotation?r:e:-1!==n.indexOf(".")?"0"===l&&""===o||l===o||i&&l==="-"+o?r:e:s?o===l||i+o===l?r:e:n===l||n===i+l?r:e}}return e}};"<((!\\[CDATA\\[([\\s\\S]*?)(]]>))|((NAME:)?(NAME))([^>]*)>|((\\/)(NAME)\\s*>))([^<]*)".replace(/NAME/g,ji.nameRegexp);function Ki(e){const t=Object.keys(e);for(let n=0;n<t.length;n++){const r=t[n];this.lastEntities[r]={regex:new RegExp("&"+r+";","g"),val:e[r]}}}function Ri(e,t,n,r,i,s,o){if(void 0!==e&&(this.options.trimValues&&!r&&(e=e.trim()),e.length>0)){o||(e=this.replaceEntitiesValue(e));const r=this.options.tagValueProcessor(t,e,n,i,s);if(null==r)return e;if(typeof r!=typeof e||r!==e)return r;if(this.options.trimValues)return Gi(e,this.options.parseTagValue,this.options.numberParseOptions);return e.trim()===e?Gi(e,this.options.parseTagValue,this.options.numberParseOptions):e}}function Mi(e){if(this.options.removeNSPrefix){const t=e.split(":"),n="/"===e.charAt(0)?"/":"";if("xmlns"===t[0])return"";2===t.length&&(e=n+t[1])}return e}const Li=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function zi(e,t){if(!this.options.ignoreAttributes&&"string"==typeof e){const n=ji.getAllMatches(e,Li),r=n.length,i={};for(let e=0;e<r;e++){const r=this.resolveNameSpace(n[e][1]);let s=n[e][4];const o=this.options.attributeNamePrefix+r;if(r.length)if(void 0!==s){this.options.trimValues&&(s=s.trim()),s=this.replaceEntitiesValue(s);const e=this.options.attributeValueProcessor(r,s,t);i[o]=null==e?s:typeof e!=typeof s||e!==s?e:Gi(s,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(i[o]=!0)}if(!Object.keys(i).length)return;if(this.options.attributesGroupName){const e={};return e[this.options.attributesGroupName]=i,e}return i}}const qi=function(e){e=e.replace(/\r\n?/g,"\n");const t=new Fi("!xml");let n=t,r="",i="";for(let s=0;s<e.length;s++){if("<"===e[s])if("/"===e[s+1]){const t=Xi(e,">",s,"Closing Tag is not closed.");let o=e.substring(s+2,t).trim();if(this.options.removeNSPrefix){const e=o.indexOf(":");-1!==e&&(o=o.substr(e+1))}n&&(r=this.saveTextToParentTag(r,n,i)),i=i.substr(0,i.lastIndexOf(".")),n=this.tagsNodeStack.pop(),r="",s=t}else if("?"===e[s+1]){let t=Yi(e,s,!1,"?>");if(!t)throw new Error("Pi Tag is not closed.");if(r=this.saveTextToParentTag(r,n,i),this.options.ignoreDeclaration&&"?xml"===t.tagName||this.options.ignorePiTags);else{const e=new Fi(t.tagName);e.add(this.options.textNodeName,""),t.tagName!==t.tagExp&&t.attrExpPresent&&(e[":@"]=this.buildAttributesMap(t.tagExp,i)),n.addChild(e)}s=t.closeIndex+1}else if("!--"===e.substr(s+1,3)){const t=Xi(e,"--\x3e",s+4,"Comment is not closed.");if(this.options.commentPropName){const o=e.substring(s+4,t-2);r=this.saveTextToParentTag(r,n,i),n.add(this.options.commentPropName,[{[this.options.textNodeName]:o}])}s=t}else if("!D"===e.substr(s+1,2)){const t=Di(e,s);this.docTypeEntities=t.entities,s=t.i}else if("!["===e.substr(s+1,2)){const t=Xi(e,"]]>",s,"CDATA is not closed.")-2,o=e.substring(s+9,t);if(r=this.saveTextToParentTag(r,n,i),this.options.cdataPropName)n.add(this.options.cdataPropName,[{[this.options.textNodeName]:o}]);else{let e=this.parseTextData(o,n.tagname,i,!0,!1,!0);null==e&&(e=""),n.add(this.options.textNodeName,e)}s=t+2}else{let o=Yi(e,s,this.options.removeNSPrefix),a=o.tagName,l=o.tagExp,c=o.attrExpPresent,u=o.closeIndex;n&&r&&"!xml"!==n.tagname&&(r=this.saveTextToParentTag(r,n,i,!1)),a!==t.tagname&&(i+=i?"."+a:a);const h=n;if(h&&-1!==this.options.unpairedTags.indexOf(h.tagname)&&(n=this.tagsNodeStack.pop()),this.isItStopNode(this.options.stopNodes,i,a)){let t="";if(l.length>0&&l.lastIndexOf("/")===l.length-1)s=o.closeIndex;else if(-1!==this.options.unpairedTags.indexOf(a))s=o.closeIndex;else{const n=this.readStopNodeData(e,a,u+1);if(!n)throw new Error(`Unexpected end of ${a}`);s=n.i,t=n.tagContent}const r=new Fi(a);a!==l&&c&&(r[":@"]=this.buildAttributesMap(l,i)),t&&(t=this.parseTextData(t,a,i,!0,c,!0,!0)),i=i.substr(0,i.lastIndexOf(".")),r.add(this.options.textNodeName,t),n.addChild(r)}else{if(l.length>0&&l.lastIndexOf("/")===l.length-1){"/"===a[a.length-1]?(a=a.substr(0,a.length-1),l=a):l=l.substr(0,l.length-1);const e=new Fi(a);a!==l&&c&&(e[":@"]=this.buildAttributesMap(l,i)),i=i.substr(0,i.lastIndexOf(".")),n.addChild(e)}else{const e=new Fi(a);this.tagsNodeStack.push(n),a!==l&&c&&(e[":@"]=this.buildAttributesMap(l,i)),n.addChild(e),n=e}r="",s=u}}else r+=e[s]}return t.child},Vi=function(e){if(this.options.processEntities){for(let t in this.docTypeEntities){const n=this.docTypeEntities[t];e=e.replace(n.regx,n.val)}for(let t in this.lastEntities){const n=this.lastEntities[t];e=e.replace(n.regex,n.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const n=this.htmlEntities[t];e=e.replace(n.regex,n.val)}}return e};function Ui(e,t,n,r){return e&&(void 0===r&&(r=0===Object.keys(t.child).length),void 0!==(e=this.parseTextData(e,t.tagname,n,!1,!!t[":@"]&&0!==Object.keys(t[":@"]).length,r))&&""!==e&&t.add(this.options.textNodeName,e),e=""),e}function Wi(e,t,n){const r="*."+n;for(const n in e){const i=e[n];if(r===i||t===i)return!0}return!1}function Xi(e,t,n,r){const i=e.indexOf(t,n);if(-1===i)throw new Error(r);return i+t.length-1}function Yi(e,t,n,r=">"){const i=function(e,t,n=">"){let r,i="";for(let s=t;s<e.length;s++){let t=e[s];if(r)t===r&&(r="");else if('"'===t||"'"===t)r=t;else if(t===n[0]){if(!n[1])return{data:i,index:s};if(e[s+1]===n[1])return{data:i,index:s}}else"\t"===t&&(t=" ");i+=t}}(e,t+1,r);if(!i)return;let s=i.data;const o=i.index,a=s.search(/\s/);let l=s,c=!0;if(-1!==a&&(l=s.substr(0,a).replace(/\s\s*$/,""),s=s.substr(a+1)),n){const e=l.indexOf(":");-1!==e&&(l=l.substr(e+1),c=l!==i.data.substr(e+1))}return{tagName:l,tagExp:s,closeIndex:o,attrExpPresent:c}}function Hi(e,t,n){const r=n;let i=1;for(;n<e.length;n++)if("<"===e[n])if("/"===e[n+1]){const s=Xi(e,">",n,`${t} is not closed`);if(e.substring(n+2,s).trim()===t&&(i--,0===i))return{tagContent:e.substring(r,n),i:s};n=s}else{const r=Yi(e,n,">");if(r){(r&&r.tagName)===t&&i++,n=r.closeIndex}}}function Gi(e,t,n){if(t&&"string"==typeof e){const t=e.trim();return"true"===t||"false"!==t&&Ii(e,n)}return ji.isExist(e)?e:""}var Qi=class{constructor(e){this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={amp:{regex:/&(amp|#38|#x26);/g,val:"&"},apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"}},this.addExternalEntities=Ki,this.parseXml=qi,this.parseTextData=Ri,this.resolveNameSpace=Mi,this.buildAttributesMap=zi,this.isItStopNode=Wi,this.replaceEntitiesValue=Vi,this.readStopNodeData=Hi,this.saveTextToParentTag=Ui}},Ji={};function Zi(e,t,n){let r;const i={};for(let s=0;s<e.length;s++){const o=e[s],a=es(o);let l="";if(l=void 0===n?a:n+"."+a,a===t.textNodeName)void 0===r?r=o[a]:r+=""+o[a];else{if(void 0===a)continue;if(o[a]){let e=Zi(o[a],t,l);const n=ns(e,t);o[":@"]?ts(e,o[":@"],l,t):1!==Object.keys(e).length||void 0===e[t.textNodeName]||t.alwaysCreateTextNode?0===Object.keys(e).length&&(t.alwaysCreateTextNode?e[t.textNodeName]="":e=""):e=e[t.textNodeName],void 0!==i[a]&&i.hasOwnProperty(a)?(Array.isArray(i[a])||(i[a]=[i[a]]),i[a].push(e)):t.isArray(a,l,n)?i[a]=[e]:i[a]=e}}}return"string"==typeof r?r.length>0&&(i[t.textNodeName]=r):void 0!==r&&(i[t.textNodeName]=r),i}function es(e){const t=Object.keys(e);for(let e=0;e<t.length;e++){const n=t[e];if(":@"!==n)return n}}function ts(e,t,n,r){if(t){const i=Object.keys(t),s=i.length;for(let o=0;o<s;o++){const s=i[o];r.isArray(s,n+"."+s,!0,!0)?e[s]=[t[s]]:e[s]=t[s]}}}function ns(e,t){const n=Object.keys(e).length;return!!(0===n||1===n&&e[t.textNodeName])}Ji.prettify=function(e,t){return Zi(e,t)};const{buildOptions:rs}=Ai,is=Qi,{prettify:ss}=Ji,os=ui;var as=class{constructor(e){this.externalEntities={},this.options=rs(e)}parse(e,t){if("string"==typeof e);else{if(!e.toString)throw new Error("XML data is accepted in String or Bytes[] form.");e=e.toString()}if(t){!0===t&&(t={});const n=os.validate(e,t);if(!0!==n)throw Error(`${n.err.msg}:${n.err.line}:${n.err.col}`)}const n=new is(this.options);n.addExternalEntities(this.externalEntities);const r=n.parseXml(e);return this.options.preserveOrder||void 0===r?r:ss(r,this.options)}addEntity(e,t){if(-1!==t.indexOf("&"))throw new Error("Entity value can't have '&'");if(-1!==e.indexOf("&")||-1!==e.indexOf(";"))throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");this.externalEntities[e]=t}};function ls(e,t,n,r){let i="",s="";t.format&&t.indentBy.length>0&&(s="\n"+t.indentBy.repeat(r));for(let o=0;o<e.length;o++){const a=e[o],l=cs(a);let c="";if(c=0===n.length?l:`${n}.${l}`,l===t.textNodeName){let e=a[l];hs(c,t)||(e=t.tagValueProcessor(l,e),e=ds(e,t)),i+=s+e;continue}if(l===t.cdataPropName){i+=s+`<![CDATA[${a[l][0][t.textNodeName]}]]>`;continue}if(l===t.commentPropName){i+=s+`\x3c!--${a[l][0][t.textNodeName]}--\x3e`;continue}if("?"===l[0]){const e=us(a[":@"],t),n="?xml"===l?"":s;let r=a[l][0][t.textNodeName];r=0!==r.length?" "+r:"",i+=n+`<${l}${r}${e}?>`;continue}let u=s+`<${l}${us(a[":@"],t)}`,h=ls(a[l],t,c,r+1);-1!==t.unpairedTags.indexOf(l)?t.suppressUnpairedNode?i+=u+">":i+=u+"/>":h&&0!==h.length||!t.suppressEmptyNode?i+=u+`>${h}${s}</${l}>`:i+=u+"/>"}return i}function cs(e){const t=Object.keys(e);for(let e=0;e<t.length;e++){const n=t[e];if(":@"!==n)return n}}function us(e,t){let n="";if(e&&!t.ignoreAttributes)for(let r in e){let i=t.attributeValueProcessor(r,e[r]);i=ds(i,t),!0===i&&t.suppressBooleanAttributes?n+=` ${r.substr(t.attributeNamePrefix.length)}`:n+=` ${r.substr(t.attributeNamePrefix.length)}="${i}"`}return n}function hs(e,t){let n=(e=e.substr(0,e.length-t.textNodeName.length-1)).substr(e.lastIndexOf(".")+1);for(let r in t.stopNodes)if(t.stopNodes[r]===e||t.stopNodes[r]==="*."+n)return!0;return!1}function ds(e,t){if(e&&e.length>0&&t.processEntities)for(let n=0;n<t.entities.length;n++){const r=t.entities[n];e=e.replace(r.regex,r.val)}return e}const fs=function(e,t){return ls(e,t,"",0)},ps={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[]};function ms(e){this.options=Object.assign({},ps,e),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=Es),this.processTextOrObjNode=ys,this.options.format?(this.indentate=ks,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine=""),this.options.suppressEmptyNode?(this.buildTextNode=_s,this.buildObjNode=vs):(this.buildTextNode=ws,this.buildObjNode=bs),this.buildTextValNode=ws,this.buildObjectNode=bs,this.replaceEntitiesValue=xs,this.buildAttrPairStr=gs}function gs(e,t){return t=this.options.attributeValueProcessor(e,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&"true"===t?" "+e:" "+e+'="'+t+'"'}function ys(e,t,n){const r=this.j2x(e,n+1);return void 0!==e[this.options.textNodeName]&&1===Object.keys(e).length?this.buildTextNode(e[this.options.textNodeName],t,r.attrStr,n):this.buildObjNode(r.val,t,r.attrStr,n)}function bs(e,t,n,r){let i="</"+t+this.tagEndChar,s="";return"?"===t[0]&&(s="?",i=""),n&&-1===e.indexOf("<")?this.indentate(r)+"<"+t+n+s+">"+e+i:!1!==this.options.commentPropName&&t===this.options.commentPropName&&0===s.length?this.indentate(r)+`\x3c!--${e}--\x3e`+this.newLine:this.indentate(r)+"<"+t+n+s+this.tagEndChar+e+this.indentate(r)+i}function vs(e,t,n,r){return""!==e?this.buildObjectNode(e,t,n,r):"?"===t[0]?this.indentate(r)+"<"+t+n+"?"+this.tagEndChar:this.indentate(r)+"<"+t+n+"/"+this.tagEndChar}function ws(e,t,n,r){if(!1!==this.options.cdataPropName&&t===this.options.cdataPropName)return this.indentate(r)+`<![CDATA[${e}]]>`+this.newLine;if(!1!==this.options.commentPropName&&t===this.options.commentPropName)return this.indentate(r)+`\x3c!--${e}--\x3e`+this.newLine;{let i=this.options.tagValueProcessor(t,e);return i=this.replaceEntitiesValue(i),""===i&&-1!==this.options.unpairedTags.indexOf(t)?this.options.suppressUnpairedNode?this.indentate(r)+"<"+t+this.tagEndChar:this.indentate(r)+"<"+t+"/"+this.tagEndChar:this.indentate(r)+"<"+t+n+">"+i+"</"+t+this.tagEndChar}}function xs(e){if(e&&e.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){const n=this.options.entities[t];e=e.replace(n.regex,n.val)}return e}function _s(e,t,n,r){return""===e&&-1!==this.options.unpairedTags.indexOf(t)?this.options.suppressUnpairedNode?this.indentate(r)+"<"+t+this.tagEndChar:this.indentate(r)+"<"+t+"/"+this.tagEndChar:""!==e?this.buildTextValNode(e,t,n,r):"?"===t[0]?this.indentate(r)+"<"+t+n+"?"+this.tagEndChar:this.indentate(r)+"<"+t+n+"/"+this.tagEndChar}function ks(e){return this.options.indentBy.repeat(e)}function Es(e){return!!e.startsWith(this.options.attributeNamePrefix)&&e.substr(this.attrPrefixLen)}ms.prototype.build=function(e){return this.options.preserveOrder?fs(e,this.options):(Array.isArray(e)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(e={[this.options.arrayNodeName]:e}),this.j2x(e,0).val)},ms.prototype.j2x=function(e,t){let n="",r="";for(let i in e)if(void 0===e[i]);else if(null===e[i])"?"===i[0]?r+=this.indentate(t)+"<"+i+"?"+this.tagEndChar:r+=this.indentate(t)+"<"+i+"/"+this.tagEndChar;else if(e[i]instanceof Date)r+=this.buildTextNode(e[i],i,"",t);else if("object"!=typeof e[i]){const s=this.isAttribute(i);if(s)n+=this.buildAttrPairStr(s,""+e[i]);else if(i===this.options.textNodeName){let t=this.options.tagValueProcessor(i,""+e[i]);r+=this.replaceEntitiesValue(t)}else r+=this.buildTextNode(e[i],i,"",t)}else if(Array.isArray(e[i])){const n=e[i].length;for(let s=0;s<n;s++){const n=e[i][s];void 0===n||(null===n?"?"===i[0]?r+=this.indentate(t)+"<"+i+"?"+this.tagEndChar:r+=this.indentate(t)+"<"+i+"/"+this.tagEndChar:r+="object"==typeof n?this.processTextOrObjNode(n,i,t):this.buildTextNode(n,i,"",t))}}else if(this.options.attributesGroupName&&i===this.options.attributesGroupName){const t=Object.keys(e[i]),r=t.length;for(let s=0;s<r;s++)n+=this.buildAttrPairStr(t[s],""+e[i][t[s]])}else r+=this.processTextOrObjNode(e[i],i,t);return{attrStr:n,val:r}};var As={XMLParser:as,XMLValidator:ui,XMLBuilder:ms};function Ns(e){return e.arrayBuffer?e.arrayBuffer():new Promise(((t,n)=>{const r=new FileReader;r.addEventListener("loadend",(()=>{t(r.result)})),r.addEventListener("error",n),r.readAsArrayBuffer(e)}))}async function Os(e){const t=await Ns(e);return new Uint8Array(t)}function $s(e){return"undefined"!=typeof Blob&&e instanceof Blob}function Ps(e){return"undefined"!=typeof SharedArrayBuffer&&e instanceof SharedArrayBuffer}const Ss="undefined"!=typeof process&&process.versions&&void 0!==process.versions.node&&void 0===process.versions.electron;class Cs{constructor(e){this.typedArray=e instanceof ArrayBuffer||Ps(e)?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}async getLength(){return this.typedArray.byteLength}async read(e,t){return new Uint8Array(this.typedArray.buffer,this.typedArray.byteOffset+e,t)}}class Ts{constructor(e){this.blob=e}async getLength(){return this.blob.size}async read(e,t){const n=this.blob.slice(e,e+t),r=await Ns(n);return new Uint8Array(r)}async sliceAsBlob(e,t,n=""){return this.blob.slice(e,e+t,n)}}function Bs(e,t){var n=e.length;if(t<=n)return e;var r=new Uint8Array(Math.max(n<<1,t));return r.set(e,0),r}function js(e,t,n,r,i,s){for(var o=Rs,a=Ls,l=0;l<n;){var c=e[a(r,i)&t];i+=15&c;var u=c>>>4;if(u<=15)s[l]=u,l++;else{var h=0,d=0;16==u?(d=3+o(r,i,2),i+=2,h=s[l-1]):17==u?(d=3+o(r,i,3),i+=3):18==u&&(d=11+o(r,i,7),i+=7);for(var f=l+d;l<f;)s[l]=h,l++}}return i}function Fs(e,t,n,r){for(var i=0,s=0,o=r.length>>>1;s<n;){var a=e[s+t];r[s<<1]=0,r[1+(s<<1)]=a,a>i&&(i=a),s++}for(;s<o;)r[s<<1]=0,r[1+(s<<1)]=0,s++;return i}function Ds(e,t){for(var n,r,i,s,o=e.length,a=zs.bl_count,l=0;l<=t;l++)a[l]=0;for(l=1;l<o;l+=2)a[e[l]]++;var c=zs.next_code;for(n=0,a[0]=0,r=1;r<=t;r++)n=n+a[r-1]<<1,c[r]=n;for(i=0;i<o;i+=2)0!=(s=e[i+1])&&(e[i]=c[s],c[s]++)}function Is(e,t,n){for(var r=e.length,i=zs.rev15,s=0;s<r;s+=2)if(0!=e[s+1])for(var o=s>>1,a=e[s+1],l=o<<4|a,c=t-a,u=e[s]<<c,h=u+(1<<c);u!=h;){n[i[u]>>>15-t]=l,u++}}function Ks(e,t){for(var n=zs.rev15,r=15-t,i=0;i<e.length;i+=2){var s=e[i]<<t-e[i+1];e[i]=n[s]>>>r}}function Rs(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<n)-1}function Ms(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<n)-1}function Ls(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)}const zs=(qs=Uint16Array,Vs=Uint32Array,{next_code:new qs(16),bl_count:new qs(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new qs(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new Vs(32),flmap:new qs(512),fltree:[],fdmap:new qs(32),fdtree:[],lmap:new qs(32768),ltree:[],ttree:[],dmap:new qs(32768),dtree:[],imap:new qs(512),itree:[],rev15:new qs(32768),lhst:new Vs(286),dhst:new Vs(30),ihst:new Vs(19),lits:new Vs(15e3),strt:new qs(65536),prev:new qs(32768)});var qs,Vs;!function(){for(var e=0;e<32768;e++){var t=e;t=(4278255360&(t=(4042322160&(t=(3435973836&(t=(2863311530&t)>>>1|(1431655765&t)<<1))>>>2|(858993459&t)<<2))>>>4|(252645135&t)<<4))>>>8|(16711935&t)<<8,zs.rev15[e]=(t>>>16|t<<16)>>>17}function n(e,t,n){for(;0!=t--;)e.push(0,n)}for(e=0;e<32;e++)zs.ldef[e]=zs.of0[e]<<3|zs.exb[e],zs.ddef[e]=zs.df0[e]<<4|zs.dxb[e];n(zs.fltree,144,8),n(zs.fltree,112,9),n(zs.fltree,24,7),n(zs.fltree,8,8),Ds(zs.fltree,9),Is(zs.fltree,9,zs.flmap),Ks(zs.fltree,9),n(zs.fdtree,32,5),Ds(zs.fdtree,5),Is(zs.fdtree,5,zs.fdmap),Ks(zs.fdtree,5),n(zs.itree,19,0),n(zs.ltree,286,0),n(zs.dtree,30,0),n(zs.ttree,320,0)}();const Us={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var n=t,r=0;r<8;r++)1&n?n=3988292384^n>>>1:n>>>=1;e[t]=n}return e}(),update:function(e,t,n,r){for(var i=0;i<r;i++)e=Us.table[255&(e^t[n+i])]^e>>>8;return e},crc:function(e,t,n){return 4294967295^Us.update(4294967295,e,t,n)}};function Ws(e,t){return function(e,t){var n=Uint8Array;if(3==e[0]&&0==e[1])return t||new n(0);var r=Ms,i=Rs,s=js,o=Ls,a=null==t;a&&(t=new n(e.length>>>2<<3));for(var l,c,u=0,h=0,d=0,f=0,p=0,m=0,g=0,y=0,b=0;0==u;)if(u=r(e,b,1),h=r(e,b+1,2),b+=3,0!=h){if(a&&(t=Bs(t,y+(1<<17))),1==h&&(l=zs.flmap,c=zs.fdmap,m=511,g=31),2==h){d=i(e,b,5)+257,f=i(e,b+5,5)+1,p=i(e,b+10,4)+4,b+=14;for(var v=0;v<38;v+=2)zs.itree[v]=0,zs.itree[v+1]=0;var w=1;for(v=0;v<p;v++){var x=i(e,b+3*v,3);zs.itree[1+(zs.ordr[v]<<1)]=x,x>w&&(w=x)}b+=3*p,Ds(zs.itree,w),Is(zs.itree,w,zs.imap),l=zs.lmap,c=zs.dmap,b=s(zs.imap,(1<<w)-1,d+f,e,b,zs.ttree);var _=Fs(zs.ttree,0,d,zs.ltree);m=(1<<_)-1;var k=Fs(zs.ttree,d,f,zs.dtree);g=(1<<k)-1,Ds(zs.ltree,_),Is(zs.ltree,_,l),Ds(zs.dtree,k),Is(zs.dtree,k,c)}for(;;){var E=l[o(e,b)&m];b+=15&E;var A=E>>>4;if(A>>>8==0)t[y++]=A;else{if(256==A)break;var N=y+A-254;if(A>264){var O=zs.ldef[A-257];N=y+(O>>>3)+i(e,b,7&O),b+=7&O}var $=c[o(e,b)&g];b+=15&$;var P=$>>>4,S=zs.ddef[P],C=(S>>>4)+r(e,b,15&S);for(b+=15&S,a&&(t=Bs(t,y+(1<<17)));y<N;)t[y]=t[y++-C],t[y]=t[y++-C],t[y]=t[y++-C],t[y]=t[y++-C];y=N}}}else{0!=(7&b)&&(b+=8-(7&b));var T=4+(b>>>3),B=e[T-4]|e[T-3]<<8;a&&(t=Bs(t,y+B)),t.set(new n(e.buffer,e.byteOffset+T,B),y),b=T+B<<3,y+=B}return t.length==y?t:t.slice(0,y)}(e,t)}const Xs={numWorkers:1,workerURL:"",useWorkers:!1};let Ys=0;const Hs=[];function Gs(e){return new Promise(((t,n)=>{const r=new Worker(e);r.onmessage=e=>{"start"===e.data?(r.onerror=void 0,r.onmessage=void 0,t(r)):n(new Error(`unexpected message: ${e.data}`))},r.onerror=n}))}function Qs(e,t,n,r){const i=new Uint8Array(t);Ws(e,i),r(n?new Blob([i],{type:n}):i.buffer)}function Js(e,t,n){return new Promise(((r,i)=>{Hs.push({src:e,uncompressedSize:t,type:n,resolve:r,reject:i,id:Ys++}),async function(){if(0!==Hs.length)for(;Hs.length;){const{src:e,uncompressedSize:t,type:n,resolve:r}=Hs.shift();let i=e;$s(e)&&(i=await Os(e)),Qs(i,t,n,r)}}()}))}!function(){if(Ss){const{Worker:n}=(e=module,t="worker_threads",e.require(t));return{createWorker:async e=>new n(e),addEventListener(e,t){e.on("message",(n=>{t({target:e,data:n})}))},async terminate(e){await e.terminate()}}}return{async createWorker(e){try{return await Gs(e)}catch(t){console.warn("could not load worker:",e)}let t;try{const n=await fetch(e,{mode:"cors"});if(!n.ok)throw new Error(`could not load: ${e}`);t=await n.text(),e=URL.createObjectURL(new Blob([t],{type:"application/javascript"}));const r=await Gs(e);return Xs.workerURL=e,r}catch(t){console.warn("could not load worker via fetch:",e)}if(void 0!==t)try{e=`data:application/javascript;base64,${btoa(t)}`;const n=await Gs(e);return Xs.workerURL=e,n}catch(e){console.warn("could not load worker via dataURI")}throw console.warn("workers will not be used"),new Error("can not start workers")},addEventListener(e,t){e.addEventListener("message",t)},async terminate(e){e.terminate()}};var e,t}();class Zs{constructor(e,t){var n,r;this._reader=e,this._rawEntry=t,this.name=t.name,this.nameBytes=t.nameBytes,this.size=t.uncompressedSize,this.compressedSize=t.compressedSize,this.comment=t.comment,this.commentBytes=t.commentBytes,this.compressionMethod=t.compressionMethod,this.lastModDate=(n=t.lastModFileDate,r=t.lastModFileTime,new Date(1980+(n>>9&127),(n>>5&15)-1,31&n,r>>11&31,r>>5&63,2*(31&r),0)),this.isDirectory=0===t.uncompressedSize&&t.name.endsWith("/"),this.encrypted=!!(1&t.generalPurposeBitFlag),this.externalFileAttributes=t.externalFileAttributes,this.versionMadeBy=t.versionMadeBy}async blob(e="application/octet-stream"){return await async function(e,t,n){const{decompress:r,fileDataStart:i}=await uo(e,t);if(!r){const r=await to(e,i,t.compressedSize,n);return $s(r)?r:new Blob([Ps(r.buffer)?new Uint8Array(r):r],{type:n})}const s=await to(e,i,t.compressedSize);return await Js(s,t.uncompressedSize,n)}(this._reader,this._rawEntry,e)}async arrayBuffer(){return await async function(e,t){const{decompress:n,fileDataStart:r}=await uo(e,t);if(!n){const n=await eo(e,r,t.compressedSize);return 0===(i=n).byteOffset&&i.byteLength===i.buffer.byteLength?n.buffer:n.slice().buffer}var i;const s=await to(e,r,t.compressedSize);return await Js(s,t.uncompressedSize)}(this._reader,this._rawEntry)}async text(){const e=await this.arrayBuffer();return ao(new Uint8Array(e))}async json(){const e=await this.text();return JSON.parse(e)}}async function eo(e,t,n){return await e.read(t,n)}async function to(e,t,n,r){return e.sliceAsBlob?await e.sliceAsBlob(t,n,r):await e.read(t,n)}const no={unsigned:()=>0};function ro(e,t){return e[t]+256*e[t+1]}function io(e,t){return e[t]+256*e[t+1]+65536*e[t+2]+16777216*e[t+3]}function so(e,t){return io(e,t)+4294967296*io(e,t+4)}const oo=new TextDecoder;function ao(e,t){return Ps(e.buffer)&&(e=new Uint8Array(e)),oo.decode(e)}async function lo(e,t,n,r){const i=t-20,s=await eo(e,i,20);if(117853008!==io(s,0))throw new Error("invalid zip64 end of central directory locator signature");const o=so(s,8),a=await eo(e,o,56);if(101075792!==io(a,0))throw new Error("invalid zip64 end of central directory record signature");const l=so(a,32),c=so(a,40);return co(e,so(a,48),c,l,n,r)}async function co(e,t,n,r,i,s){let o=0;const a=await eo(e,t,n),l=[];for(let e=0;e<r;++e){const e=a.subarray(o,o+46),t=io(e,0);if(33639248!==t)throw new Error(`invalid central directory file header signature: 0x${t.toString(16)}`);const n={versionMadeBy:ro(e,4),versionNeededToExtract:ro(e,6),generalPurposeBitFlag:ro(e,8),compressionMethod:ro(e,10),lastModFileTime:ro(e,12),lastModFileDate:ro(e,14),crc32:io(e,16),compressedSize:io(e,20),uncompressedSize:io(e,24),fileNameLength:ro(e,28),extraFieldLength:ro(e,30),fileCommentLength:ro(e,32),internalFileAttributes:ro(e,36),externalFileAttributes:io(e,38),relativeOffsetOfLocalHeader:io(e,42)};if(64&n.generalPurposeBitFlag)throw new Error("strong encryption is not supported");o+=46;const r=a.subarray(o,o+n.fileNameLength+n.extraFieldLength+n.fileCommentLength);n.nameBytes=r.slice(0,n.fileNameLength),n.name=ao(n.nameBytes);const i=n.fileNameLength+n.extraFieldLength,s=r.slice(n.fileNameLength,i);n.extraFields=[];let c=0;for(;c<s.length-3;){const e=ro(s,c+0),t=c+4,r=t+ro(s,c+2);if(r>s.length)throw new Error("extra field length exceeds extra field buffer size");n.extraFields.push({id:e,data:s.slice(t,r)}),c=r}if(n.commentBytes=r.slice(i,i+n.fileCommentLength),n.comment=ao(n.commentBytes),o+=r.length,4294967295===n.uncompressedSize||4294967295===n.compressedSize||4294967295===n.relativeOffsetOfLocalHeader){const e=n.extraFields.find((e=>1===e.id));if(!e)throw new Error("expected zip64 extended information extra field");const t=e.data;let r=0;if(4294967295===n.uncompressedSize){if(r+8>t.length)throw new Error("zip64 extended information extra field does not include uncompressed size");n.uncompressedSize=so(t,r),r+=8}if(4294967295===n.compressedSize){if(r+8>t.length)throw new Error("zip64 extended information extra field does not include compressed size");n.compressedSize=so(t,r),r+=8}if(4294967295===n.relativeOffsetOfLocalHeader){if(r+8>t.length)throw new Error("zip64 extended information extra field does not include relative header offset");n.relativeOffsetOfLocalHeader=so(t,r),r+=8}}const u=n.extraFields.find((e=>28789===e.id&&e.data.length>=6&&1===e.data[0]&&io(e.data,1)),no.unsigned(n.nameBytes));if(u&&(n.fileName=ao(u.data.slice(5))),0===n.compressionMethod){let e=n.uncompressedSize;if(0!=(1&n.generalPurposeBitFlag)&&(e+=12),n.compressedSize!==e)throw new Error(`compressed size mismatch for stored file: ${n.compressedSize} != ${e}`)}l.push(n)}return{zip:{comment:i,commentBytes:s},entries:l.map((t=>new Zs(e,t)))}}async function uo(e,t){if(1&t.generalPurposeBitFlag)throw new Error("encrypted entries not supported");const n=await eo(e,t.relativeOffsetOfLocalHeader,30),r=await e.getLength(),i=io(n,0);if(67324752!==i)throw new Error(`invalid local file header signature: 0x${i.toString(16)}`);const s=ro(n,26),o=ro(n,28),a=t.relativeOffsetOfLocalHeader+n.length+s+o;let l;if(0===t.compressionMethod)l=!1;else{if(8!==t.compressionMethod)throw new Error(`unsupported compression method: ${t.compressionMethod}`);l=!0}const c=a,u=c+t.compressedSize;if(0!==t.compressedSize&&u>r)throw new Error(`file data overflows file bounds: ${c} +  ${t.compressedSize}  > ${r}`);return{decompress:l,fileDataStart:c}}async function ho(e){let t;if("undefined"!=typeof Blob&&e instanceof Blob)t=new Ts(e);else if(e instanceof ArrayBuffer||e&&e.buffer&&e.buffer instanceof ArrayBuffer)t=new Cs(e);else if(Ps(e)||Ps(e.buffer))t=new Cs(e);else if("string"==typeof e){const n=await fetch(e);if(!n.ok)throw new Error(`failed http request ${e}, status: ${n.status}: ${n.statusText}`);const r=await n.blob();t=new Ts(r)}else{if("function"!=typeof e.getLength||"function"!=typeof e.read)throw new Error("unsupported source type");t=e}const n=await t.getLength();if(n>Number.MAX_SAFE_INTEGER)throw new Error(`file too large. size: ${n}. Only file sizes up 4503599627370496 bytes are supported`);return await async function(e,t){const n=Math.min(65557,t),r=t-n,i=await eo(e,r,n);for(let t=n-22;t>=0;--t){if(101010256!==io(i,t))continue;const n=new Uint8Array(i.buffer,i.byteOffset+t,i.byteLength-t),s=ro(n,4);if(0!==s)throw new Error(`multi-volume zip files are not supported. This is volume: ${s}`);const o=ro(n,10),a=io(n,12),l=io(n,16),c=ro(n,20),u=n.length-22;if(c!==u)throw new Error(`invalid comment length. expected: ${u}, actual: ${c}`);const h=new Uint8Array(n.buffer,n.byteOffset+22,c),d=ao(h);return 65535===o||4294967295===l?await lo(e,r+t,d,h):await co(e,l,a,o,d,h)}throw new Error("could not find end of central directory. maybe not zip file")}(t,n)}let fo,po=[],mo=[],go=[],yo=[],bo=[],vo="";const wo=async e=>{const{entries:t}=await async function(e){const{zip:t,entries:n}=await ho(e);return{zip:t,entries:Object.fromEntries(n.map((e=>[e.name,e])))}}(e);let n="";for(const[e,r]of Object.entries(t))switch(e.substring(e.lastIndexOf("."))){case".opf":n=await r.text();break;case".png":case".jpg":case".jpeg":case".gif":{const t=await r.blob();mo.push({name:e,blob:t});break}case".css":{const t=await r.text();yo.push({name:e,css:t});break}case".htm":case".xml":case".html":case".xhtml":{const t=await r.text();go.push({name:e,html:t});break}case".otf":case".ttf":case".woff":{const t=await r.blob();bo.push({name:e,blob:t})}}return n},xo=e=>{const t=e["dc:title"],n=e["dc:creator"];let r=mo[0].blob;for(let{name:e,blob:t}of mo){if(e.includes(vo)){r=t;break}e.includes("cover")&&(r=t)}return{title:t,author:n,cover:r}},_o=e=>{let t=[];for(const n of e.item)"application/xhtml+xml"===n["@_media-type"]?t.push({id:n["@_id"],href:n["@_href"]}):n["@_media-type"].includes("image")&&n["@_id"].includes("cover")&&(vo=n["@_href"]);return t},ko=(e,t)=>{let n=[];e.itemref.forEach((e=>n.push(e["@_idref"]))),po=n.map((e=>t.find((t=>t.id===e))))},Eo=e=>e.split("\\").pop().split("/").pop(),Ao=(e,t)=>{for(const[n,{name:r}]of t.entries())if(r.includes(e))return"ESSENCE-READER-IMAGE-"+n;return""},No=new DOMParser,Oo=(e,t)=>{let n=No.parseFromString(e,"application/xhtml+xml");n.querySelector("parsererror")&&(n=No.parseFromString(e,"text/html"));for(const e of n.querySelectorAll("[src],[href], image"))switch(e.tagName){case"img":{const n=Eo(e.getAttribute("src"));e.setAttribute("src",Ao(n,t)),e.style.cssText+="max-height: 100%; max-width: 100%; object-fit: scale-down;";break}case"image":{const n=Eo(e.getAttributeNS("http://www.w3.org/1999/xlink","href"));e.setAttributeNS("http://www.w3.org/1999/xlink","href",Ao(n,t));break}default:null===e.getAttribute("href")||e.getAttribute("href").includes("http")?null===e.getAttribute("src")||e.getAttribute("src").includes("http")||e.removeAttribute("src"):e.removeAttribute("href")}return n.body.innerHTML},$o=(e,t)=>{let n=[];return(e=(e=e.replace(/@(-moz-|-webkit-|-ms-)*keyframes\s(.*?){([0-9%a-zA-Z,\s.]*{(.*?)})*[\s\n]*}/g,(e=>n.push(e)&&"__keyframes__"))).replace(/([^\r\n,{}]+)(,(?=[^}]*{)|\s*{)/g,(e=>"@"===e.trim()[0]?e:e.replace(/(\s*)/,"$1"+t+" ")))).replace(/__keyframes__/g,(e=>n.shift()))},Po=async e=>{mo=[],po=[],go=[],bo=[];try{(e=>{const t=new As.XMLParser({ignoreAttributes:!1}).parse(e).package,n=_o(t.manifest),r=(new As.XMLParser).parse(e).package;fo=xo(void 0===r.metadata?r["opf:metadata"]:r.metadata),ko(t.spine,n)})(await wo(e))}catch(t){throw new Error(e.name+" does not appear to be a valid EPUB file")}let t=[];for(let e=0;e<po.length;e++)for(const{name:n,html:r}of go)if(n.includes(po[e].href)){t.push(Oo(r,mo));break}for(let e=0;e<yo.length;e++)yo[e].css=$o(yo[e].css,"#container");return{meta:fo,contents:t,files:{images:mo,fonts:bo,styles:yo}}},So=(e,t,n)=>e.replace(/url\((?!['"]?(?:data):)['"]?([^'"\)]*)['"]?\)/g,(function(e,r){const i=r.split("\\").pop().split("/").pop();let s=[];return[".png",".jpg",".jpeg",".gif"].some((e=>i.endsWith(e)))?s=t:[".otf",".ttf",".woff"].some((e=>i.endsWith(e)))&&(s=n),"url("+Co(i,s)+")"})),Co=(e,t)=>{for(const{name:n,blob:r}of t)if(n.includes(e))return URL.createObjectURL(r);return""},To=(e,t)=>e.replace(/ESSENCE-READER-IMAGE-(\d*)/g,(function(e,n){return URL.createObjectURL(t[n].blob)})),Bo=e=>({}),jo=e=>({}),Fo=e=>({}),Do=e=>({}),Io=e=>({}),Ko=e=>({});function Ro(e){let t,n,r,i,s,o,a;const l=e[1].leftbar,c=u(l,e,e[0],Ko),h=e[1].toptext,m=u(h,e,e[0],Do),w=e[1].rightbar,_=u(w,e,e[0],jo);return{c(){t=v("div"),n=v("div"),c&&c.c(),r=x(),i=v("div"),m&&m.c(),s=x(),o=v("div"),_&&_.c(),E(n,"class","buttonbar svelte-5uyilb"),E(n,"id","leftbar"),E(i,"id","toptext"),E(i,"class","svelte-5uyilb"),E(o,"class","buttonbar svelte-5uyilb"),E(o,"id","rightbar"),E(t,"id","topbar"),E(t,"class","svelte-5uyilb")},m(e,l){y(e,t,l),g(t,n),c&&c.m(n,null),g(t,r),g(t,i),m&&m.m(i,null),g(t,s),g(t,o),_&&_.m(o,null),a=!0},p(e,[t]){c&&c.p&&(!a||1&t)&&f(c,l,e,e[0],a?d(l,e[0],t,Io):p(e[0]),Ko),m&&m.p&&(!a||1&t)&&f(m,h,e,e[0],a?d(h,e[0],t,Fo):p(e[0]),Do),_&&_.p&&(!a||1&t)&&f(_,w,e,e[0],a?d(w,e[0],t,Bo):p(e[0]),jo)},i(e){a||(Y(c,e),Y(m,e),Y(_,e),a=!0)},o(e){H(c,e),H(m,e),H(_,e),a=!1},d(e){e&&b(t),c&&c.d(e),m&&m.d(e),_&&_.d(e)}}}function Mo(e,t,n){let{$$slots:r={},$$scope:i}=t;return e.$$set=e=>{"$$scope"in e&&n(0,i=e.$$scope)},[i,r]}class Lo extends ie{constructor(e){super(),re(this,e,Mo,Ro,s,{})}}function zo(t){let n,s,o,a,l;const c=t[4].default,h=u(c,t,t[3],null);return{c(){n=v("div"),h&&h.c(),E(n,"id","popover"),O(n,"top",t[1]),O(n,"right",t[2]),E(n,"class","svelte-5z79nf")},m(r,c){var u;y(r,n,c),h&&h.m(n,null),o=!0,a||(l=[(u=s=Vo.call(null,n),u&&i(u.destroy)?u.destroy:e),k(n,"outclick",t[5])],a=!0)},p(e,t){h&&h.p&&(!o||8&t)&&f(h,c,e,e[3],o?d(c,e[3],t,null):p(e[3]),null),(!o||2&t)&&O(n,"top",e[1]),(!o||4&t)&&O(n,"right",e[2])},i(e){o||(Y(h,e),o=!0)},o(e){H(h,e),o=!1},d(e){e&&b(n),h&&h.d(e),a=!1,r(l)}}}function qo(e){let t,n,r=e[0]&&zo(e);return{c(){r&&r.c(),t=_()},m(e,i){r&&r.m(e,i),y(e,t,i),n=!0},p(e,[n]){e[0]?r?(r.p(e,n),1&n&&Y(r,1)):(r=zo(e),r.c(),Y(r,1),r.m(t.parentNode,t)):r&&(W(),H(r,1,1,(()=>{r=null})),X())},i(e){n||(Y(r),n=!0)},o(e){H(r),n=!1},d(e){r&&r.d(e),e&&b(t)}}}function Vo(e){const t=t=>{t.target instanceof Element&&(e.contains(t.target)||"settingsBtn"===t.target.className||e.dispatchEvent(new CustomEvent("outclick")))};return document.addEventListener("click",t,!0),{destroy(){document.removeEventListener("click",t,!0)}}}function Uo(e,t,n){let{$$slots:r={},$$scope:i}=t,{visible:s}=t,{top:o}=t,{right:a}=t;return e.$$set=e=>{"visible"in e&&n(0,s=e.visible),"top"in e&&n(1,o=e.top),"right"in e&&n(2,a=e.right),"$$scope"in e&&n(3,i=e.$$scope)},[s,o,a,i,r,()=>n(0,s=!1)]}class Wo extends ie{constructor(e){super(),re(this,e,Uo,qo,s,{visible:0,top:1,right:2})}}function Xo(t){let n,i,s,o,a,l,c,u,h;return{c(){n=v("div"),n.textContent="warm",i=x(),s=v("div"),s.textContent="black",o=x(),a=v("div"),a.textContent="dark",l=x(),c=v("div"),c.textContent="light",O(n,"background-color","#f6e4bd"),O(n,"color","#000"),E(n,"class","svelte-7vb56k"),O(s,"background-color","#000"),O(s,"color","#e9e9e9"),E(s,"class","svelte-7vb56k"),O(a,"background-color","#032038"),O(a,"color","#e9e9e9"),E(a,"class","svelte-7vb56k"),O(c,"background-color","#fff"),O(c,"color","#000"),E(c,"class","svelte-7vb56k")},m(e,r){y(e,n,r),y(e,i,r),y(e,s,r),y(e,o,r),y(e,a,r),y(e,l,r),y(e,c,r),u||(h=[k(n,"click",t[1]),k(s,"click",t[2]),k(a,"click",t[3]),k(c,"click",t[4])],u=!0)},p:e,i:e,o:e,d(e){e&&b(n),e&&b(i),e&&b(s),e&&b(o),e&&b(a),e&&b(l),e&&b(c),u=!1,r(h)}}}function Yo(e){const t=e=>{document.documentElement.setAttribute("data-theme",e),localStorage.setItem("theme",e)};return[t,()=>t("warm"),()=>t("black"),()=>t("dark"),()=>t("light")]}class Ho extends ie{constructor(e){super(),re(this,e,Yo,Xo,s,{})}}function Go(e){let t,n,i,s,o,a,l,c,u,h,d,f,p,m,w,_,A,P,S,C,T,B,j;return C=new Ho({}),{c(){t=v("label"),t.textContent="Font:",n=x(),i=v("br"),s=x(),o=v("select"),a=v("option"),a.textContent="Verdana",l=v("option"),l.textContent="Arial",c=v("option"),c.textContent="Courier New ",u=v("option"),u.textContent="Helvetica",h=v("option"),h.textContent="Times New Roman",d=x(),f=v("br"),p=x(),m=v("label"),m.textContent="Font size:",w=x(),_=v("br"),A=x(),P=v("input"),S=x(),Z(C.$$.fragment),E(t,"for","fontpicker"),O(a,"font-family","'Verdana'"),a.__value="Verdana",a.value=a.__value,O(l,"font-family","'Arial'"),l.__value="Arial",l.value=l.__value,O(c,"font-family","'Courier New '"),c.__value="Courier New ",c.value=c.__value,O(u,"font-family","'Helvetica'"),u.__value="Helvetica",u.value=u.__value,O(h,"font-family","'Times New Roman'"),h.__value="Times New Roman",h.value=h.__value,E(o,"name","fontpicker"),O(o,"width","100%"),void 0===e[0].fontFamily&&K((()=>e[2].call(o))),E(m,"for","fontsize"),E(P,"name","fontsize"),E(P,"type","range"),E(P,"min","12"),E(P,"max","40")},m(r,b){y(r,t,b),y(r,n,b),y(r,i,b),y(r,s,b),y(r,o,b),g(o,a),g(o,l),g(o,c),g(o,u),g(o,h),$(o,e[0].fontFamily),y(r,d,b),y(r,f,b),y(r,p,b),y(r,m,b),y(r,w,b),y(r,_,b),y(r,A,b),y(r,P,b),N(P,e[0].fontSize),y(r,S,b),ee(C,r,b),T=!0,B||(j=[k(o,"change",e[2]),k(P,"change",e[3]),k(P,"input",e[3])],B=!0)},p(e,t){1&t&&$(o,e[0].fontFamily),1&t&&N(P,e[0].fontSize)},i(e){T||(Y(C.$$.fragment,e),T=!0)},o(e){H(C.$$.fragment,e),T=!1},d(e){e&&b(t),e&&b(n),e&&b(i),e&&b(s),e&&b(o),e&&b(d),e&&b(f),e&&b(p),e&&b(m),e&&b(w),e&&b(_),e&&b(A),e&&b(P),e&&b(S),te(C,e),B=!1,r(j)}}}function Qo(e){let t,n,r;function i(t){e[4](t)}let s={top:"3.1em",right:"1%",$$slots:{default:[Go]},$$scope:{ctx:e}};return void 0!==e[1]&&(s.visible=e[1]),t=new Wo({props:s}),B.push((()=>J(t,"visible",i))),{c(){Z(t.$$.fragment)},m(e,n){ee(t,e,n),r=!0},p(e,[r]){const i={};33&r&&(i.$$scope={dirty:r,ctx:e}),!n&&2&r&&(n=!0,i.visible=e[1],R((()=>n=!1))),t.$set(i)},i(e){r||(Y(t.$$.fragment,e),r=!0)},o(e){H(t.$$.fragment,e),r=!1},d(e){te(t,e)}}}function Jo(e,t,n){let{settings:r={fontSize:16,fontFamily:"Verdana"}}=t,{settingsVisible:i=!1}=t;return e.$$set=e=>{"settings"in e&&n(0,r=e.settings),"settingsVisible"in e&&n(1,i=e.settingsVisible)},[r,i,function(){r.fontFamily=function(e){const t=e.querySelector(":checked")||e.options[0];return t&&t.__value}(this),n(0,r)},function(){var e;r.fontSize=""===(e=this.value)?null:+e,n(0,r)},function(e){i=e,n(1,i)}]}class Zo extends ie{constructor(e){super(),re(this,e,Jo,Qo,s,{settings:0,settingsVisible:1})}}const{document:ea}=G;function ta(t){let n,r,i;return{c(){n=v("button"),n.textContent="<",E(n,"slot","leftbar"),O(n,"opacity","0.5")},m(e,s){y(e,n,s),r||(i=k(n,"click",t[12]),r=!0)},p:e,d(e){e&&b(n),r=!1,i()}}}function na(e){let t,n,r,i,s,o,a,l,c,u,h,d,f=void 0!==e[1]?e[1].meta.title+" - ":"",p=(void 0!==e[1]?e[1].meta.author:"")+"",m=e[1].contents.length+"";return{c(){t=v("div"),n=v("h4"),r=v("b"),i=w(f),s=x(),o=w(p),a=x(),l=v("p"),c=w(e[2]),u=w("/"),h=w(m),E(n,"class","svelte-ketruh"),E(l,"id","progress"),E(l,"class","svelte-ketruh"),E(t,"slot","toptext"),E(t,"style",d="transition: opacity 0.3s; "+(e[5]>100?"opacity: 0.5;":""))},m(e,d){y(e,t,d),g(t,n),g(n,r),g(r,i),g(n,s),g(n,o),g(t,a),g(t,l),g(l,c),g(l,u),g(l,h)},p(e,n){2&n&&f!==(f=void 0!==e[1]?e[1].meta.title+" - ":"")&&A(i,f),2&n&&p!==(p=(void 0!==e[1]?e[1].meta.author:"")+"")&&A(o,p),4&n&&A(c,e[2]),2&n&&m!==(m=e[1].contents.length+"")&&A(h,m),32&n&&d!==(d="transition: opacity 0.3s; "+(e[5]>100?"opacity: 0.5;":""))&&E(t,"style",d)},d(e){e&&b(t)}}}function ra(t){let n,i,s,o,a,l,c,u;return{c(){n=v("div"),i=v("button"),i.textContent="⚙",s=x(),o=v("button"),o.textContent="«",a=x(),l=v("button"),l.textContent="»",E(i,"class","settingsBtn"),E(n,"slot","rightbar"),O(n,"display","inline-block")},m(e,r){y(e,n,r),g(n,i),g(n,s),g(n,o),g(n,a),g(n,l),c||(u=[k(i,"click",t[9]),k(o,"click",t[10]),k(l,"click",t[11])],c=!0)},p:e,d(e){e&&b(n),c=!1,r(u)}}}function ia(e){let t,n,i,s,o,a,l,c,u,h,d,f,p,m,w,_,A=!1,N=()=>{A=!1},$=e[1].contents[e[2]]+"",S=e[1].contents[e[2]+1]+"";function C(t){e[13](t)}function T(t){e[14](t)}K(e[8]),ea.title=n="\n        "+e[1].meta.title+" - "+e[1].meta.author+"\n    ",s=new Lo({props:{$$slots:{rightbar:[ra],toptext:[na],leftbar:[ta]},$$scope:{ctx:e}}});let j={};return void 0!==e[3]&&(j.settingsVisible=e[3]),void 0!==e[4]&&(j.settings=e[4]),d=new Zo({props:j}),B.push((()=>J(d,"settingsVisible",C))),B.push((()=>J(d,"settings",T))),{c(){i=x(),Z(s.$$.fragment),o=x(),a=v("div"),l=new P(!1),c=x(),u=new P(!1),h=x(),Z(d.$$.fragment),l.a=c,u.a=null,E(a,"id","container"),O(a,"font-size",e[4].fontSize+"px"),O(a,"font-family",e[4].fontFamily),E(a,"class","svelte-ketruh")},m(n,r){y(n,i,r),ee(s,n,r),y(n,o,r),y(n,a,r),l.m($,a),g(a,c),u.m(S,a),y(n,h,r),ee(d,n,r),m=!0,w||(_=[k(window,"keydown",e[7]),k(window,"scroll",(()=>{A=!0,clearTimeout(t),t=setTimeout(N,100),e[8]()}))],w=!0)},p(e,[r]){32&r&&!A&&(A=!0,clearTimeout(t),scrollTo(window.pageXOffset,e[5]),t=setTimeout(N,100)),(!m||2&r)&&n!==(n="\n        "+e[1].meta.title+" - "+e[1].meta.author+"\n    ")&&(ea.title=n);const i={};131119&r&&(i.$$scope={dirty:r,ctx:e}),s.$set(i),(!m||6&r)&&$!==($=e[1].contents[e[2]]+"")&&l.p($),(!m||6&r)&&S!==(S=e[1].contents[e[2]+1]+"")&&u.p(S),(!m||16&r)&&O(a,"font-size",e[4].fontSize+"px"),(!m||16&r)&&O(a,"font-family",e[4].fontFamily);const o={};!f&&8&r&&(f=!0,o.settingsVisible=e[3],R((()=>f=!1))),!p&&16&r&&(p=!0,o.settings=e[4],R((()=>p=!1))),d.$set(o)},i(e){m||(Y(s.$$.fragment,e),Y(d.$$.fragment,e),m=!0)},o(e){H(s.$$.fragment,e),H(d.$$.fragment,e),m=!1},d(e){e&&b(i),te(s,e),e&&b(o),e&&b(a),e&&b(h),te(d,e),w=!1,r(_)}}}function sa(e,t,n){let{currentBook:r}=t,{reading:i}=t,s=0,o=!1,a={fontSize:16,fontFamily:"Verdana"},l=0,c=r.meta.title;var u;u=()=>{c!=r.meta.title&&(n(2,s=0),c=r.meta.title,h())},C().$$.after_update.push(u);const h=()=>{for(let e of document.getElementsByTagName("style"))e.innerHTML="";r.files.styles.forEach((e=>{const t=document.createElement("style");t.innerText=e.css,document.head.appendChild(t)}))},d=e=>{0<=s+e&&s+e<=r.contents.length&&(n(2,s+=e),n(5,l=0))};h();return e.$$set=e=>{"currentBook"in e&&n(1,r=e.currentBook),"reading"in e&&n(0,i=e.reading)},[i,r,s,o,a,l,d,({key:e})=>{switch(e){case"ArrowLeft":d(-2);break;case"ArrowRight":d(2)}},function(){n(5,l=window.pageYOffset)},()=>n(3,o=!o),()=>d(-2),()=>d(2),()=>{n(0,i=!1),document.title="Essence Reader",location.hash=""},function(e){o=e,n(3,o)},function(e){a=e,n(4,a)}]}class oa extends ie{constructor(e){super(),re(this,e,sa,ia,s,{currentBook:1,reading:0})}}function aa(e,t,n){const r=e.slice();return r[18]=t[n],r}function la(t){let n;return{c(){n=v("h3"),n.textContent="Essence Reader",E(n,"slot","toptext"),O(n,"display","inline")},m(e,t){y(e,n,t)},p:e,d(e){e&&b(n)}}}function ca(t){let n,r,i;return{c(){n=v("button"),n.textContent="⚙",E(n,"class","settingsBtn"),E(n,"slot","rightbar")},m(e,s){y(e,n,s),r||(i=k(n,"click",t[11]),r=!0)},p:e,d(e){e&&b(n),r=!1,i()}}}function ua(e){let t,n,r,i,s,o,a,l,c,u,h,d,f,p;return h=new Ho({}),{c(){t=v("div"),n=v("label"),r=v("input"),i=w("\n            Save books\n        "),s=v("br"),o=x(),a=v("hr"),l=x(),c=v("p"),c.textContent="Select theme",u=x(),Z(h.$$.fragment),E(r,"type","checkbox"),O(n,"user-select","none"),O(c,"display","inline"),O(t,"width","8em")},m(m,b){y(m,t,b),g(t,n),g(n,r),r.checked=e[0],g(n,i),g(t,s),g(t,o),g(t,a),g(t,l),g(t,c),g(t,u),ee(h,t,null),d=!0,f||(p=k(r,"change",e[12]),f=!0)},p(e,t){1&t&&(r.checked=e[0])},i(e){d||(Y(h.$$.fragment,e),d=!0)},o(e){H(h.$$.fragment,e),d=!1},d(e){e&&b(t),te(h),f=!1,p()}}}function ha(e){let t,n=[],r=new Map,i=e[6];const s=e=>e[18].id;for(let t=0;t<i.length;t+=1){let o=aa(e,i,t),a=s(o);r.set(a,n[t]=da(a,o))}return{c(){for(let e=0;e<n.length;e+=1)n[e].c();t=_()},m(e,r){for(let t=0;t<n.length;t+=1)n[t].m(e,r);y(e,t,r)},p(e,o){578&o&&(i=e[6],n=function(e,t,n,r,i,s,o,a,l,c,u,h){let d=e.length,f=s.length,p=d;const m={};for(;p--;)m[e[p].key]=p;const g=[],y=new Map,b=new Map;for(p=f;p--;){const e=h(i,s,p),a=n(e);let l=o.get(a);l?r&&l.p(e,t):(l=c(a,e),l.c()),y.set(a,g[p]=l),a in m&&b.set(a,Math.abs(p-m[a]))}const v=new Set,w=new Set;function x(e){Y(e,1),e.m(a,u),o.set(e.key,e),u=e.first,f--}for(;d&&f;){const t=g[f-1],n=e[d-1],r=t.key,i=n.key;t===n?(u=t.first,d--,f--):y.has(i)?!o.has(r)||v.has(r)?x(t):w.has(i)?d--:b.get(r)>b.get(i)?(w.add(r),x(t)):(v.add(i),d--):(l(n,o),d--)}for(;d--;){const t=e[d];y.has(t.key)||l(t,o)}for(;f;)x(g[f-1]);return g}(n,o,s,1,e,i,r,t.parentNode,Q,da,t,aa))},d(e){for(let t=0;t<n.length;t+=1)n[t].d(e);e&&b(t)}}}function da(e,t){let n,i,s,o,a,c,u,h,d,f,p,m=t[18].meta.author+" - "+t[18].meta.title;function _(...e){return t[14](t[18],...e)}function N(){return t[15](t[18])}return{key:e,first:null,c(){n=v("div"),i=v("button"),i.textContent="Delete book",s=x(),o=v("img"),c=x(),u=v("p"),h=w(m),d=x(),E(i,"class","deleteBtn svelte-ft5tu3"),l(o.src,a=void 0!==t[18].meta.cover?URL.createObjectURL(t[18].meta.cover):"")||E(o,"src",a),E(o,"alt","cover"),E(o,"class","svelte-ft5tu3"),E(u,"class","svelte-ft5tu3"),E(n,"class","book svelte-ft5tu3"),this.first=n},m(e,t){y(e,n,t),g(n,i),g(n,s),g(n,o),g(n,c),g(n,u),g(u,h),g(n,d),f||(p=[k(i,"click",_),k(n,"click",N)],f=!0)},p(e,n){t=e,64&n&&!l(o.src,a=void 0!==t[18].meta.cover?URL.createObjectURL(t[18].meta.cover):"")&&E(o,"src",a),64&n&&m!==(m=t[18].meta.author+" - "+t[18].meta.title)&&A(h,m)},d(e){e&&b(n),f=!1,r(p)}}}function fa(e){let t,n,r,i,s=e[4]?"+":"Drop anywhere or click to select a file";return{c(){t=v("h1"),t.textContent="📚",n=x(),r=v("h2"),i=w(s),E(t,"class","svelte-ft5tu3"),E(r,"class","svelte-ft5tu3")},m(e,s){y(e,t,s),y(e,n,s),y(e,r,s),g(r,i)},p(e,t){16&t&&s!==(s=e[4]?"+":"Drop anywhere or click to select a file")&&A(i,s)},d(e){e&&b(t),e&&b(n),e&&b(r)}}}function pa(t){let n,r,i;return{c(){n=v("h1"),n.textContent="📚",r=x(),i=v("h2"),i.textContent="...",E(n,"class","svelte-ft5tu3"),E(i,"class","svelte-ft5tu3")},m(e,t){y(e,n,t),y(e,r,t),y(e,i,t)},p:e,d(e){e&&b(n),e&&b(r),e&&b(i)}}}function ma(e){let t,n,r=e[3]?"Loading":"Drop anywhere or click to select a file";return{c(){t=v("p"),n=w(r),O(t,"color",e[2]?"#87CEFA":"inherit"),E(t,"class","svelte-ft5tu3")},m(e,r){y(e,t,r),g(t,n)},p(e,i){8&i&&r!==(r=e[3]?"Loading":"Drop anywhere or click to select a file")&&A(n,r),4&i&&O(t,"color",e[2]?"#87CEFA":"inherit")},d(e){e&&b(t)}}}function ga(e){let t,n,r,i,s,o,a,l,c,u,h,d,f,p,w,_;function A(t){e[13](t)}t=new Lo({props:{$$slots:{rightbar:[ca],toptext:[la]},$$scope:{ctx:e}}});let N={top:"3.1em",right:"1%",$$slots:{default:[ua]},$$scope:{ctx:e}};void 0!==e[5]&&(N.visible=e[5]),r=new Wo({props:N}),B.push((()=>J(r,"visible",A)));let $=e[6]&&ha(e);function P(e,t){return e[3]?pa:fa}let S=P(e),C=S(e),T=e[4]&&ma(e);return{c(){Z(t.$$.fragment),n=x(),Z(r.$$.fragment),s=x(),o=v("div"),$&&$.c(),a=x(),l=v("div"),c=v("div"),C.c(),h=x(),T&&T.c(),E(c,"id","dropInfo"),E(c,"class",u=m(e[3]?"loading":"")+" svelte-ft5tu3"),O(c,"max-width",e[4]?"":"100% "),O(c,"background-color",e[2]?" #87CEFA":""),E(l,"class","book svelte-ft5tu3"),E(l,"style",d=e[4]?"":"max-width: 80em   "),E(o,"id","parent"),E(o,"style",f=e[4]?"":"justify-content: center"),E(o,"class","svelte-ft5tu3")},m(i,u){ee(t,i,u),y(i,n,u),ee(r,i,u),y(i,s,u),y(i,o,u),$&&$.m(o,null),g(o,a),g(o,l),g(l,c),C.m(c,null),g(l,h),T&&T.m(l,null),p=!0,w||(_=k(l,"click",e[16]),w=!0)},p(e,[n]){const s={};2097184&n&&(s.$$scope={dirty:n,ctx:e}),t.$set(s);const h={};2097153&n&&(h.$$scope={dirty:n,ctx:e}),!i&&32&n&&(i=!0,h.visible=e[5],R((()=>i=!1))),r.$set(h),e[6]?$?$.p(e,n):($=ha(e),$.c(),$.m(o,a)):$&&($.d(1),$=null),S===(S=P(e))&&C?C.p(e,n):(C.d(1),C=S(e),C&&(C.c(),C.m(c,null))),(!p||8&n&&u!==(u=m(e[3]?"loading":"")+" svelte-ft5tu3"))&&E(c,"class",u),(!p||16&n)&&O(c,"max-width",e[4]?"":"100% "),(!p||4&n)&&O(c,"background-color",e[2]?" #87CEFA":""),e[4]?T?T.p(e,n):(T=ma(e),T.c(),T.m(l,null)):T&&(T.d(1),T=null),(!p||16&n&&d!==(d=e[4]?"":"max-width: 80em   "))&&E(l,"style",d),(!p||16&n&&f!==(f=e[4]?"":"justify-content: center"))&&E(o,"style",f)},i(e){p||(Y(t.$$.fragment,e),Y(r.$$.fragment,e),p=!0)},o(e){H(t.$$.fragment,e),H(r.$$.fragment,e),p=!1},d(e){te(t,e),e&&b(n),te(r,e),e&&b(s),e&&b(o),$&&$.d(),C.d(),T&&T.d(),w=!1,_()}}}function ya(e,t,n){let r,{readFiles:i=(e=>{})}=t,{openExisting:s=(e=>{})}=t,{dragging:o}=t,{saveBooksOn:a}=t,{loading:l}=t,u=ii((()=>ci.books.toArray()));c(e,u,(e=>n(6,r=e)));let h=!1,d=!1;const f=()=>{let e=document.createElement("input");e.type="file",e.onchange=e=>{i(e.target.files[0])},e.click()};async function p(e){await ci.books.delete(e)}!async function(){if(a){const e=await ci.books.count().catch((()=>n(0,a=!1)));n(4,h=e>0)}}();return e.$$set=e=>{"readFiles"in e&&n(10,i=e.readFiles),"openExisting"in e&&n(1,s=e.openExisting),"dragging"in e&&n(2,o=e.dragging),"saveBooksOn"in e&&n(0,a=e.saveBooksOn),"loading"in e&&n(3,l=e.loading)},[a,s,o,l,h,d,r,u,f,p,i,()=>n(5,d=!d),function(){a=this.checked,n(0,a)},function(e){d=e,n(5,d)},(e,t)=>{t.stopPropagation(),p(e.id)},e=>s(e.id),()=>f()]}class ba extends ie{constructor(e){super(),re(this,e,ya,ga,s,{readFiles:10,openExisting:1,dragging:2,saveBooksOn:0,loading:3})}}function va(e){let t,n,r,i;function s(t){e[8](t)}function o(t){e[9](t)}let a={readFiles:e[5],openExisting:e[6],dragging:e[3]};return void 0!==e[0]&&(a.saveBooksOn=e[0]),void 0!==e[4]&&(a.loading=e[4]),t=new ba({props:a}),B.push((()=>J(t,"saveBooksOn",s))),B.push((()=>J(t,"loading",o))),{c(){Z(t.$$.fragment)},m(e,n){ee(t,e,n),i=!0},p(e,i){const s={};8&i&&(s.dragging=e[3]),!n&&1&i&&(n=!0,s.saveBooksOn=e[0],R((()=>n=!1))),!r&&16&i&&(r=!0,s.loading=e[4],R((()=>r=!1))),t.$set(s)},i(e){i||(Y(t.$$.fragment,e),i=!0)},o(e){H(t.$$.fragment,e),i=!1},d(e){te(t,e)}}}function wa(e){let t,n,r;function i(t){e[7](t)}let s={currentBook:e[1]};return void 0!==e[2]&&(s.reading=e[2]),t=new oa({props:s}),B.push((()=>J(t,"reading",i))),{c(){Z(t.$$.fragment)},m(e,n){ee(t,e,n),r=!0},p(e,r){const i={};2&r&&(i.currentBook=e[1]),!n&&4&r&&(n=!0,i.reading=e[2],R((()=>n=!1))),t.$set(i)},i(e){r||(Y(t.$$.fragment,e),r=!0)},o(e){H(t.$$.fragment,e),r=!1},d(e){te(t,e)}}}function xa(e){let t,n,r,i;const s=[wa,va],o=[];function a(e,t){return e[2]?0:1}return n=a(e),r=o[n]=s[n](e),{c(){t=v("main"),r.c()},m(e,r){y(e,t,r),o[n].m(t,null),i=!0},p(e,[i]){let l=n;n=a(e),n===l?o[n].p(e,i):(W(),H(o[l],1,1,(()=>{o[l]=null})),X(),r=o[n],r?r.p(e,i):(r=o[n]=s[n](e),r.c()),Y(r,1),r.m(t,null))},i(e){i||(Y(r),i=!0)},o(e){H(r),i=!1},d(e){e&&b(t),o[n].d()}}}function _a(e,t,n){let r,i=!1,s=!1,o=!1;const a=async e=>{try{n(4,o=!0);const t=await Po(e);if(l&&e.size<3e7){const e=await(async e=>{for(let t of await ci.books.toArray())if(t.meta.title===e.meta.title)return t.id;try{return await ci.books.add(e)}catch(e){console.log(e)}})(t);c(t,e)}else c(t);n(4,o=!1)}catch(e){alert(e)}};let l;l=null===localStorage.getItem("saveBooksOn")||JSON.parse(localStorage.getItem("saveBooksOn"));window.addEventListener("dragenter",(e=>{e.dataTransfer.types.includes("Files")&&n(3,s=!0)})),window.addEventListener("dragleave",(e=>{n(3,s=!1),e.preventDefault()}));const c=(e,t)=>{n(1,r=(e=>{let t=[];for(const n of e.contents)t.push(To(n,e.files.images));let n=e.files.styles;for(let t=0;t<n.length;t++)n[t].css=So(n[t].css,e.files.images,e.files.fonts);return{meta:e.meta,contents:t,files:e.files}})(e)),n(2,i=!0),location.hash=t?t.toString():""},u=e=>{ci.transaction("r",ci.books,(async()=>{let t=await ci.books.get(e);t&&c(t,t.id)}))};var h;return h=()=>{""!==location.hash&&u(parseInt(location.hash.substring(1)))},C().$$.on_mount.push(h),window.onhashchange=()=>{l&&i&&""===location.hash?(document.title="Essence Reader",n(2,i=!1)):l&&!i&&""!==location.hash&&u(parseInt(location.hash.substring(1)))},window.addEventListener("dragover",(e=>e.preventDefault())),window.addEventListener("drop",(e=>{e.preventDefault(),n(3,s=!1),a(e.dataTransfer.files[0])})),e.$$.update=()=>{1&e.$$.dirty&&localStorage.setItem("saveBooksOn",JSON.stringify(l))},[l,r,i,s,o,a,u,function(e){i=e,n(2,i)},function(e){l=e,n(0,l)},function(e){o=e,n(4,o)}]}return new class extends ie{constructor(e){super(),re(this,e,_a,xa,s,{})}}({target:document.body})}();
